/* This file was generated by the Hex-Rays decompiler version 8.3.0.230608.
   Copyright (c) 2007-2021 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <math.h>
#include <defs.h>

#include <stdarg.h>


//-------------------------------------------------------------------------
// Function declarations

#define __thiscall __cdecl // Test compile in C mode

// void __cdecl __vcrt_trace_logging_provider::TraceLoggingUnregister(__vcrt_trace_logging_provider *__hidden this, const struct _TlgProvider_t *); idb
void *sub_40125F();
int sub_401269();
int sub_401275();
bool sub_401280();
int sub_40128A();
int *sub_4012A0();
int sub_4012AA();
int sub_4012C0();
int sub_4012D6();
bool __stdcall sub_4012F0(HWND a1, const WCHAR *a2, LPWSTR pszPath);
BOOL __stdcall sub_40136D(HWND hDlg, int nIDDlgItem, unsigned __int8 a3);
BOOL __stdcall sub_40138B(HWND hDlg, int nIDDlgItem, char a3);
char __stdcall sub_4013B0(HWND hWnd, int a2, int a3, int a4, LPCWCH lpWideCharStr, int a6, char a7);
int __thiscall sub_4013F0(int this);
wchar_t *__thiscall sub_401472(_DWORD *this, wchar_t *a2);
char __stdcall sub_40147D(wchar_t *a1, char a2, wchar_t *a3, int a4, int a5);
bool __thiscall sub_40157C(int this, wchar_t *a2, char a3, int a4, char a5);
void __thiscall sub_4015D6(int this);
int __thiscall sub_401643(wchar_t *this, int a2, bool *a3, int a4, wchar_t *Destination, int a6);
void __thiscall sub_401708(int this);
void *__thiscall sub_401725(void *this);
unsigned int __stdcall sub_401773(unsigned int a1, _DWORD *a2, unsigned int a3);
void __stdcall sub_401859(int a1);
void __stdcall sub_40188E(int a1, int a2);
void __stdcall sub_4018B9(int a1, int a2, int a3);
int __thiscall sub_401901(_DWORD *this, int a2);
char __stdcall sub_40191C(int a1);
bool __thiscall sub_401921(_BYTE *this, int ArgList, int a3);
void __thiscall sub_401947(_BYTE *this, int a2);
int __thiscall sub_401968(_DWORD *this, int a2, int a3);
int __stdcall sub_401987(int pExceptionObject); // idb
void sub_40198C(int a1, char *Format, ...);
void __thiscall sub_4019C4(_DWORD *this);
int __thiscall sub_4019D7(_DWORD *this);
int __thiscall sub_4019EC(_DWORD *this, int a2, int a3);
int __thiscall sub_401A0B(_DWORD *this, int a2);
void __thiscall sub_401A19(_DWORD *this, int a2);
int __thiscall sub_401A34(_DWORD *this, int a2, int a3);
int __thiscall sub_401A53(_DWORD *this, int a2);
void __thiscall sub_401A61(_BYTE *this, int a2);
int __thiscall sub_401A82(_DWORD *this, int a2);
void __thiscall sub_401ACA(int this, int pExceptionObject);
int __stdcall sub_401AFC(int a1, int a2);
void __thiscall sub_401B1A(_DWORD *this, int a2, int a3);
int __thiscall sub_401B37(_DWORD *this, int a2, int a3);
void __stdcall sub_401B56(int a1);
void *sub_401B78();
// int __cdecl _vsprintf_s_l(char *const Buffer, const size_t BufferCount, const char *const Format, const _locale_t Locale, va_list ArgList);
_DWORD *__thiscall sub_401BAB(_DWORD *this);
bool __thiscall sub_401BE1(_DWORD *this);
int __thiscall sub_401C2B(_DWORD *this);
_DWORD *__thiscall sub_401C62(_DWORD *Block, char a2);
bool __thiscall sub_401C84(int this);
BOOL __thiscall sub_401CD2(int this, wchar_t *lpFileName, int a3);
bool __thiscall sub_401DCE(int this);
DWORD __thiscall sub_401DF7(int this, LPVOID lpBuffer, DWORD nNumberOfBytesToRead);
__int64 __thiscall sub_401E8E(int *this);
bool __thiscall sub_401EE4(HANDLE *this);
bool __thiscall sub_401F07(int this, WCHAR *lpFileName, char a3);
bool __thiscall sub_402032(int *this, __int64 lDistanceToMove, DWORD DistanceToMoveHigh);
DWORD __thiscall sub_4020A8(_BYTE *this, LPVOID lpBuffer, DWORD nNumberOfBytesToRead);
void __thiscall sub_40217B(int this, __int64 lDistanceToMove, DWORD DistanceToMoveHigh);
_DWORD __stdcall nullsub_1(_DWORD, _DWORD); // weak
BOOL __thiscall sub_4021AD(int this, int *a2, int *a3, int *a4);
int __thiscall sub_402286(int this);
BOOL __thiscall sub_402305(HANDLE *this);
// char __userpurge sub_402315@<al>(int *a1@<ecx>, char *lpBuffer, DWORD NumberOfBytesWritten, unsigned int a4);
_DWORD *__thiscall sub_40241E(_DWORD *this);
bool __stdcall sub_402447(wchar_t *Source, char a2);
bool __stdcall sub_402525(WCHAR *lpFileName);
bool __stdcall sub_402578(WCHAR *lpFileName);
DWORD __stdcall sub_40258C(WCHAR *lpFileName);
BOOL __stdcall sub_4025DA(char a1);
BOOL __stdcall sub_4025E8(int a1);
int __stdcall sub_402600(unsigned int a1);
int __stdcall sub_40260D(wchar_t *lpPathName, char a2, DWORD dwFileAttributes);
bool __stdcall sub_4026A3(WCHAR *lpFileName);
char __stdcall sub_4026B1(WCHAR *lpFileName, int *a2, int *a3, int *a4);
bool __stdcall sub_40284A(WCHAR *lpFileName, DWORD dwFileAttributes);
_DWORD *__thiscall sub_4028A3(_DWORD *this);
HANDLE __thiscall sub_4028B9(HANDLE *this);
char __stdcall sub_4028CC(wchar_t *String, wchar_t *Destination, int a3);
char __thiscall sub_402930(WCHAR *lpFileName, wchar_t *String, int a3);
wchar_t *__thiscall sub_4029DD(wchar_t *Destination, wchar_t *Source);
int __stdcall sub_4029F7(HANDLE hFindFile, WCHAR *lpFileName, wchar_t *Destination);
int sub_402B7C();
char __stdcall sub_402BEC(wchar_t *String, wchar_t *String2, int a3);
bool __stdcall sub_402D79(unsigned __int16 *a1, wchar_t *Str, char a3);
int __stdcall sub_402EAA(wchar_t *String1, wchar_t *String2, char a3); // idb
int __stdcall sub_402ECB(wchar_t *String1, wchar_t *String2, size_t MaxCount, char a4); // idb
LPWSTR __stdcall sub_402EF0(LPWSTR lpsz, char a2);
char *__thiscall sub_402F09(char *this);
// int __thiscall unknown_libname_1(_DWORD, _DWORD); weak
int __thiscall sub_402F92(void *this); // idb
wchar_t *__stdcall sub_402FFE(wchar_t *String, unsigned int a2);
void __stdcall sub_40302E(WCHAR *lpFileName, wchar_t *Destination, int a3);
wchar_t *__stdcall sub_4030FA(wchar_t *a1, wchar_t *Destination);
wchar_t *__stdcall sub_403251(WCHAR *lpSrcStr, int a2);
wchar_t *__stdcall sub_4032A5(wchar_t *String);
void __stdcall sub_4032C6(wchar_t *Source, wchar_t *Destination, int a3);
wchar_t *__stdcall sub_403309(wchar_t *String, wchar_t *Destination, size_t BufferCount);
wchar_t *__stdcall sub_403396(LPCCH lpMultiByteStr, wchar_t *Source, wchar_t *Destination, size_t Count);
char __stdcall sub_4033EC(wchar_t *Source, wchar_t *Destination, unsigned int a3);
BOOL __stdcall sub_403593(unsigned __int16 *a1);
BOOL __stdcall sub_4035BF(unsigned __int16 *a1);
BOOL __stdcall sub_4035F5(int a1);
BOOL __stdcall sub_40360D(wchar_t *String);
wchar_t *__stdcall sub_403631(wchar_t *a1, wchar_t *Source, wchar_t *Destination, int a4);
wchar_t *__stdcall sub_40368A(wchar_t *String);
wchar_t *__stdcall sub_4036A6(wchar_t *String);
wchar_t *__stdcall sub_4036E9(wchar_t *String);
void __stdcall sub_403715(wchar_t *String, wchar_t *Source, int a3);
wchar_t *__stdcall sub_40375A(wchar_t *String, wchar_t *Source, int a3);
int __stdcall sub_40377F(unsigned __int16 *a1, int a2, int a3);
int sub_4037C1(char *Buffer, size_t BufferCount, char *Format, ...);
_DWORD *__thiscall sub_4037DD(_DWORD *this);
char __thiscall sub_4037F3(__int16 **this, LPCWCH lpWideCharStr, _DWORD *a3, _DWORD *a4);
void __thiscall sub_403884(__int16 **this, wchar_t *Source, wchar_t *Str, int a4, int a5, LPCWCH lpWideCharStr);
char __thiscall sub_403A07(int this, wchar_t *Str);
char __thiscall sub_403A2C(WCHAR **this, wchar_t *Str);
BOOL __thiscall sub_403D29(_DWORD *this);
__int16 *__thiscall sub_403D31(__int16 **this, int a2);
char __thiscall sub_403D9C(int this);
void __thiscall sub_403E04(_BYTE *this, HWND hWnd);
HWND __thiscall sub_403E2E(__int16 **this, HWND hWnd, LPCWCH lpWideCharStr, char a4);
WCHAR *__stdcall sub_4040A7(UINT uID);
char *__thiscall sub_40411E(char *this);
int __thiscall sub_404152(_DWORD); // weak
_BYTE *__thiscall sub_404157(_BYTE *this);
_WORD *__thiscall sub_40416A(char *Src, _WORD *a2, int a3);
void __thiscall sub_4041A3(HMODULE *this);
DWORD __thiscall sub_4041E1(char *this, void *Src, unsigned int a3, void *a4, unsigned int a5, char a6);
DWORD __stdcall sub_404222(int a1, unsigned int a2, char a3, char a4);
void *__thiscall sub_4042D3(char *this, wchar_t *String);
_BYTE *__stdcall sub_40431E(_BYTE *a1, int a2);
char __stdcall sub_404336(unsigned __int8 *lpszSrc, LPWSTR lpWideCharStr, int cchWideChar, int a4);
unsigned __int16 *__stdcall sub_40439F(unsigned __int16 *a1, int a2, int a3);
BOOL __stdcall sub_404453(LPCSTR lpszSrc, LPSTR lpszDst, DWORD cchDstLength);
BOOL __stdcall sub_404484(int a1);
BOOL __stdcall sub_404496(int a1);
char __stdcall sub_4044AE(char *a1);
LPWSTR __stdcall sub_4044CC(unsigned __int16 a1);
int __stdcall sub_4044E8(__int64 a1, int a2, int a3);
int __stdcall sub_404597(PCNZWCH lpString1, PCNZWCH lpString2); // idb
wchar_t *__stdcall sub_40459C(wchar_t *String, wchar_t *Source, int a3);
wchar_t *__stdcall sub_4045C8(wchar_t *Destination, wchar_t *Source, int a3);
_DWORD *__thiscall sub_4045F5(_DWORD *this);
void __thiscall sub_404614(int this, int a2);
wchar_t *__thiscall sub_40468A(_DWORD *this, wchar_t *Source);
const wchar_t *__thiscall sub_4046C6(wchar_t *this);
char __thiscall sub_4046DA(_DWORD *this, const wchar_t **a2);
char __thiscall sub_404716(wchar_t *this, wchar_t *Destination, int a3);
void __thiscall sub_40473D(_DWORD *this);
void __thiscall sub_404753(_DWORD *this);
int sub_404758();
HMODULE __stdcall sub_4047AA(wchar_t *Source);
DWORD __stdcall sub_4047F4(char a1);
_DWORD *__thiscall sub_404D93(_DWORD *this, int *a2);
_DWORD *__thiscall sub_404DA6(int *this, _DWORD *a2);
int __thiscall sub_404DB7(DWORD *this, unsigned int a2);
int __thiscall sub_404E15(DWORD *this, int a2);
int __thiscall sub_404F14(_DWORD *this, int a2, int a3);
void __thiscall sub_404F24(int *this);
bool __stdcall sub_405184(int ArgList, int a2);
INT_PTR __stdcall sub_4051F3(int a1, wchar_t *Source, int a3, __int64 a4, int a5, int a6);
LRESULT __stdcall sub_405320(int a1, int a2, int a3, int a4, unsigned int a5, int a6, unsigned int a7, int a8);
char __stdcall sub_405344(int a1, wchar_t *Source, char *a3);
LRESULT sub_40535A();
char sub_40535F();
LRESULT __stdcall sub_405365(char a1, wchar_t *String);
int __stdcall sub_405381(char ArgList, int, int, char); // idb
bool __stdcall sub_405386(LPCCH lpMultiByteStr, LPWSTR lpWideCharStr, int cchWideChar);
bool __thiscall sub_4053BF(_BYTE *this);
char __stdcall sub_405401(unsigned __int8 *a1, _WORD *a2, int a3);
bool __stdcall sub_40557F(LPCWCH lpWideCharStr, LPSTR lpMultiByteStr, int cbMultiByte);
unsigned __int64 __stdcall sub_4055B7(unsigned __int16 *a1);
unsigned __int64 __stdcall sub_405639(unsigned __int16 *);
// LPWSTR __stdcall CharUpperW(LPWSTR lpsz);
int __stdcall sub_405644(PCNZWCH lpString1, PCNZWCH lpString2); // idb
int __stdcall sub_405666(PCNZWCH lpString1, PCNZWCH lpString2, unsigned int cchCount2);
_DWORD *__thiscall sub_4056C7(_DWORD *this, int a2);
_DWORD *__thiscall sub_4056E6(_DWORD *this);
void __thiscall sub_405737(int this, int a2);
void __thiscall sub_4057AD(int this, int a2);
void __thiscall sub_405825(_DWORD *this, unsigned int a2);
BOOL __stdcall sub_40583F(wchar_t *String);
void __stdcall sub_40587A(wchar_t *String, int a2, int a3);
int __thiscall sub_4058E0(int *this, int a2, int a3);
int __cdecl sub_405903(int a1, int a2, int a3, int a4, int a5, int a6, wchar_t *a7, int a8, int a9, int a10, int a11, int a12, int a13, int a14, int a15, int a16, int a17, int a18, int a19, int a20, int a21, int a22, int a23, int a24, int a25, int a26, int a27, int a28);
int __cdecl sub_405907(int a1, int a2, int a3, __int64 a4, int a5, wchar_t *Source, int a7, int a8, int a9, int a10, unsigned __int64 a11, int a12, int a13, int a14, int a15, int a16, unsigned __int64 a17, int a18, int a19, int a20, int a21, int a22, int a23, int a24, int a25);
int sub_40678B();
char __stdcall sub_406AF2(int a1, int a2, int a3, char *Destination, int a5);
char __stdcall sub_406B88(int a1, unsigned int a2, _WORD *a3);
char __stdcall sub_406C69(int a1, unsigned int a2, _DWORD *a3, _DWORD *a4, _DWORD *a5);
BOOL __stdcall sub_406D5A(_BYTE *a1);
BOOL __stdcall sub_406D7F(_BYTE *a1);
BOOL __stdcall sub_406DA4(_BYTE *a1);
BOOL __stdcall sub_406DC9(_BYTE *a1);
int __stdcall sub_406DEE(void *Src, size_t Size); // idb
int sub_406E2B();
BOOL __thiscall sub_406F10(unsigned int *this, int a2);
int __stdcall sub_406F37(int a1, _DWORD *a2, LPSTR lpMultiByteStr, int a4);
int __stdcall sub_406FF6(unsigned __int16 *a1);
char sub_407059();
int sub_40710E();
int __stdcall sub_40719B(size_t Size, int a2, _WORD *a3, int a4);
// char __userpurge sub_407345@<al>(char *a1, unsigned int a2, unsigned int a3);
unsigned __int64 __stdcall sub_40737D(unsigned __int8 *a1);
int __stdcall sub_407400(unsigned __int8 *a1);
int __stdcall sub_407425(unsigned __int16 *a1);
// int __usercall sub_407438@<eax>(int a1@<esi>);
int sub_4074AD();
size_t __stdcall sub_407568(char *a1, size_t Size);
int sub_407650();
int __stdcall sub_407786(__int64 a1);
int sub_407885();
int __stdcall sub_407917(int a1, int a2);
int __stdcall sub_407A70(size_t Size); // idb
int __stdcall sub_407A93(int *a1, unsigned int a2, unsigned int a3, int a4, int a5, _DWORD *a6, unsigned int *a7);
int __stdcall sub_407F34(int a1);
int __stdcall sub_407F58(int a1);
int __stdcall sub_4080E2(int *a1);
int __stdcall sub_408203(int a1, int a2, unsigned int a3, unsigned int a4);
int sub_408677();
int sub_408C6F();
int sub_408D79();
int sub_408DA9();
int sub_408F82();
int sub_408FD2();
int __stdcall sub_4090EA(__int64 a1);
int __stdcall sub_40936D(__int64 a1);
void sub_409723();
int __stdcall sub_40976E(int a1, unsigned int a2, char a3);
// int __usercall sub_4098F0@<eax>(int a1@<esi>);
int sub_409B5E();
int sub_409CD5();
int sub_409E11();
int __stdcall sub_409E36(__int64 a1, void *Buf2, int a3);
int sub_40A0A6();
int sub_40A0E3();
int sub_40A2C7();
int sub_40A2DA();
char __stdcall sub_40A2F8(char *a1);
int __stdcall sub_40A33B(void *Src, char *a2);
int __stdcall sub_40A3EC(int a1);
int sub_40A446();
int __stdcall sub_40A539(unsigned int a1);
char __stdcall sub_40A581(unsigned __int8 *a1, int a2);
bool __stdcall sub_40A5A9(char a1, unsigned __int8 a2);
bool __stdcall sub_40A5D3(wchar_t *String, int a2, int a3, int a4, _DWORD *a5);
_DWORD *__thiscall sub_40A65B(_DWORD *this);
_DWORD *__thiscall sub_40A6A2(_DWORD *this);
int __thiscall sub_40A6C5(_DWORD *this);
int __thiscall sub_40A722(_DWORD *this);
int __stdcall sub_40A776(int a1);
int __stdcall sub_40A784(int a1);
int __stdcall sub_40A78E(int a1);
int __stdcall sub_40A798(int a1);
BOOL __thiscall sub_40A7AC(HWND *this);
int __stdcall sub_40A7C4(int a1, int a2);
int __stdcall sub_40A7CE(int a1, int a2);
int __stdcall sub_40A7D8(int a1, int a2, _DWORD *a3);
int __stdcall sub_40A7E5(int a1, int a2);
int __stdcall sub_40A7ED(int a1, _DWORD *a2);
int __stdcall sub_40A7FA(int a1, _DWORD *a2);
int __stdcall sub_40A814(int a1, int a2, int a3, int a4, int a5, _DWORD *a6);
int __stdcall sub_40A823(int a1, int a2, int a3);
int __stdcall sub_40A829(int a1, int a2, int a3, int a4);
int __stdcall sub_40A831(int a1, _DWORD *a2);
int __stdcall sub_40A855(int a1, _DWORD *a2);
int __stdcall sub_40A85F(int a1, _DWORD *a2, _DWORD *a3, RECT *lprcSrc, LPRECT lprcDst, _DWORD *a6);
int __stdcall sub_40A8D9(int a1, int a2, int a3, int a4, int a5, int a6, int a7, int a8, int a9);
char __stdcall sub_40A8E1(_WORD *a1);
BOOL __thiscall sub_40A918(int this, int a2, int a3);
void __thiscall sub_40AA67(int *this, wchar_t *String);
// void __userpurge sub_40ABAF(int a1@<ecx>, int a2@<ebx>, int a3);
int __stdcall sub_40AC6B(int a1);
wchar_t *__stdcall sub_40AC70(wchar_t *String);
int __stdcall sub_40AD88(int a1, void *Buf1, _DWORD *a3);
int __stdcall sub_40AE6F(int a1, void *a2, _DWORD *a3);
int __stdcall sub_40AE79(int a1, void *a2, _DWORD *a3);
int __stdcall sub_40AE83(int a1, void *a2, _DWORD *a3);
ATOM __thiscall sub_40AE97(HINSTANCE *this, HINSTANCE a2);
int __stdcall sub_40AF00(_DWORD *Block);
int __stdcall sub_40AF25(int a1);
int __stdcall sub_40AF2F(int a1);
int __stdcall sub_40AF39(int a1);
WCHAR *__stdcall sub_40AF4D(wchar_t *String);
int __stdcall sub_40B115(int a1, int a2);
int __stdcall sub_40B11D(int a1);
int __stdcall sub_40B125(int a1, int a2, int a3, int a4);
int __stdcall sub_40B12A(int a1, int a2, int a3);
int __stdcall sub_40B132(int a1, int a2);
void __thiscall sub_40B137(LPVOID lpParam, HINSTANCE a2, HWND hWnd, int a4, int a5, char a6);
int __stdcall sub_40B242(int a1, int a2, int a3, int a4, int a5);
int __stdcall sub_40B248(int a1, int a2, int a3, int a4, int a5, int a6);
int __stdcall sub_40B24E(int a1, int a2, int a3);
int __stdcall sub_40B253(int a1, int a2, int a3, int a4);
int __stdcall sub_40B259(int a1, int a2, int a3, _DWORD *a4);
// LRESULT __userpurge sub_40B266@<eax>(int a1@<ebx>, HWND hWnd, UINT Msg, WPARAM wParam, LONG *lParam);
HRESULT __thiscall sub_40B2B5(LPVOID *this, LPCOLESTR lpsz);
void __thiscall sub_40B33C(int this);
int __thiscall sub_40B369(_DWORD *this);
void __thiscall sub_40B382(_DWORD *this);
void __thiscall sub_40B404(_DWORD *this, int a2);
// void __userpurge sub_40B44E(int a1@<ecx>, int a2@<ebx>, int a3@<esi>, int a4);
char __stdcall sub_40B4BF(char a1, int a2, int a3, int a4, int a5, int a6, int a7);
BOOL sub_40B599();
int __stdcall sub_40B5B8(int a1);
int __stdcall sub_40B5FB(int a1);
BOOL __stdcall sub_40B63E(LPWSTR lpBuffer, DWORD nBufferLength);
BOOL sub_40B655();
int __stdcall sub_40B680(HWND hWnd, LPCWSTR lpText, LPCWSTR lpCaption, UINT uType); // idb
// HBITMAP __userpurge sub_40B6A8@<eax>(int a1@<ebx>, int a2@<ebp>, int a3@<edi>, int a4@<esi>, HANDLE h, int wDest, int cy, char a8, int a9, int a10);
HBITMAP __stdcall sub_40B89F(HANDLE h, int wDest, int cy);
HWND __stdcall sub_40B97D(HWND hWnd);
BOOL __stdcall sub_40B9D8(LPCWSTR lpPathName);
HMODULE *__thiscall sub_40B9EB(HMODULE *this);
void sub_40BA31();
int __stdcall sub_40BAAA(_WORD *a1);
int sub_40BAFF();
_WORD *__stdcall sub_40BB98(_WORD *a1);
LPCWSTR sub_40BBAC(LPCWSTR a1, ...);
int __stdcall sub_40BBF0(__int64 a1, LPWSTR lpNumberStr, int cchNumber);
unsigned __int16 *__stdcall sub_40BC7B(unsigned __int16 *a1, _WORD *a2);
bool __stdcall sub_40BD46(int a1, WCHAR *lpFileName, WCHAR **a3, int *a4);
void __stdcall sub_40BE95(wchar_t *Destination, int a2);
INT_PTR __stdcall sub_40BF44(HWND hDlg, int a2, int a3, const WCHAR *lpString);
WCHAR *__stdcall sub_40BFEA(WCHAR *a1, WCHAR *a2, wchar_t *Destination, _BYTE *a4, _BYTE *a5, int a6);
bool __stdcall sub_40C0E2(LPWSTR pszPath, int csidl);
wchar_t *__stdcall sub_40C142(WCHAR **a1);
LRESULT sub_40C21C();
INT_PTR __stdcall DialogFunc(HWND hWnd, int a2, int a3, LPARAM a4);
void sub_40C371(int a1, char *Format, ...);
INT_PTR __stdcall sub_40C3C5(HWND hDlg, int a2, LPCVOID lpBaseAddress, HWND hWnd);
INT_PTR __stdcall sub_40CD67(HWND hDlg, int a2, int a3, wchar_t *a4);
unsigned __int16 *__stdcall sub_40D104(unsigned __int16 *a1);
wchar_t *__stdcall sub_40D230(wchar_t *Source, wchar_t *Destination);
WCHAR *__stdcall sub_40D273(HWND hWnd, WCHAR *a2, int a3);
wchar_t *__stdcall sub_40DEB7(wchar_t *Str, int a2);
LRESULT __stdcall sub_40DF38(char a1, LPARAM a2);
INT_PTR __stdcall sub_40E04A(HWND hDlg, int a2, int a3, WCHAR *lpString);
// HWND __userpurge sub_40E0DC@<eax>(int a1@<ebx>, char a2@<dil>, int a3@<esi>, HWND hWnd);
void __stdcall sub_40E1D2(HWND hWnd, wchar_t *String, char a3);
LRESULT __stdcall sub_40E404(HWND hWnd);
int __stdcall sub_40E463(HWND hWnd, wchar_t *Source); // idb
void __stdcall sub_40E533(BYTE *lpData);
unsigned __int16 *__stdcall sub_40E5C3(WCHAR *lpValue);
unsigned int __stdcall sub_40E622(unsigned int a1, unsigned int a2);
DWORD __stdcall sub_40E652(HANDLE hHandle);
INT_PTR __stdcall sub_40E693(LPARAM dwInitParam, int a2, __int64 a3, int a4, int a5);
LRESULT __stdcall sub_40E723(int a1, int a2, int a3, int a4, unsigned int a5, int a6, unsigned int a7, int a8);
char __stdcall sub_40E74E(int a1, LPCCH lpMultiByteStr, wchar_t *Source, char *a4);
LRESULT __stdcall sub_40E820(char a1, wchar_t *String);
BOOL __stdcall sub_40E87D(int ArgList, int a2, int a3, char a4);
int __stdcall WinMain(HINSTANCE hInstance, HINSTANCE hPrevInstance, LPSTR lpCmdLine, int nShowCmd);
void sub_40EF0C();
bool sub_40EF3F();
int sub_40EFBA();
SIZE_T __stdcall sub_40F017(unsigned int lpAddress, unsigned int a2);
char *__stdcall sub_40F089(_DWORD *a1, _DWORD *a2);
PDWORD __stdcall sub_40F10C(DWORD flNewProtect, PDWORD lpflOldProtect);
void sub_40F17C();
char sub_40F1B4();
int __stdcall sub_40F1FE(_DWORD *a1, char *a2);
_DWORD *__thiscall sub_40F4DD(_DWORD *Block, char a2);
void __cdecl sub_40F500(void *Block);
// int __cdecl atexit(void (__cdecl *)());
// void *__cdecl operator new(size_t Size); idb
// int __cdecl unknown_libname_4(_DWORD); weak
void __cdecl j_j_j___free_base(void *Block);
int sub_40FB57();
int sub_40FB5F();
void __cdecl j_j___free_base(void *Block);
int sub_40FEA8();
LPTOP_LEVEL_EXCEPTION_FILTER sub_41004A();
// LONG __stdcall __scrt_unhandled_exception_filter(struct _EXCEPTION_POINTERS *ExceptionInfo); idb
void sub_410097();
_DWORD _guard_check_icall_nop(); // weak
std::exception *__thiscall sub_41010B(std::exception *this, struct std::exception *a2);
_DWORD *__thiscall sub_410126(_DWORD *this);
std::exception *__thiscall sub_41013E(std::exception *this, struct std::exception *a2);
_DWORD *__thiscall sub_410159(_DWORD *this);
// _DWORD __thiscall std::exception::exception(std::exception *__hidden this, const struct std::exception *); idb
void __noreturn sub_4101AE(); // weak
void __noreturn sub_4101CB(); // weak
int __cdecl UserMathErrorFunction();
void sub_41029A();
void *sub_4102C7();
// int __scrt_initialize_default_local_stdio_options(void); weak
BOOL sub_4102EA();
void *sub_4102F6();
void *sub_4102FC();
void sub_410302();
void __cdecl sub_41032D(); // idb
// void *__cdecl memset(void *, int Val, size_t Size);
// void __stdcall __noreturn _CxxThrowException(void *pExceptionObject, _ThrowInfo *pThrowInfo);
// wchar_t *__cdecl wcschr(const wchar_t *Str, wchar_t Ch);
// wchar_t *__cdecl wcsrchr(const wchar_t *Str, wchar_t Ch);
// void *__cdecl memmove(void *, const void *Src, size_t Size);
// int __cdecl memcmp(const void *Buf1, const void *Buf2, size_t Size);
// __vcrt_bool __cdecl __vcrt_uninitialize(__vcrt_bool Terminating);
_DWORD sub_41328F(); // weak
std::exception *__thiscall sub_413550(std::exception *this, struct std::exception *a2);
_DWORD *__thiscall sub_41356B(_DWORD *this);
int __cdecl sub_413DC2(int a1, int a2);
_DWORD _guard_check_icall_nop(); // weak
// wchar_t *__cdecl wcscpy(wchar_t *Destination, const wchar_t *Source);
// size_t __cdecl wcslen(const wchar_t *String);
void __cdecl j___free_base(void *Block);
int __cdecl sub_414995(int a1, int a2, int *a3, unsigned int a4, int a5, struct __crt_locale_pointers *a6, int a7);
// _DWORD __cdecl __crt_stdio_output::is_wide_character_specifier<wchar_t>(_DWORD, _DWORD, __int16, _DWORD); weak
// _DWORD __stdcall unknown_libname_12(_DWORD, _DWORD, char); weak
// _DWORD __stdcall unknown_libname_13(_DWORD, _DWORD, _DWORD, char); weak
// _DWORD __cdecl __crt_stdio_output::write_multiple_characters<__crt_stdio_output::string_output_adapter<wchar_t>,char>(_DWORD, char, _DWORD, _DWORD); weak
// _DWORD __stdcall unknown_libname_15(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD); weak
// _LocaleUpdate *__thiscall _LocaleUpdate::_LocaleUpdate(_LocaleUpdate *__hidden this, struct __crt_locale_pointers *const); idb
// void __thiscall __crt_stdio_output::formatting_buffer::~formatting_buffer(__crt_stdio_output::formatting_buffer *__hidden this); idb
// _DWORD __stdcall unknown_libname_17(_DWORD, _DWORD); weak
// _DWORD __stdcall unknown_libname_18(_DWORD); weak
int __thiscall sub_415016(int this);
// int __thiscall unknown_libname_19(_DWORD); weak
char sub_415173();
// int unknown_libname_20(void); weak
char __thiscall sub_4151AD(int this);
char __thiscall sub_4151D6(_DWORD *this);
char __thiscall sub_415352(int this);
char __thiscall sub_4155AF(int this);
// int __cdecl __crt_stdio_output::to_integer_size(_DWORD); weak
// int __thiscall unknown_libname_21(_DWORD); weak
// int __thiscall unknown_libname_22(_DWORD); weak
// _DWORD __stdcall unknown_libname_23(_DWORD); weak
char __thiscall sub_4158A4(_DWORD *this, int a2, char a3);
// int __thiscall unknown_libname_24(_DWORD); weak
char __thiscall sub_415A62(_DWORD *this);
char __thiscall sub_415A81(_DWORD *this);
char __thiscall sub_415A99(_DWORD *this);
// _DWORD __stdcall unknown_libname_25(_DWORD, _DWORD); weak
// int __thiscall unknown_libname_26(_DWORD); weak
// _DWORD __stdcall unknown_libname_27(_DWORD); weak
// int __stdcall __crt_stdio_output::string_output_adapter<wchar_t>::write_string(void *Src, int, int, int); idb
int __cdecl sub_415CD2(int a1, int a2, int *a3, int a4, int a5, struct __crt_locale_pointers *a6, int a7);
// int __cdecl wcscmp(const wchar_t *String1, const wchar_t *String2);
// wchar_t *__cdecl wcsncpy(wchar_t *Destination, const wchar_t *Source, size_t Count);
// int __cdecl wcsncmp(const wchar_t *String1, const wchar_t *String2, size_t MaxCount);
// wchar_t *__cdecl wcspbrk(const wchar_t *String, const wchar_t *Control);
// wchar_t *__cdecl wcscat(wchar_t *Destination, const wchar_t *Source);
// size_t __cdecl strlen(const char *Str);
// void *__cdecl malloc(size_t Size);
// int __cdecl strncmp(const char *Str1, const char *Str2, size_t MaxCount);
// int __cdecl toupper(int C);
// wchar_t *__cdecl wcsncat(wchar_t *Destination, const wchar_t *Source, size_t Count);
// char *__cdecl strncpy(char *Destination, const char *Source, size_t Count);
// size_t __cdecl wcsnlen(const wchar_t *Source, size_t MaxCount);
// void *__cdecl realloc(void *Block, size_t Size);
// int __cdecl __crt_strtox::parse_integer<unsigned long,__crt_strtox::c_string_character_source<char>>(struct __crt_locale_pointers *, int, int, int, char); idb
int __cdecl sub_41710A(int a1);
int __cdecl sub_4174E4(int a1);
// int __cdecl unknown_libname_28(void *Block); idb
void *__cdecl sub_417A07(void **a1);
void *__cdecl sub_417A22(void **a1);
// int __dcrt_uninitialize_environments_nolock(void); weak
// _DWORD __stdcall __crt_seh_guarded_call<char *>::operator()<_lambda_0fef6fff2b5e6b53303c9058db11ae1f_,_lambda_082c17da81b0962e08c0587ee0fac50c_ &,_lambda_fa6e051aed0a38726081083cc7c328e9_>(_DWORD, _DWORD, _DWORD); weak
// _DWORD __stdcall __crt_seh_guarded_call<char *>::operator()<_lambda_0fef6fff2b5e6b53303c9058db11ae1f_,_lambda_082c17da81b0962e08c0587ee0fac50c_ &,_lambda_fa6e051aed0a38726081083cc7c328e9_>(_DWORD, _DWORD, _DWORD); weak
int __cdecl sub_417B1B(int a1, int a2);
int __cdecl sub_417B43(int a1, int a2);
int __cdecl sub_417DEB(_onexit_t Function); // idb
// int __cdecl _register_onexit_function(_onexit_table_t *Table, _onexit_t Function);
char sub_417E7F();
char sub_417EAB();
__vcrt_bool sub_417EF0();
char sub_417F70();
// _DWORD __stdcall unknown_libname_31(_DWORD); weak
int __cdecl sub_417FC8(int a1);
int sub_418073();
int __cdecl sub_418079(int a1);
int __cdecl sub_4180A1(int a1);
__int32 sub_418244();
int sub_418303();
// int __cdecl _set_new_mode(int NewMode);
void *sub_418338();
// void __cdecl _free_base(void *Block);
int __cdecl sub_418696(int a1);
// void __cdecl _invalid_parameter_noinfo();
// unsigned int *__cdecl __doserrno();
// int *__cdecl _errno();
// _DWORD __cdecl unknown_libname_33(_DWORD, _DWORD, _DWORD); weak
// _DWORD __stdcall __crt_seh_guarded_call<void>::operator()<_lambda_3518db117f0e7cdb002338c5d3c47b6c_,_lambda_b2ea41f6bbb362cd97d94c6828d90b61_ &,_lambda_abdedf541bb04549bc734292b4a045d4_>(_DWORD, _DWORD, _DWORD); weak
// _DWORD __stdcall __crt_seh_guarded_call<void>::operator()<_lambda_51b6e8b1eb166f2a3faf91f424b38130_,_lambda_6250bd4b2a391816dd638c3bf72b0bcb_ &,_lambda_0b5a4a3e68152e1d9b943535f5f47bed_>(_DWORD, _DWORD, _DWORD); weak
// _DWORD __stdcall __crt_seh_guarded_call<void>::operator()<_lambda_5b71d36f03204c0beab531769a5b5694_,_lambda_be2b3da3f62db62e9dad5dc70221a656_ &,_lambda_8f9ce462984622f9bf76b59e2aaaf805_>(_DWORD, _DWORD, _DWORD); weak
// _DWORD __stdcall __crt_seh_guarded_call<void>::operator()<_lambda_9df27f884b057bc3edfc946cb5b7cf47_,_lambda_e69574bed617af4e071282c136b37893_ &,_lambda_cc0d902bcbbeb830f749456577db4721_>(_DWORD, _DWORD, _DWORD); weak
int __cdecl sub_418AF8(int a1, int a2);
int __cdecl sub_418B20(int a1, int a2);
int __cdecl sub_418B48(int a1, int a2);
int __cdecl sub_418B70(int a1, int a2);
struct __crt_locale_data *__cdecl sub_418E75(int a1, struct __crt_locale_data **a2);
void *__cdecl sub_418EA2(int a1, void **a2);
// void *__cdecl _realloc_base(void *Block, size_t Size);
int __thiscall sub_41AA27(_DWORD **this, void *Block);
// int unknown_libname_36(void); weak
// _DWORD __stdcall __crt_seh_guarded_call<void>::operator()<_lambda_c76fdea48760d5f9368b465f31df4405_,_lambda_e378711a6f6581bf7f0efd7cdf97f5d9_ &,_lambda_e927a58b2a85c081d733e8c6192ae2d2_>(_DWORD, _DWORD, _DWORD); weak
int __cdecl sub_41AB31(int a1, int a2);
// int __acrt_update_thread_multibyte_data(void); weak
char *__cdecl sub_41B43E(void *Block, unsigned int a2, unsigned int a3);
char sub_41B4C7();
// _DWORD __stdcall __crt_seh_guarded_call<void (__cdecl *)(int)>::operator()<_lambda_a048d3beccc847880fc8490e18b82769_,_lambda_ec61778202f4f5fc7e7711acc23c3bca_ &,_lambda_f7496a158712204296dd6628a163878e_>(_DWORD, _DWORD, _DWORD); weak
int __cdecl sub_41B5FB(int a1, int a2);
// int __acrt_update_thread_locale_data(void); weak
int sub_41E257();
// _DWORD __cdecl common_flush_all(_DWORD); weak
// size_t __cdecl _msize(void *Block);
// _DWORD __stdcall __crt_seh_guarded_call<int>::operator()<_lambda_61cee617f5178ae960314fd4d05640a0_,_lambda_6978c1fb23f02e42e1d9e99668cc68aa_ &,_lambda_9cd88cf8ad10232537feb2133f08c833_>(_DWORD, _DWORD, _DWORD); weak
int __cdecl sub_41FA2B(int a1, int a2);
// _DWORD __stdcall __crt_seh_guarded_call<int>::operator()<_lambda_123407a5e2ac06da108355a851863b7a_,_lambda_2fe9b910cf3cbf4a0ab98a02ba45b3ec_ &,_lambda_ae55bdf541ad94d75914d381c370e64d_>(_DWORD, _DWORD, _DWORD); weak
int __cdecl sub_41FBB3(int a1, int a2);
int __cdecl sub_41FBDB(int a1);
int sub_420184();
// void __usercall sub_420424(char a1@<ch>, int a2@<ebp>);
// int _ffexpm1(void); weak
// int isintTOS(void); weak
// BOOL __stdcall IsProcessorFeaturePresent(DWORD ProcessorFeature);
void __cdecl sub_421F45(); // idb
void __cdecl sub_421F4F(); // idb
void __cdecl sub_421F59(); // idb
void __cdecl sub_421F63(); // idb
// void __usercall sub_421F6D(int a1@<esi>);

//-------------------------------------------------------------------------
// Data declarations

struct HINSTANCE__ _ImageBase = { 9460301 }; // idb
__int16 word_400006 = 0; // weak
__int16 word_40000C = -1; // weak
__int16 word_400014 = 0; // weak
__int16 word_400018 = 64; // weak
int *off_40003C = (int *)0x118; // weak
char byte_400040[216] =
{
  '\x0E',
  '\x1F',
  '\xBA',
  '\x0E',
  '\0',
  '\xB4',
  '\t',
  '\xCD',
  '!',
  '\xB8',
  '\x01',
  'L',
  '\xCD',
  '!',
  'T',
  'h',
  'i',
  's',
  ' ',
  'p',
  'r',
  'o',
  'g',
  'r',
  'a',
  'm',
  ' ',
  'c',
  'a',
  'n',
  'n',
  'o',
  't',
  ' ',
  'b',
  'e',
  ' ',
  'r',
  'u',
  'n',
  ' ',
  'i',
  'n',
  ' ',
  'D',
  'O',
  'S',
  ' ',
  'm',
  'o',
  'd',
  'e',
  '.',
  '\r',
  '\r',
  '\n',
  '$',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '+',
  '\x0F',
  '}',
  '\x9E',
  'o',
  'n',
  '\x13',
  '\xCD',
  'o',
  'n',
  '\x13',
  '\xCD',
  'o',
  'n',
  '\x13',
  '\xCD',
  '\xDB',
  '\xF2',
  '\xE2',
  '\xCD',
  'b',
  'n',
  '\x13',
  '\xCD',
  '\xDB',
  '\xF2',
  '\xE0',
  '\xCD',
  '\xE6',
  'n',
  '\x13',
  '\xCD',
  '\xDB',
  '\xF2',
  '\xE1',
  '\xCD',
  'w',
  'n',
  '\x13',
  '\xCD',
  '\f',
  '3',
  '\x10',
  '\xCC',
  'y',
  'n',
  '\x13',
  '\xCD',
  '\f',
  '3',
  '\x17',
  '\xCC',
  '|',
  'n',
  '\x13',
  '\xCD',
  '\f',
  '3',
  '\x16',
  '\xCC',
  'E',
  'n',
  '\x13',
  '\xCD',
  'f',
  '\x16',
  '\x90',
  '\xCD',
  'e',
  'n',
  '\x13',
  '\xCD',
  'f',
  '\x16',
  '€',
  '\xCD',
  'l',
  'n',
  '\x13',
  '\xCD',
  'o',
  'n',
  '\x12',
  '\xCD',
  '\x8B',
  'n',
  '\x13',
  '\xCD',
  '\x01',
  '3',
  '\x16',
  '\xCC',
  'M',
  'n',
  '\x13',
  '\xCD',
  '\x01',
  '3',
  '\x13',
  '\xCC',
  'n',
  'n',
  '\x13',
  '\xCD',
  '\x01',
  '3',
  '\xEC',
  '\xCD',
  'n',
  'n',
  '\x13',
  '\xCD',
  '\x01',
  '3',
  '\x11',
  '\xCC',
  'n',
  'n',
  '\x13',
  '\xCD',
  'R',
  'i',
  'c',
  'h',
  'o',
  'n',
  '\x13',
  '\xCD',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0',
  '\0'
}; // weak
_UNKNOWN loc_421F16; // weak
// extern DWORD (__stdcall *GetLastError)();
// extern void (__stdcall *SetLastError)(DWORD dwErrCode);
// extern DWORD (__stdcall *GetFileType)(HANDLE hFile);
// extern HANDLE (__stdcall *GetStdHandle)(DWORD nStdHandle);
// extern BOOL (__stdcall *WriteFile)(HANDLE hFile, LPCVOID lpBuffer, DWORD nNumberOfBytesToWrite, LPDWORD lpNumberOfBytesWritten, LPOVERLAPPED lpOverlapped);
// extern BOOL (__stdcall *ReadFile)(HANDLE hFile, LPVOID lpBuffer, DWORD nNumberOfBytesToRead, LPDWORD lpNumberOfBytesRead, LPOVERLAPPED lpOverlapped);
// extern BOOL (__stdcall *FlushFileBuffers)(HANDLE hFile);
// extern BOOL (__stdcall *SetEndOfFile)(HANDLE hFile);
// extern DWORD (__stdcall *SetFilePointer)(HANDLE hFile, LONG lDistanceToMove, PLONG lpDistanceToMoveHigh, DWORD dwMoveMethod);
// extern BOOL (__stdcall *SetFileTime)(HANDLE hFile, const FILETIME *lpCreationTime, const FILETIME *lpLastAccessTime, const FILETIME *lpLastWriteTime);
// extern BOOL (__stdcall *CloseHandle)(HANDLE hObject);
// extern HANDLE (__stdcall *CreateFileW)(LPCWSTR lpFileName, DWORD dwDesiredAccess, DWORD dwShareMode, LPSECURITY_ATTRIBUTES lpSecurityAttributes, DWORD dwCreationDisposition, DWORD dwFlagsAndAttributes, HANDLE hTemplateFile);
// extern BOOL (__stdcall *CreateDirectoryW)(LPCWSTR lpPathName, LPSECURITY_ATTRIBUTES lpSecurityAttributes);
// extern BOOL (__stdcall *SetFileAttributesW)(LPCWSTR lpFileName, DWORD dwFileAttributes);
// extern DWORD (__stdcall *GetFileAttributesW)(LPCWSTR lpFileName);
// extern BOOL (__stdcall *DeleteFileW)(LPCWSTR lpFileName);
// extern BOOL (__stdcall *MoveFileW)(LPCWSTR lpExistingFileName, LPCWSTR lpNewFileName);
// extern BOOL (__stdcall *FindClose)(HANDLE hFindFile);
// extern HANDLE (__stdcall *FindFirstFileW)(LPCWSTR lpFileName, LPWIN32_FIND_DATAW lpFindFileData);
// extern BOOL (__stdcall *FindNextFileW)(HANDLE hFindFile, LPWIN32_FIND_DATAW lpFindFileData);
// extern BOOL (__stdcall *GetVersionExW)(LPOSVERSIONINFOW lpVersionInformation);
// extern DWORD (__stdcall *GetCurrentDirectoryW)(DWORD nBufferLength, LPWSTR lpBuffer);
// extern DWORD (__stdcall *GetFullPathNameW)(LPCWSTR lpFileName, DWORD nBufferLength, LPWSTR lpBuffer, LPWSTR *lpFilePart);
// extern int (__stdcall *FoldStringW)(DWORD dwMapFlags, LPCWCH lpSrcStr, int cchSrc, LPWSTR lpDestStr, int cchDest);
// extern DWORD (__stdcall *GetModuleFileNameW)(HMODULE hModule, LPWSTR lpFilename, DWORD nSize);
// extern HMODULE (__stdcall *GetModuleHandleW)(LPCWSTR lpModuleName);
// extern HRSRC (__stdcall *FindResourceW)(HMODULE hModule, LPCWSTR lpName, LPCWSTR lpType);
// extern BOOL (__stdcall *FreeLibrary)(HMODULE hLibModule);
// extern FARPROC (__stdcall *GetProcAddress)(HMODULE hModule, LPCSTR lpProcName);
// extern DWORD (__stdcall *GetCurrentProcessId)();
// extern void (__stdcall __noreturn *ExitProcess)(UINT uExitCode);
// extern void (__stdcall *Sleep)(DWORD dwMilliseconds);
// extern HMODULE (__stdcall *LoadLibraryW)(LPCWSTR lpLibFileName);
// extern UINT (__stdcall *GetSystemDirectoryW)(LPWSTR lpBuffer, UINT uSize);
// extern int (__stdcall *CompareStringW)(LCID Locale, DWORD dwCmpFlags, PCNZWCH lpString1, int cchCount1, PCNZWCH lpString2, int cchCount2);
// extern BOOL (__stdcall *AllocConsole)();
// extern BOOL (__stdcall *FreeConsole)();
// extern BOOL (__stdcall *AttachConsole)(DWORD dwProcessId);
// extern BOOL (__stdcall *WriteConsoleW)(HANDLE hConsoleOutput, const void *lpBuffer, DWORD nNumberOfCharsToWrite, LPDWORD lpNumberOfCharsWritten, LPVOID lpReserved);
// extern BOOL (__stdcall *TzSpecificLocalTimeToSystemTime)(const TIME_ZONE_INFORMATION *lpTimeZoneInformation, const SYSTEMTIME *lpLocalTime, LPSYSTEMTIME lpUniversalTime);
// extern BOOL (__stdcall *SystemTimeToFileTime)(const SYSTEMTIME *lpSystemTime, LPFILETIME lpFileTime);
// extern BOOL (__stdcall *FileTimeToLocalFileTime)(const FILETIME *lpFileTime, LPFILETIME lpLocalFileTime);
// extern BOOL (__stdcall *LocalFileTimeToFileTime)(const FILETIME *lpLocalFileTime, LPFILETIME lpFileTime);
// extern BOOL (__stdcall *FileTimeToSystemTime)(const FILETIME *lpFileTime, LPSYSTEMTIME lpSystemTime);
// extern BOOL (__stdcall *GetCPInfo)(UINT CodePage, LPCPINFO lpCPInfo);
// extern BOOL (__stdcall *IsDBCSLeadByte)(BYTE TestChar);
// extern int (__stdcall *MultiByteToWideChar)(UINT CodePage, DWORD dwFlags, LPCCH lpMultiByteStr, int cbMultiByte, LPWSTR lpWideCharStr, int cchWideChar);
// extern int (__stdcall *WideCharToMultiByte)(UINT CodePage, DWORD dwFlags, LPCWCH lpWideCharStr, int cchWideChar, LPSTR lpMultiByteStr, int cbMultiByte, LPCCH lpDefaultChar, LPBOOL lpUsedDefaultChar);
// extern HGLOBAL (__stdcall *GlobalAlloc)(UINT uFlags, SIZE_T dwBytes);
// extern DWORD (__stdcall *GetTickCount)();
// extern BOOL (__stdcall *SetCurrentDirectoryW)(LPCWSTR lpPathName);
// extern BOOL (__stdcall *GetExitCodeProcess)(HANDLE hProcess, LPDWORD lpExitCode);
// extern DWORD (__stdcall *WaitForSingleObject)(HANDLE hHandle, DWORD dwMilliseconds);
// extern void (__stdcall *GetLocalTime)(LPSYSTEMTIME lpSystemTime);
// extern LPVOID (__stdcall *MapViewOfFile)(HANDLE hFileMappingObject, DWORD dwDesiredAccess, DWORD dwFileOffsetHigh, DWORD dwFileOffsetLow, SIZE_T dwNumberOfBytesToMap);
// extern BOOL (__stdcall *UnmapViewOfFile)(LPCVOID lpBaseAddress);
// extern HANDLE (__stdcall *CreateFileMappingW)(HANDLE hFile, LPSECURITY_ATTRIBUTES lpFileMappingAttributes, DWORD flProtect, DWORD dwMaximumSizeHigh, DWORD dwMaximumSizeLow, LPCWSTR lpName);
// extern HANDLE (__stdcall *OpenFileMappingW)(DWORD dwDesiredAccess, BOOL bInheritHandle, LPCWSTR lpName);
// extern LPWSTR (__stdcall *GetCommandLineW)();
// extern BOOL (__stdcall *SetEnvironmentVariableW)(LPCWSTR lpName, LPCWSTR lpValue);
// extern DWORD (__stdcall *ExpandEnvironmentStringsW)(LPCWSTR lpSrc, LPWSTR lpDst, DWORD nSize);
// extern DWORD (__stdcall *GetTempPathW)(DWORD nBufferLength, LPWSTR lpBuffer);
// extern BOOL (__stdcall *MoveFileExW)(LPCWSTR lpExistingFileName, LPCWSTR lpNewFileName, DWORD dwFlags);
// extern int (__stdcall *GetLocaleInfoW)(LCID Locale, LCTYPE LCType, LPWSTR lpLCData, int cchData);
// extern int (__stdcall *GetTimeFormatW)(LCID Locale, DWORD dwFlags, const SYSTEMTIME *lpTime, LPCWSTR lpFormat, LPWSTR lpTimeStr, int cchTime);
// extern int (__stdcall *GetDateFormatW)(LCID Locale, DWORD dwFlags, const SYSTEMTIME *lpDate, LPCWSTR lpFormat, LPWSTR lpDateStr, int cchDate);
// extern int (__stdcall *GetNumberFormatW)(LCID Locale, DWORD dwFlags, LPCWSTR lpValue, const NUMBERFMTW *lpFormat, LPWSTR lpNumberStr, int cchNumber);
// extern void (__stdcall *RaiseException)(DWORD dwExceptionCode, DWORD dwExceptionFlags, DWORD nNumberOfArguments, const ULONG_PTR *lpArguments);
// extern void (__stdcall *GetSystemInfo)(LPSYSTEM_INFO lpSystemInfo);
// extern BOOL (__stdcall *VirtualProtect)(LPVOID lpAddress, SIZE_T dwSize, DWORD flNewProtect, PDWORD lpflOldProtect);
// extern SIZE_T (__stdcall *VirtualQuery)(LPCVOID lpAddress, PMEMORY_BASIC_INFORMATION lpBuffer, SIZE_T dwLength);
// extern HMODULE (__stdcall *LoadLibraryExA)(LPCSTR lpLibFileName, HANDLE hFile, DWORD dwFlags);
// extern LPTOP_LEVEL_EXCEPTION_FILTER (__stdcall *SetUnhandledExceptionFilter)(LPTOP_LEVEL_EXCEPTION_FILTER lpTopLevelExceptionFilter);
// extern void (__stdcall *InitializeSListHead)(PSLIST_HEADER ListHead);
int (__thiscall *off_422254)(void *Block, char) = &sub_401C62; // weak
const wchar_t asc_422268[] = L"."; // idb
const char aR[2] = "r!"; // idb
_UNKNOWN unk_4222F4; // weak
const WCHAR String = 0u; // idb
_UNKNOWN unk_422B60; // weak
_UNKNOWN unk_422BA0; // weak
_UNKNOWN unk_422BE0; // weak
_UNKNOWN unk_422C00; // weak
_UNKNOWN unk_422C20; // weak
_UNKNOWN unk_422C60; // weak
_UNKNOWN unk_422C80; // weak
int dword_422CA0[19] = { 16, 17, 18, 0, 8, 7, 9, 6, 10, 5, 11, 4, 12, 3, 13, 2, 14, 1, 15 }; // weak
int (__stdcall *off_422CEC)(int, void *Buf1, int) = &sub_40AD88; // weak
int (__stdcall *off_422D10)(int, int, int) = &sub_40AE6F; // weak
int (__stdcall *off_422D4C)(int, int, int) = &sub_40AE79; // weak
void *off_422D88 = &loc_40AE8D; // weak
int (__stdcall *off_422DA4)(int, int, int) = &sub_40AE83; // weak
const IID stru_422FDC =
{
  3965634729u,
  50069u,
  17172u,
  { 156u, 119u, 84u, 215u, 169u, 53u, 255u, 112u }
}; // idb
const IID stru_42346C = { 136441u, 0u, 0u, { 192u, 0u, 0u, 0u, 0u, 0u, 0u, 70u } }; // idb
const IID Buf2 = { 0u, 0u, 0u, { 192u, 0u, 0u, 0u, 0u, 0u, 0u, 70u } }; // idb
_UNKNOWN unk_42349C; // weak
_UNKNOWN unk_4234AC; // weak
_UNKNOWN unk_4234BC; // weak
_UNKNOWN unk_4234CC; // weak
_UNKNOWN unk_4234DC; // weak
_UNKNOWN unk_4234EC; // weak
_UNKNOWN unk_4234FC; // weak
_UNKNOWN unk_42350C; // weak
_UNKNOWN unk_42351C; // weak
_UNKNOWN unk_42352C; // weak
const IID rclsid = { 136193u, 0u, 0u, { 192u, 0u, 0u, 0u, 0u, 0u, 0u, 70u } }; // idb
const IID stru_42354C = { 3402297954u, 37744u, 17941u, { 161u, 59u, 159u, 85u, 57u, 218u, 76u, 10u } }; // idb
_UNKNOWN unk_42355C; // weak
void *type_info::`vftable' = &sub_40F4DD; // weak
void *std::bad_alloc::`vftable' = &unknown_libname_10; // weak
void *std::bad_array_new_length::`vftable' = &unknown_libname_10; // weak
void *std::bad_exception::`vftable' = &unknown_libname_10; // weak
const _ThrowInfo _TI1_AW4RAR_EXIT__ = { 0u, NULL, NULL, &_CTA1_AW4RAR_EXIT__ }; // idb
const _ThrowInfo _TI2_AVbad_alloc_std__ = { 0u, &unknown_libname_5, NULL, &_CTA2_AVbad_alloc_std__ }; // idb
const _ThrowInfo _TI3_AVbad_array_new_length_std__ = { 0u, &unknown_libname_5, NULL, &_CTA3_AVbad_array_new_length_std__ }; // idb
int dword_42B000 = -1; // weak
int off_42B004 = 4334624; // idb
int dword_42B008[12] = { 0, 1, 3, 3, 8, 8, 8, 8, 8, 6, 7, 1 }; // weak
PCNZWCH off_42B038 = L"RarSFX"; // idb
NUMBERFMTW Format = { 0u, 0u, 3u, L".", NULL, 0u }; // idb
PCNZWCH lpString2 = L"Delete"; // idb
int dword_42B0B0 = 1; // weak
wchar_t *off_42B1D8 = L"         (((((                  H"; // weak
void *off_42B7C0 = &unk_42B5A0; // idb
int dword_42B820 = -2; // weak
// extern LSTATUS (__stdcall *RegCloseKey)(HKEY hKey);
// extern LSTATUS (__stdcall *RegSetValueExW)(HKEY hKey, LPCWSTR lpValueName, DWORD Reserved, DWORD dwType, const BYTE *lpData, DWORD cbData);
// extern LSTATUS (__stdcall *RegQueryValueExW)(HKEY hKey, LPCWSTR lpValueName, LPDWORD lpReserved, LPDWORD lpType, LPBYTE lpData, LPDWORD lpcbData);
// extern LSTATUS (__stdcall *RegOpenKeyExW)(HKEY hKey, LPCWSTR lpSubKey, DWORD ulOptions, REGSAM samDesired, PHKEY phkResult);
// extern LSTATUS (__stdcall *RegCreateKeyExW)(HKEY hKey, LPCWSTR lpSubKey, DWORD Reserved, LPWSTR lpClass, DWORD dwOptions, REGSAM samDesired, const LPSECURITY_ATTRIBUTES lpSecurityAttributes, PHKEY phkResult, LPDWORD lpdwDisposition);
// extern BOOL (__stdcall *InitCommonControlsEx)(const INITCOMMONCONTROLSEX *picce);
// extern BOOL (__stdcall *DeleteDC)(HDC hdc);
// extern HGDIOBJ (__stdcall *SelectObject)(HDC hdc, HGDIOBJ h);
// extern BOOL (__stdcall *StretchBlt)(HDC hdcDest, int xDest, int yDest, int wDest, int hDest, HDC hdcSrc, int xSrc, int ySrc, int wSrc, int hSrc, DWORD rop);
// extern HDC (__stdcall *CreateCompatibleDC)(HDC hdc);
// extern int (__stdcall *GetDeviceCaps)(HDC hdc, int index);
// extern BOOL (__stdcall *DeleteObject)(HGDIOBJ ho);
// extern HBITMAP (__stdcall *CreateCompatibleBitmap)(HDC hdc, int cx, int cy);
// extern int (__stdcall *GetObjectW)(HANDLE h, int c, LPVOID pv);
// extern HBITMAP (__stdcall *CreateDIBSection)(HDC hdc, const BITMAPINFO *pbmi, UINT usage, void **ppvBits, HANDLE hSection, DWORD offset);
// extern BOOL (__stdcall *SHGetPathFromIDListW)(LPCITEMIDLIST pidl, LPWSTR pszPath);
// extern LPITEMIDLIST (__stdcall *SHBrowseForFolderW)(LPBROWSEINFOW lpbi);
// extern int (__stdcall *SHFileOperationW)(LPSHFILEOPSTRUCTW lpFileOp);
// extern BOOL (__stdcall *ShellExecuteExW)(SHELLEXECUTEINFOW *pExecInfo);
// extern DWORD_PTR (__stdcall *SHGetFileInfoW)(LPCWSTR pszPath, DWORD dwFileAttributes, SHFILEINFOW *psfi, UINT cbFileInfo, UINT uFlags);
// extern void (__stdcall *SHChangeNotify)(LONG wEventId, UINT uFlags, LPCVOID dwItem1, LPCVOID dwItem2);
// extern HRESULT (__stdcall *SHGetMalloc)(IMalloc **ppMalloc);
// extern HRESULT (__stdcall *SHGetFolderLocation)(HWND hwnd, int csidl, HANDLE hToken, DWORD dwFlags, LPITEMIDLIST *ppidl);
// extern HRESULT (__stdcall *SHAutoComplete)(HWND hwndEdit, DWORD dwFlags);
// extern BOOL (__stdcall *UpdateWindow)(HWND hWnd);
// extern int (__stdcall *MapWindowPoints)(HWND hWndFrom, HWND hWndTo, LPPOINT lpPoints, UINT cPoints);
// extern BOOL (__stdcall *CopyRect)(LPRECT lprcDst, const RECT *lprcSrc);
// extern HWND (__stdcall *GetParent)(HWND hWnd);
// extern HCURSOR (__stdcall *LoadCursorW)(HINSTANCE hInstance, LPCWSTR lpCursorName);
// extern HDC (__stdcall *GetDC)(HWND hWnd);
// extern int (__stdcall *ReleaseDC)(HWND hWnd, HDC hDC);
// extern int (__stdcall *MessageBoxW)(HWND hWnd, LPCWSTR lpText, LPCWSTR lpCaption, UINT uType);
// extern HWND (__stdcall *FindWindowExW)(HWND hWndParent, HWND hWndChildAfter, LPCWSTR lpszClass, LPCWSTR lpszWindow);
// extern int (__stdcall *GetClassNameW)(HWND hWnd, LPWSTR lpClassName, int nMaxCount);
// extern int (__stdcall *wvsprintfW)(LPWSTR, LPCWSTR, va_list arglist);
// extern LRESULT (__stdcall *SendMessageW)(HWND hWnd, UINT Msg, WPARAM wParam, LPARAM lParam);
// extern BOOL (__stdcall *PostMessageW)(HWND hWnd, UINT Msg, WPARAM wParam, LPARAM lParam);
// extern DWORD (__stdcall *WaitForInputIdle)(HANDLE hProcess, DWORD dwMilliseconds);
// extern BOOL (__stdcall *SetWindowPos)(HWND hWnd, HWND hWndInsertAfter, int X, int Y, int cx, int cy, UINT uFlags);
// extern BOOL (__stdcall *IsWindow)(HWND hWnd);
// extern BOOL (__stdcall *EndDialog)(HWND hDlg, INT_PTR nResult);
// extern BOOL (__stdcall *SetDlgItemTextW)(HWND hDlg, int nIDDlgItem, LPCWSTR lpString);
// extern UINT (__stdcall *GetDlgItemTextW)(HWND hDlg, int nIDDlgItem, LPWSTR lpString, int cchMax);
// extern LRESULT (__stdcall *SendDlgItemMessageW)(HWND hDlg, int nIDDlgItem, UINT Msg, WPARAM wParam, LPARAM lParam);
// extern HWND (__stdcall *SetFocus)(HWND hWnd);
// extern BOOL (__stdcall *SetForegroundWindow)(HWND hWnd);
// extern HBITMAP (__stdcall *LoadBitmapW)(HINSTANCE hInstance, LPCWSTR lpBitmapName);
// extern HICON (__stdcall *LoadIconW)(HINSTANCE hInstance, LPCWSTR lpIconName);
// extern BOOL (__stdcall *DestroyIcon)(HICON hIcon);
// extern BOOL (__stdcall *IsDialogMessageW)(HWND hDlg, LPMSG lpMsg);
// extern HWND (__stdcall *CreateWindowExW)(DWORD dwExStyle, LPCWSTR lpClassName, LPCWSTR lpWindowName, DWORD dwStyle, int X, int Y, int nWidth, int nHeight, HWND hWndParent, HMENU hMenu, HINSTANCE hInstance, LPVOID lpParam);
// extern ATOM (__stdcall *RegisterClassExW)(const WNDCLASSEXW *);
// extern LRESULT (__stdcall *DefWindowProcW)(HWND hWnd, UINT Msg, WPARAM wParam, LPARAM lParam);
// extern BOOL (__stdcall *PeekMessageW)(LPMSG lpMsg, HWND hWnd, UINT wMsgFilterMin, UINT wMsgFilterMax, UINT wRemoveMsg);
// extern LRESULT (__stdcall *DispatchMessageW)(const MSG *lpMsg);
// extern BOOL (__stdcall *TranslateMessage)(const MSG *lpMsg);
// extern BOOL (__stdcall *GetMessageW)(LPMSG lpMsg, HWND hWnd, UINT wMsgFilterMin, UINT wMsgFilterMax);
// extern BOOL (__stdcall *OemToCharBuffA)(LPCSTR lpszSrc, LPSTR lpszDst, DWORD cchDstLength);
// extern int (__stdcall *LoadStringW)(HINSTANCE hInstance, UINT uID, LPWSTR lpBuffer, int cchBufferMax);
// extern HWND (__stdcall *GetWindow)(HWND hWnd, UINT uCmd);
// extern BOOL (__stdcall *EnableWindow)(HWND hWnd, BOOL bEnable);
// extern HWND (__stdcall *GetDlgItem)(HWND hDlg, int nIDDlgItem);
// extern BOOL (__stdcall *ShowWindow)(HWND hWnd, int nCmdShow);
// extern DWORD (__stdcall *GetSysColor)(int nIndex);
// extern BOOL (__stdcall *DestroyWindow)(HWND hWnd);
// extern BOOL (__stdcall *SetProcessDefaultLayout)(DWORD dwDefaultLayout);
// extern LONG (__stdcall *SetWindowLongW)(HWND hWnd, int nIndex, LONG dwNewLong);
// extern LONG (__stdcall *GetWindowLongW)(HWND hWnd, int nIndex);
// extern BOOL (__stdcall *GetWindowRect)(HWND hWnd, LPRECT lpRect);
// extern BOOL (__stdcall *GetClientRect)(HWND hWnd, LPRECT lpRect);
// extern int (__stdcall *GetWindowTextW)(HWND hWnd, LPWSTR lpString, int nMaxCount);
// extern BOOL (__stdcall *SetWindowTextW)(HWND hWnd, LPCWSTR lpString);
// extern INT_PTR (__stdcall *DialogBoxParamW)(HINSTANCE hInstance, LPCWSTR lpTemplateName, HWND hWndParent, DLGPROC lpDialogFunc, LPARAM dwInitParam);
// extern int (__stdcall *GetSystemMetrics)(int nIndex);
// extern BOOL (__stdcall *IsWindowVisible)(HWND hWnd);
// extern HRESULT (__stdcall *CoCreateInstance)(const IID *const rclsid, LPUNKNOWN pUnkOuter, DWORD dwClsContext, const IID *const riid, LPVOID *ppv);
// extern HRESULT (__stdcall *CLSIDFromString)(LPCOLESTR lpsz, LPCLSID pclsid);
// extern HRESULT (__stdcall *OleInitialize)(LPVOID pvReserved);
// extern void (__stdcall *OleUninitialize)();
// extern HRESULT (__stdcall *CreateStreamOnHGlobal)(HGLOBAL hGlobal, BOOL fDeleteOnRelease, LPSTREAM *ppstm);
_UNKNOWN unk_42BA68; // weak
int dword_42BA70[256] =
{
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  
}; // weak
int dword_42BE70[256]; // weak
int dword_42C270[256]; // weak
int dword_42C670[256]; // weak
int dword_42CA70[256]; // weak
int dword_42CE70[256]; // weak
int dword_42D270[256]; // weak
int dword_42D670[256]; // weak
_UNKNOWN unk_42DA70; // weak
int dword_42DA78; // weak
int dword_42DA7C; // weak
_UNKNOWN unk_42DA88; // weak
int dword_42FA88; // weak
HMODULE dword_42FA8C[2]; // weak
int dword_42FA94; // weak
int (__stdcall *dword_42FA98)(_DWORD, _DWORD, _DWORD); // weak
int dword_42FA9C; // weak
_BYTE byte_42FAA8[264]; // weak
int dword_42FBB0[256]; // weak
int dword_42FFB0; // weak
int dword_42FFBC; // weak
__int64 qword_42FFC0; // weak
__int64 qword_42FFC8; // weak
__int64 qword_42FFD0; // weak
int qword_42FFD8; // idb
char byte_42FFEC[8]; // weak
int dword_42FFF4; // weak
char byte_42FFF8[65540]; // weak
int dword_43FFFC; // weak
char *dword_440000; // idb
void *Src; // idb
__int64 qword_440008; // weak
int dword_440010; // weak
int dword_440014; // weak
int dword_440018; // weak
int dword_440020; // weak
__int64 qword_440028; // weak
__int64 qword_440030; // weak
__int64 qword_440038; // weak
__int64 qword_440040; // weak
__int64 qword_440048; // weak
void *Block; // idb
char *dword_440054; // idb
char byte_440058; // weak
char byte_440059; // weak
__int16 word_44005A; // weak
__int16 word_44005C; // weak
__int16 word_44005E; // weak
__int16 word_440060; // weak
int dword_440064; // weak
__int64 qword_440068; // weak
__int64 qword_440070; // weak
__int16 word_440078; // weak
__int16 word_44007A; // weak
char byte_440080; // weak
char byte_440081; // weak
char byte_440082; // weak
char byte_440083; // weak
int dword_440084; // weak
int dword_440088; // weak
int dword_44008C; // weak
__int64 qword_440090; // weak
__int64 qword_440098; // weak
__int16 word_4400A0; // weak
__int16 word_4400A2; // weak
__int16 word_4400A4; // weak
__int16 word_4400A6; // weak
__int16 word_4400A8; // weak
int dword_4400AC; // weak
__int64 qword_4400B0; // weak
__int16 word_4400B8; // weak
__int16 word_4400BA; // weak
__int64 qword_4400C0; // weak
__int64 qword_4400C8; // weak
__int64 qword_4400D0; // weak
__int64 qword_4400D8; // weak
__int16 word_4400E0; // weak
int dword_4400E8; // weak
void *dword_4400EC; // idb
int dword_4400F0; // weak
int dword_4400F4; // weak
int dword_4400F8; // weak
void *dword_4400FC; // idb
int dword_440100; // weak
int dword_440104; // weak
int dword_440108; // weak
wchar_t SrcStr; // idb
__int16 word_44010E; // weak
__int16 word_440110; // weak
int dword_44110C; // idb
int dword_441110; // weak
int dword_441114; // weak
int dword_441118; // weak
int dword_44111C; // weak
int dword_441120; // weak
int dword_441124; // weak
int dword_441128; // weak
int dword_44112C; // weak
int dword_441130; // weak
int dword_441134; // weak
LPSTR lpMultiByteStr; // idb
int dword_441140; // weak
int dword_441144; // weak
int dword_441148; // weak
int dword_44114C; // weak
int dword_441150; // weak
int dword_441154; // weak
int dword_441158; // weak
int dword_44115C; // weak
int dword_441160; // weak
int dword_441164; // weak
int dword_441168; // weak
int dword_44116C; // weak
int dword_441170; // weak
int dword_441174; // weak
int dword_441178; // weak
size_t Size; // idb
int dword_441180; // weak
int dword_441184; // weak
int dword_441188; // weak
int dword_44118C; // weak
int dword_441190; // weak
char byte_441194; // weak
int dword_441198; // weak
char byte_44119C; // weak
char byte_44119D; // weak
char byte_44119E; // weak
int dword_4411A0; // weak
int dword_4411A8; // weak
int dword_4411AC; // weak
IMalloc *ppMalloc; // idb
int dword_4411B8; // weak
void *dword_4411BC; // idb
char byte_4411C0; // weak
wchar_t word_4411C2[8192]; // weak
wchar_t pszPath[2048]; // weak
wchar_t word_4461C2[2048]; // weak
wchar_t word_4471C2[2048]; // weak
char byte_4481C2; // weak
char byte_4481C3; // weak
int dword_4481C4; // weak
LPVOID dword_4481C8; // idb
LPVOID lpParam; // idb
HINSTANCE hInstance; // idb
HINSTANCE dword_4481D8; // idb
HWND hDlg; // idb
int dword_4481E0; // weak
char byte_4481E4; // weak
char byte_4481E5; // weak
char byte_4481E6; // weak
char byte_4481E7; // weak
char byte_4481E8; // weak
char byte_4481E9; // weak
HWND hWnd; // idb
char byte_4481F0; // weak
int dword_4481F4; // weak
char byte_4481F8; // weak
char byte_4481F9; // weak
wchar_t word_4481FA[2048]; // weak
wchar_t word_4491FA[2048]; // weak
char byte_44A1FA[256]; // weak
char byte_44A2FA; // weak
int dword_44A2FC[4]; // weak
_DWORD dword_44A30C[4]; // weak
char byte_44A31C; // weak
wchar_t word_44A320[8210]; // weak
char byte_44E344[256]; // weak
char byte_44E444; // weak
int dword_44F450; // weak
char byte_44F470; // weak
char byte_44F473; // weak
char byte_44F474; // weak
int dword_44F478; // weak
char byte_44F4A8; // weak
char byte_44F4AB; // weak
char byte_44F4B4; // weak
char byte_44F4B5; // weak
char byte_44F4BC; // weak
char byte_44F4E1; // weak
int dword_4505AC; // weak
int dword_4505B0; // weak
int dword_4505B4; // weak
wchar_t word_4515D2; // idb
wchar_t word_4525F2; // idb
_DWORD dword_4535F4[115]; // weak
char byte_4537C0[256]; // weak
char byte_4538C0; // weak
char byte_4538C2; // weak
char byte_4538C3; // weak
int dword_4538C4; // weak
int qword_4538C8; // idb
wchar_t Value[2048]; // weak
LPARAM lParam; // idb
LPARAM dword_4548D4; // idb
wchar_t *Destination; // idb
void *dword_4548DC; // idb
char byte_4548E0; // weak
char byte_4548E1; // weak
char byte_4548E2; // weak
int dword_4548E4; // weak
DWORD dwMilliseconds; // idb
HANDLE hHandle; // idb
wchar_t String1; // idb
__int16 word_4558F0; // weak
__int16 word_4558F2; // weak
LPWSTR lpString; // idb
char Buffer[8192]; // idb
char byte_4578F8; // weak
char byte_4578F9; // weak
int dword_457918; // weak
int (__thiscall *dword_45791C)(_DWORD, _DWORD); // weak
int (__thiscall *dword_457920)(_DWORD, _DWORD); // weak
int dword_457924; // weak
int dword_457930; // weak
int (__thiscall *dword_457934)(_DWORD, _DWORD, _DWORD); // weak
int (__thiscall *dword_457938)(_DWORD, _DWORD, _DWORD); // weak
int dword_457968; // weak
union _SLIST_HEADER ListHead; // idb
_UNKNOWN unk_457978; // weak
int dword_457D6C; // weak
void *dword_457E88; // idb
void *dword_457E8C; // idb
_onexit_table_t stru_457E90; // idb
int dword_457EAC; // weak
int dword_457EB8; // weak
int dword_457EBC; // weak
_UNKNOWN unk_457EC0; // weak
struct __crt_locale_data *dword_457EDC; // idb
int dword_457EE0[124]; // weak
int dword_4580E0; // weak
HANDLE hHeap; // idb
_UNKNOWN unk_45835C; // weak
_UNKNOWN unk_458360; // weak
int dword_45836C; // weak


//----- (0040125F) --------------------------------------------------------
void *sub_40125F()
{
  return sub_401725(&unk_42BA68);
}

//----- (00401269) --------------------------------------------------------
int sub_401269()
{
  return atexit(sub_421F45);
}

//----- (00401275) --------------------------------------------------------
int sub_401275()
{
  int result; // eax

  result = sub_404758();
  dword_42FA9C = result;
  return result;
}
// 42FA9C: using guessed type int dword_42FA9C;

//----- (00401280) --------------------------------------------------------
bool sub_401280()
{
  return sub_4053BF(byte_42FAA8);
}
// 42FAA8: using guessed type _BYTE byte_42FAA8[264];

//----- (0040128A) --------------------------------------------------------
int sub_40128A()
{
  sub_40411E(byte_4537C0);
  return atexit(sub_421F4F);
}

//----- (004012A0) --------------------------------------------------------
int *sub_4012A0()
{
  *((_WORD *)&dword_44A2FC + 4) = 1;
  dword_44A2FC = 0;
  *(&dword_44A2FC + 1) = 0;
  *(_WORD *)((char *)&dword_44A2FC + 11) = 0;
  *((_BYTE *)&dword_44A2FC + 10) = 0;
  return &dword_44A2FC;
}
// 44A2FC: using guessed type int dword_44A2FC;

//----- (004012AA) --------------------------------------------------------
int sub_4012AA()
{
  sub_4037DD(dword_44A30C);
  return atexit(sub_421F59);
}
// 44A30C: using guessed type _DWORD dword_44A30C[4];

//----- (004012C0) --------------------------------------------------------
int sub_4012C0()
{
  sub_40411E(byte_44A1FA);
  return atexit(sub_421F63);
}

//----- (004012D6) --------------------------------------------------------
int sub_4012D6()
{
  sub_4013F0((int)&unk_44A320);
  return atexit((void (__cdecl *)())sub_421F6D);
}

//----- (004012F0) --------------------------------------------------------
bool __stdcall sub_4012F0(HWND a1, const WCHAR *a2, LPWSTR pszPath)
{
  const ITEMIDLIST *v4; // eax
  ITEMIDLIST *v5; // edi
  BOOL v6; // esi
  char v7; // [esp+0h] [ebp-22Ch] BYREF
  struct _browseinfoW bi; // [esp+208h] [ebp-24h] BYREF
  IMalloc *ppMalloc; // [esp+228h] [ebp-4h] BYREF

  if ( SHGetMalloc(&ppMalloc) )
    return 0;
  bi.hwndOwner = a1;
  bi.pszDisplayName = (LPWSTR)&v7;
  bi.lpszTitle = a2;
  bi.pidlRoot = 0;
  bi.ulFlags = 65;
  bi.lpfn = 0;
  bi.lParam = 0;
  v4 = SHBrowseForFolderW(&bi);
  v5 = (ITEMIDLIST *)v4;
  if ( !v4 )
    return 0;
  v6 = SHGetPathFromIDListW(v4, pszPath);
  ppMalloc->lpVtbl->Free(ppMalloc, v5);
  return v6;
}

//----- (0040136D) --------------------------------------------------------
BOOL __stdcall sub_40136D(HWND hDlg, int nIDDlgItem, unsigned __int8 a3)
{
  HWND DlgItem; // eax

  DlgItem = GetDlgItem(hDlg, nIDDlgItem);
  return EnableWindow(DlgItem, a3);
}

//----- (0040138B) --------------------------------------------------------
BOOL __stdcall sub_40138B(HWND hDlg, int nIDDlgItem, char a3)
{
  HWND DlgItem; // eax

  DlgItem = GetDlgItem(hDlg, nIDDlgItem);
  return ShowWindow(DlgItem, a3 != 0 ? 9 : 0);
}

//----- (004013B0) --------------------------------------------------------
char __stdcall sub_4013B0(HWND hWnd, int a2, int a3, int a4, LPCWCH lpWideCharStr, int a6, char a7)
{
  if ( a2 == 48 )
  {
    sub_403E04(dword_44A30C, hWnd);
  }
  else if ( a2 == 272 )
  {
    sub_403E2E((__int16 **)dword_44A30C, hWnd, lpWideCharStr, a7 & 1);
  }
  return 0;
}
// 44A30C: using guessed type _DWORD dword_44A30C[4];

//----- (004013F0) --------------------------------------------------------
int __thiscall sub_4013F0(int this)
{
  sub_402F09((char *)this);
  sub_4045F5((_DWORD *)(this + 37588));
  sub_4045F5((_DWORD *)(this + 37680));
  sub_4045F5((_DWORD *)(this + 37772));
  sub_4045F5((_DWORD *)(this + 37864));
  sub_4045F5((_DWORD *)(this + 37956));
  sub_4015D6(this);
  return this;
}

//----- (00401472) --------------------------------------------------------
wchar_t *__thiscall sub_401472(_DWORD *this, wchar_t *a2)
{
  return sub_40468A(this + 9466, a2);
}

//----- (0040147D) --------------------------------------------------------
char __stdcall sub_40147D(wchar_t *a1, char a2, wchar_t *a3, int a4, int a5)
{
  wchar_t *v5; // ebx
  wchar_t *v6; // esi
  bool v7; // al
  wchar_t *v8; // edi
  wchar_t *v9; // eax
  wchar_t *v10; // esi
  char result; // al
  wchar_t String[2048]; // [esp+10h] [ebp-2004h] BYREF
  __int16 v13[2]; // [esp+1010h] [ebp-1004h] BYREF
  wchar_t Destination[2048]; // [esp+1014h] [ebp-1000h] BYREF

  v5 = sub_4030FA(a3, 0);
  sub_404753(a1);
  while ( 1 )
  {
    result = sub_404716(a1, String, 2048);
    if ( !result )
      break;
    v6 = sub_40368A(String);
    v7 = sub_4035F5(*v6);
    if ( a2 )
    {
      if ( v7 )
        *v6 = 0;
    }
    else if ( v7 )
    {
      sub_40459C(String, (wchar_t *)L"*", 2048);
    }
    v8 = v5;
    v9 = sub_4030FA(String, 0);
    v10 = v9;
    if ( *v9 == 42 )
    {
      if ( sub_4035F5(v9[1]) )
      {
        v13[0] = 46;
        v13[1] = 92;
        sub_4045C8(Destination, v5, 2048);
        v8 = (wchar_t *)v13;
      }
    }
    if ( sub_402BEC(v10, v8, a5) )
      return 1;
  }
  return result;
}
// 40147D: using guessed type wchar_t Destination[2048];

//----- (0040157C) --------------------------------------------------------
bool __thiscall sub_40157C(int this, wchar_t *a2, char a3, int a4, char a5)
{
  if ( sub_40147D((wchar_t *)(this + 37680), a3, a2, a4, 5) )
    return 1;
  if ( a5 && *(_DWORD *)(this + 37792) )
    return sub_40147D((wchar_t *)(this + 37772), a3, a2, a4, 5) == 0;
  return 0;
}

//----- (004015D6) --------------------------------------------------------
void __thiscall sub_4015D6(int this)
{
  sub_402F92((void *)this);
  *(_WORD *)(this + 29362) = 0;
  *(_WORD *)(this + 33490) = 0;
  *(_BYTE *)(this + 29352) = 0;
  *(_DWORD *)(this + 29356) = 0;
  *(_BYTE *)(this + 29360) = 0;
  sub_40473D((_DWORD *)(this + 37588));
  sub_40473D((_DWORD *)(this + 37680));
  sub_40473D((_DWORD *)(this + 37772));
  sub_40473D((_DWORD *)(this + 37956));
  sub_40473D((_DWORD *)(this + 37864));
  sub_401708(this + 20840);
}

//----- (00401643) --------------------------------------------------------
int __thiscall sub_401643(wchar_t *this, int a2, bool *a3, int a4, wchar_t *Destination, int a6)
{
  WCHAR *v6; // ebx
  int v8; // ebp
  wchar_t *v9; // ecx
  wchar_t *v10; // eax
  WCHAR *v11; // edi

  if ( Destination && a6 )
    *Destination = 0;
  v6 = (WCHAR *)(a2 + 32);
  if ( wcslen((const wchar_t *)(a2 + 32)) >= 0x800 )
    return 0;
  v8 = 1;
  if ( !sub_40157C((int)this, v6, *(_BYTE *)(a2 + 4321), 0, 1) )
  {
    sub_404753((_DWORD *)this + 9397);
    v9 = this + 18794;
    while ( 1 )
    {
      v10 = (wchar_t *)sub_4046C6(v9);
      v11 = v10;
      if ( !v10 )
        break;
      if ( sub_402BEC(v10, v6, a4) )
      {
        if ( a3 )
          *a3 = sub_404597(v11, v6) == 0;
        if ( Destination )
          sub_4045C8(Destination, v11, a6);
        return v8;
      }
      v9 = this + 18794;
      ++v8;
    }
  }
  return 0;
}

//----- (00401708) --------------------------------------------------------
void __thiscall sub_401708(int this)
{
  if ( *(_DWORD *)this )
  {
    j___free_base(*(void **)this);
    *(_DWORD *)this = 0;
  }
  *(_DWORD *)(this + 4) = 0;
  *(_DWORD *)(this + 8) = 0;
}

//----- (00401725) --------------------------------------------------------
void *__thiscall sub_401725(void *this)
{
  int *v2; // edx
  int v3; // esi
  unsigned int v4; // ecx
  _DWORD *v5; // edi
  int v6; // ebp

  sub_401859((int)dword_42BA70);
  v2 = dword_42BE70;
  v3 = 256;
  do
  {
    v4 = *(v2 - 256);
    v5 = v2;
    v6 = 7;
    do
    {
      v4 = dword_42BA70[(unsigned __int8)v4] ^ (v4 >> 8);
      *v5 = v4;
      v5 += 256;
      --v6;
    }
    while ( v6 );
    ++v2;
    --v3;
  }
  while ( v3 );
  return this;
}
// 42BA70: using guessed type int dword_42BA70[256];
// 42BE70: using guessed type int dword_42BE70[256];

//----- (00401773) --------------------------------------------------------
unsigned int __stdcall sub_401773(unsigned int a1, _DWORD *a2, unsigned int a3)
{
  _DWORD *v3; // edx
  unsigned int i; // esi
  unsigned int v6; // edi
  unsigned int v7; // ebx
  unsigned int v8; // edx
  int v9; // ecx
  int v10; // eax

  v3 = a2;
  for ( i = a3; i; --i )
  {
    if ( ((unsigned __int8)v3 & 7) == 0 )
      break;
    a1 = dword_42BA70[(unsigned __int8)a1 ^ *(unsigned __int8 *)v3] ^ (a1 >> 8);
    v3 = (_DWORD *)((char *)v3 + 1);
    a2 = v3;
  }
  if ( i >= 8 )
  {
    v6 = i >> 3;
    do
    {
      v7 = *v3 ^ a1;
      i -= 8;
      v8 = v3[1];
      v9 = dword_42D270[BYTE1(v7)] ^ dword_42CE70[BYTE2(v7)] ^ dword_42CA70[HIBYTE(v7)] ^ dword_42C270[BYTE1(v8)] ^ dword_42BE70[BYTE2(v8)] ^ dword_42BA70[HIBYTE(v8)];
      v10 = (unsigned __int8)v8;
      v3 = a2 + 2;
      a2 += 2;
      a1 = dword_42D670[(unsigned __int8)v7] ^ dword_42C670[v10] ^ v9;
      --v6;
    }
    while ( v6 );
  }
  for ( ; i; --i )
  {
    a1 = dword_42BA70[(unsigned __int8)a1 ^ *(unsigned __int8 *)v3] ^ (a1 >> 8);
    v3 = (_DWORD *)((char *)v3 + 1);
  }
  return a1;
}
// 42BA70: using guessed type int dword_42BA70[256];
// 42BE70: using guessed type int dword_42BE70[256];
// 42C270: using guessed type int dword_42C270[256];
// 42C670: using guessed type int dword_42C670[256];
// 42CA70: using guessed type int dword_42CA70[256];
// 42CE70: using guessed type int dword_42CE70[256];
// 42D270: using guessed type int dword_42D270[256];
// 42D670: using guessed type int dword_42D670[256];

//----- (00401859) --------------------------------------------------------
void __stdcall sub_401859(int a1)
{
  unsigned int v1; // ecx
  unsigned int v2; // eax
  int v3; // esi

  v1 = 0;
  if ( !*(_DWORD *)(a1 + 4) )
  {
    do
    {
      v2 = v1;
      v3 = 8;
      do
      {
        if ( (v2 & 1) != 0 )
          v2 = (v2 >> 1) ^ 0xEDB88320;
        else
          v2 >>= 1;
        --v3;
      }
      while ( v3 );
      *(_DWORD *)(a1 + 4 * v1++) = v2;
    }
    while ( v1 < 0x100 );
  }
}

//----- (0040188E) --------------------------------------------------------
void __stdcall sub_40188E(int a1, int a2)
{
  int v2[19]; // [esp+0h] [ebp-4Ch] BYREF

  v2[17] = 0;
  v2[18] = a1;
  v2[0] = a2;
  v2[16] = 1;
  sub_404F24(v2);
}

//----- (004018B9) --------------------------------------------------------
void __stdcall sub_4018B9(int a1, int a2, int a3)
{
  int v3[19]; // [esp+0h] [ebp-4Ch] BYREF

  v3[17] = 0;
  v3[18] = a1;
  v3[0] = a2;
  v3[1] = a3;
  v3[16] = 2;
  sub_404F24(v3);
}

//----- (00401901) --------------------------------------------------------
int __thiscall sub_401901(_DWORD *this, int a2)
{
  sub_40188E(23, a2);
  return sub_401A82(this, 3);
}

//----- (0040191C) --------------------------------------------------------
char __stdcall sub_40191C(int a1)
{
  return 0;
}

//----- (00401921) --------------------------------------------------------
bool __thiscall sub_401921(_BYTE *this, int ArgList, int a3)
{
  bool result; // al

  if ( this[9] )
    return 0;
  result = sub_405184(ArgList, a3);
  if ( !result )
    this[10] = 1;
  return result;
}
// 401921: using guessed type int ArgList;

//----- (00401947) --------------------------------------------------------
void __thiscall sub_401947(_BYTE *this, int a2)
{
  if ( !this[11] )
    sub_40188E(10, a2);
  sub_401ACA((int)this, 2);
}

//----- (00401968) --------------------------------------------------------
int __thiscall sub_401968(_DWORD *this, int a2, int a3)
{
  sub_4018B9(9, a2, a3);
  return sub_401A82(this, 9);
}

//----- (0040198C) --------------------------------------------------------
void sub_40198C(int a1, char *Format, ...)
{
  char Buffer[2048]; // [esp+0h] [ebp-800h] BYREF
  va_list va; // [esp+810h] [ebp+10h] BYREF

  va_start(va, Format);
  _vsprintf_s_l(Buffer, 0x400u, Format, 0, va);
  sub_40188E(1, (int)Buffer);
}

//----- (004019C4) --------------------------------------------------------
void __thiscall sub_4019C4(_DWORD *this)
{
  sub_4019D7(this);
  sub_401ACA((int)this, 8);
}

//----- (004019D7) --------------------------------------------------------
int __thiscall sub_4019D7(_DWORD *this)
{
  sub_401B56(7);
  return sub_401A82(this, 8);
}

//----- (004019EC) --------------------------------------------------------
int __thiscall sub_4019EC(_DWORD *this, int a2, int a3)
{
  sub_4018B9(8, a2, a3);
  return sub_401A82(this, 6);
}

//----- (00401A0B) --------------------------------------------------------
int __thiscall sub_401A0B(_DWORD *this, int a2)
{
  return sub_4019EC(this, 0, a2);
}

//----- (00401A19) --------------------------------------------------------
void __thiscall sub_401A19(_DWORD *this, int a2)
{
  sub_401A34(this, 0, a2);
  sub_401ACA((int)this, 2);
}

//----- (00401A34) --------------------------------------------------------
int __thiscall sub_401A34(_DWORD *this, int a2, int a3)
{
  sub_4018B9(12, a2, a3);
  return sub_401A82(this, 2);
}

//----- (00401A53) --------------------------------------------------------
int __thiscall sub_401A53(_DWORD *this, int a2)
{
  return sub_401A34(this, 0, a2);
}

//----- (00401A61) --------------------------------------------------------
void __thiscall sub_401A61(_BYTE *this, int a2)
{
  if ( !this[11] )
    sub_40188E(11, a2);
  sub_401ACA((int)this, 2);
}

//----- (00401A82) --------------------------------------------------------
int __thiscall sub_401A82(_DWORD *this, int a2)
{
  int result; // eax

  result = a2 - 1;
  if ( a2 != 1 )
  {
    result = a2 - 2;
    if ( a2 == 2 )
    {
      if ( *this <= 1u )
        *this = 2;
      goto LABEL_7;
    }
    result = a2 - 3;
    if ( a2 == 3 )
    {
      if ( *this != 11 )
        *this = 3;
      goto LABEL_7;
    }
    result = a2 - 255;
    if ( a2 != 255 )
    {
LABEL_6:
      *this = a2;
      goto LABEL_7;
    }
  }
  if ( !*this )
    goto LABEL_6;
LABEL_7:
  ++this[1];
  return result;
}

//----- (00401ACA) --------------------------------------------------------
void __thiscall sub_401ACA(int this, int pExceptionObject)
{
  int v2; // esi

  v2 = pExceptionObject;
  if ( pExceptionObject != 255 || *(_BYTE *)(this + 8) )
  {
    sub_401A82((_DWORD *)this, pExceptionObject);
    pExceptionObject = v2;
    _CxxThrowException(&pExceptionObject, (_ThrowInfo *)&_TI1_AW4RAR_EXIT__);
  }
}

//----- (00401AFC) --------------------------------------------------------
int __stdcall sub_401AFC(int a1, int a2)
{
  sub_4018B9(31, a1, a2);
  return sub_401A82(dword_44A2FC, 2);
}
// 44A2FC: using guessed type int dword_44A2FC[4];

//----- (00401B1A) --------------------------------------------------------
void __thiscall sub_401B1A(_DWORD *this, int a2, int a3)
{
  sub_401B37(this, a2, a3);
  sub_401ACA((int)this, 5);
}

//----- (00401B37) --------------------------------------------------------
int __thiscall sub_401B37(_DWORD *this, int a2, int a3)
{
  sub_4018B9(13, a2, a3);
  return sub_401A82(this, 5);
}

//----- (00401B56) --------------------------------------------------------
void __stdcall sub_401B56(int a1)
{
  int v1[19]; // [esp+0h] [ebp-4Ch] BYREF

  v1[16] = 0;
  v1[17] = 0;
  v1[18] = a1;
  sub_404F24(v1);
}

//----- (00401B78) --------------------------------------------------------
void *sub_401B78()
{
  return &unk_42DA70;
}

//----- (00401BAB) --------------------------------------------------------
_DWORD *__thiscall sub_401BAB(_DWORD *this)
{
  _DWORD *result; // eax

  this[1] = -1;
  *this = &off_422254;
  *((_WORD *)this + 15) = 0;
  *((_BYTE *)this + 8) = 0;
  this[3] = 0;
  *((_BYTE *)this + 16) = 0;
  this[1032] = 0;
  *((_BYTE *)this + 28) = 0;
  *((_BYTE *)this + 21) = 0;
  result = this;
  *(_DWORD *)((char *)this + 17) = 16842752;
  this[6] = 256;
  return result;
}
// 422254: using guessed type int (__thiscall *off_422254)(void *Block, char);

//----- (00401BE1) --------------------------------------------------------
bool __thiscall sub_401BE1(_DWORD *this)
{
  bool v1; // zf
  bool result; // al

  v1 = this[1] == -1;
  *this = &off_422254;
  if ( !v1 && !*((_BYTE *)this + 16) )
  {
    if ( *((_BYTE *)this + 18) )
      return sub_401DCE((int)this);
    else
      return sub_401C84((int)this);
  }
  return result;
}
// 422254: using guessed type int (__thiscall *off_422254)(void *Block, char);

//----- (00401C2B) --------------------------------------------------------
int __thiscall sub_401C2B(_DWORD *this)
{
  return (*(int (__thiscall **)(_DWORD, _DWORD, _DWORD, _DWORD))(*(_DWORD *)*this + 12))(*this, this[2], this[3], 0);
}

//----- (00401C62) --------------------------------------------------------
_DWORD *__thiscall sub_401C62(_DWORD *Block, char a2)
{
  sub_401BE1(Block);
  if ( (a2 & 1) != 0 )
    sub_40F500(Block);
  return Block;
}

//----- (00401C84) --------------------------------------------------------
bool __thiscall sub_401C84(int this)
{
  bool v2; // bl

  v2 = 1;
  if ( *(_DWORD *)(this + 4) != -1 )
  {
    if ( !*(_BYTE *)(this + 16) && !*(_DWORD *)(this + 12) )
      v2 = CloseHandle(*(HANDLE *)(this + 4));
    *(_DWORD *)(this + 4) = -1;
  }
  *(_DWORD *)(this + 12) = 0;
  if ( !v2 && *(_BYTE *)(this + 20) )
    sub_401947(dword_44A2FC, this + 30);
  return v2;
}
// 44A2FC: using guessed type int dword_44A2FC[4];

//----- (00401CD2) --------------------------------------------------------
BOOL __thiscall sub_401CD2(int this, wchar_t *lpFileName, int a3)
{
  bool v4; // dl
  DWORD v5; // ebx
  int v6; // eax
  DWORD v7; // ebp
  BOOL dwShareMode; // [esp+Ch] [ebp-1004h]
  WCHAR FileName[2048]; // [esp+10h] [ebp-1000h] BYREF

  v4 = (a3 & 0x10) != 0 || *(_BYTE *)(this + 28);
  *(_DWORD *)(this + 24) = a3;
  v5 = (a3 & 2) == 0 ? -1073741824 : 0x40000000;
  dwShareMode = v4;
  v6 = *sub_40368A(lpFileName);
  if ( v6 == 46 || v6 == 32 )
  {
    *(_DWORD *)(this + 4) = -1;
    v7 = dwShareMode;
  }
  else
  {
    v7 = dwShareMode;
    *(_DWORD *)(this + 4) = CreateFileW(lpFileName, v5, dwShareMode, 0, 2u, 0, 0);
  }
  if ( *(_DWORD *)(this + 4) == -1 && sub_4033EC(lpFileName, FileName, 0x800u) )
    *(_DWORD *)(this + 4) = CreateFileW(FileName, v5, v7, 0, 2u, 0, 0);
  *(_DWORD *)(this + 12) = 0;
  *(_BYTE *)(this + 18) = 1;
  *(_BYTE *)(this + 16) = 0;
  sub_4045C8((wchar_t *)(this + 30), lpFileName, 2048);
  return *(_DWORD *)(this + 4) != -1;
}

//----- (00401DCE) --------------------------------------------------------
bool __thiscall sub_401DCE(int this)
{
  if ( *(_DWORD *)(this + 12) )
    return 0;
  if ( *(_DWORD *)(this + 4) != -1 )
    sub_401C84(this);
  return *(_BYTE *)(this + 19) && sub_402525((WCHAR *)(this + 30));
}

//----- (00401DF7) --------------------------------------------------------
DWORD __thiscall sub_401DF7(int this, LPVOID lpBuffer, DWORD nNumberOfBytesToRead)
{
  DWORD NumberOfBytesRead; // [esp+8h] [ebp-4h] BYREF

  if ( *(_DWORD *)(this + 12) == 1 )
    *(_DWORD *)(this + 4) = GetStdHandle(0xFFFFFFF6);
  if ( ReadFile(*(HANDLE *)(this + 4), lpBuffer, nNumberOfBytesToRead, &NumberOfBytesRead, 0) )
    return NumberOfBytesRead;
  if ( sub_401EE4((HANDLE *)this) && nNumberOfBytesToRead > 0x4E20 )
    return sub_401DF7(lpBuffer, 0x4E20u);
  if ( *(_DWORD *)(this + 12) == 1 && GetLastError() == 109 )
    return 0;
  if ( *(_DWORD *)(this + 12) || nNumberOfBytesToRead <= 0x8000 || GetLastError() != 33 )
    return -1;
  return sub_401DF7(lpBuffer, 0x8000u);
}

//----- (00401E8E) --------------------------------------------------------
__int64 __thiscall sub_401E8E(int *this)
{
  int v2; // eax
  __int64 v3; // kr00_8
  int *v5; // [esp+8h] [ebp-1Ch] BYREF
  __int64 v6; // [esp+10h] [ebp-14h]
  int v7; // [esp+20h] [ebp-4h]

  v5 = this;
  v6 = ((__int64 (__thiscall *)(int *))*(_DWORD *)(*this + 16))(this);
  v2 = *this;
  v7 = 0;
  (*(void (__thiscall **)(int *, _DWORD, _DWORD, int))(v2 + 12))(this, 0, 0, 2);
  v3 = ((__int64 (__thiscall *)(int *))*(_DWORD *)(*this + 16))(this);
  sub_401C2B(&v5);
  return v3;
}

//----- (00401EE4) --------------------------------------------------------
bool __thiscall sub_401EE4(HANDLE *this)
{
  DWORD FileType; // eax

  if ( this[1] == (HANDLE)-1 )
    return 0;
  FileType = GetFileType(this[1]);
  return FileType == 2 || FileType == 3;
}

//----- (00401F07) --------------------------------------------------------
bool __thiscall sub_401F07(int this, WCHAR *lpFileName, char a3)
{
  char v4; // cl
  DWORD v5; // esi
  DWORD v6; // ebx
  char *FileW; // ebp
  DWORD LastError; // [esp+Ch] [ebp-1008h]
  int dwFlagsAndAttributes; // [esp+10h] [ebp-1004h]
  WCHAR FileName[2048]; // [esp+14h] [ebp-1000h] BYREF

  *(_DWORD *)(this + 4128) = 0;
  if ( *(_BYTE *)(this + 28) || (v4 = 0, (a3 & 4) != 0) )
    v4 = 1;
  v5 = (a3 & 2) != 0 ? 0x40000000 : 0x80000000;
  if ( (a3 & 1) != 0 )
    v5 |= 0x40000000u;
  v6 = (a3 & 8) == 0;
  if ( v4 )
    v6 |= 2u;
  dwFlagsAndAttributes = *(_BYTE *)(this + 21) != 0 ? 0 : 0x8000000;
  FileW = (char *)CreateFileW(lpFileName, v5, v6, 0, 3u, dwFlagsAndAttributes, 0);
  if ( FileW == (char *)-1 )
  {
    LastError = GetLastError();
    if ( !sub_4033EC(lpFileName, FileName, 0x800u) )
      goto LABEL_13;
    FileW = (char *)CreateFileW(FileName, v5, v6, 0, 3u, dwFlagsAndAttributes, 0);
    if ( GetLastError() == 2 )
      LastError = 2;
    if ( FileW == (char *)-1 )
    {
LABEL_13:
      if ( LastError == 2 )
        *(_DWORD *)(this + 4128) = 1;
    }
  }
  *(_BYTE *)(this + 18) = 0;
  *(_DWORD *)(this + 12) = 0;
  *(_BYTE *)(this + 16) = 0;
  if ( FileW != (char *)-1 )
  {
    *(_DWORD *)(this + 4) = FileW;
    sub_4045C8((wchar_t *)(this + 30), lpFileName, 2048);
  }
  return FileW + 1 != 0;
}

//----- (00402032) --------------------------------------------------------
bool __thiscall sub_402032(int *this, __int64 lDistanceToMove, DWORD DistanceToMoveHigh)
{
  LONG v4; // edi
  LONG v5; // esi
  __int64 v6; // rax
  DWORD v7; // ecx

  if ( this[1] == -1 )
    return 1;
  v4 = HIDWORD(lDistanceToMove);
  v5 = lDistanceToMove;
  if ( lDistanceToMove < 0 )
  {
    v7 = DistanceToMoveHigh;
    if ( DistanceToMoveHigh )
    {
      if ( DistanceToMoveHigh == 1 )
        LODWORD(v6) = (*(int (__thiscall **)(int *))(*this + 16))(this);
      else
        v6 = sub_401E8E(this);
      v4 = (unsigned __int64)(v6 + lDistanceToMove) >> 32;
      v5 = v6 + lDistanceToMove;
      v7 = 0;
    }
  }
  else
  {
    v7 = DistanceToMoveHigh;
  }
  DistanceToMoveHigh = v4;
  return SetFilePointer((HANDLE)this[1], v5, (PLONG)&DistanceToMoveHigh, v7) != -1 || !GetLastError();
}
// 40206C: variable 'v6' is possibly undefined

//----- (004020A8) --------------------------------------------------------
DWORD __thiscall sub_4020A8(_BYTE *this, LPVOID lpBuffer, DWORD nNumberOfBytesToRead)
{
  DWORD v4; // ebx
  DWORD v5; // edi
  DWORD v6; // eax
  DWORD v7; // eax
  __int64 v9; // [esp+10h] [ebp-8h]

  v4 = 0;
  v9 = 0i64;
  if ( this[17] )
    v9 = ((__int64 (__thiscall *)(_BYTE *))*(_DWORD *)(*(_DWORD *)this + 16))(this);
  while ( 1 )
  {
    v5 = sub_401DF7((int)this, lpBuffer, nNumberOfBytesToRead);
    if ( v5 != -1 )
      break;
    *((_DWORD *)this + 1032) = 2;
    if ( !this[20] )
      break;
    if ( this[17] )
    {
      v5 = 0;
      if ( nNumberOfBytesToRead )
      {
        do
        {
          (*(void (__thiscall **)(_BYTE *, _DWORD, _DWORD, _DWORD))(*(_DWORD *)this + 12))(
            this,
            v9 + v4,
            (v9 + (unsigned __int64)v4) >> 32,
            0);
          v6 = nNumberOfBytesToRead - v4;
          if ( nNumberOfBytesToRead - v4 >= 0x200 )
            v6 = 512;
          v7 = sub_401DF7((int)this, lpBuffer, v6);
          if ( v7 == -1 )
            v7 = 512;
          v4 += 512;
          v5 += v7;
        }
        while ( v4 < nNumberOfBytesToRead );
      }
      return v5;
    }
    if ( *((_DWORD *)this + 3) || !sub_40191C((int)(this + 30)) )
    {
      sub_401A19(dword_44A2FC, (int)(this + 30));
      return v5;
    }
  }
  return v5;
}
// 44A2FC: using guessed type int dword_44A2FC[4];

//----- (0040217B) --------------------------------------------------------
void __thiscall sub_40217B(int this, __int64 lDistanceToMove, DWORD DistanceToMoveHigh)
{
  if ( !sub_402032((int *)this, lDistanceToMove, DistanceToMoveHigh) )
  {
    if ( *(_BYTE *)(this + 20) )
      sub_401A61(dword_44A2FC, this + 30);
  }
}
// 44A2FC: using guessed type int dword_44A2FC[4];

//----- (004021AD) --------------------------------------------------------
BOOL __thiscall sub_4021AD(int this, int *a2, int *a3, int *a4)
{
  char v6; // bl
  bool v7; // dl
  bool v9; // [esp+Fh] [ebp-19h]
  FILETIME v10; // [esp+10h] [ebp-18h] BYREF
  FILETIME v11; // [esp+18h] [ebp-10h] BYREF
  FILETIME v12; // [esp+20h] [ebp-8h] BYREF
  char v13; // [esp+2Ch] [ebp+4h]

  if ( *(_DWORD *)(this + 24) != 256 && (*(_BYTE *)(this + 24) & 2) == 0 )
    FlushFileBuffers(*(HANDLE *)(this + 4));
  v6 = 1;
  v7 = a2 && *(_QWORD *)a2;
  v9 = v7;
  if ( !a3 || (v13 = 1, !*(_QWORD *)a3) )
    v13 = 0;
  if ( !a4 || !*(_QWORD *)a4 )
    v6 = 0;
  if ( v7 )
    sub_404DA6(a2, &v10);
  if ( v13 )
    sub_404DA6(a3, &v12);
  if ( v6 )
    sub_404DA6(a4, &v11);
  return SetFileTime(*(HANDLE *)(this + 4), v13 != 0 ? &v12 : 0, v6 != 0 ? &v11 : 0, v9 ? &v10 : 0);
}
// 4021AD: using guessed type FILETIME var_18;
// 4021AD: using guessed type FILETIME var_8;
// 4021AD: using guessed type FILETIME var_10;

//----- (00402286) --------------------------------------------------------
int __thiscall sub_402286(int this)
{
  DWORD v2; // edi
  LONG DistanceToMoveHigh; // [esp+Ch] [ebp-4h] BYREF

  if ( *(_DWORD *)(this + 4) == -1 )
  {
    if ( !*(_BYTE *)(this + 20) )
      return -1;
    sub_401A61(dword_44A2FC, this + 30);
  }
  DistanceToMoveHigh = 0;
  v2 = SetFilePointer(*(HANDLE *)(this + 4), 0, &DistanceToMoveHigh, 1u);
  if ( v2 == -1 && GetLastError() )
  {
    if ( !*(_BYTE *)(this + 20) )
      return -1;
    sub_401A61(dword_44A2FC, this + 30);
  }
  return v2;
}
// 44A2FC: using guessed type int dword_44A2FC[4];

//----- (00402305) --------------------------------------------------------
BOOL __thiscall sub_402305(HANDLE *this)
{
  return SetEndOfFile(this[1]);
}

//----- (00402315) --------------------------------------------------------
char __userpurge sub_402315@<al>(int *a1@<ecx>, char *lpBuffer, DWORD NumberOfBytesWritten, unsigned int a4)
{
  DWORD v4; // ebp
  char result; // al
  bool v7; // bl
  DWORD v8; // esi
  DWORD v9; // eax
  BOOL v10; // eax
  int v11; // esi
  __int64 v12; // rax

  v4 = NumberOfBytesWritten;
  if ( !NumberOfBytesWritten )
    return 1;
  if ( a1[3] == 1 )
    a1[1] = (int)GetStdHandle(0xFFFFFFF5);
  while ( 1 )
  {
    NumberOfBytesWritten = 0;
    v7 = 0;
    if ( a1[3] )
    {
      v8 = 0;
      if ( v4 )
      {
        while ( 1 )
        {
          v9 = v4 - v8;
          if ( v4 - v8 >= 0x4000 )
            v9 = 0x4000;
          v10 = WriteFile((HANDLE)a1[1], &lpBuffer[v8], v9, &NumberOfBytesWritten, 0);
          v7 = v10;
          if ( !v10 )
            break;
          v8 += 0x4000;
          if ( v8 >= v4 )
            goto LABEL_13;
        }
      }
    }
    else
    {
      v7 = WriteFile((HANDLE)a1[1], lpBuffer, v4, &NumberOfBytesWritten, 0);
LABEL_13:
      if ( v7 )
        goto LABEL_21;
    }
    if ( !*((_BYTE *)a1 + 20) || a1[3] )
      goto LABEL_21;
    if ( !sub_401921(dword_44A2FC, (int)a1 + 30, 0) )
      break;
    if ( NumberOfBytesWritten < v4 )
    {
      if ( NumberOfBytesWritten )
      {
        v11 = *a1;
        v12 = ((__int64 (__thiscall *)(int *, _DWORD))*(_DWORD *)(*a1 + 16))(a1, 0);
        (*(void (__thiscall **)(int *, _DWORD, _DWORD))(v11 + 12))(a1, v12 - a4, (v12 - (unsigned __int64)a4) >> 32);
      }
    }
  }
  sub_401B1A(dword_44A2FC, 0, (int)a1 + 30);
LABEL_21:
  result = v7;
  *((_BYTE *)a1 + 8) = 1;
  return result;
}
// 44A2FC: using guessed type int dword_44A2FC[4];

//----- (0040241E) --------------------------------------------------------
_DWORD *__thiscall sub_40241E(_DWORD *this)
{
  this[1028] = 0;
  this[1029] = 0;
  this[1030] = 0;
  this[1031] = 0;
  this[1032] = 0;
  this[1033] = 0;
  return this;
}

//----- (00402447) --------------------------------------------------------
bool __stdcall sub_402447(wchar_t *Source, char a2)
{
  int v2; // eax
  bool v3; // bl
  wchar_t *v4; // edi
  int v5; // ebp
  wchar_t *v6; // eax
  int v8; // [esp+4h] [ebp-1004h]
  wchar_t Destination[2048]; // [esp+8h] [ebp-1000h] BYREF

  if ( !Source )
    return 0;
  v2 = 0;
  if ( !*Source )
    return 0;
  v3 = 1;
  v8 = 0;
  v4 = Source;
  do
  {
    v5 = v2 >> 1;
    if ( (unsigned int)(v2 >> 1) >= 0x800 )
      break;
    if ( sub_4035F5(*v4) && v4 > Source && (v4 != Source + 2 || Source[1] != 58) )
    {
      wcsncpy(Destination, Source, v5);
      Destination[v5] = 0;
      v3 = sub_40260D(Destination, 1, 0) == 0;
    }
    ++v4;
    v2 = v8 + 2;
    v8 += 2;
  }
  while ( *v4 );
  if ( !a2 )
  {
    v6 = sub_40368A(Source);
    if ( !sub_4035F5(*v6) )
      return sub_40260D(Source, 1, 0) == 0;
  }
  return v3;
}
// 402447: using guessed type wchar_t Destination[2048];

//----- (00402525) --------------------------------------------------------
bool __stdcall sub_402525(WCHAR *lpFileName)
{
  BOOL v1; // eax
  bool v2; // bl
  WCHAR FileName[2048]; // [esp+4h] [ebp-1000h] BYREF

  v1 = DeleteFileW(lpFileName);
  v2 = v1;
  if ( !v1 && sub_4033EC(lpFileName, FileName, 0x800u) )
    return DeleteFileW(FileName);
  return v2;
}

//----- (00402578) --------------------------------------------------------
bool __stdcall sub_402578(WCHAR *lpFileName)
{
  return sub_40258C(lpFileName) != -1;
}

//----- (0040258C) --------------------------------------------------------
DWORD __stdcall sub_40258C(WCHAR *lpFileName)
{
  DWORD FileAttributesW; // esi
  WCHAR FileName[2048]; // [esp+4h] [ebp-1000h] BYREF

  FileAttributesW = GetFileAttributesW(lpFileName);
  if ( FileAttributesW == -1 && sub_4033EC(lpFileName, FileName, 0x800u) )
    return GetFileAttributesW(FileName);
  return FileAttributesW;
}

//----- (004025DA) --------------------------------------------------------
BOOL __stdcall sub_4025DA(char a1)
{
  return (a1 & 7) == 0;
}

//----- (004025E8) --------------------------------------------------------
BOOL __stdcall sub_4025E8(int a1)
{
  return a1 != -1 && (a1 & 0x10) != 0;
}

//----- (00402600) --------------------------------------------------------
int __stdcall sub_402600(unsigned int a1)
{
  return (a1 >> 10) & 1;
}

//----- (0040260D) --------------------------------------------------------
int __stdcall sub_40260D(wchar_t *lpPathName, char a2, DWORD dwFileAttributes)
{
  int v3; // eax
  DWORD LastError; // eax
  WCHAR PathName[2048]; // [esp+4h] [ebp-1000h] BYREF

  v3 = *sub_40368A(lpPathName);
  if ( (v3 == 46 || v3 == 32 || !CreateDirectoryW(lpPathName, 0))
    && (sub_402578(lpPathName) || !sub_4033EC(lpPathName, PathName, 0x800u) || !CreateDirectoryW(PathName, 0)) )
  {
    LastError = GetLastError();
    if ( LastError == 2 || LastError == 3 )
      return 2;
    else
      return 1;
  }
  else
  {
    if ( a2 )
      sub_40284A(lpPathName, dwFileAttributes);
    return 0;
  }
}

//----- (004026A3) --------------------------------------------------------
bool __stdcall sub_4026A3(WCHAR *lpFileName)
{
  return sub_40284A(lpFileName, 0);
}

//----- (004026B1) --------------------------------------------------------
char __stdcall sub_4026B1(WCHAR *lpFileName, int *a2, int *a3, int *a4)
{
  char v4; // bl
  DWORD v5; // eax
  HANDLE FileW; // eax
  char v8; // [esp+11h] [ebp-1023h]
  char v9; // [esp+12h] [ebp-1022h]
  char v10; // [esp+13h] [ebp-1021h]
  HANDLE hFile; // [esp+14h] [ebp-1020h]
  DWORD dwFileAttributes; // [esp+18h] [ebp-101Ch]
  FILETIME v13; // [esp+1Ch] [ebp-1018h] BYREF
  FILETIME v14; // [esp+24h] [ebp-1010h] BYREF
  FILETIME v15; // [esp+2Ch] [ebp-1008h] BYREF
  WCHAR FileName[2048]; // [esp+34h] [ebp-1000h] BYREF

  v4 = 1;
  if ( !a2 || (v8 = 1, !*(_QWORD *)a2) )
    v8 = 0;
  if ( !a3 || (v10 = 1, !*(_QWORD *)a3) )
    v10 = 0;
  if ( !a4 || (v9 = 1, !*(_QWORD *)a4) )
    v9 = 0;
  v5 = sub_40258C(lpFileName);
  dwFileAttributes = v5;
  if ( v5 == -1 || (v5 & 1) == 0 )
    v4 = 0;
  else
    sub_40284A(lpFileName, 0);
  hFile = CreateFileW(lpFileName, 0x40000000u, 3u, 0, 3u, 0x2000000u, 0);
  if ( hFile != (HANDLE)-1
    || (LOBYTE(FileW) = sub_4033EC(lpFileName, FileName, 0x800u), (_BYTE)FileW)
    && (FileW = CreateFileW(FileName, 0x40000000u, 3u, 0, 3u, 0x2000000u, 0), hFile = FileW, FileW != (HANDLE)-1) )
  {
    if ( v8 )
      sub_404DA6(a2, &v13);
    if ( v10 )
      sub_404DA6(a3, &v15);
    if ( v9 )
      sub_404DA6(a4, &v14);
    SetFileTime(hFile, v10 != 0 ? &v15 : 0, v9 != 0 ? &v14 : 0, v8 != 0 ? &v13 : 0);
    LOBYTE(FileW) = CloseHandle(hFile);
    if ( v4 )
      LOBYTE(FileW) = sub_40284A(lpFileName, dwFileAttributes);
  }
  return (char)FileW;
}
// 4026B1: using guessed type FILETIME var_1018;
// 4026B1: using guessed type FILETIME var_1008;
// 4026B1: using guessed type FILETIME var_1010;

//----- (0040284A) --------------------------------------------------------
bool __stdcall sub_40284A(WCHAR *lpFileName, DWORD dwFileAttributes)
{
  BOOL v2; // eax
  bool v3; // bl
  WCHAR FileName[2048]; // [esp+4h] [ebp-1000h] BYREF

  v2 = SetFileAttributesW(lpFileName, dwFileAttributes);
  v3 = v2;
  if ( !v2 && sub_4033EC(lpFileName, FileName, 0x800u) )
    return SetFileAttributesW(FileName, dwFileAttributes);
  return v3;
}

//----- (004028A3) --------------------------------------------------------
_DWORD *__thiscall sub_4028A3(_DWORD *this)
{
  _DWORD *result; // eax

  this[1025] = -1;
  *(_WORD *)this = 0;
  result = this;
  *((_BYTE *)this + 4096) = 1;
  return result;
}

//----- (004028B9) --------------------------------------------------------
HANDLE __thiscall sub_4028B9(HANDLE *this)
{
  HANDLE result; // eax

  result = this[1025];
  if ( result != (HANDLE)-1 )
    return (HANDLE)FindClose(this[1025]);
  return result;
}

//----- (004028CC) --------------------------------------------------------
char __stdcall sub_4028CC(wchar_t *String, wchar_t *Destination, int a3)
{
  void *v4; // eax
  bool v5; // al
  int v6; // [esp-4h] [ebp-8h]
  unsigned int v7; // [esp-4h] [ebp-8h]

  *((_BYTE *)Destination + 4164) = 0;
  if ( sub_40360D(String) )
    return 0;
  v4 = (void *)sub_4029F7((HANDLE)0xFFFFFFFF, String, Destination);
  if ( v4 == (void *)-1 )
    return 0;
  FindClose(v4);
  v6 = *((_DWORD *)Destination + 1026);
  *((_DWORD *)Destination + 1040) = 0;
  v5 = sub_4025E8(v6);
  v7 = *((_DWORD *)Destination + 1026);
  *((_BYTE *)Destination + 4108) = v5;
  *((_BYTE *)Destination + 4109) = sub_402600(v7);
  return 1;
}

//----- (00402930) --------------------------------------------------------
char __thiscall sub_402930(WCHAR *lpFileName, wchar_t *String, int a3)
{
  int v4; // eax
  bool v5; // al
  wchar_t *v6; // ebx
  int v8; // [esp-4h] [ebp-10h]
  unsigned int v9; // [esp-4h] [ebp-10h]

  do
  {
    *((_BYTE *)String + 4164) = 0;
    if ( !*lpFileName )
      return 0;
    if ( *((_BYTE *)lpFileName + 4096) )
    {
      v4 = sub_4029F7((HANDLE)0xFFFFFFFF, lpFileName, String);
      *((_DWORD *)lpFileName + 1025) = v4;
    }
    else
    {
      v4 = sub_4029F7(*((HANDLE *)lpFileName + 1025), lpFileName, String);
    }
    if ( v4 == -1 )
      return 0;
    v8 = *((_DWORD *)String + 1026);
    *((_DWORD *)String + 1040) = 0;
    v5 = sub_4025E8(v8);
    v9 = *((_DWORD *)String + 1026);
    *((_BYTE *)String + 4108) = v5;
    *((_BYTE *)String + 4109) = sub_402600(v9);
    *((_BYTE *)lpFileName + 4096) = 0;
    v6 = sub_4036A6(String);
  }
  while ( !wcscmp(v6, asc_422268) || !wcscmp(v6, L"..") );
  return 1;
}

//----- (004029DD) --------------------------------------------------------
wchar_t *__thiscall sub_4029DD(wchar_t *Destination, wchar_t *Source)
{
  wchar_t *result; // eax

  result = wcscpy(Destination, Source);
  *((_BYTE *)Destination + 4096) = 1;
  return result;
}

//----- (004029F7) --------------------------------------------------------
int __stdcall sub_4029F7(HANDLE hFindFile, WCHAR *lpFileName, wchar_t *Destination)
{
  int FirstFileW; // esi
  DWORD LastError; // eax
  bool v5; // al
  DWORD nFileSizeHigh; // ecx
  struct _WIN32_FIND_DATAW FindFileData; // [esp+10h] [ebp-1250h] BYREF
  WCHAR FileName[2048]; // [esp+260h] [ebp-1000h] BYREF

  FirstFileW = (int)hFindFile;
  if ( hFindFile == (HANDLE)-1 )
  {
    FirstFileW = (int)FindFirstFileW(lpFileName, &FindFileData);
    if ( FirstFileW == -1 )
    {
      if ( !sub_4033EC(lpFileName, FileName, 0x800u)
        || (FirstFileW = (int)FindFirstFileW(FileName, &FindFileData), FirstFileW == -1) )
      {
        LastError = GetLastError();
        v5 = LastError != 2 && LastError != 3 && LastError != 18;
        *((_BYTE *)Destination + 4164) = v5;
        goto LABEL_15;
      }
    }
LABEL_14:
    sub_4045C8(Destination, lpFileName, 2048);
    sub_40375A(Destination, FindFileData.cFileName, 2048);
    nFileSizeHigh = FindFileData.nFileSizeHigh;
    *((_DWORD *)Destination + 1024) = FindFileData.nFileSizeLow;
    *((_DWORD *)Destination + 1026) = FindFileData.dwFileAttributes;
    *((FILETIME *)Destination + 517) = FindFileData.ftCreationTime;
    *((FILETIME *)Destination + 518) = FindFileData.ftLastAccessTime;
    *((FILETIME *)Destination + 519) = FindFileData.ftLastWriteTime;
    *((_DWORD *)Destination + 1025) = nFileSizeHigh;
    sub_404D93((_DWORD *)Destination + 1028, (int *)&FindFileData.ftLastWriteTime);
    sub_404D93((_DWORD *)Destination + 1030, (int *)&FindFileData.ftCreationTime);
    sub_404D93((_DWORD *)Destination + 1032, (int *)&FindFileData.ftLastAccessTime);
    goto LABEL_15;
  }
  if ( !FindNextFileW(hFindFile, &FindFileData) )
  {
    FirstFileW = -1;
    *((_BYTE *)Destination + 4164) = GetLastError() != 18;
  }
  if ( FirstFileW != -1 )
    goto LABEL_14;
LABEL_15:
  *((_DWORD *)Destination + 1040) = 0;
  return FirstFileW;
}

//----- (00402B7C) --------------------------------------------------------
int sub_402B7C()
{
  DWORD dwPlatformId; // ecx
  DWORD dwMajorVersion; // eax
  DWORD dwMinorVersion; // edx
  struct _OSVERSIONINFOW VersionInformation; // [esp+0h] [ebp-114h] BYREF

  dwPlatformId = dword_42B000;
  if ( dword_42B000 == -1 )
  {
    VersionInformation.dwOSVersionInfoSize = 276;
    GetVersionExW(&VersionInformation);
    dwPlatformId = VersionInformation.dwPlatformId;
    dwMajorVersion = VersionInformation.dwMajorVersion;
    dwMinorVersion = VersionInformation.dwMinorVersion;
    dword_42B000 = VersionInformation.dwPlatformId;
    dword_42DA78 = VersionInformation.dwMajorVersion;
    dword_42DA7C = VersionInformation.dwMinorVersion;
  }
  else
  {
    dwMajorVersion = dword_42DA78;
    dwMinorVersion = dword_42DA7C;
  }
  if ( dwPlatformId == 2 )
    return dwMinorVersion + (dwMajorVersion << 8);
  else
    return 1281;
}
// 42B000: using guessed type int dword_42B000;
// 42DA78: using guessed type int dword_42DA78;
// 42DA7C: using guessed type int dword_42DA7C;

//----- (00402BEC) --------------------------------------------------------
char __stdcall sub_402BEC(wchar_t *String, wchar_t *String2, int a3)
{
  bool v3; // di
  size_t v4; // eax
  int v5; // eax
  int v7; // eax
  size_t v8; // eax
  wchar_t *v9; // ebx
  unsigned __int16 *v10; // [esp-Ch] [ebp-2020h]
  wchar_t *v11; // [esp-8h] [ebp-201Ch]
  bool v12; // [esp-4h] [ebp-2018h]
  size_t v13; // [esp+10h] [ebp-2004h]
  wchar_t *v14; // [esp+10h] [ebp-2004h]
  wchar_t String1[2048]; // [esp+14h] [ebp-2000h] BYREF
  wchar_t Destination[2048]; // [esp+1014h] [ebp-1000h] BYREF

  v3 = a3 < 0;
  if ( (_WORD)a3 )
  {
    v4 = wcslen(String);
    v13 = v4;
    if ( (unsigned __int16)a3 != 2 && (unsigned __int16)a3 != 3 && !sub_402ECB(String, String2, v4, v3) )
    {
      v5 = String2[v13];
      if ( v5 == 92 || v5 == 47 || !(_WORD)v5 )
        return 1;
    }
    if ( (unsigned __int16)a3 == 1 )
      return 0;
    sub_4032C6(String, String1, 2048);
    sub_4032C6(String2, Destination, 2048);
    if ( (unsigned __int16)a3 == 2 || (unsigned __int16)a3 == 3 )
    {
      if ( sub_402EAA(String1, Destination, v3) )
        return 0;
    }
    if ( (unsigned __int16)a3 == 4 || (unsigned __int16)a3 == 5 )
    {
      if ( sub_40360D(String1) )
      {
        v12 = a3 < 0;
        v11 = String2;
        v10 = String;
        return sub_402D79(v10, v11, v12);
      }
      if ( (unsigned __int16)a3 == 4 || sub_40360D(String) )
      {
        if ( !String1[0] )
          goto LABEL_25;
        v8 = wcslen(String1);
        v7 = sub_402ECB(String1, Destination, v8, v3);
      }
      else
      {
        v7 = sub_402EAA(String1, Destination, v3);
      }
      if ( v7 )
        return 0;
    }
  }
LABEL_25:
  v14 = sub_4036A6(String);
  v9 = sub_4036A6(String2);
  if ( !sub_405666(L"__rar_", v9, 6u) )
    return 0;
  v12 = a3 < 0;
  v11 = v9;
  v10 = v14;
  if ( (unsigned __int16)a3 != 2 )
    return sub_402D79(v10, v11, v12);
  return sub_402EAA(v14, v9, v3) == 0;
}

//----- (00402D79) --------------------------------------------------------
bool __stdcall sub_402D79(unsigned __int16 *a1, wchar_t *Str, char a3)
{
  int v5; // edi
  unsigned __int16 v6; // cx
  char v8; // bl
  wchar_t *v9; // eax
  wchar_t *v10; // edi
  wchar_t *v11; // edi
  char v12; // al

  while ( 1 )
  {
    v5 = (unsigned __int16)sub_402EF0((LPWSTR)*Str, a3);
    v6 = (unsigned __int16)sub_402EF0((LPWSTR)*a1++, a3);
    if ( !v6 )
      return (_WORD)v5 == 0;
    if ( v6 == 42 )
      break;
    if ( v6 == 63 )
    {
      if ( !(_WORD)v5 )
        return 0;
LABEL_11:
      ++Str;
    }
    else
    {
      if ( v6 == (_WORD)v5 )
        goto LABEL_11;
      if ( v6 != 46 || (_WORD)v5 && v5 != 92 && (_WORD)v5 != 46 )
        return 0;
    }
  }
  if ( !*a1 )
    return 1;
  v8 = 0;
  if ( *a1 != 46 )
    goto LABEL_27;
  if ( a1[1] == 42 && !a1[2] )
    return 1;
  v9 = wcschr(Str, 0x2Eu);
  v10 = v9;
  if ( a1[1] )
  {
    if ( !v9 || (Str = v9, wcspbrk(a1, L"*?")) || (v11 = v10 + 1, wcschr(v11, 0x2Eu)) )
    {
LABEL_27:
      while ( *Str )
      {
        v12 = sub_402D79((int)a1, Str++, a3);
        if ( v12 )
          return 1;
      }
      return 0;
    }
    return sub_402EAA(a1 + 1, v11, a3) == 0;
  }
  else
  {
    if ( !v9 || !v9[1] )
      return 1;
    return v8;
  }
}

//----- (00402EAA) --------------------------------------------------------
int __stdcall sub_402EAA(wchar_t *String1, wchar_t *String2, char a3)
{
  if ( a3 )
    return wcscmp(String1, String2);
  else
    return sub_404597(String1, String2);
}

//----- (00402ECB) --------------------------------------------------------
int __stdcall sub_402ECB(wchar_t *String1, wchar_t *String2, size_t MaxCount, char a4)
{
  if ( a4 )
    return wcsncmp(String1, String2, MaxCount);
  else
    return sub_405666(String1, String2, MaxCount);
}

//----- (00402EF0) --------------------------------------------------------
LPWSTR __stdcall sub_402EF0(LPWSTR lpsz, char a2)
{
  if ( a2 )
    return lpsz;
  else
    return CharUpperW(lpsz);
}

//----- (00402F09) --------------------------------------------------------
char *__thiscall sub_402F09(char *this)
{
  sub_40411E(this + 16420);
  *((_DWORD *)this + 5210) = 0;
  *((_DWORD *)this + 5211) = 0;
  *((_DWORD *)this + 5212) = 0;
  *((_DWORD *)this + 5213) = 0;
  *((_DWORD *)this + 5224) = 0;
  *((_DWORD *)this + 5225) = 0;
  *((_DWORD *)this + 5226) = 0;
  *((_DWORD *)this + 5227) = 0;
  sub_402F92(this);
  return this;
}

//----- (00402F92) --------------------------------------------------------
int __thiscall sub_402F92(void *this)
{
  int result; // eax

  memset(this, 0, 0x72A8u);
  *((_DWORD *)this + 5196) = 0;
  result = 0x7FFFFFFF;
  *((_DWORD *)this + 5194) = 0;
  *((_DWORD *)this + 5217) = 0;
  *((_DWORD *)this + 3) = 0x2000000;
  *((_DWORD *)this + 5197) = 3;
  *((_DWORD *)this + 6307) = 4;
  *((_DWORD *)this + 5228) = 0x7FFFFFFF;
  *((_DWORD *)this + 5229) = 0x7FFFFFFF;
  *((_DWORD *)this + 5230) = 0x7FFFFFFF;
  *((_DWORD *)this + 5231) = 0x7FFFFFFF;
  *((_DWORD *)this + 5198) = 2;
  return result;
}

//----- (00402FFE) --------------------------------------------------------
wchar_t *__stdcall sub_402FFE(wchar_t *String, unsigned int a2)
{
  wchar_t *result; // eax

  result = (wchar_t *)wcslen(String);
  if ( result && String[(_DWORD)result - 1] != 92 )
  {
    result = (wchar_t *)((char *)result + 1);
    if ( (unsigned int)result < a2 )
      return wcscat(String, L"\\");
  }
  return result;
}

//----- (0040302E) --------------------------------------------------------
void __stdcall sub_40302E(WCHAR *lpFileName, wchar_t *Destination, int a3)
{
  DWORD FullPathNameW; // eax
  DWORD v4; // edi
  LPWSTR FilePart; // [esp+Ch] [ebp-2004h] BYREF
  WCHAR Buffer[2048]; // [esp+10h] [ebp-2000h] BYREF
  WCHAR FileName[2048]; // [esp+1010h] [ebp-1000h] BYREF

  if ( lpFileName && *lpFileName )
  {
    FullPathNameW = GetFullPathNameW(lpFileName, 0x800u, Buffer, &FilePart);
    v4 = FullPathNameW;
    if ( (!FullPathNameW || FullPathNameW > 0x800) && sub_4033EC(lpFileName, FileName, 0x800u) )
      v4 = GetFullPathNameW(FileName, 0x800u, Buffer, &FilePart);
    if ( v4 && v4 < 0x800 )
    {
      sub_4045C8(Destination, Buffer, a3);
    }
    else if ( lpFileName != Destination )
    {
      sub_4045C8(Destination, lpFileName, a3);
    }
  }
  else if ( a3 )
  {
    *Destination = 0;
  }
}

//----- (004030FA) --------------------------------------------------------
wchar_t *__stdcall sub_4030FA(wchar_t *a1, wchar_t *Destination)
{
  wchar_t *v2; // esi
  wchar_t v3; // cx
  wchar_t *v4; // edi
  wchar_t v5; // ax
  wchar_t *v6; // edi
  wchar_t *v7; // eax
  wchar_t *v8; // eax
  wchar_t *v9; // ebp
  wchar_t v10; // bx
  wchar_t Source[2048]; // [esp+Ch] [ebp-1000h] BYREF

  v2 = a1;
  if ( *a1 )
  {
    v3 = *a1;
    v4 = a1 + 2;
    do
    {
      if ( sub_4035F5(v3) && *(v4 - 1) == 46 && *v4 == 46 && sub_4035F5(v4[1]) )
        v2 = v4 + 2;
      v5 = *(v4++ - 1);
      v3 = v5;
    }
    while ( v5 );
    a1 = v2;
  }
  if ( *v2 )
  {
    do
    {
      v6 = v2;
      if ( *v2 && v2[1] == 58 )
        v6 = v2 + 2;
      if ( *v6 == 92 && v6[1] == 92 )
      {
        v7 = wcschr(v6 + 2, 0x5Cu);
        if ( v7 )
        {
          v8 = wcschr(v7 + 1, 0x5Cu);
          if ( v8 )
            v6 = v8 + 1;
        }
      }
      v9 = v6;
      if ( *v6 )
      {
        v10 = *v6;
        do
        {
          if ( sub_4035F5(v10) )
          {
            v6 = v9 + 1;
          }
          else if ( v10 != 46 )
          {
            break;
          }
          v10 = *++v9;
        }
        while ( *v9 );
        v2 = a1;
      }
      if ( v6 == v2 )
        break;
      v2 = v6;
      a1 = v6;
    }
    while ( *v6 );
  }
  if ( *v2 == 46 && v2[1] == 46 && !v2[2] )
    v2 += 2;
  if ( Destination )
  {
    sub_4045C8(Source, v2, 2048);
    wcscpy(Destination, Source);
  }
  return v2;
}

//----- (00403251) --------------------------------------------------------
wchar_t *__stdcall sub_403251(WCHAR *lpSrcStr, int a2)
{
  wchar_t *result; // eax
  WCHAR DestStr[2048]; // [esp+0h] [ebp-1000h] BYREF

  result = (wchar_t *)sub_402B7C();
  if ( (unsigned int)result >= 0x600 )
  {
    result = (wchar_t *)FoldStringW(0x20u, lpSrcStr, -1, DestStr, 2048);
    if ( result )
    {
      DestStr[2047] = 0;
      return sub_4045C8(lpSrcStr, DestStr, a2);
    }
  }
  return result;
}

//----- (004032A5) --------------------------------------------------------
wchar_t *__stdcall sub_4032A5(wchar_t *String)
{
  wchar_t *v2; // eax

  if ( !String )
    return 0;
  v2 = sub_4036A6(String);
  return wcsrchr(v2, 0x2Eu);
}

//----- (004032C6) --------------------------------------------------------
void __stdcall sub_4032C6(wchar_t *Source, wchar_t *Destination, int a3)
{
  size_t v3; // edi

  if ( a3 )
  {
    v3 = a3 - 1;
    if ( a3 - 1 >= (unsigned int)(sub_4036A6(Source) - Source) )
      v3 = sub_4036A6(Source) - Source;
    wcsncpy(Destination, Source, v3);
    Destination[v3] = 0;
  }
}

//----- (00403309) --------------------------------------------------------
wchar_t *__stdcall sub_403309(wchar_t *String, wchar_t *Destination, size_t BufferCount)
{
  wchar_t *result; // eax
  wchar_t *v4; // eax
  size_t v5; // eax
  size_t v6; // esi

  *Destination = 0;
  result = (wchar_t *)sub_403593(String);
  if ( (_BYTE)result )
    return (wchar_t *)sub_4037C1((char *)Destination, BufferCount, (char *)L"%c:\\", *String);
  if ( *String == 92 && String[1] == 92 )
  {
    result = wcschr(String + 2, 0x5Cu);
    if ( result )
    {
      v4 = wcschr(result + 1, 0x5Cu);
      if ( v4 )
        v5 = v4 - String + 1;
      else
        v5 = wcslen(String);
      v6 = v5 < BufferCount ? v5 : 0;
      wcsncpy(Destination, String, v6);
      result = 0;
      Destination[v6] = 0;
    }
  }
  return result;
}

//----- (00403396) --------------------------------------------------------
wchar_t *__stdcall sub_403396(LPCCH lpMultiByteStr, wchar_t *Source, wchar_t *Destination, size_t Count)
{
  wchar_t *v4; // esi

  if ( Source && *Source )
  {
    v4 = Destination;
    if ( Destination != Source )
      wcsncpy(Destination, Source, Count);
  }
  else
  {
    v4 = Destination;
    if ( lpMultiByteStr )
      sub_405386(lpMultiByteStr, Destination, Count);
    else
      *Destination = 0;
  }
  if ( Count )
    v4[Count - 1] = 0;
  return v4;
}

//----- (004033EC) --------------------------------------------------------
char __stdcall sub_4033EC(wchar_t *Source, wchar_t *Destination, unsigned int a3)
{
  wchar_t *v3; // edi
  size_t v5; // esi
  DWORD CurrentDirectoryW; // eax
  WCHAR Buffer[2048]; // [esp+4h] [ebp-1000h] BYREF

  v3 = Source;
  if ( !*Source )
    return 0;
  sub_403593(Source);
  v5 = wcslen(Source);
  if ( !sub_4035BF(Source) )
  {
    CurrentDirectoryW = GetCurrentDirectoryW(0x7FFu, Buffer);
    if ( CurrentDirectoryW && CurrentDirectoryW <= 0x7FF )
    {
      if ( sub_4035F5(*Source) )
      {
        if ( a3 > v5 + 6 )
        {
          wcsncpy(Destination, L"\\\\?\\", 4u);
          wcsncpy(Destination + 4, Buffer, 2u);
          wcscpy(Destination + 6, Source);
          return 1;
        }
      }
      else
      {
        sub_402FFE(Buffer, 0x800u);
        if ( a3 > v5 + wcslen(Buffer) + 4 )
        {
          wcsncpy(Destination, L"\\\\?\\", 4u);
          wcscpy(Destination + 4, Buffer);
          if ( *Source == 46 && sub_4035F5(Source[1]) )
            v3 = Source + 2;
          sub_40459C(Destination, v3, a3);
          return 1;
        }
      }
    }
    return 0;
  }
  if ( sub_403593(Source) )
  {
    if ( a3 > v5 + 4 )
    {
      wcsncpy(Destination, L"\\\\?\\", 4u);
      wcscpy(Destination + 4, Source);
      return 1;
    }
  }
  else if ( *Source == 92 && Source[1] == 92 && a3 > v5 + 6 )
  {
    wcsncpy(Destination, L"\\\\?\\", 4u);
    wcscpy(Destination + 4, L"UNC");
    wcscpy(Destination + 7, Source + 1);
    return 1;
  }
  return 0;
}

//----- (00403593) --------------------------------------------------------
BOOL __stdcall sub_403593(unsigned __int16 *a1)
{
  return (unsigned __int16)((unsigned __int16)sub_4044CC(*a1) - 65) <= 0x19u && a1[1] == 58;
}

//----- (004035BF) --------------------------------------------------------
BOOL __stdcall sub_4035BF(unsigned __int16 *a1)
{
  return *a1 == 92 && a1[1] == 92 || sub_403593(a1) && sub_4035F5(a1[2]);
}

//----- (004035F5) --------------------------------------------------------
BOOL __stdcall sub_4035F5(int a1)
{
  return a1 == 92 || a1 == 47;
}

//----- (0040360D) --------------------------------------------------------
BOOL __stdcall sub_40360D(wchar_t *String)
{
  return String && wcspbrk(String, L"*?") != 0;
}

//----- (00403631) --------------------------------------------------------
wchar_t *__stdcall sub_403631(wchar_t *a1, wchar_t *Source, wchar_t *Destination, int a4)
{
  wchar_t String[2048]; // [esp+4h] [ebp-1000h] BYREF

  sub_4045C8(String, a1, 2048);
  sub_402FFE(String, 0x800u);
  sub_40459C(String, Source, 2048);
  return sub_4045C8(Destination, String, a4);
}

//----- (0040368A) --------------------------------------------------------
wchar_t *__stdcall sub_40368A(wchar_t *String)
{
  wchar_t *v1; // esi
  size_t v2; // eax

  v1 = String;
  v2 = wcslen(String);
  if ( v2 )
    return &String[v2 - 1];
  return v1;
}

//----- (004036A6) --------------------------------------------------------
wchar_t *__stdcall sub_4036A6(wchar_t *String)
{
  wchar_t *v1; // esi
  size_t v2; // edi

  v1 = String;
  v2 = wcslen(String);
  while ( (--v2 & 0x80000000) == 0 )
  {
    if ( sub_4035F5(String[v2]) )
      return &String[v2 + 1];
  }
  if ( *String )
  {
    if ( String[1] == 58 )
      return String + 2;
  }
  return v1;
}

//----- (004036E9) --------------------------------------------------------
wchar_t *__stdcall sub_4036E9(wchar_t *String)
{
  wchar_t *result; // eax

  result = sub_4036A6(String);
  if ( result >= String + 2 && (String[1] != 58 || result >= String + 4) )
    --result;
  *result = 0;
  return result;
}

//----- (00403715) --------------------------------------------------------
void __stdcall sub_403715(wchar_t *String, wchar_t *Source, int a3)
{
  wchar_t *v3; // eax

  if ( String && *String )
  {
    v3 = sub_4032A5(String);
    if ( v3 )
      *v3 = 0;
    if ( Source )
    {
      sub_40459C(String, (wchar_t *)asc_422268, a3);
      sub_40459C(String, Source, a3);
    }
  }
}

//----- (0040375A) --------------------------------------------------------
wchar_t *__stdcall sub_40375A(wchar_t *String, wchar_t *Source, int a3)
{
  wchar_t *v3; // eax

  v3 = sub_4036A6(String);
  return sub_4045C8(v3, Source, a3 - (v3 - String));
}

//----- (0040377F) --------------------------------------------------------
int __stdcall sub_40377F(unsigned __int16 *a1, int a2, int a3)
{
  unsigned int v3; // ecx
  unsigned __int16 *v4; // eax
  int v5; // edx
  int result; // eax

  v3 = 0;
  if ( a3 != 1 )
  {
    v4 = a1;
    do
    {
      v5 = *v4;
      if ( !(_WORD)v5 )
        break;
      if ( v5 == 47 )
        LOWORD(v5) = 92;
      *(unsigned __int16 *)((char *)v4 + a2 - (_DWORD)a1) = v5;
      ++v3;
      ++v4;
    }
    while ( v3 < a3 - 1 );
  }
  result = 0;
  *(_WORD *)(a2 + 2 * v3) = 0;
  return result;
}

//----- (004037C1) --------------------------------------------------------
int sub_4037C1(char *Buffer, size_t BufferCount, char *Format, ...)
{
  va_list va; // [esp+10h] [ebp+10h] BYREF

  va_start(va, Format);
  return _vsprintf_s_l(Buffer, BufferCount, Format, 0, va);
}

//----- (004037DD) --------------------------------------------------------
_DWORD *__thiscall sub_4037DD(_DWORD *this)
{
  *this = 0;
  this[1] = 0;
  *((_BYTE *)this + 16) = 0;
  return this;
}

//----- (004037F3) --------------------------------------------------------
char __thiscall sub_4037F3(__int16 **this, LPCWCH lpWideCharStr, _DWORD *a3, _DWORD *a4)
{
  char v4; // bl
  wchar_t *v5; // edi
  _DWORD *v6; // esi
  int v7; // eax
  _DWORD *v8; // ecx
  wchar_t Str[512]; // [esp+10h] [ebp-400h] BYREF

  v4 = 1;
  sub_403884(this, (wchar_t *)&String, Str, 512, 1, lpWideCharStr);
  v5 = wcschr(Str, 0x2Au);
  if ( v5 )
  {
    v6 = a3;
    *a3 = sub_405639(Str);
    v7 = sub_405639(v5 + 1);
    v8 = a4;
    *a4 = v7;
  }
  else
  {
    v8 = a4;
    v6 = a3;
    *a4 = 100;
    *a3 = 100;
  }
  if ( *v6 == 100 && *v8 == 100 )
    return 0;
  return v4;
}

//----- (00403884) --------------------------------------------------------
void __thiscall sub_403884(__int16 **this, wchar_t *Source, wchar_t *Str, int a4, int a5, LPCWCH lpWideCharStr)
{
  wchar_t *v7; // edx
  unsigned int v8; // edi
  unsigned int v9; // eax
  unsigned int v10; // eax
  unsigned int v11; // eax
  __int16 *v12; // eax
  const wchar_t *v13; // edi
  wchar_t *v14; // eax
  unsigned int v15; // esi
  wchar_t *v16; // eax
  char Buffer[20]; // [esp+10h] [ebp-2014h] BYREF
  CHAR v18[4096]; // [esp+24h] [ebp-2000h] BYREF
  CHAR MultiByteStr[4096]; // [esp+1024h] [ebp-1000h] BYREF

  if ( !*this )
    goto LABEL_22;
  v7 = (wchar_t *)&unk_4222F4;
  if ( a5 )
  {
    if ( a5 == 1 )
    {
      v7 = L"$";
    }
    else if ( a5 == 2 )
    {
      v7 = L"@";
    }
  }
  else
  {
    v7 = L"s";
  }
  v8 = sub_401773(0xFFFFFFFF, v7, 1u);
  if ( lpWideCharStr )
  {
    sub_40557F(lpWideCharStr, MultiByteStr, 4096);
    v9 = strlen(MultiByteStr);
    v8 = sub_401773(v8, MultiByteStr, v9);
  }
  sub_40557F(Source, v18, 4096);
  v18[4095] = 0;
  v10 = strlen(v18);
  v11 = sub_401773(v8, v18, v10);
  sub_4037C1(Buffer, 0xAu, (char *)L"%08x", ~v11);
  v12 = sub_403D31(this, (int)Buffer);
  if ( v12 )
  {
    v13 = (const wchar_t *)(v12 + 9);
    if ( v12[9] == 34 )
      v13 = (const wchar_t *)(v12 + 10);
    v14 = wcschr(v13, 0xCu);
    if ( v14 )
      v15 = v14 - v13;
    else
      v15 = 255;
    if ( v15 > a4 - 1 )
      v15 = a4 != 0 ? a4 - 1 : 0;
    if ( v15 )
      wcsncpy(Str, v13, v15);
    Str[v15] = 0;
    v16 = wcsrchr(Str, 0x22u);
    if ( v16 )
      *v16 = 0;
  }
  else
  {
LABEL_22:
    if ( Source != Str )
      wcscpy(Str, Source);
  }
}
// 4222F8: using guessed type wchar_t aS[2];
// 4222FC: using guessed type wchar_t asc_4222FC[2];
// 422300: using guessed type wchar_t asc_422300[2];

//----- (00403A07) --------------------------------------------------------
char __thiscall sub_403A07(int this, wchar_t *Str)
{
  char result; // al

  sub_403A2C((WCHAR **)this, Str);
  result = sub_403D9C(this);
  if ( *(_BYTE *)(this + 16) )
    return SetProcessDefaultLayout(1u);
  return result;
}

//----- (00403A2C) --------------------------------------------------------
char __thiscall sub_403A2C(WCHAR **this, wchar_t *Str)
{
  unsigned int v3; // ebx
  bool v4; // zf
  WCHAR *v5; // eax
  wchar_t *v6; // eax
  int v7; // edi
  DWORD v8; // eax
  signed int v9; // edi
  int v10; // eax
  WCHAR *v11; // eax
  DWORD v12; // eax
  WCHAR *v13; // eax
  WCHAR *v14; // edi
  int v15; // ecx
  WCHAR *v16; // ecx
  LPCCH v17; // edx
  __int16 v18; // di
  __int16 v20; // [esp-4h] [ebp-4058h]
  WCHAR Filename[2048]; // [esp+Ch] [ebp-4048h] BYREF
  __int16 Buffer[4096]; // [esp+100Ch] [ebp-3048h] BYREF
  _DWORD v23[1033]; // [esp+300Ch] [ebp-1048h] BYREF
  int v24; // [esp+4030h] [ebp-24h]
  int v25; // [esp+4034h] [ebp-20h]
  unsigned int i; // [esp+4038h] [ebp-1Ch]
  DWORD v27; // [esp+403Ch] [ebp-18h]
  int v28; // [esp+4040h] [ebp-14h]
  int v29; // [esp+4044h] [ebp-10h]
  int v30; // [esp+4050h] [ebp-4h]
  char Str_3; // [esp+405Fh] [ebp+Bh]

  v24 = 92;
  v3 = 0;
  v4 = wcschr(Str, 0x5Cu) == 0;
  v5 = Filename;
  if ( !v4 )
    goto LABEL_4;
  GetModuleFileNameW(0, Filename, 0x800u);
  v6 = wcsrchr(Filename, 0x5Cu);
  if ( v6 )
  {
    v5 = v6 + 1;
LABEL_4:
    wcscpy(v5, Str);
    sub_401BAB(v23);
    v30 = 0;
    if ( sub_401F07((int)v23, Filename, 4) )
    {
      v7 = -1;
      Str_3 = 0;
      v29 = -1;
      for ( i = 0; i < 0x100; ++i )
      {
        if ( v7 != -1 )
          goto LABEL_26;
        v28 = sub_402286((int)v23);
        v8 = sub_4020A8(v23, Buffer, 0x2000u);
        v27 = v8;
        v9 = 0;
        v25 = v8 - 16;
        if ( (int)(v8 - 16) < 0 )
        {
LABEL_23:
          v10 = v28;
          v7 = v29;
        }
        else
        {
          while ( 1 )
          {
            if ( *((_BYTE *)Buffer + v9) == 42 && *((_BYTE *)Buffer + v9 + 1) == 42 )
            {
              if ( !strncmp((const char *)&Buffer[1] + v9, "*messages***", 0xBu) )
                goto LABEL_22;
              v8 = v27;
            }
            if ( *(__int16 *)((char *)Buffer + v9) == 42
              && *(__int16 *)((char *)&Buffer[1] + v9) == 42
              && v9 <= (int)(v8 - 32)
              && !wcsncmp((const wchar_t *)((char *)&Buffer[2] + v9), L"*messages***", 0xBu) )
            {
              break;
            }
            if ( *((_BYTE *)Buffer + v9) == 82
              && *((_BYTE *)Buffer + v9 + 1) == 97
              && !strncmp((const char *)&Buffer[1] + v9, aR, 4u) )
            {
              goto LABEL_53;
            }
            if ( ++v9 > v25 )
              goto LABEL_23;
            v8 = v27;
          }
          Str_3 = 1;
LABEL_22:
          v10 = v28;
          v7 = v28 + v9;
          v29 = v7;
        }
        sub_40217B((int)v23, v27 - 16 + v10, 0);
      }
      if ( v7 != -1 )
      {
LABEL_26:
        sub_40217B((int)v23, v7, 0);
        v11 = (WCHAR *)malloc(0x80002u);
        *this = v11;
        if ( v11 )
        {
          v12 = sub_4020A8(v23, v11, 0x80000u);
          this[1] = (WCHAR *)v12;
          if ( Str_3 )
          {
            this[1] = (WCHAR *)(v12 >> 1);
LABEL_31:
            v15 = 0x40000;
            if ( (unsigned int)this[1] <= 0x40000 )
              v15 = (int)this[1];
            (*this)[v15] = 0;
            v16 = 0;
            if ( this[1] )
            {
              while ( 1 )
              {
                v17 = (LPCCH)*this;
                v18 = (*this)[v3++];
                if ( !v18 )
                  goto LABEL_52;
                if ( v18 != (_WORD)v24 )
                  break;
                switch ( *(_WORD *)&v17[2 * v3] )
                {
                  case '"':
                    v20 = 34;
                    break;
                  case '\\':
                    v20 = 92;
                    break;
                  case 'n':
                    v20 = 10;
                    break;
                  case 'r':
                    v20 = 13;
                    break;
                  case 't':
                    v20 = 9;
                    break;
                  default:
                    goto LABEL_50;
                }
                *(_WORD *)&v17[2 * (_DWORD)v16] = v20;
                ++v3;
LABEL_51:
                v16 = (WCHAR *)((char *)v16 + 1);
                if ( v3 >= (unsigned int)this[1] )
                  goto LABEL_52;
              }
              if ( v18 == 13 || v18 == 10 )
                v18 = 12;
LABEL_50:
              *(_WORD *)&v17[2 * (_DWORD)v16] = v18;
              goto LABEL_51;
            }
LABEL_52:
            (*this)[(_DWORD)v16] = 0;
            this[1] = v16;
            goto LABEL_53;
          }
          v13 = (WCHAR *)malloc(2 * v12 + 2);
          v14 = v13;
          if ( v13 )
          {
            *((_BYTE *)this[1] + (_DWORD)*this) = 0;
            sub_405386((LPCCH)*this, v13, (int)this[1] + 1);
            j___free_base(*this);
            *this = v14;
            goto LABEL_31;
          }
        }
      }
    }
LABEL_53:
    LOBYTE(v6) = sub_401BE1(v23);
  }
  return (char)v6;
}
// 403A2C: using guessed type _DWORD var_1048[1033];

//----- (00403D29) --------------------------------------------------------
BOOL __thiscall sub_403D29(_DWORD *this)
{
  return *this != 0;
}

//----- (00403D31) --------------------------------------------------------
__int16 *__thiscall sub_403D31(__int16 **this, int a2)
{
  __int16 *v2; // esi
  __int16 v3; // ax

  v2 = *this;
  v3 = **this;
  if ( v3 )
  {
    do
    {
      if ( v3 == *(_WORD *)a2
        && !wcsncmp((const wchar_t *)v2 + 1, (const wchar_t *)(a2 + 2), 7u)
        && v2[8] == 61
        && v2[9] == 34 )
      {
        return v2;
      }
      while ( *v2 )
      {
        if ( *v2 == 12 )
          goto LABEL_11;
        ++v2;
      }
      while ( *v2 == 12 )
LABEL_11:
        ++v2;
      v3 = *v2;
    }
    while ( *v2 );
  }
  return 0;
}

//----- (00403D9C) --------------------------------------------------------
char __thiscall sub_403D9C(int this)
{
  HMODULE ModuleHandleW; // eax
  HRSRC ResourceW; // eax
  wchar_t String1[1024]; // [esp+8h] [ebp-800h] BYREF

  ModuleHandleW = GetModuleHandleW(0);
  ResourceW = FindResourceW(ModuleHandleW, L"RTL", (LPCWSTR)5);
  if ( ResourceW )
  {
    *(_BYTE *)(this + 16) = 1;
  }
  else
  {
    sub_403884((__int16 **)this, (wchar_t *)L"LTR", String1, 1024, 1, L"LTR");
    LOBYTE(ResourceW) = wcscmp(String1, L"RTL") == 0;
    *(_BYTE *)(this + 16) = (_BYTE)ResourceW;
  }
  return (char)ResourceW;
}

//----- (00403E04) --------------------------------------------------------
void __thiscall sub_403E04(_BYTE *this, HWND hWnd)
{
  LONG WindowLongW; // eax

  if ( this[16] )
  {
    WindowLongW = GetWindowLongW(hWnd, -20);
    SetWindowLongW(hWnd, -20, (unsigned int)&_ImageBase | WindowLongW);
  }
}

//----- (00403E2E) --------------------------------------------------------
HWND __thiscall sub_403E2E(__int16 **this, HWND hWnd, LPCWCH lpWideCharStr, char a4)
{
  __int16 **v4; // ebx
  int v5; // ebp
  int v6; // edi
  UINT v7; // ebx
  int v8; // ebp
  HWND result; // eax
  HWND v10; // edi
  int v11; // ebx
  char v12; // [esp+13h] [ebp-851h]
  int v13; // [esp+14h] [ebp-850h] BYREF
  int v14; // [esp+18h] [ebp-84Ch] BYREF
  int v15; // [esp+1Ch] [ebp-848h]
  int cy; // [esp+20h] [ebp-844h]
  int X; // [esp+24h] [ebp-840h]
  __int16 **v18; // [esp+28h] [ebp-83Ch]
  int v19; // [esp+2Ch] [ebp-838h]
  int v20; // [esp+30h] [ebp-834h]
  struct tagRECT Rect; // [esp+34h] [ebp-830h] BYREF
  struct tagRECT v22; // [esp+44h] [ebp-820h] BYREF
  struct tagRECT v23; // [esp+54h] [ebp-810h] BYREF
  WCHAR String[1024]; // [esp+64h] [ebp-800h] BYREF

  v4 = this;
  v18 = this;
  v12 = sub_4037F3(this, lpWideCharStr, &v14, &v13);
  GetWindowRect(hWnd, &Rect);
  GetClientRect(hWnd, &v23);
  v19 = 100;
  v5 = Rect.bottom - Rect.top + 1 - v23.bottom;
  v20 = Rect.right - Rect.left + 1 - v23.right;
  if ( v12 )
  {
    if ( a4 )
      goto LABEL_12;
    v15 = v20 + v14 * v23.right / 100;
    cy = v5 + v13 * v23.bottom / v19;
    v6 = Rect.top + (Rect.bottom - Rect.top + 1 - cy) / 2;
    X = Rect.left + (Rect.right - Rect.left + 1 - v15) / 2;
    if ( X < 0 )
      X = 0;
    if ( v6 < 0 )
      v6 = 0;
    v7 = 516;
    if ( (GetWindowLongW(hWnd, -16) & 0x800) == 0 )
      v7 = 518;
    SetWindowPos(hWnd, 0, X, v6, v15, cy, v7);
    GetWindowRect(hWnd, &Rect);
    v4 = v18;
  }
  if ( !a4 )
  {
    GetWindowTextW(hWnd, String, 1024);
    sub_403884(v4, String, String, 1024, 1, lpWideCharStr);
    SetWindowTextW(hWnd, String);
  }
LABEL_12:
  v8 = v5 - GetSystemMetrics(8);
  result = GetWindow(hWnd, 5u);
  v10 = result;
  v11 = 0;
  v15 = (int)result;
  while ( v10 && v11 < 512 )
  {
    GetWindowTextW(v10, String, 1024);
    if ( String[0] )
    {
      sub_403884(v18, String, String, 1024, 1, lpWideCharStr);
      SetWindowTextW(v10, String);
    }
    if ( v12 )
    {
      GetWindowRect(v10, &v22);
      SetWindowPos(
        v10,
        0,
        v14 * (v22.left - v20 / 2 - Rect.left) / 100,
        v13 * (v22.top - v8 - Rect.top) / 100,
        v14 * (v22.right - v22.left + 1) / v19,
        v13 * (v22.bottom - v22.top + 1) / 100,
        0x204u);
    }
    result = GetWindow(v10, 2u);
    v10 = result;
    if ( result == (HWND)v15 )
      break;
    ++v11;
  }
  return result;
}

//----- (004040A7) --------------------------------------------------------
WCHAR *__stdcall sub_4040A7(UINT uID)
{
  WCHAR *v1; // esi

  dword_42FA88 = (unsigned int)(dword_42FA88 + 1) < 8 ? dword_42FA88 + 1 : 0;
  v1 = (WCHAR *)((char *)&unk_42DA88 + 1024 * dword_42FA88);
  *v1 = 0;
  if ( sub_403D29(&unk_44A30C) || !LoadStringW(hInstance, uID, v1, 512) )
    LoadStringW(dword_4481D8, uID, v1, 512);
  sub_403884((__int16 **)&unk_44A30C, v1, v1, 512, 0, 0);
  return v1;
}
// 42FA88: using guessed type int dword_42FA88;

//----- (0040411E) --------------------------------------------------------
char *__thiscall sub_40411E(char *this)
{
  this[257] = 0;
  sub_4042D3(this, (wchar_t *)&String);
  return this;
}

//----- (00404157) --------------------------------------------------------
_BYTE *__thiscall sub_404157(_BYTE *this)
{
  this[256] = 0;
  return sub_40431E(this, 256);
}

//----- (0040416A) --------------------------------------------------------
_WORD *__thiscall sub_40416A(char *Src, _WORD *a2, int a3)
{
  _WORD *result; // eax

  if ( Src[256] )
  {
    sub_4041E1(Src, Src, 0x80u, a2, a3, 0);
    result = 0;
    a2[a3 - 1] = 0;
  }
  else
  {
    result = a2;
    *a2 = 0;
  }
  return result;
}

//----- (004041A3) --------------------------------------------------------
void __thiscall sub_4041A3(HMODULE *this)
{
  HMODULE v2; // eax
  BOOL (__stdcall *CryptProtectMemory)(LPVOID, DWORD, DWORD); // eax
  HMODULE v4; // [esp-8h] [ebp-Ch]

  if ( !*((_BYTE *)this + 4) )
  {
    v2 = sub_4047AA((wchar_t *)L"Crypt32.dll");
    *this = v2;
    if ( v2 )
    {
      CryptProtectMemory = (BOOL (__stdcall *)(LPVOID, DWORD, DWORD))GetProcAddress(v2, "CryptProtectMemory");
      v4 = *this;
      this[2] = (HMODULE)CryptProtectMemory;
      this[3] = (HMODULE)GetProcAddress(v4, "CryptUnprotectMemory");
    }
    *((_BYTE *)this + 4) = 1;
  }
}

//----- (004041E1) --------------------------------------------------------
DWORD __thiscall sub_4041E1(char *this, void *Src, unsigned int a3, void *a4, unsigned int a5, char a6)
{
  unsigned int v6; // eax

  v6 = a3;
  if ( a3 >= a5 )
    v6 = a5;
  memmove(a4, Src, 2 * v6);
  return sub_404222((int)a4, 2 * a5, a6, this[257]);
}

//----- (00404222) --------------------------------------------------------
DWORD __stdcall sub_404222(int a1, unsigned int a2, char a3, char a4)
{
  int (__stdcall *v4)(int, unsigned int, bool); // ecx
  DWORD result; // eax
  unsigned int v6; // edx
  DWORD v7; // ebx
  char *v8; // [esp-8h] [ebp-8h]

  v4 = (int (__stdcall *)(int, unsigned int, bool))dword_42FA94;
  if ( !dword_42FA94 )
  {
    sub_4041A3(dword_42FA8C);
    v4 = (int (__stdcall *)(int, unsigned int, bool))dword_42FA94;
  }
  if ( a3 )
  {
    if ( v4 )
    {
      result = v4(a1, a2 - (a2 & 0xF), a4 != 0);
      if ( result )
        return result;
      v8 = (char *)L"CryptProtectMemory failed";
      goto LABEL_7;
    }
    goto LABEL_11;
  }
  if ( !dword_42FA98 )
  {
LABEL_11:
    result = GetCurrentProcessId();
    v6 = 0;
    v7 = result;
    if ( a2 )
    {
      LOBYTE(v7) = result + 75;
      do
      {
        result = v6 + v7;
        *(_BYTE *)(v6 + a1) ^= (_BYTE)v6 + (_BYTE)v7;
        ++v6;
      }
      while ( v6 < a2 );
    }
    return result;
  }
  result = dword_42FA98(a1, a2 - (a2 & 0xF), a4 != 0);
  if ( !result )
  {
    v8 = (char *)L"CryptUnprotectMemory failed";
LABEL_7:
    sub_40198C((int)&dword_44A2FC, v8);
    return sub_401987(2);
  }
  return result;
}
// 414249: using guessed type _DWORD _guard_check_icall_nop();
// 42238C: using guessed type wchar_t aCryptunprotect_0[28];
// 42FA8C: using guessed type HMODULE dword_42FA8C[2];
// 42FA94: using guessed type int dword_42FA94;
// 42FA98: using guessed type int (__stdcall *dword_42FA98)(_DWORD, _DWORD, _DWORD);
// 44A2FC: using guessed type int dword_44A2FC;

//----- (004042D3) --------------------------------------------------------
void *__thiscall sub_4042D3(char *this, wchar_t *String)
{
  size_t v4; // eax

  if ( *String )
  {
    this[256] = 1;
    v4 = wcslen(String);
    return (void *)sub_4041E1(this, String, v4 + 1, this, 0x80u, 1);
  }
  else
  {
    this[256] = 0;
    return memset(this, 0, 0x100u);
  }
}

//----- (0040431E) --------------------------------------------------------
_BYTE *__stdcall sub_40431E(_BYTE *a1, int a2)
{
  int v2; // ecx
  _BYTE *result; // eax

  v2 = a2;
  for ( result = a1; v2; --v2 )
    *result++ = 0;
  return result;
}

//----- (00404336) --------------------------------------------------------
char __stdcall sub_404336(unsigned __int8 *lpszSrc, LPWSTR lpWideCharStr, int cchWideChar, int a4)
{
  int v4; // esi
  LPWSTR v5; // edi
  char result; // al
  CHAR *v7; // eax
  CHAR szDst[2048]; // [esp+8h] [ebp-800h] BYREF

  if ( a4 == 2 )
  {
    v4 = cchWideChar;
    v5 = lpWideCharStr;
    result = sub_405401(lpszSrc, lpWideCharStr, cchWideChar);
  }
  else
  {
    if ( a4 == 1 )
    {
      sub_404453((LPCSTR)lpszSrc, szDst, 0x800u);
      v7 = szDst;
    }
    else
    {
      v7 = (CHAR *)lpszSrc;
    }
    v4 = cchWideChar;
    v5 = lpWideCharStr;
    result = sub_405386(v7, lpWideCharStr, cchWideChar);
  }
  if ( v4 )
  {
    result = 0;
    v5[v4 - 1] = 0;
  }
  return result;
}

//----- (0040439F) --------------------------------------------------------
unsigned __int16 *__stdcall sub_40439F(unsigned __int16 *a1, int a2, int a3)
{
  unsigned __int16 v4; // di
  unsigned int v6; // ebx
  bool v7; // al
  bool v8; // [esp+Ch] [ebp+4h]

  while ( sub_404496(*a1) )
    ++a1;
  v4 = *a1;
  if ( !*a1 )
    return 0;
  v6 = 0;
  v7 = 0;
  v8 = 0;
  do
  {
    if ( !v7 )
    {
      if ( sub_404496(v4) )
        break;
      v7 = v8;
    }
    if ( v4 == 34 )
    {
      if ( a1[1] != 34 )
      {
        v7 = !v7;
        v8 = v7;
        goto LABEL_21;
      }
      if ( a2 && v6 < a3 - 1 )
        *(_WORD *)(a2 + 2 * v6++) = 34;
      ++a1;
    }
    else
    {
      if ( !a2 )
        goto LABEL_21;
      if ( v6 < a3 - 1 )
        *(_WORD *)(a2 + 2 * v6++) = v4;
    }
    v7 = v8;
LABEL_21:
    v4 = *++a1;
  }
  while ( *a1 );
  if ( a2 )
    *(_WORD *)(a2 + 2 * v6) = 0;
  return a1;
}

//----- (00404453) --------------------------------------------------------
BOOL __stdcall sub_404453(LPCSTR lpszSrc, LPSTR lpszDst, DWORD cchDstLength)
{
  DWORD v3; // edi
  size_t v4; // eax
  BOOL result; // eax

  v3 = cchDstLength;
  v4 = strlen(lpszSrc) + 1;
  if ( cchDstLength > v4 )
    v3 = v4;
  result = OemToCharBuffA(lpszSrc, lpszDst, v3);
  lpszDst[v3 - 1] = 0;
  return result;
}

//----- (00404484) --------------------------------------------------------
BOOL __stdcall sub_404484(int a1)
{
  return (unsigned int)(a1 - 48) <= 9;
}

//----- (00404496) --------------------------------------------------------
BOOL __stdcall sub_404496(int a1)
{
  return a1 == 32 || a1 == 9;
}

//----- (004044AE) --------------------------------------------------------
char __stdcall sub_4044AE(char *a1)
{
  while ( 1 )
  {
    if ( !*a1 )
      return 1;
    if ( *a1 < 32 )
      break;
    ++a1;
  }
  return 0;
}

//----- (004044CC) --------------------------------------------------------
LPWSTR __stdcall sub_4044CC(unsigned __int16 a1)
{
  if ( a1 == 105 )
    return (LPWSTR)73;
  else
    return CharUpperW((LPWSTR)a1);
}

//----- (004044E8) --------------------------------------------------------
int __stdcall sub_4044E8(__int64 a1, int a2, int a3)
{
  __int64 v3; // rax
  int v4; // ebx
  unsigned int v5; // ecx
  unsigned int v6; // esi
  unsigned int v7; // edi
  int v8; // ebp
  unsigned int v9; // ebp
  __int64 v10; // rcx
  __int16 *v11; // ecx
  __int16 v12; // ax
  int result; // eax
  signed __int64 v14; // [esp-10h] [ebp-94h]
  int v15; // [esp+10h] [ebp-74h]
  int v16; // [esp+14h] [ebp-70h]
  int v17[26]; // [esp+1Ch] [ebp-68h] BYREF

  HIDWORD(v3) = HIDWORD(a1);
  v4 = a1;
  v5 = 1;
  v6 = 0;
  v15 = 1;
  v7 = 0;
  if ( a1 < 0 )
  {
    v4 = -(int)a1;
    v8 = 1;
    v16 = 1;
    HIDWORD(v3) = (unsigned __int64)-a1 >> 32;
  }
  else
  {
    v8 = 0;
    v16 = 0;
  }
  v9 = a3 - v8;
  do
  {
    if ( v5 >= v9 )
      break;
    v14 = __PAIR64__(HIDWORD(v3), v4);
    v10 = __SPAIR64__(HIDWORD(v3), v4) % 10;
    v3 = v14 / 10;
    HIWORD(v17[0]) = HIWORD(v10);
    *((_WORD *)&v17[1] + v7) = v10 + 48;
    v4 = v14 / 10;
    ++v7;
    v5 = ++v15;
  }
  while ( v14 / 10 );
  if ( v16 )
    *((_WORD *)&v17[1] + v7++) = 45;
  if ( v7 )
  {
    v11 = (__int16 *)v17 + v7 + 1;
    do
    {
      v12 = *v11--;
      *(_WORD *)(a2 + 2 * v6++) = v12;
    }
    while ( v6 < v7 );
  }
  result = 0;
  *(_WORD *)(a2 + 2 * v7) = 0;
  return result;
}

//----- (0040459C) --------------------------------------------------------
wchar_t *__stdcall sub_40459C(wchar_t *String, wchar_t *Source, int a3)
{
  size_t v3; // eax

  v3 = wcslen(String);
  if ( (int)(a3 - v3 - 1) > 0 )
    wcsncat(String, Source, a3 - v3 - 1);
  return String;
}

//----- (004045C8) --------------------------------------------------------
wchar_t *__stdcall sub_4045C8(wchar_t *Destination, wchar_t *Source, int a3)
{
  if ( a3 )
  {
    wcsncpy(Destination, Source, a3 - 1);
    Destination[a3 - 1] = 0;
  }
  return Destination;
}

//----- (004045F5) --------------------------------------------------------
_DWORD *__thiscall sub_4045F5(_DWORD *this)
{
  *this = 0;
  this[1] = 0;
  this[2] = 0;
  this[3] = 0;
  sub_40473D(this);
  return this;
}

//----- (00404614) --------------------------------------------------------
void __thiscall sub_404614(int this, int a2)
{
  unsigned int v3; // ecx
  unsigned int v4; // eax
  unsigned int v5; // edi
  void *v6; // ebx

  *(_DWORD *)(this + 4) += a2;
  v3 = *(_DWORD *)(this + 4);
  if ( v3 > *(_DWORD *)(this + 8) )
  {
    v4 = *(_DWORD *)(this + 12);
    if ( v4 && v3 > v4 )
    {
      sub_40198C((int)dword_44A2FC, (char *)L"Maximum allowed array size (%u) is exceeded", v4);
      sub_4019C4(dword_44A2FC);
    }
    v5 = *(_DWORD *)(this + 4);
    if ( v5 <= *(_DWORD *)(this + 8) + (*(_DWORD *)(this + 8) >> 2) + 32 )
      v5 = *(_DWORD *)(this + 8) + (*(_DWORD *)(this + 8) >> 2) + 32;
    v6 = realloc(*(void **)this, 2 * v5);
    if ( !v6 )
      sub_4019C4(dword_44A2FC);
    *(_DWORD *)(this + 8) = v5;
    *(_DWORD *)this = v6;
  }
}
// 44A2FC: using guessed type int dword_44A2FC[4];

//----- (0040468A) --------------------------------------------------------
wchar_t *__thiscall sub_40468A(_DWORD *this, wchar_t *Source)
{
  const wchar_t *v2; // edi
  int v4; // esi
  size_t v5; // eax
  wchar_t *result; // eax

  v2 = Source;
  if ( !Source )
    v2 = &String;
  v4 = this[1];
  v5 = wcslen(v2);
  sub_404614((int)this, v5 + 1);
  result = wcscpy((wchar_t *)(*this + 2 * v4), v2);
  ++this[5];
  return result;
}

//----- (004046C6) --------------------------------------------------------
const wchar_t *__thiscall sub_4046C6(wchar_t *this)
{
  wchar_t *v2; // [esp+0h] [ebp-4h] BYREF

  v2 = this;
  sub_4046DA(this, (const wchar_t **)&v2);
  return v2;
}

//----- (004046DA) --------------------------------------------------------
char __thiscall sub_4046DA(_DWORD *this, const wchar_t **a2)
{
  unsigned int v3; // ecx
  const wchar_t *v5; // edi

  v3 = this[4];
  if ( v3 < this[1] )
  {
    v5 = (const wchar_t *)(*this + 2 * v3);
    this[4] += wcslen(v5) + 1;
    if ( a2 )
      *a2 = v5;
    return 1;
  }
  else
  {
    if ( a2 )
      *a2 = 0;
    return 0;
  }
}

//----- (00404716) --------------------------------------------------------
char __thiscall sub_404716(wchar_t *this, wchar_t *Destination, int a3)
{
  char result; // al
  wchar_t *Source; // [esp+0h] [ebp-4h] BYREF

  Source = this;
  result = sub_4046DA(this, (const wchar_t **)&Source);
  if ( result )
  {
    sub_4045C8(Destination, Source, a3);
    return 1;
  }
  return result;
}

//----- (0040473D) --------------------------------------------------------
void __thiscall sub_40473D(_DWORD *this)
{
  this[4] = 0;
  sub_401708((int)this);
  this[5] = 0;
  this[22] = 0;
}

//----- (00404753) --------------------------------------------------------
void __thiscall sub_404753(_DWORD *this)
{
  this[4] = 0;
}

//----- (00404758) --------------------------------------------------------
int sub_404758()
{
  _EAX = 1;
  __asm { cpuid }
  if ( (_ECX & 0x80000) != 0 )
    return 4;
  if ( (_ECX & 0x200) != 0 )
    return 3;
  if ( (_EDX & 0x4000000) != 0 )
    return 2;
  return (_EDX >> 25) & 1;
}

//----- (004047AA) --------------------------------------------------------
HMODULE __stdcall sub_4047AA(wchar_t *Source)
{
  HMODULE result; // eax
  WCHAR Buffer[2048]; // [esp+4h] [ebp-1000h] BYREF

  result = (HMODULE)GetSystemDirectoryW(Buffer, 0x800u);
  if ( result )
  {
    sub_403631(Buffer, Source, Buffer, 2048);
    return LoadLibraryW(Buffer);
  }
  return result;
}

//----- (004047F4) --------------------------------------------------------
DWORD __stdcall sub_4047F4(char a1)
{
  HMODULE ModuleHandleW; // eax
  HMODULE v2; // esi
  BOOL (__stdcall *SetDllDirectoryW)(LPCWSTR); // eax
  BOOL (__stdcall *SetDefaultDllDirectories)(DWORD); // eax
  bool v5; // zf
  int v6; // edi
  HANDLE FileW; // eax
  void *v8; // esi
  unsigned __int16 *i; // eax
  unsigned __int16 *v10; // edi
  wchar_t *v11; // eax
  wchar_t *v12; // edi
  int v13; // esi
  HMODULE v14; // eax
  DWORD result; // eax
  int v16; // esi
  char *v17; // eax
  WCHAR *v18; // eax
  DWORD CurrentProcessId; // eax
  HANDLE StdHandle; // eax
  DWORD v21; // [esp-Ah] [ebp-B3E8h]
  char v22; // [esp+15h] [ebp-B3C9h]
  DWORD NumberOfBytesRead; // [esp+16h] [ebp-B3C8h] BYREF
  PCNZWCH lpString1[8]; // [esp+1Ah] [ebp-B3C4h]
  wchar_t *Source[53]; // [esp+3Ah] [ebp-B3A4h]
  wchar_t v26[260]; // [esp+10Eh] [ebp-B2D0h] BYREF
  WCHAR FileName[2048]; // [esp+316h] [ebp-B0C8h] BYREF
  WCHAR Filename[2148]; // [esp+1316h] [ebp-A0C8h] BYREF
  wchar_t Destination[2048]; // [esp+23DEh] [ebp-9000h] BYREF
  unsigned __int16 Buffer[16384]; // [esp+33DEh] [ebp-8000h] BYREF

  v22 = 0;
  ModuleHandleW = GetModuleHandleW(L"kernel32");
  v2 = ModuleHandleW;
  if ( ModuleHandleW )
  {
    SetDllDirectoryW = (BOOL (__stdcall *)(LPCWSTR))GetProcAddress(ModuleHandleW, "SetDllDirectoryW");
    if ( SetDllDirectoryW )
      SetDllDirectoryW(a1 != 0 ? &String : 0);
    SetDefaultDllDirectories = (BOOL (__stdcall *)(DWORD))GetProcAddress(v2, "SetDefaultDllDirectories");
    if ( SetDefaultDllDirectories )
    {
      SetDefaultDllDirectories(a1 == 0 ? 4096 : 2048);
      v22 = 1;
    }
  }
  lpString1[0] = L"version.dll";
  lpString1[1] = L"DXGIDebug.dll";
  v5 = *(_BYTE *)off_42B004 == 120;
  lpString1[2] = L"sfc_os.dll";
  lpString1[3] = L"SSPICLI.DLL";
  lpString1[4] = L"rsaenh.dll";
  lpString1[5] = L"UXTheme.dll";
  lpString1[6] = L"dwmapi.dll";
  lpString1[7] = L"cryptbase.dll";
  Source[0] = L"lpk.dll";
  Source[1] = L"usp10.dll";
  Source[2] = L"clbcatq.dll";
  Source[3] = L"comres.dll";
  Source[4] = L"ws2_32.dll";
  Source[5] = L"ws2help.dll";
  Source[6] = L"psapi.dll";
  Source[7] = L"ieframe.dll";
  Source[8] = L"ntshrui.dll";
  Source[9] = L"atl.dll";
  Source[10] = L"setupapi.dll";
  Source[11] = L"apphelp.dll";
  Source[12] = L"userenv.dll";
  Source[13] = L"netapi32.dll";
  Source[14] = L"shdocvw.dll";
  Source[15] = L"crypt32.dll";
  Source[16] = L"msasn1.dll";
  Source[17] = L"cryptui.dll";
  Source[18] = L"wintrust.dll";
  Source[19] = L"shell32.dll";
  Source[20] = L"secur32.dll";
  Source[21] = L"cabinet.dll";
  Source[22] = L"oleaccrc.dll";
  Source[23] = L"ntmarta.dll";
  Source[24] = L"profapi.dll";
  Source[25] = L"WindowsCodecs.dll";
  Source[26] = L"srvcli.dll";
  Source[27] = L"cscapi.dll";
  Source[28] = L"slc.dll";
  Source[29] = L"imageres.dll";
  Source[30] = L"dnsapi.DLL";
  Source[31] = L"iphlpapi.DLL";
  Source[32] = L"WINNSI.DLL";
  Source[33] = L"netutils.dll";
  Source[34] = L"mpr.dll";
  Source[35] = L"devrtl.dll";
  Source[36] = L"propsys.dll";
  Source[37] = L"mlang.dll";
  Source[38] = L"samcli.dll";
  Source[39] = L"samlib.dll";
  Source[40] = L"wkscli.dll";
  Source[41] = L"dfscli.dll";
  Source[42] = L"browcli.dll";
  Source[43] = L"rasadhlp.dll";
  Source[44] = L"dhcpcsvc6.dll";
  Source[45] = L"dhcpcsvc.dll";
  Source[46] = L"XmlLite.dll";
  Source[47] = L"linkinfo.dll";
  Source[48] = L"cryptsp.dll";
  Source[49] = L"RpcRtRemote.dll";
  Source[50] = L"aclui.dll";
  Source[51] = L"dsrole.dll";
  Source[52] = L"peerdist.dll";
  if ( !v5 )
  {
    v6 = sub_41710A(off_42B004);
    if ( v6 )
    {
      GetModuleFileNameW(0, Filename, 0x800u);
      FileW = CreateFileW(Filename, 0x80000000, 1u, 0, 3u, 0, 0);
      v8 = FileW;
      if ( FileW != (HANDLE)-1
        && SetFilePointer(FileW, v6, 0, 0) == v6
        && ReadFile(v8, Buffer, 0x7FFEu, &NumberOfBytesRead, 0) )
      {
        Buffer[NumberOfBytesRead >> 1] = 0;
        for ( i = sub_40439F(Buffer, (int)v26, 260); ; i = sub_40439F(v10, (int)v26, 260) )
        {
          v10 = i;
          if ( !i )
            break;
          sub_4047AA(v26);
        }
      }
      CloseHandle(v8);
    }
  }
  GetModuleFileNameW(0, FileName, 0x800u);
  v11 = sub_4036A6(FileName);
  sub_4045C8(Destination, v11, 2048);
  v12 = 0;
  v13 = 0;
  while ( 1 )
  {
    v14 = (unsigned int)sub_402B7C() < 0x600 ? 0 : sub_4047AA((wchar_t *)lpString1[v13]);
    if ( !v14 || (result = CompareStringW(0x400u, 0x1001u, lpString1[v13], -1, L"DXGIDebug.dll", -1), result == 2) )
    {
      sub_40375A(FileName, (wchar_t *)lpString1[v13], 2048);
      result = GetFileAttributesW(FileName);
      if ( result != -1 )
        break;
    }
    if ( (unsigned int)++v13 >= 8 )
      goto LABEL_25;
  }
  v12 = (wchar_t *)lpString1[v13];
LABEL_25:
  if ( !v22 )
  {
    v16 = 0;
    while ( 1 )
    {
      sub_40375A(FileName, Source[v16], 2048);
      result = GetFileAttributesW(FileName);
      if ( result != -1 )
        break;
      if ( (unsigned int)++v16 >= 0x35 )
        goto LABEL_31;
    }
    v12 = Source[v16];
  }
LABEL_31:
  if ( v12 )
  {
    sub_4036E9(FileName);
    if ( (unsigned int)sub_402B7C() < 0x600 )
    {
      sub_4037C1(
        (char *)Filename,
        0x864u,
        (char *)L"Please remove %s from %s folder. It is unsecure to run %s until it is done.",
        v12,
        FileName,
        Destination);
      if ( AllocConsole() )
      {
        CurrentProcessId = GetCurrentProcessId();
        AttachConsole(CurrentProcessId);
        v21 = wcslen(Filename);
        StdHandle = GetStdHandle(0xFFFFFFF4);
        WriteConsoleW(StdHandle, Filename, v21, &NumberOfBytesRead, 0);
        Sleep(0x2710u);
        FreeConsole();
      }
    }
    else
    {
      sub_4047AA((wchar_t *)L"dwmapi.dll");
      sub_4047AA((wchar_t *)L"uxtheme.dll");
      v17 = (char *)sub_4040A7(0xF1u);
      sub_4037C1((char *)Filename, 0x864u, v17, v12, FileName, Destination);
      v18 = sub_4040A7(0xF0u);
      sub_40B680(0, Filename, v18, 0x30u);
    }
    ExitProcess(0);
  }
  return result;
}
// 422470: using guessed type wchar_t aVersionDll[12];
// 4224A4: using guessed type wchar_t aSfcOsDll[11];
// 4224BC: using guessed type wchar_t aSspicliDll[12];
// 4224D4: using guessed type wchar_t aRsaenhDll[11];
// 4224EC: using guessed type wchar_t aUxthemeDll[12];
// 42251C: using guessed type wchar_t aCryptbaseDll[14];
// 422538: using guessed type wchar_t aLpkDll[8];
// 422548: using guessed type wchar_t aUsp10Dll[10];
// 42255C: using guessed type wchar_t aClbcatqDll[12];
// 422574: using guessed type wchar_t aComresDll[11];
// 42258C: using guessed type wchar_t aWs232Dll[11];
// 4225A4: using guessed type wchar_t aWs2helpDll[12];
// 4225BC: using guessed type wchar_t aPsapiDll[10];
// 4225D0: using guessed type wchar_t aIeframeDll[12];
// 4225E8: using guessed type wchar_t aNtshruiDll[12];
// 422600: using guessed type wchar_t aAtlDll[8];
// 422610: using guessed type wchar_t aSetupapiDll[13];
// 42262C: using guessed type wchar_t aApphelpDll[12];
// 422644: using guessed type wchar_t aUserenvDll[12];
// 42265C: using guessed type wchar_t aNetapi32Dll[13];
// 422678: using guessed type wchar_t aShdocvwDll[12];
// 422690: using guessed type wchar_t aCrypt32Dll_0[12];
// 4226A8: using guessed type wchar_t aMsasn1Dll[11];
// 4226C0: using guessed type wchar_t aCryptuiDll[12];
// 4226D8: using guessed type wchar_t aWintrustDll[13];
// 4226F4: using guessed type wchar_t aShell32Dll_0[12];
// 42270C: using guessed type wchar_t aSecur32Dll[12];
// 422724: using guessed type wchar_t aCabinetDll[12];
// 42273C: using guessed type wchar_t aOleaccrcDll[13];
// 422758: using guessed type wchar_t aNtmartaDll[12];
// 422770: using guessed type wchar_t aProfapiDll[12];
// 422788: using guessed type wchar_t aWindowscodecsD[18];
// 4227AC: using guessed type wchar_t aSrvcliDll[11];
// 4227C4: using guessed type wchar_t aCscapiDll[11];
// 4227DC: using guessed type wchar_t aSlcDll[8];
// 4227EC: using guessed type wchar_t aImageresDll[13];
// 422808: using guessed type wchar_t aDnsapiDll[11];
// 422820: using guessed type wchar_t aIphlpapiDll[13];
// 42283C: using guessed type wchar_t aWinnsiDll[11];
// 422854: using guessed type wchar_t aNetutilsDll[13];
// 422870: using guessed type wchar_t aMprDll[8];
// 422880: using guessed type wchar_t aDevrtlDll[11];
// 422898: using guessed type wchar_t aPropsysDll[12];
// 4228B0: using guessed type wchar_t aMlangDll[10];
// 4228C4: using guessed type wchar_t aSamcliDll[11];
// 4228DC: using guessed type wchar_t aSamlibDll[11];
// 4228F4: using guessed type wchar_t aWkscliDll[11];
// 42290C: using guessed type wchar_t aDfscliDll[11];
// 422924: using guessed type wchar_t aBrowcliDll[12];
// 42293C: using guessed type wchar_t aRasadhlpDll[13];
// 422958: using guessed type wchar_t aDhcpcsvc6Dll[14];
// 422974: using guessed type wchar_t aDhcpcsvcDll[13];
// 422990: using guessed type wchar_t aXmlliteDll[12];
// 4229A8: using guessed type wchar_t aLinkinfoDll[13];
// 4229C4: using guessed type wchar_t aCryptspDll[12];
// 4229DC: using guessed type wchar_t aRpcrtremoteDll[16];
// 4229FC: using guessed type wchar_t aAcluiDll[10];
// 422A10: using guessed type wchar_t aDsroleDll[11];
// 422A28: using guessed type wchar_t aPeerdistDll[13];
// 4047F4: using guessed type unsigned __int16 Buffer[16384];

//----- (00404D93) --------------------------------------------------------
_DWORD *__thiscall sub_404D93(_DWORD *this, int *a2)
{
  int v2; // edx
  _DWORD *result; // eax

  v2 = *a2;
  this[1] = a2[1];
  result = this;
  *this = v2;
  return result;
}

//----- (00404DA6) --------------------------------------------------------
_DWORD *__thiscall sub_404DA6(int *this, _DWORD *a2)
{
  _DWORD *result; // eax
  int v3; // edx
  int v4; // ecx

  result = a2;
  v3 = *this;
  v4 = this[1];
  *a2 = v3;
  a2[1] = v4;
  return result;
}

//----- (00404DB7) --------------------------------------------------------
int __thiscall sub_404DB7(DWORD *this, unsigned int a2)
{
  int v3[9]; // [esp+0h] [ebp-24h] BYREF

  v3[6] = 0;
  v3[5] = 2 * (a2 & 0x1F);
  v3[4] = (a2 >> 5) & 0x3F;
  v3[3] = (unsigned __int16)a2 >> 11;
  v3[2] = HIWORD(a2) & 0x1F;
  v3[1] = (a2 >> 21) & 0xF;
  v3[0] = (a2 >> 25) + 1980;
  return sub_404E15(this, (int)v3);
}

//----- (00404E15) --------------------------------------------------------
int __thiscall sub_404E15(DWORD *this, int a2)
{
  int result; // eax
  DWORD dwHighDateTime; // ecx
  DWORD dwLowDateTime; // edx
  unsigned __int64 v6; // kr00_8
  struct _SYSTEMTIME UniversalTime; // [esp+Ch] [ebp-48h] BYREF
  SYSTEMTIME LocalTime; // [esp+1Ch] [ebp-38h] BYREF
  SYSTEMTIME SystemTime; // [esp+2Ch] [ebp-28h] BYREF
  struct _FILETIME v10; // [esp+3Ch] [ebp-18h] BYREF
  struct _FILETIME v11; // [esp+44h] [ebp-10h] BYREF
  struct _FILETIME FileTime; // [esp+4Ch] [ebp-8h] BYREF

  SystemTime.wYear = *(_WORD *)a2;
  SystemTime.wMonth = *(_WORD *)(a2 + 4);
  SystemTime.wDay = *(_WORD *)(a2 + 8);
  SystemTime.wHour = *(_WORD *)(a2 + 12);
  SystemTime.wMinute = *(_WORD *)(a2 + 16);
  SystemTime.wSecond = *(_WORD *)(a2 + 20);
  SystemTime.wMilliseconds = 0;
  SystemTime.wDayOfWeek = 0;
  result = SystemTimeToFileTime(&SystemTime, &FileTime);
  if ( result )
  {
    FileTime.dwLowDateTime += *(_DWORD *)(a2 + 24);
    if ( FileTime.dwLowDateTime < *(_DWORD *)(a2 + 24) )
      ++FileTime.dwHighDateTime;
    if ( (unsigned int)sub_402B7C() >= 0x600 )
    {
      FileTimeToSystemTime(&FileTime, &LocalTime);
      TzSpecificLocalTimeToSystemTime(0, &LocalTime, &UniversalTime);
      SystemTimeToFileTime(&UniversalTime, &v11);
      SystemTimeToFileTime(&LocalTime, &v10);
      v6 = FileTime.dwLowDateTime
         + v11.dwLowDateTime
         + __PAIR64__(FileTime.dwHighDateTime, 0)
         + __PAIR64__(v11.dwHighDateTime, 0)
         - __PAIR64__(v10.dwHighDateTime, 0)
         - v10.dwLowDateTime;
      dwHighDateTime = HIDWORD(v6);
      dwLowDateTime = v6;
      result = SHIDWORD(v6) >> 31;
    }
    else
    {
      result = LocalFileTimeToFileTime(&FileTime, &v11);
      dwHighDateTime = v11.dwHighDateTime;
      dwLowDateTime = v11.dwLowDateTime;
    }
    *this = dwLowDateTime;
    this[1] = dwHighDateTime;
  }
  else
  {
    *this = 0;
    this[1] = 0;
  }
  return result;
}

//----- (00404F14) --------------------------------------------------------
int __thiscall sub_404F14(_DWORD *this, int a2, int a3)
{
  int result; // eax

  *this = a2;
  result = a3;
  this[1] = a3;
  return result;
}

//----- (00404F24) --------------------------------------------------------
void __thiscall sub_404F24(int *this)
{
  int v2; // eax
  char *v3; // eax
  char *v4; // eax
  char *v5; // eax
  char *v6; // eax
  char *v7; // eax
  int v8; // eax
  int v9; // eax
  int v10; // eax
  int v11; // eax
  int v12; // [esp-8h] [ebp-Ch]
  int v13; // [esp-4h] [ebp-8h]
  int v14; // [esp-4h] [ebp-8h]
  int v15; // [esp-4h] [ebp-8h]

  v2 = this[18];
  if ( v2 > 106 )
    return;
  if ( v2 == 106 )
  {
    v4 = (char *)sub_4040A7(0x456u);
    goto LABEL_53;
  }
  if ( v2 <= 21 )
  {
    if ( v2 == 21 )
    {
      v14 = *this;
      v6 = (char *)sub_4040A7(0xDDu);
LABEL_20:
      sub_40C371(0, v6, v14);
    }
    else
    {
      switch ( v2 )
      {
        case 0:
          sub_40C371((int)L">", (char *)L"%ls", *this);
          break;
        case 1:
          sub_40C371(0, (char *)L"%ls", *this);
          break;
        case 2:
          sub_40BBAC(0);
          break;
        case 3:
          v13 = this[1];
          v3 = (char *)sub_4040A7(0x7Bu);
          goto LABEL_11;
        case 4:
          v13 = this[1];
          v3 = (char *)sub_4040A7(0x7Au);
          goto LABEL_11;
        case 5:
          v13 = this[1];
          v3 = (char *)sub_4040A7(0x7Cu);
          goto LABEL_11;
        case 6:
          v4 = (char *)sub_4040A7(0xC9u);
          goto LABEL_53;
        case 7:
          v5 = (char *)sub_4040A7(0x70u);
          goto LABEL_16;
        case 8:
          v13 = this[1];
          v3 = (char *)sub_4040A7(0x72u);
          goto LABEL_11;
        case 9:
          v13 = this[1];
          v3 = (char *)sub_4040A7(0x78u);
          goto LABEL_11;
        case 10:
          v14 = *this;
          v6 = (char *)sub_4040A7(0x85u);
          goto LABEL_20;
        case 11:
          v14 = *this;
          v6 = (char *)sub_4040A7(0x204u);
          goto LABEL_20;
        case 12:
          v13 = this[1];
          v3 = (char *)sub_4040A7(0x84u);
          goto LABEL_11;
        case 13:
          v13 = this[1];
          v3 = (char *)sub_4040A7(0x83u);
          goto LABEL_11;
        case 17:
          v15 = this[2];
          v12 = this[1];
          v7 = (char *)sub_4040A7(0xD2u);
          sub_40C371(*this, v7, v12, v15);
          break;
        case 19:
          v13 = this[1];
          v3 = (char *)sub_4040A7(0x79u);
          goto LABEL_11;
        case 20:
          v13 = this[1];
          v3 = (char *)sub_4040A7(0xDCu);
          goto LABEL_11;
        default:
          return;
      }
    }
    return;
  }
  if ( v2 > 55 )
  {
    v8 = v2 - 56;
    if ( v8 )
    {
      v9 = v8 - 1;
      if ( v9 )
      {
        v10 = v9 - 1;
        if ( !v10 )
        {
          v13 = this[1];
          v3 = (char *)sub_4040A7(0x406u);
LABEL_11:
          sub_40C371(*this, v3, v13);
          return;
        }
        v11 = v10 - 9;
        if ( v11 )
        {
          if ( v11 != 1 )
            return;
          v4 = (char *)sub_4040A7(0x86u);
        }
        else
        {
          v4 = (char *)sub_4040A7(0x343u);
        }
      }
      else
      {
        v4 = (char *)sub_4040A7(0x6Fu);
      }
    }
    else
    {
      v4 = (char *)sub_4040A7(0x8Cu);
    }
LABEL_53:
    sub_40C371(*this, v4);
    return;
  }
  if ( v2 == 55 )
  {
    v4 = (char *)sub_4040A7(0x67u);
    goto LABEL_53;
  }
  switch ( v2 )
  {
    case 22:
      v5 = (char *)sub_4040A7(0xE1u);
LABEL_16:
      sub_40C371(0, v5);
      break;
    case 23:
      v4 = (char *)sub_4040A7(0xB4u);
      goto LABEL_53;
    case 24:
      v4 = (char *)sub_4040A7(0x69u);
      goto LABEL_53;
    case 25:
      v4 = (char *)sub_4040A7(0x6Au);
      goto LABEL_53;
    case 26:
      v13 = this[1];
      v3 = (char *)sub_4040A7(0x68u);
      goto LABEL_11;
    case 27:
      v4 = (char *)sub_4040A7(0x46Fu);
      goto LABEL_53;
    case 28:
      v4 = (char *)sub_4040A7(0x470u);
      goto LABEL_53;
    case 29:
      v13 = this[1];
      v3 = (char *)sub_4040A7(0x471u);
      goto LABEL_11;
    case 31:
      v13 = this[1];
      v3 = (char *)sub_4040A7(0x71u);
      goto LABEL_11;
    case 32:
      v13 = this[1];
      v3 = (char *)sub_4040A7(0xC8u);
      goto LABEL_11;
    default:
      return;
  }
}
// 422B00: using guessed type wchar_t asc_422B00[2];

//----- (00405184) --------------------------------------------------------
bool __stdcall sub_405184(int ArgList, int a2)
{
  char *v2; // eax
  DWORD LastError; // esi
  WCHAR *v4; // eax
  bool v5; // bl
  WCHAR Buffer[2304]; // [esp+8h] [ebp-1200h] BYREF

  v2 = (char *)sub_4040A7(0x83u);
  sub_4037C1((char *)Buffer, 0x900u, v2, ArgList);
  LastError = GetLastError();
  v4 = sub_4040A7(0x96u);
  v5 = sub_40B680(hWnd, Buffer, v4, 0x35u) == 4;
  SetLastError(LastError);
  return v5;
}
// 405184: using guessed type WCHAR Buffer[2304];

//----- (004051F3) --------------------------------------------------------
INT_PTR __stdcall sub_4051F3(int a1, wchar_t *Source, int a3, __int64 a4, int a5, int a6)
{
  int v6; // eax
  INT_PTR v8; // eax
  INT_PTR v9; // edi
  wchar_t String[2048]; // [esp+10h] [ebp-1000h] BYREF

  v6 = *(_DWORD *)(a1 + 20784);
  if ( v6 == 2 )
    return 1;
  if ( *(_BYTE *)(a1 + 20860) || v6 == 1 )
  {
    sub_4026A3(Source);
  }
  else
  {
    sub_4045C8(String, Source, 2048);
    v8 = sub_40E693((LPARAM)String, 2048, a4, a5, a6);
    v9 = v8;
    if ( (!v8 || v8 == 2) && (sub_4026A3(Source), v9 == 2) )
    {
      *(_DWORD *)(a1 + 20784) = 1;
    }
    else
    {
      if ( v9 == 3 )
      {
        *(_DWORD *)(a1 + 20784) = 2;
        return 1;
      }
      if ( v9 != 4 )
        return v9;
      if ( sub_4036A6(String) == String )
        sub_40375A(Source, String, a3);
      else
        sub_4045C8(Source, String, a3);
      if ( sub_402578(Source) )
        return sub_4051F3(a1, Source, a3, a4, SHIDWORD(a4), a5, a6);
    }
  }
  return 0;
}

//----- (00405320) --------------------------------------------------------
LRESULT __stdcall sub_405320(int a1, int a2, int a3, int a4, unsigned int a5, int a6, unsigned int a7, int a8)
{
  return sub_40E723(a1, a2, a3, a4, a5, a6, a7, a8);
}

//----- (00405344) --------------------------------------------------------
char __stdcall sub_405344(int a1, wchar_t *Source, char *a3)
{
  return sub_40E74E(a1, 0, Source, a3);
}

//----- (0040535F) --------------------------------------------------------
char sub_40535F()
{
  return byte_4481E9;
}
// 4481E9: using guessed type char byte_4481E9;

//----- (00405365) --------------------------------------------------------
LRESULT __stdcall sub_405365(char a1, wchar_t *String)
{
  return sub_40E820(4 * (a1 != 0) + 84, String);
}

//----- (00405386) --------------------------------------------------------
bool __stdcall sub_405386(LPCCH lpMultiByteStr, LPWSTR lpWideCharStr, int cchWideChar)
{
  bool result; // al

  *lpWideCharStr = 0;
  result = MultiByteToWideChar(0, 0, lpMultiByteStr, -1, lpWideCharStr, cchWideChar) != 0;
  if ( cchWideChar )
    lpWideCharStr[cchWideChar - 1] = 0;
  return result;
}

//----- (004053BF) --------------------------------------------------------
bool __thiscall sub_4053BF(_BYTE *this)
{
  unsigned int v1; // esi
  bool result; // al
  struct _cpinfo CPInfo; // [esp+8h] [ebp-14h] BYREF

  v1 = 0;
  GetCPInfo(0, &CPInfo);
  this[256] = CPInfo.MaxCharSize > 1;
  do
  {
    result = IsDBCSLeadByte(v1);
    this[v1++] = result;
  }
  while ( v1 < 0x100 );
  return result;
}

//----- (00405401) --------------------------------------------------------
char __stdcall sub_405401(unsigned __int8 *a1, _WORD *a2, int a3)
{
  int v4; // ebp
  char v6; // bl
  unsigned int v7; // edx
  int v8; // ecx
  unsigned __int8 v9; // al

  v4 = a3 - 1;
  v6 = 1;
  while ( 1 )
  {
    v9 = *a1;
    if ( !*a1 )
      break;
    v7 = v9;
    ++a1;
    if ( v9 >= 0x80u )
    {
      if ( (v9 & 0xE0) == 192 )
      {
        if ( (*a1 & 0xC0) != 0x80 )
          goto LABEL_29;
        v7 = *a1++ & 0x3F | ((v9 & 0x1F) << 6);
      }
      else
      {
        if ( (v9 & 0xF0) == 224 )
        {
          if ( (*a1 & 0xC0) != 0x80 || (a1[1] & 0xC0) != 0x80 )
            goto LABEL_29;
          v8 = a1[1] & 0x3F | ((((v9 & 0xF) << 6) | *a1 & 0x3F) << 6);
          a1 += 2;
        }
        else
        {
          if ( (v9 & 0xF8) != 240 || (*a1 & 0xC0) != 0x80 || (a1[1] & 0xC0) != 0x80 || (a1[2] & 0xC0) != 0x80 )
          {
LABEL_29:
            v6 = 0;
            break;
          }
          v8 = a1[2] & 0x3F | ((a1[1] & 0x3F | ((((v9 & 7) << 6) | *a1 & 0x3F) << 6)) << 6);
          a1 += 3;
        }
        v7 = v8;
      }
    }
    if ( a2 )
    {
      if ( --v4 < 0 )
        break;
    }
    if ( v7 <= 0xFFFF )
    {
      if ( a2 )
        *a2++ = v7;
    }
    else
    {
      if ( a2 )
      {
        if ( --v4 < 0 )
          break;
      }
      if ( v7 <= 0x10FFFF )
      {
        if ( a2 )
        {
          *a2 = ((v7 - 0x10000) >> 10) - 10240;
          a2[1] = (v7 & 0x3FF) - 9216;
          a2 += 2;
        }
      }
      else
      {
        v6 = 0;
      }
    }
  }
  if ( a2 )
    *a2 = 0;
  return v6;
}
// 40545B: mask 0xFFFFFFF0 is shortened because edx.4 <= 0xFF
// 4054A2: mask 0xFFFFFFF8 is shortened because edx.4 <= 0xFF

//----- (0040557F) --------------------------------------------------------
bool __stdcall sub_40557F(LPCWCH lpWideCharStr, LPSTR lpMultiByteStr, int cbMultiByte)
{
  bool result; // al

  *lpMultiByteStr = 0;
  result = WideCharToMultiByte(0, 0, lpWideCharStr, -1, lpMultiByteStr, cbMultiByte, 0, 0) != 0;
  if ( cbMultiByte )
    lpMultiByteStr[cbMultiByte - 1] = 0;
  return result;
}

//----- (004055B7) --------------------------------------------------------
unsigned __int64 __stdcall sub_4055B7(unsigned __int16 *a1)
{
  unsigned __int16 *v1; // ebx
  int v2; // ebp
  unsigned __int16 v3; // ax
  unsigned int v4; // esi
  int v5; // ecx
  unsigned int v6; // edi
  int v8; // [esp+Ch] [ebp-4h]
  unsigned int v9; // [esp+14h] [ebp+4h]

  v1 = a1;
  v2 = 1;
  v8 = 1;
  if ( *a1 == 45 )
  {
    v1 = a1 + 1;
    v2 = -1;
    v8 = -1;
  }
  v3 = *v1;
  v4 = 0;
  v5 = 0;
  v9 = 0;
  if ( *v1 >= 0x30u )
  {
    do
    {
      if ( v3 > 0x39u )
        break;
      v6 = (10 * __PAIR64__(v9, v5) + v3 - 48) >> 32;
      v5 = 10 * v5 + v3 - 48;
      ++v1;
      v4 = v6;
      v9 = v6;
      v3 = *v1;
    }
    while ( *v1 >= 0x30u );
    v2 = v8;
  }
  return v2 * __PAIR64__(v4, v5);
}

//----- (00405644) --------------------------------------------------------
int __stdcall sub_405644(PCNZWCH lpString1, PCNZWCH lpString2)
{
  return CompareStringW(0x400u, 0x1001u, lpString1, -1, lpString2, -1) - 2;
}

//----- (00405666) --------------------------------------------------------
int __stdcall sub_405666(PCNZWCH lpString1, PCNZWCH lpString2, unsigned int cchCount2)
{
  int v3; // esi
  int v4; // edi

  v3 = cchCount2;
  if ( wcslen(lpString1) + 1 >= cchCount2 )
    v4 = cchCount2;
  else
    v4 = wcslen(lpString1) + 1;
  if ( wcslen(lpString2) + 1 < cchCount2 )
    v3 = wcslen(lpString2) + 1;
  return CompareStringW(0x400u, 0x1001u, lpString1, v4, lpString2, v3) - 2;
}

//----- (004056C7) --------------------------------------------------------
_DWORD *__thiscall sub_4056C7(_DWORD *this, int a2)
{
  *this = 0;
  this[1] = 0;
  this[2] = 0;
  this[3] = 0;
  sub_405737((int)this, a2);
  return this;
}

//----- (004056E6) --------------------------------------------------------
_DWORD *__thiscall sub_4056E6(_DWORD *this)
{
  this[1032] = 0;
  this[1033] = 0;
  this[1034] = 0;
  this[1035] = 0;
  this[1036] = 0;
  this[1037] = 0;
  this[1038] = 0;
  this[1039] = 0;
  this[1040] = 0;
  this[1041] = 0;
  return this;
}

//----- (00405737) --------------------------------------------------------
void __thiscall sub_405737(int this, int a2)
{
  unsigned int v3; // ecx
  unsigned int v4; // eax
  unsigned int v5; // edi
  void *v6; // ebx

  *(_DWORD *)(this + 4) += a2;
  v3 = *(_DWORD *)(this + 4);
  if ( v3 > *(_DWORD *)(this + 8) )
  {
    v4 = *(_DWORD *)(this + 12);
    if ( v4 && v3 > v4 )
    {
      sub_40198C((int)dword_44A2FC, (char *)L"Maximum allowed array size (%u) is exceeded", v4);
      sub_4019C4(dword_44A2FC);
    }
    v5 = *(_DWORD *)(this + 4);
    if ( v5 <= *(_DWORD *)(this + 8) + (*(_DWORD *)(this + 8) >> 2) + 32 )
      v5 = *(_DWORD *)(this + 8) + (*(_DWORD *)(this + 8) >> 2) + 32;
    v6 = realloc(*(void **)this, 72 * v5);
    if ( !v6 )
      sub_4019C4(dword_44A2FC);
    *(_DWORD *)(this + 8) = v5;
    *(_DWORD *)this = v6;
  }
}
// 44A2FC: using guessed type int dword_44A2FC[4];

//----- (004057AD) --------------------------------------------------------
void __thiscall sub_4057AD(int this, int a2)
{
  unsigned int v3; // ecx
  unsigned int v4; // eax
  unsigned int v5; // edi
  void *v6; // ebx

  *(_DWORD *)(this + 4) += a2;
  v3 = *(_DWORD *)(this + 4);
  if ( v3 > *(_DWORD *)(this + 8) )
  {
    v4 = *(_DWORD *)(this + 12);
    if ( v4 && v3 > v4 )
    {
      sub_40198C((int)dword_44A2FC, (char *)L"Maximum allowed array size (%u) is exceeded", v4);
      sub_4019C4(dword_44A2FC);
    }
    v5 = *(_DWORD *)(this + 4);
    if ( v5 <= *(_DWORD *)(this + 8) + (*(_DWORD *)(this + 8) >> 2) + 32 )
      v5 = *(_DWORD *)(this + 8) + (*(_DWORD *)(this + 8) >> 2) + 32;
    v6 = realloc(*(void **)this, 8 * v5);
    if ( !v6 )
      sub_4019C4(dword_44A2FC);
    *(_DWORD *)(this + 8) = v5;
    *(_DWORD *)this = v6;
  }
}
// 44A2FC: using guessed type int dword_44A2FC[4];

//----- (00405825) --------------------------------------------------------
void __thiscall sub_405825(_DWORD *this, unsigned int a2)
{
  if ( a2 <= this[2] )
    this[1] = a2;
  else
    sub_405737((int)this, a2 - this[1]);
}

//----- (0040583F) --------------------------------------------------------
BOOL __stdcall sub_40583F(wchar_t *String)
{
  wchar_t *v1; // eax
  const WCHAR *v2; // esi

  v1 = sub_4032A5(String);
  v2 = v1;
  return v1 && (!sub_405644(v1, L".zipx") || !sub_405666(v2, L".zx", 3u));
}

//----- (0040587A) --------------------------------------------------------
void __stdcall sub_40587A(wchar_t *String, int a2, int a3)
{
  bool v3; // al
  const wchar_t *v4; // ecx
  wchar_t Buffer[20]; // [esp+0h] [ebp-28h] BYREF

  v3 = sub_40583F(String);
  v4 = L"x";
  if ( a3 < 99 )
  {
    if ( !v3 )
      v4 = &::String;
    sub_4037C1((char *)Buffer, 0x14u, (char *)L"z%s%02d", v4, a3 + 1);
  }
  else
  {
    if ( !v3 )
      v4 = &::String;
    sub_4037C1((char *)Buffer, 0x14u, (char *)L"z%s%d", v4, a3 + 1);
  }
  sub_403715(String, Buffer, a2);
}
// 422B40: using guessed type wchar_t asc_422B40[2];
// 422B44: using guessed type wchar_t aZSD[6];
// 40587A: using guessed type wchar_t Buffer[20];

//----- (004058E0) --------------------------------------------------------
int __thiscall sub_4058E0(int *this, int a2, int a3)
{
  int v4; // edx
  int v5; // ecx
  int result; // eax

  sub_4057AD((int)this, 1);
  v4 = *this;
  v5 = this[1];
  *(_DWORD *)(v4 + 8 * v5 - 8) = a2;
  result = a3;
  *(_DWORD *)(v4 + 8 * v5 - 4) = a3;
  return result;
}

//----- (00405903) --------------------------------------------------------
int __cdecl sub_405903(
        int a1,
        int a2,
        int a3,
        int a4,
        int a5,
        int a6,
        wchar_t *a7,
        int a8,
        int a9,
        int a10,
        int a11,
        int a12,
        int a13,
        int a14,
        int a15,
        int a16,
        int a17,
        int a18,
        int a19,
        int a20,
        int a21,
        int a22,
        int a23,
        int a24,
        int a25,
        int a26,
        int a27,
        int a28)
{
  return sub_405907(
           a1,
           a2,
           a3,
           a4,
           a5,
           a6,
           a7,
           a8,
           a9,
           a10,
           a11,
           a12,
           a13,
           a14,
           a15,
           a16,
           a17,
           a18,
           a19,
           a20,
           a21,
           a22,
           a23,
           a24,
           a25,
           a26,
           a27,
           a28);
}

//----- (00405907) --------------------------------------------------------
int __cdecl sub_405907(
        int a1,
        int a2,
        int a3,
        __int64 a4,
        int a5,
        wchar_t *Source,
        int a7,
        int a8,
        int a9,
        int a10,
        unsigned __int64 a11,
        int a12,
        int a13,
        int a14,
        int a15,
        int a16,
        unsigned __int64 a17,
        int a18,
        int a19,
        int a20,
        int a21,
        int a22,
        int a23,
        int a24,
        int a25)
{
  int v25; // ebx
  int v26; // edi
  int v27; // esi
  int v28; // eax
  int v29; // eax
  int v30; // eax
  int v31; // eax
  int v32; // eax
  int v33; // eax
  unsigned int v34; // esi
  unsigned __int16 *v35; // ebx
  char v36; // bl
  wchar_t *v37; // esi
  unsigned int v38; // ecx
  int v39; // esi
  bool v40; // zf
  wchar_t *v41; // eax
  int v42; // eax
  int v43; // ecx
  const wchar_t *v44; // eax
  wchar_t *v45; // esi
  int v46; // ecx
  wchar_t *v47; // eax
  __int64 v48; // kr18_8
  unsigned int v49; // eax
  unsigned int v50; // ecx
  __int64 v51; // kr20_8
  int v52; // edx
  int v53; // esi
  unsigned int v54; // ebx
  unsigned __int64 v55; // kr28_8
  int v56; // eax
  int v57; // esi
  int v58; // eax
  int v59; // eax
  bool v60; // bl
  __int16 *v61; // eax
  int v62; // eax
  DWORD v63; // esi
  int v64; // eax
  int v65; // eax
  INT_PTR v66; // eax
  int v67; // eax
  int v68; // eax
  char v69; // al
  void *v70; // ebx
  int *v71; // esi
  __int16 v72; // cx
  int v73; // eax
  int v74; // esi
  int v76; // [esp-4h] [ebp-63E4h]
  int v77; // [esp+0h] [ebp-63E0h]
  int v78; // [esp+0h] [ebp-63E0h]
  char v79[12288]; // [esp+Ch] [ebp-63D4h] BYREF
  wchar_t Destination[2048]; // [esp+300Ch] [ebp-33D4h] BYREF
  int v81[2240]; // [esp+400Ch] [ebp-23D4h] BYREF
  wchar_t v82[46]; // [esp+630Ch] [ebp-D4h] BYREF
  wchar_t v83[46]; // [esp+6368h] [ebp-78h] BYREF
  void *v84[4]; // [esp+63C4h] [ebp-1Ch] BYREF
  int v85; // [esp+63DCh] [ebp-4h]
  void *Block; // [esp+63E0h] [ebp+0h] BYREF
  void *retaddr; // [esp+63E4h] [ebp+4h]
  void *v88; // [esp+63F0h] [ebp+10h]
  __int64 v89; // [esp+63F4h] [ebp+14h]
  int i; // [esp+63FCh] [ebp+1Ch]
  wchar_t *Sourcea; // [esp+6400h] [ebp+20h]

  a22 = -1;
  v25 = 0;
  a16 = 0;
  v26 = 0;
  a20 = 0;
  a21 = 0;
  a17 = 0i64;
  a18 = 0;
  a12 = 0;
  a15 = 0;
  a25 = 0;
  sub_4056C7(v84, 64);
  v85 = 0;
  sub_4045F5(v82);
  Block = 0;
  retaddr = 0;
  LOBYTE(v85) = 2;
  sub_4045F5(v83);
  LOBYTE(v85) = 3;
  dword_42FFBC = 1;
  do
  {
    if ( sub_40535F() )
      break;
    v27 = 0;
    a24 = 0;
    a23 = 0;
    while ( 1 )
    {
      if ( v27 >= 64 && !byte_441194 )
        goto LABEL_47;
      if ( v27 >= (int)v84[1] )
        sub_405825(v84, v27 + 1);
      dword_42FFF4 = (int)v84[0] + v25;
      if ( !sub_407568(byte_42FFEC, 4u) )
      {
        v39 = 1;
        v26 = 51;
        a25 = 1;
        goto LABEL_48;
      }
      if ( !sub_406D5A(byte_42FFEC) )
        break;
      v28 = sub_409B5E();
      if ( v28 )
      {
        v26 = v28;
        a25 = 1;
LABEL_47:
        v39 = a25;
LABEL_48:
        v25 = 0;
        goto LABEL_49;
      }
      SrcStr = 0;
      v29 = sub_40719B((unsigned __int16)word_4400A0, 2, &dword_440084, (unsigned __int8)byte_440081);
      if ( v29 )
      {
        if ( v29 > v26 )
          v26 = v29;
        if ( v29 > 1 )
        {
          sub_4018B9(26, (int)&word_4525F2, (int)&SrcStr);
          a25 = 1;
          v39 = 1;
          goto LABEL_48;
        }
      }
      v25 = 0;
      v30 = sub_40719B((unsigned __int16)word_4400A2, 3, 0, 0);
      if ( v30 )
      {
        if ( v30 > v26 )
          v26 = v30;
        if ( v30 > 1 )
          goto LABEL_45;
      }
      sub_40976E((int)::Block, (unsigned __int16)word_4400A2, 0);
      sub_406B88((int)::Block, (unsigned __int16)word_4400A2, (_WORD *)&dword_440084 + 1);
      v31 = sub_40719B((unsigned __int16)word_4400A4, 0, 0, 0);
      if ( v31 )
      {
        if ( v31 > v26 )
          v26 = v31;
        if ( v31 > 1 )
        {
LABEL_45:
          sub_4018B9(26, (int)&word_4525F2, (int)&SrcStr);
          goto LABEL_72;
        }
      }
      if ( sub_406AF2((int)::Block, (unsigned __int16)word_4400A2, dword_44110C, v79, 12288) )
      {
        sub_405401((unsigned __int8 *)v79, &SrcStr, 2048);
        sub_403251(&SrcStr, 2048);
        sub_40377F(&SrcStr, (int)&SrcStr, 2048);
      }
      sub_404DB7((DWORD *)(dword_42FFF4 + 40), dword_440088);
      v32 = dword_42FFF4;
      *(_DWORD *)(dword_42FFF4 + 48) = 0;
      *(_DWORD *)(v32 + 52) = 0;
      v33 = dword_42FFF4;
      *(_DWORD *)(dword_42FFF4 + 56) = 0;
      *(_DWORD *)(v33 + 60) = 0;
      sub_406C69(
        (int)::Block,
        (unsigned __int16)word_4400A2,
        (_DWORD *)(dword_42FFF4 + 40),
        (_DWORD *)(dword_42FFF4 + 48),
        (_DWORD *)(dword_42FFF4 + 56));
      v34 = (unsigned __int16)word_4400A2;
      v35 = (unsigned __int16 *)::Block;
      if ( word_4400A2 && ::Block )
      {
        while ( v34 >= 4 )
        {
          a19 = (unsigned __int16)sub_407425(v35);
          v38 = (unsigned __int16)sub_407425(v35 + 1);
          if ( v38 > v34 - 4 )
            break;
          if ( a19 == 23 )
          {
            v36 = 1;
            sub_4018B9(32, (int)&word_4525F2, (int)&SrcStr);
            goto LABEL_28;
          }
          v35 = (unsigned __int16 *)((char *)v35 + v38 + 4);
          v34 += -4 - v38;
        }
      }
      v36 = 0;
LABEL_28:
      sub_4056E6(v81);
      LOBYTE(v85) = 4;
      memset(v81, 0, sizeof(v81));
      sub_4045C8((wchar_t *)&v81[8], &SrcStr, 2048);
      v37 = sub_40368A((wchar_t *)&v81[8]);
      if ( v37 > (wchar_t *)&v81[8] && sub_4035F5(*v37) )
        *v37 = 0;
      v81[1036] = *(_DWORD *)(dword_42FFF4 + 40);
      v81[1037] = *(_DWORD *)(dword_42FFF4 + 44);
      *(_QWORD *)&v81[1044] = qword_440098;
      if ( !v36 && sub_401643(word_44A320, (int)v81, 0, 5, 0, 0) )
      {
        if ( sub_406E2B() )
        {
          sub_40468A(v82, &SrcStr);
          v27 = a23 + 1;
          v25 = a24 + 72;
          ++a23;
          a24 += 72;
          goto LABEL_43;
        }
        ++a20;
      }
      v25 = a24;
      v27 = a23;
LABEL_43:
      a12 = (__PAIR64__(a12, a18++) + 1) >> 32;
      LOBYTE(v85) = 3;
      unknown_libname_1(&v81[1032], v77);
    }
    v25 = 0;
    if ( (unsigned __int16)a18 != (unsigned __int16)dword_4400C8 && (dword_4400C8 != 0xFFFF || dword_4400CC) )
    {
      sub_401901(dword_44A2FC, (int)&word_4525F2);
      v26 = 3;
    }
    else
    {
      a15 = !sub_406DA4(byte_42FFEC) && (!byte_44119C || !sub_406D7F(byte_42FFEC));
    }
LABEL_72:
    a25 = 1;
    v39 = 1;
LABEL_49:
    v89 = qword_440040;
    v88 = Src;
    a8 = HIDWORD(qword_440008);
    a10 = qword_440008;
    if ( byte_441194 )
    {
      dword_441198 = 0;
      v40 = !sub_40583F(&word_4525F2);
      v41 = (wchar_t *)L"zx01";
      if ( v40 )
        v41 = L"z01";
      sub_403715(&word_4525F2, v41, 2048);
      if ( dword_440020 )
        (**(void (__thiscall ***)(int, int))dword_440020)(dword_440020, 1);
      dword_440020 = 0;
      sub_407438(v39);
      sub_405365(byte_44F4E1 == 0, &word_4525F2);
    }
    v42 = 0;
    a19 = 0;
    if ( a23 > 0 )
    {
      v43 = a16 << 6;
      for ( i = a16 << 6; ; v43 = i )
      {
        a22 = v42 + v43;
        dword_42FFF4 = (int)v84[0] + 72 * v42;
        v44 = sub_4046C6(v82);
        v45 = (wchar_t *)dword_42FFF4;
        Sourcea = (wchar_t *)v44;
        if ( byte_441194 )
        {
          v46 = *(_DWORD *)(dword_42FFF4 + 32);
          if ( v46 != dword_441198 )
          {
            if ( v46 == (unsigned __int16)word_4400B8 )
            {
              v45 = &word_4525F2;
              v40 = !sub_40583F(&word_4525F2);
              v47 = (wchar_t *)L"zipx";
              if ( v40 )
                v47 = L"zip";
              sub_403715(&word_4525F2, v47, 2048);
            }
            else
            {
              sub_40587A(&word_4525F2, 2048, *(_DWORD *)(dword_42FFF4 + 32));
            }
            dword_441198 = *(_DWORD *)(dword_42FFF4 + 32);
            if ( dword_440020 )
              (**(void (__thiscall ***)(int, int))dword_440020)(dword_440020, 1);
            dword_440020 = 0;
            sub_407438((int)v45);
            v45 = (wchar_t *)dword_42FFF4;
          }
        }
        v48 = qword_440048 + *(_QWORD *)v45;
        v51 = v48 - v48 % 0x2000;
        v50 = HIDWORD(v51);
        v49 = v51;
        a24 = v48 % 0x2000;
        a11 = v51;
        if ( v48 < 0 )
        {
          sub_401901(dword_44A2FC, (int)&word_4525F2);
          v26 = 2;
          if ( a22 )
            goto LABEL_83;
          v52 = HIDWORD(qword_440048);
          if ( !qword_440048 )
            goto LABEL_83;
          HIDWORD(a17) = qword_440048;
          qword_440048 = 0i64;
          v53 = *(_DWORD *)(dword_42FFF4 + 4);
          v54 = *(_DWORD *)dword_42FFF4;
          LODWORD(a17) = v52;
          v55 = __PAIR64__(v53, v54) - __SPAIR64__(v53, v54) % 0x2000;
          v50 = HIDWORD(v55);
          v49 = v55;
          a24 = __SPAIR64__(v53, v54) % 0x2000;
          a11 = v55;
          if ( v53 < 0 )
            goto LABEL_82;
        }
        if ( __PAIR64__(v50, v49) != qword_440040 || byte_441194 )
        {
          v25 = 0;
          (*(void (__thiscall **)(int, _DWORD, _DWORD, _DWORD))(*(_DWORD *)dword_440020 + 12))(
            dword_440020,
            a11,
            HIDWORD(a11),
            0);
          qword_440040 = ((__int64 (__thiscall *)(int))*(_DWORD *)(*(_DWORD *)dword_440020 + 16))(dword_440020);
          v56 = sub_407917((int)dword_440000, 0x2000);
          qword_440008 = v56;
          if ( v56 <= 0 )
            goto LABEL_91;
          Src = &dword_440000[a24];
          qword_440008 = v56 - (__int64)a24;
        }
        else
        {
          qword_440008 += (char *)Src - a24 - dword_440000;
          Src = &dword_440000[a24];
        }
        if ( !sub_407568(byte_42FFEC, 4u) )
        {
LABEL_82:
          sub_401901(dword_44A2FC, (int)&word_4525F2);
LABEL_83:
          v26 = 3;
LABEL_84:
          v25 = 0;
          goto LABEL_85;
        }
        if ( !sub_406DC9(byte_42FFEC) )
        {
          sub_401901(dword_44A2FC, (int)&word_4525F2);
          v26 = 2;
          if ( a22 || !qword_440048 )
          {
            if ( qword_440048 || !a17 )
              goto LABEL_84;
            LODWORD(qword_440048) = HIDWORD(a17);
            v25 = 0;
            HIDWORD(qword_440048) = a17;
          }
          else
          {
            v25 = 0;
            a17 = __PAIR64__(qword_440048, HIDWORD(qword_440048));
            qword_440048 = 0i64;
          }
          if ( sub_407786(*(_QWORD *)dword_42FFF4) || !sub_407568(byte_42FFEC, 4u) || !sub_406DC9(byte_42FFEC) )
          {
LABEL_91:
            sub_401901(dword_44A2FC, (int)&word_4525F2);
            v26 = 3;
            goto LABEL_85;
          }
        }
        v57 = sub_409CD5();
        if ( v57 )
        {
          sub_401901(dword_44A2FC, (int)&word_4525F2);
          v26 = v57;
          goto LABEL_84;
        }
        v25 = 0;
        SrcStr = 0;
        v58 = sub_40719B((unsigned __int16)word_440078, 2, &word_44005A, 0);
        if ( v58 )
        {
          if ( v58 > v26 )
            v26 = v58;
          if ( v58 > 1 )
            goto LABEL_110;
        }
        if ( ::Block )
        {
          j___free_base(::Block);
          ::Block = 0;
        }
        v59 = sub_40719B((unsigned __int16)word_44007A, 3, 0, 0);
        if ( v59 )
        {
          if ( v59 > v26 )
            v26 = v59;
          if ( v59 > 1 )
          {
LABEL_110:
            sub_4018B9(26, (int)&word_4525F2, (int)&SrcStr);
            goto LABEL_85;
          }
        }
        sub_40976E((int)::Block, (unsigned __int16)word_44007A, 1);
        if ( sub_406AF2((int)::Block, (unsigned __int16)word_44007A, dword_44110C, v79, 12288) )
        {
          sub_405401((unsigned __int8 *)v79, &SrcStr, 2048);
          sub_403251(&SrcStr, 2048);
          sub_40377F(&SrcStr, (int)&SrcStr, 2048);
        }
        dword_441110 = *(_DWORD *)(dword_42FFF4 + 40);
        dword_441114 = *(_DWORD *)(dword_42FFF4 + 44);
        dword_441118 = *(_DWORD *)(dword_42FFF4 + 48);
        dword_44111C = *(_DWORD *)(dword_42FFF4 + 52);
        dword_441120 = *(_DWORD *)(dword_42FFF4 + 56);
        dword_441124 = *(_DWORD *)(dword_42FFF4 + 60);
        sub_406C69((int)::Block, (unsigned __int16)word_44007A, &dword_441110, &dword_441118, &dword_441120);
        sub_406B88((int)::Block, (unsigned __int16)word_44007A, &word_44005C);
        sub_4045C8(&SrcStr, Sourcea, 2048);
        v60 = sub_40A5D3(
                &SrcStr,
                *(_DWORD *)(dword_42FFF4 + 28),
                *(_DWORD *)(dword_42FFF4 + 16),
                *(_DWORD *)(dword_42FFF4 + 20),
                (_DWORD *)(dword_42FFF4 + 36));
        if ( SrcStr )
        {
          if ( word_44010E )
          {
            v61 = &word_440110;
            if ( word_440110 )
            {
              do
              {
                if ( *v61 == 58 )
                  *v61 = 95;
                ++v61;
              }
              while ( *v61 );
            }
          }
        }
        sub_4030FA(&SrcStr, &SrcStr);
        if ( !byte_44F4E1 || (v62 = 73, word_4515D2 == 73) )
          v62 = 0;
        else
          LOBYTE(v62) = 1;
        if ( !(unsigned __int8)sub_405381((char)&SrcStr, byte_44F4E1 == 0, v62, 0) )
        {
          v25 = 0;
          goto LABEL_172;
        }
        if ( !byte_44F4E1 )
        {
          if ( v60 )
          {
            v25 = 0;
            if ( !byte_44F473 && SrcStr && dword_44F478 != 1 )
            {
              v63 = 0;
              if ( !*(_DWORD *)(dword_42FFF4 + 28) || *(_DWORD *)(dword_42FFF4 + 28) == 11 )
                v63 = *(_DWORD *)(dword_42FFF4 + 36);
              if ( !sub_402578(&SrcStr)
                && sub_40260D(&SrcStr, byte_44F4BC == 0, v63)
                && (sub_402447(&SrcStr, 1), sub_40260D(&SrcStr, byte_44F4BC == 0, v63)) )
              {
                sub_4018B9(19, (int)&word_4525F2, (int)&SrcStr);
              }
              else
              {
                sub_40468A(v83, &SrcStr);
                sub_4058E0((int *)&Block, dword_441110, dword_441114);
                sub_4058E0((int *)&Block, dword_441120, dword_441124);
                sub_4058E0((int *)&Block, dword_441118, dword_44111C);
              }
            }
            goto LABEL_85;
          }
          v64 = sub_406FF6(&SrcStr);
          switch ( v64 )
          {
            case -1:
              v25 = 0;
              if ( byte_44F473 )
                goto LABEL_85;
              goto LABEL_159;
            case 0:
              v65 = dword_44F450;
              if ( dword_44F450 == 2 )
                goto LABEL_84;
              goto LABEL_151;
            case 1:
              v65 = dword_44F450;
              if ( dword_44F450 == 2 || byte_44F474 || byte_44F473 )
                goto LABEL_84;
LABEL_151:
              if ( !v65 || v65 == 3 )
              {
                v25 = 0;
                a13 = 0;
                a14 = 0;
                sub_404DB7((DWORD *)&a13, (unsigned __int16)word_44005E + ((unsigned __int16)word_440060 << 16));
                v66 = sub_4051F3((int)word_44A320, &SrcStr, 2048, *(__int64 *)&qword_42FFD8, (int)&a13, 0);
                if ( v66 == 6 )
                {
                  a25 = 1;
LABEL_172:
                  v39 = a25;
                  goto LABEL_173;
                }
                if ( v66 == 1 )
                  goto LABEL_85;
                goto LABEL_159;
              }
              break;
          }
        }
        v25 = 0;
LABEL_159:
        if ( (*(_BYTE *)(dword_42FFF4 + 64) & 1) != 0 && (v67 = sub_40A2C7()) != 0 )
        {
          if ( v67 == 9 )
          {
            sub_401B56(2);
            goto LABEL_176;
          }
          if ( v67 == 1 )
          {
            sub_40188E(6, (int)&SrcStr);
            ++a21;
          }
          else
          {
            if ( v67 > v26 )
              v26 = v67;
            sub_40188E(6, (int)&SrcStr);
          }
        }
        else
        {
          v68 = sub_40678B();
          if ( v68 && v68 > v26 )
            v26 = v68;
        }
LABEL_85:
        v42 = a19 + 1;
        a19 = v42;
        if ( v42 >= a23 )
          goto LABEL_172;
      }
    }
LABEL_173:
    (*(void (__thiscall **)(int, _DWORD, _DWORD, _DWORD))(*(_DWORD *)dword_440020 + 12))(
      dword_440020,
      v89,
      HIDWORD(v89),
      0);
    qword_440040 = ((__int64 (__thiscall *)(int))*(_DWORD *)(*(_DWORD *)dword_440020 + 16))(dword_440020);
    sub_407917((int)dword_440000, 0x2000);
    ++a16;
    Src = v88;
    LODWORD(qword_440008) = a10;
    HIDWORD(qword_440008) = a8;
  }
  while ( !v39 );
LABEL_176:
  v69 = sub_404716(v83, Destination, 2048);
  v70 = Block;
  if ( v69 )
  {
    v71 = (int *)((char *)Block + 16);
    do
    {
      a9 = *(v71 - 4);
      a10 = *(v71 - 3);
      a7 = *(v71 - 2);
      a8 = *(v71 - 1);
      a13 = *v71;
      a14 = v71[1];
      sub_4026B1(Destination, &a9, &a7, &a13);
      v71 += 6;
    }
    while ( sub_404716(v83, Destination, 2048) );
  }
  if ( !sub_40535F() )
  {
    if ( a15 )
    {
      if ( !byte_441194 )
      {
        sub_401901(dword_44A2FC, (int)&word_4525F2);
        if ( !v26 )
          v26 = 1;
      }
    }
  }
  v72 = a21;
  v73 = a22 + 1;
  v74 = (unsigned __int16)a21;
  a22 = v73;
  if ( v73 == (unsigned __int16)a21 && word_4515D2 != 73 && !dword_441128 )
  {
    sub_40188E(67, (int)&word_4525F2);
    v73 = a22;
    v72 = a21;
  }
  if ( !v73 && v26 <= 1 )
  {
    v26 = (_WORD)a20 != 0 ? 81 : 11;
    goto LABEL_201;
  }
  if ( v73 == v74 && v26 <= 1 )
  {
    v76 = 82;
    goto LABEL_197;
  }
  if ( (_WORD)a20 && v26 <= 1 )
  {
    v76 = 81;
LABEL_197:
    v26 = v76;
  }
  else if ( v72 && !v26 )
  {
    v26 = 1;
  }
LABEL_201:
  unknown_libname_1(v83, v77);
  if ( v70 )
    j___free_base(v70);
  unknown_libname_1(v82, v78);
  if ( v84[0] )
    j___free_base(v84[0]);
  return v26;
}
// 405CCB: variable 'v77' is possibly undefined
// 406764: variable 'v78' is possibly undefined
// 402F5A: using guessed type int __thiscall unknown_libname_1(_DWORD, _DWORD);
// 414249: using guessed type _DWORD _guard_check_icall_nop();
// 422B10: using guessed type wchar_t aZ01[4];
// 422B24: using guessed type wchar_t aZip[4];
// 42FFBC: using guessed type int dword_42FFBC;
// 42FFF4: using guessed type int dword_42FFF4;
// 440008: using guessed type __int64 qword_440008;
// 440020: using guessed type int dword_440020;
// 440040: using guessed type __int64 qword_440040;
// 440048: using guessed type __int64 qword_440048;
// 44005A: using guessed type __int16 word_44005A;
// 44005C: using guessed type __int16 word_44005C;
// 44005E: using guessed type __int16 word_44005E;
// 440060: using guessed type __int16 word_440060;
// 440078: using guessed type __int16 word_440078;
// 44007A: using guessed type __int16 word_44007A;
// 440081: using guessed type char byte_440081;
// 440084: using guessed type int dword_440084;
// 440088: using guessed type int dword_440088;
// 440098: using guessed type __int64 qword_440098;
// 4400A0: using guessed type __int16 word_4400A0;
// 4400A2: using guessed type __int16 word_4400A2;
// 4400A4: using guessed type __int16 word_4400A4;
// 4400B8: using guessed type __int16 word_4400B8;
// 4400C8: using guessed type int dword_4400C8;
// 4400CC: using guessed type int dword_4400CC;
// 44010E: using guessed type __int16 word_44010E;
// 440110: using guessed type __int16 word_440110;
// 441110: using guessed type int dword_441110;
// 441114: using guessed type int dword_441114;
// 441118: using guessed type int dword_441118;
// 44111C: using guessed type int dword_44111C;
// 441120: using guessed type int dword_441120;
// 441124: using guessed type int dword_441124;
// 441128: using guessed type int dword_441128;
// 441194: using guessed type char byte_441194;
// 441198: using guessed type int dword_441198;
// 44119C: using guessed type char byte_44119C;
// 44A2FC: using guessed type int dword_44A2FC[4];
// 44A320: using guessed type wchar_t word_44A320[8210];
// 44F450: using guessed type int dword_44F450;
// 44F473: using guessed type char byte_44F473;
// 44F474: using guessed type char byte_44F474;
// 44F478: using guessed type int dword_44F478;
// 44F4BC: using guessed type char byte_44F4BC;
// 44F4E1: using guessed type char byte_44F4E1;
// 405907: using guessed type wchar_t var_D4[46];
// 405907: using guessed type wchar_t var_78[46];

//----- (0040678B) --------------------------------------------------------
int sub_40678B()
{
  char v0; // bl
  int v1; // esi
  int v3; // edi
  int v4; // ebp
  int v5; // ecx
  int v6; // edi
  int v7; // ebp
  unsigned int v8; // ecx
  char *v9; // edx
  bool v10; // cf
  int v11; // edi
  int v12; // eax
  __int64 v13; // rax
  char v14; // al
  char v15; // cl
  unsigned int v16; // [esp+0h] [ebp-20h]
  int v17; // [esp+4h] [ebp-1Ch]
  unsigned int v18; // [esp+8h] [ebp-18h]
  int v19; // [esp+18h] [ebp-8h]

  dword_43FFFC = -1;
  v0 = 0;
  dword_4400F4 = 1;
  v1 = 0;
  dword_440014 = 0;
  dword_440010 = 0;
  dword_440018 = 0;
  if ( !byte_44F4E1 )
  {
    if ( sub_4074AD() )
    {
      sub_402447(&SrcStr, 1);
      if ( sub_4074AD() )
      {
        sub_401968(dword_44A2FC, (int)&word_4525F2, (int)&SrcStr);
        return 52;
      }
    }
    if ( !byte_44F4E1 )
    {
      v3 = *(&qword_42FFD8 + 1);
      v4 = qword_42FFD8;
      if ( *(_QWORD *)&qword_42FFD8 / 2048i64 < qword_42FFD0 )
      {
        if ( *(__int64 *)&qword_42FFD8 > 100000000 )
        {
          if ( sub_401E8E((int *)dword_440020) <= qword_42FFD0 )
            goto LABEL_11;
          v3 = *(&qword_42FFD8 + 1);
          v4 = qword_42FFD8;
        }
        (*(void (__thiscall **)(int, int, int, _DWORD))(*(_DWORD *)dword_4400F8 + 12))(dword_4400F8, v4, v3, 0);
        sub_402305((HANDLE *)dword_4400F8);
        (*(void (__thiscall **)(int, _DWORD, _DWORD, _DWORD))(*(_DWORD *)dword_4400F8 + 12))(dword_4400F8, 0, 0, 0);
      }
    }
  }
LABEL_11:
  sub_40710E();
  if ( !word_44005C )
  {
    v6 = 0;
    v7 = 0;
    v19 = 0;
LABEL_19:
    v8 = 0;
    v9 = byte_42FFF8;
    dword_440108 = 0;
    dword_440104 = (int)byte_42FFF8;
    while ( 1 )
    {
      v10 = (_DWORD)qword_440008 != 0;
      LODWORD(qword_440008) = qword_440008 - 1;
      HIDWORD(qword_440008) = v10 + HIDWORD(qword_440008) - 1;
      if ( qword_440008 < 0 )
      {
        v12 = sub_407650();
        v8 = dword_440108;
        v9 = (char *)dword_440104;
      }
      else
      {
        v11 = *(unsigned __int8 *)Src;
        Src = (char *)Src + 1;
        v12 = v11;
        v6 = v19;
      }
      if ( v12 == -1 )
        break;
      *v9 = v12;
      v9 = (char *)(dword_440104 + 1);
      v8 = dword_440108 + 1;
      ++dword_440104;
      dword_440108 = v8;
      if ( v8 == 0x10000 )
      {
        v17 = dword_440034;
        v6 = (__PAIR64__(v6, 0x10000) + (unsigned int)v7) >> 32;
        v7 += 0x10000;
        v16 = dword_440030;
        v19 = v6;
        v13 = ((__int64 (__thiscall *)(int))*(_DWORD *)(*(_DWORD *)dword_440020 + 16))(dword_440020);
        sub_405320(
          v7,
          v6,
          qword_42FFD8,
          *(&qword_42FFD8 + 1),
          qword_440038 + v13,
          (unsigned __int64)(qword_440038 + v13) >> 32,
          v16,
          v17);
        sub_40535A();
        if ( !sub_40535F() )
        {
          sub_407345(byte_42FFF8, dword_440108, v18);
          goto LABEL_19;
        }
        v8 = dword_440108;
        break;
      }
    }
    if ( v8 )
      sub_407345(byte_42FFF8, v8, v18);
LABEL_30:
    v14 = sub_40535F();
    v15 = byte_44F4E1;
    if ( v14 && !byte_44F4E1 )
      v0 = 1;
    if ( v1 == 6 )
    {
      sub_4019D7(dword_44A2FC);
      v15 = byte_44F4E1;
    }
    if ( byte_44119D && !byte_44119E || ~dword_43FFFC == dword_440064 )
    {
      if ( !v15 )
        goto LABEL_50;
    }
    else
    {
      if ( v1 <= 2 )
      {
        if ( (*(_BYTE *)(dword_42FFF4 + 64) & 1) != 0 )
          sub_4018B9(4, (int)&word_4525F2, (int)&SrcStr);
        else
          sub_4018B9(3, (int)&word_4525F2, (int)&SrcStr);
        v15 = byte_44F4E1;
      }
      if ( !byte_44F4B4 && !v15 )
        v0 = 1;
      v1 = 2;
    }
    if ( v15 )
    {
LABEL_54:
      if ( v0 )
        sub_402525(&SrcStr);
      sub_407885();
      return v1;
    }
LABEL_50:
    if ( v1 )
    {
      sub_402305((HANDLE *)dword_4400F8);
      v15 = byte_44F4E1;
    }
    if ( !v15 )
      sub_407059();
    goto LABEL_54;
  }
  if ( (unsigned int)(unsigned __int16)word_44005C - 8 <= 1 )
  {
    v5 = sub_407F58(word_44005C == 9);
    if ( v5 )
      v1 = 4 * (v5 == 3) + 2;
    goto LABEL_30;
  }
  sub_401AFC((int)&word_4525F2, (int)&SrcStr);
  sub_407885();
  if ( !byte_44F4E1 )
  {
    sub_407059();
    sub_402525(&SrcStr);
  }
  return 1;
}
// 406A02: variable 'v18' is possibly undefined
// 42FFD0: using guessed type __int64 qword_42FFD0;
// 42FFF4: using guessed type int dword_42FFF4;
// 43FFFC: using guessed type int dword_43FFFC;
// 440008: using guessed type __int64 qword_440008;
// 440010: using guessed type int dword_440010;
// 440014: using guessed type int dword_440014;
// 440018: using guessed type int dword_440018;
// 440020: using guessed type int dword_440020;
// 440030: using guessed type int dword_440030;
// 440034: using guessed type int dword_440034;
// 440038: using guessed type __int64 qword_440038;
// 44005C: using guessed type __int16 word_44005C;
// 440064: using guessed type int dword_440064;
// 4400F4: using guessed type int dword_4400F4;
// 4400F8: using guessed type int dword_4400F8;
// 440104: using guessed type int dword_440104;
// 440108: using guessed type int dword_440108;
// 44119D: using guessed type char byte_44119D;
// 44119E: using guessed type char byte_44119E;
// 44A2FC: using guessed type int dword_44A2FC[4];
// 44F4B4: using guessed type char byte_44F4B4;
// 44F4E1: using guessed type char byte_44F4E1;

//----- (00406AF2) --------------------------------------------------------
char __stdcall sub_406AF2(int a1, int a2, int a3, char *Destination, int a5)
{
  unsigned int v5; // edi
  int v6; // esi
  int v8; // ebp
  unsigned int v9; // ebx
  size_t v10; // edi

  v5 = a2;
  if ( a2 )
  {
    v6 = a1;
    if ( a1 )
    {
      while ( v5 >= 4 )
      {
        v8 = (unsigned __int16)sub_407425((unsigned __int16 *)v6);
        v9 = (unsigned __int16)sub_407425((unsigned __int16 *)(v6 + 2));
        if ( v9 > v5 - 4 )
          break;
        if ( v8 == 28789 && v9 > 5 && *(_BYTE *)(v6 + 4) == 1 && a3 == sub_407400((unsigned __int8 *)(v6 + 5)) )
        {
          v10 = v9 - 5;
          if ( v9 - 5 >= a5 - 1 )
            v10 = a5 - 1;
          strncpy(Destination, (const char *)(v6 + 9), v10);
          Destination[v10] = 0;
          return 1;
        }
        v6 += v9 + 4;
        v5 += -4 - v9;
      }
    }
  }
  return 0;
}

//----- (00406B88) --------------------------------------------------------
char __stdcall sub_406B88(int a1, unsigned int a2, _WORD *a3)
{
  unsigned int v3; // edi
  int v4; // esi
  unsigned int v5; // ebp
  int v7; // [esp+14h] [ebp+8h]

  v3 = a2;
  byte_44119D = 0;
  if ( !a2 )
    return 0;
  v4 = a1;
  if ( !a1 || !a3 || *a3 != 99 )
    return 0;
  if ( a2 >= 4 )
  {
    do
    {
      v7 = (unsigned __int16)sub_407425((unsigned __int16 *)v4);
      v5 = (unsigned __int16)sub_407425((unsigned __int16 *)(v4 + 2));
      if ( v5 > v3 - 4 )
        break;
      if ( v7 == 39169 && v5 >= 7 && (unsigned __int16)sub_407425((unsigned __int16 *)(v4 + 6)) == 17729 )
      {
        byte_44119E = (unsigned __int16)sub_407425((unsigned __int16 *)(v4 + 4)) == 1;
        dword_4411A0 = *(unsigned __int8 *)(v4 + 8);
        if ( (unsigned int)dword_4411A0 <= 3 )
        {
          *a3 = sub_407425((unsigned __int16 *)(v4 + 9));
          byte_44119D = 1;
        }
      }
      v3 += -4 - v5;
      v4 += v5 + 4;
    }
    while ( v3 >= 4 );
  }
  return byte_44119D;
}
// 44119D: using guessed type char byte_44119D;
// 44119E: using guessed type char byte_44119E;
// 4411A0: using guessed type int dword_4411A0;

//----- (00406C69) --------------------------------------------------------
char __stdcall sub_406C69(int a1, unsigned int a2, _DWORD *a3, _DWORD *a4, _DWORD *a5)
{
  unsigned int v5; // ebx
  int v6; // edi
  int v8; // esi
  unsigned int v9; // ebp
  int v10; // esi
  __int16 v11; // ax
  int v12; // esi
  int v13; // eax
  __int64 v14; // rcx
  int v15; // esi
  int v16; // eax
  int v17; // esi
  int v18; // eax

  v5 = a2;
  if ( a2 )
  {
    v6 = a1;
    if ( a1 )
    {
      while ( v5 >= 4 )
      {
        v8 = (unsigned __int16)sub_407425((unsigned __int16 *)v6);
        v9 = (unsigned __int16)sub_407425((unsigned __int16 *)(v6 + 2));
        if ( v9 > v5 - 4 )
          break;
        if ( v8 == 10 && v9 >= 0x20 )
        {
          v10 = (unsigned __int16)sub_407425((unsigned __int16 *)(v6 + 8));
          v11 = sub_407425((unsigned __int16 *)(v6 + 10));
          if ( v10 == 1 && v11 == 24 )
          {
            v12 = sub_407400((unsigned __int8 *)(v6 + 12));
            v13 = sub_407400((unsigned __int8 *)(v6 + 16));
            v14 = (unsigned int)a3;
            sub_404F14(a3, v12, v13);
            v15 = sub_407400((unsigned __int8 *)(v6 + 20));
            v16 = sub_407400((unsigned __int8 *)(v6 + 24));
            LODWORD(v14) = 0;
            sub_404F14(a4, v15, (__PAIR64__(v16, v15) + v14) >> 32);
            v17 = sub_407400((unsigned __int8 *)(v6 + 28));
            v18 = sub_407400((unsigned __int8 *)(v6 + 32));
            LODWORD(v14) = 0;
            sub_404F14(a5, v17, (__PAIR64__(v18, v17) + v14) >> 32);
            return 1;
          }
        }
        v6 += v9 + 4;
        v5 += -4 - v9;
      }
    }
  }
  return 0;
}

//----- (00406D5A) --------------------------------------------------------
BOOL __stdcall sub_406D5A(_BYTE *a1)
{
  return *a1 == 80 && a1[1] == 75 && a1[2] == 1 && a1[3] == 2;
}

//----- (00406D7F) --------------------------------------------------------
BOOL __stdcall sub_406D7F(_BYTE *a1)
{
  return *a1 == 80 && a1[1] == 75 && a1[2] == 6 && a1[3] == 6;
}

//----- (00406DA4) --------------------------------------------------------
BOOL __stdcall sub_406DA4(_BYTE *a1)
{
  return *a1 == 80 && a1[1] == 75 && a1[2] == 5 && a1[3] == 6;
}

//----- (00406DC9) --------------------------------------------------------
BOOL __stdcall sub_406DC9(_BYTE *a1)
{
  return *a1 == 80 && a1[1] == 75 && a1[2] == 3 && a1[3] == 4;
}

//----- (00406DEE) --------------------------------------------------------
int __stdcall sub_406DEE(void *Src, size_t Size)
{
  if ( Size > dword_4400F0 )
    return 50;
  memmove(dword_4400EC, Src, Size);
  dword_4400EC = (char *)dword_4400EC + Size;
  dword_4400F0 -= Size;
  dword_440108 += Size;
  return 0;
}
// 4400F0: using guessed type int dword_4400F0;
// 440108: using guessed type int dword_440108;

//----- (00406E2B) --------------------------------------------------------
int sub_406E2B()
{
  int v0; // ecx
  int v1; // ecx
  int result; // eax
  int v3; // edx

  *(_DWORD *)(dword_42FFF4 + 64) ^= (*(_DWORD *)(dword_42FFF4 + 64) ^ dword_440084) & 1;
  *(_DWORD *)(dword_42FFF4 + 64) ^= (*(_DWORD *)(dword_42FFF4 + 64) ^ ((unsigned int)dword_440084 >> 2)) & 2;
  *(_DWORD *)(dword_42FFF4 + 64) ^= (*(_DWORD *)(dword_42FFF4 + 64) ^ (4 * (unsigned __int16)word_4400A8)) & 4;
  *(_DWORD *)(dword_42FFF4 + 24) = dword_44008C;
  v0 = dword_42FFF4;
  *(_DWORD *)(dword_42FFF4 + 8) = dword_440090;
  *(_DWORD *)(v0 + 12) = dword_440094;
  v1 = dword_42FFF4;
  *(_DWORD *)(dword_42FFF4 + 16) = dword_440098;
  *(_DWORD *)(v1 + 20) = dword_44009C;
  *(_DWORD *)(dword_42FFF4 + 36) = dword_4400AC;
  if ( byte_440083 == 2 && (unsigned __int8)byte_440082 > 0x2Au
    || HIWORD(dword_440084) && HIWORD(dword_440084) != 8 && HIWORD(dword_440084) != 9 )
  {
    sub_401AFC((int)&word_4525F2, (int)&SrcStr);
    return 0;
  }
  else
  {
    v3 = dword_42FFF4;
    result = 1;
    *(_DWORD *)dword_42FFF4 = dword_4400B0;
    *(_DWORD *)(v3 + 4) = dword_4400B4;
  }
  return result;
}
// 42FFF4: using guessed type int dword_42FFF4;
// 440082: using guessed type char byte_440082;
// 440083: using guessed type char byte_440083;
// 440084: using guessed type int dword_440084;
// 44008C: using guessed type int dword_44008C;
// 440090: using guessed type int dword_440090;
// 440094: using guessed type int dword_440094;
// 440098: using guessed type int dword_440098;
// 44009C: using guessed type int dword_44009C;
// 4400A8: using guessed type __int16 word_4400A8;
// 4400AC: using guessed type int dword_4400AC;
// 4400B0: using guessed type int dword_4400B0;
// 4400B4: using guessed type int dword_4400B4;

//----- (00406F10) --------------------------------------------------------
BOOL __thiscall sub_406F10(unsigned int *this, int a2)
{
  unsigned int v2; // edx
  unsigned int v3; // ecx

  v2 = *this;
  v3 = this[1];
  return __PAIR64__(v3, v2) > *(_QWORD *)a2 || v2 == *(_DWORD *)a2 && v3 == *(_DWORD *)(a2 + 4);
}

//----- (00406F37) --------------------------------------------------------
int __stdcall sub_406F37(int a1, _DWORD *a2, LPSTR lpMultiByteStr, int a4)
{
  int v4; // ebx
  int v5; // edi
  WCHAR WideCharStr[128]; // [esp+Ch] [ebp-210h] BYREF
  char Src[260]; // [esp+10Ch] [ebp-110h] BYREF
  int v9; // [esp+218h] [ebp-4h]

  v4 = 0;
  if ( *a2 )
    --*a2;
  else
    *a2 = 2;
  sub_40411E(Src);
  v9 = 0;
  if ( !sub_405344(1, &SrcStr, Src) || !Src[256] )
    v4 = -2;
  v5 = 128;
  sub_40416A(Src, WideCharStr, 128);
  if ( a4 <= 128 )
    v5 = a4;
  sub_40557F(WideCharStr, lpMultiByteStr, v5);
  lpMultiByteStr[v5 - 1] = 0;
  sub_40431E(WideCharStr, 256);
  sub_404152(Src);
  return v4;
}
// 404152: using guessed type int __thiscall sub_404152(_DWORD);

//----- (00406FF6) --------------------------------------------------------
int __stdcall sub_406FF6(unsigned __int16 *a1)
{
  wchar_t Destination[2056]; // [esp+0h] [ebp-2048h] BYREF
  unsigned int v3[14]; // [esp+1010h] [ebp-1038h] BYREF
  wchar_t String[2048]; // [esp+1048h] [ebp-1000h] BYREF

  sub_40377F(a1, (int)String, 2048);
  sub_40241E(Destination);
  if ( sub_4028CC(String, Destination, 0) )
    return sub_406F10(v3, (int)&dword_441110);
  else
    return -1;
}
// 441110: using guessed type int dword_441110;
// 406FF6: using guessed type unsigned int var_1038[14];

//----- (00407059) --------------------------------------------------------
char sub_407059()
{
  int v0; // eax

  if ( dword_4400F8 )
  {
    sub_4021AD(
      dword_4400F8,
      dword_4505AC != 0 ? &dword_441110 : 0,
      dword_4505B0 != 0 ? &dword_441120 : 0,
      dword_4505B4 != 0 ? &dword_441118 : 0);
    sub_401C84(dword_4400F8);
    nullsub_1(dword_4505AC != 0 ? &dword_441110 : 0, dword_4505B4 != 0 ? &dword_441118 : 0);
    if ( dword_4400F8 )
      (**(void (__thiscall ***)(int, int))dword_4400F8)(dword_4400F8, 1);
  }
  dword_4400F8 = 0;
  v0 = *(_DWORD *)(dword_42FFF4 + 36);
  if ( byte_44F470 )
    LOBYTE(v0) = v0 & 0xDF;
  if ( !byte_44F4BC )
    LOBYTE(v0) = sub_40284A(&SrcStr, v0 & 0x7F);
  return v0;
}
// 4021AA: using guessed type _DWORD __stdcall nullsub_1(_DWORD, _DWORD);
// 42FFF4: using guessed type int dword_42FFF4;
// 4400F8: using guessed type int dword_4400F8;
// 441110: using guessed type int dword_441110;
// 441118: using guessed type int dword_441118;
// 441120: using guessed type int dword_441120;
// 44F470: using guessed type char byte_44F470;
// 44F4BC: using guessed type char byte_44F4BC;
// 4505AC: using guessed type int dword_4505AC;
// 4505B0: using guessed type int dword_4505B0;
// 4505B4: using guessed type int dword_4505B4;

//----- (0040710E) --------------------------------------------------------
int sub_40710E()
{
  unsigned int v0; // ebx
  unsigned int v1; // edi
  unsigned int v2; // esi
  __int64 v3; // rax
  int v4; // ecx

  v0 = qword_440008;
  v1 = HIDWORD(qword_42FFD0);
  v2 = qword_42FFD0;
  LODWORD(v3) = qword_440008;
  if ( (int)qword_440008 <= qword_42FFD0 )
  {
    dword_441188 = 0;
    dword_44118C = 0;
    HIDWORD(v3) = HIDWORD(qword_440008);
  }
  else
  {
    if ( qword_42FFD0 < 0 )
    {
      v2 = 0;
      v1 = 0;
    }
    dword_441190 = (int)Src + v2;
    v3 = (int)v2;
    v0 = v2;
    v4 = (unsigned __int64)(qword_440008 - (int)v2) >> 32;
    dword_441188 = qword_440008 - v2;
    qword_440008 = (int)v2;
    dword_44118C = v4;
  }
  qword_42FFD0 = __PAIR64__(v1, v2) - __PAIR64__(HIDWORD(v3), v0);
  return v3;
}
// 42FFD0: using guessed type __int64 qword_42FFD0;
// 440008: using guessed type __int64 qword_440008;
// 441188: using guessed type int dword_441188;
// 44118C: using guessed type int dword_44118C;
// 441190: using guessed type int dword_441190;

//----- (0040719B) --------------------------------------------------------
int __stdcall sub_40719B(size_t Size, int a2, _WORD *a3, int a4)
{
  size_t v4; // esi
  int v5; // ebx
  void *v7; // eax
  __int64 v8; // rax
  unsigned __int16 v9; // di
  unsigned int v10; // eax
  bool v11; // al
  char szSrc[2048]; // [esp+8h] [ebp-800h] BYREF

  v4 = Size;
  v5 = 0;
  if ( !Size )
    return 0;
  switch ( a2 )
  {
    case 0:
      goto LABEL_25;
    case 2:
      v9 = 0;
      if ( Size >= 0x800 )
      {
        v5 = 1;
        v9 = Size - 2047;
        v4 = 2047;
      }
      dword_44110C = 0;
      if ( !sub_407568(szSrc, v4) )
        return 51;
      v10 = sub_401773(0xFFFFFFFF, szSrc, v4);
      szSrc[v4] = 0;
      dword_44110C = ~v10;
      if ( (*a3 & 0x800) != 0 )
        goto LABEL_21;
      if ( a4 && sub_40A581((unsigned __int8 *)szSrc, a4) )
        *a3 |= 0x800u;
      if ( (*a3 & 0x800) != 0 )
      {
LABEL_21:
        sub_405401((unsigned __int8 *)szSrc, &SrcStr, 2048);
        sub_403251(&SrcStr, 2048);
      }
      else
      {
        v11 = sub_40A5A9(*(_DWORD *)(dword_42FFF4 + 28), byte_440080);
        sub_404336((unsigned __int8 *)szSrc, &SrcStr, 2048, v11);
      }
      sub_40377F(&SrcStr, (int)&SrcStr, 2048);
      if ( !v9 )
        return v5;
      v4 = v9;
LABEL_25:
      v8 = v4 + (_BYTE *)Src - dword_440000 - qword_440048;
      goto LABEL_26;
    case 3:
      if ( Block )
        j___free_base(Block);
      v7 = malloc(Size);
      Block = v7;
      if ( !v7 )
      {
        v8 = Size + (_BYTE *)Src - dword_440000 - qword_440048;
LABEL_26:
        sub_407786(qword_440040 + v8);
        return v5;
      }
      if ( !sub_407568((char *)v7, Size) )
        return 51;
      break;
  }
  return v5;
}
// 42FFF4: using guessed type int dword_42FFF4;
// 440040: using guessed type __int64 qword_440040;
// 440048: using guessed type __int64 qword_440048;
// 440080: using guessed type char byte_440080;
// 40719B: using guessed type char szSrc[2048];

//----- (00407345) --------------------------------------------------------
char __userpurge sub_407345@<al>(char *a1, unsigned int a2, unsigned int a3)
{
  unsigned int v3; // eax

  v3 = sub_401773(dword_43FFFC, a1, a2);
  dword_43FFFC = v3;
  if ( !byte_44F4E1 && a2 )
    LOBYTE(v3) = sub_402315((int *)dword_4400F8, a1, a2, a3);
  return v3;
}
// 43FFFC: using guessed type int dword_43FFFC;
// 4400F8: using guessed type int dword_4400F8;
// 44F4E1: using guessed type char byte_44F4E1;

//----- (0040737D) --------------------------------------------------------
unsigned __int64 __stdcall sub_40737D(unsigned __int8 *a1)
{
  return ((a1[1]
         + ((a1[2] + ((a1[3] + ((a1[4] + ((a1[5] + ((a1[6] + ((unsigned __int64)a1[7] << 8)) << 8)) << 8)) << 8)) << 8)) << 8)) << 8)
       + *a1;
}

//----- (00407400) --------------------------------------------------------
int __stdcall sub_407400(unsigned __int8 *a1)
{
  return *a1 + ((a1[1] + ((a1[2] + (a1[3] << 8)) << 8)) << 8);
}

//----- (00407425) --------------------------------------------------------
int __stdcall sub_407425(unsigned __int16 *a1)
{
  return *a1;
}

//----- (00407438) --------------------------------------------------------
int __usercall sub_407438@<eax>(int a1@<esi>)
{
  _DWORD *v1; // eax
  _DWORD *v2; // ecx
  void *Block; // [esp+0h] [ebp-10h]

  v1 = operator new(0x1024u);
  Block = v1;
  v2 = 0;
  if ( v1 )
    v2 = sub_401BAB(v1);
  dword_440020 = (int)v2;
  if ( (*(unsigned __int8 (__thiscall **)(_DWORD *, wchar_t *, int, int, void *))(*v2 + 4))(
         v2,
         &word_4525F2,
         byte_44F4B5 != 0 ? 4 : 0,
         a1,
         Block) )
  {
    return 0;
  }
  sub_401A0B(dword_44A2FC, (int)&word_4525F2);
  return 1;
}
// 407438: could not find valid save-restore pair for esi
// 440020: using guessed type int dword_440020;
// 44A2FC: using guessed type int dword_44A2FC[4];
// 44F4B5: using guessed type char byte_44F4B5;

//----- (004074AD) --------------------------------------------------------
int sub_4074AD()
{
  _DWORD *v1; // eax
  _DWORD *v2; // eax
  wchar_t Destination[2052]; // [esp+4h] [ebp-1058h] BYREF
  int v4; // [esp+100Ch] [ebp-50h]
  _DWORD *v5; // [esp+104Ch] [ebp-10h]
  int v6; // [esp+1058h] [ebp-4h]

  sub_40241E(Destination);
  if ( sub_4028CC(&SrcStr, Destination, 0) )
  {
    if ( !sub_4025DA(v4) )
      sub_4026A3(&SrcStr);
    if ( !sub_402525(&SrcStr) )
      return 1;
  }
  v1 = operator new(0x1024u);
  v5 = v1;
  v6 = 0;
  if ( v1 )
    v2 = sub_401BAB(v1);
  else
    v2 = 0;
  v6 = -1;
  dword_4400F8 = (int)v2;
  if ( !sub_401CD2((int)v2, &SrcStr, 18) )
  {
    if ( dword_4400F8 )
      (**(void (__thiscall ***)(int, int))dword_4400F8)(dword_4400F8, 1);
    dword_4400F8 = 0;
    return 1;
  }
  return 0;
}
// 4400F8: using guessed type int dword_4400F8;

//----- (00407568) --------------------------------------------------------
size_t __stdcall sub_407568(char *a1, size_t Size)
{
  size_t v2; // esi
  size_t v3; // edi
  int v5; // edx
  size_t v6; // ecx
  char *v7; // eax
  __int64 v8; // rax
  size_t v9; // ebx
  unsigned __int64 v10; // kr00_8

  v2 = Size;
  v3 = Size;
  if ( !Size )
    return v3;
  v5 = HIDWORD(qword_440008);
  v6 = qword_440008;
  v7 = (char *)Src;
  while ( 1 )
  {
    if ( v5 > 0 || v5 >= 0 && v6 )
      goto LABEL_9;
    v8 = sub_407917((int)dword_440000, 0x2000);
    v6 = v8;
    qword_440008 = (int)v8;
    if ( !(_DWORD)v8 )
      return Size - v2;
    if ( v8 < 0 )
    {
      sub_401A34(dword_44A2FC, (int)&word_4525F2, (int)&SrcStr);
      return 0;
    }
    v7 = dword_440000;
    qword_440040 += 0x2000i64;
    Src = dword_440000;
LABEL_9:
    v9 = v2;
    if ( v2 >= v6 )
      v9 = v6;
    memmove(a1, v7, v9);
    v7 = (char *)Src + v9;
    a1 += v9;
    v10 = qword_440008 - v9;
    v5 = HIDWORD(v10);
    v6 = v10;
    Src = (char *)Src + v9;
    qword_440008 = __PAIR64__(v5, v6);
    v2 -= v9;
    if ( !v2 )
      return v3;
  }
}
// 440008: using guessed type __int64 qword_440008;
// 440040: using guessed type __int64 qword_440040;
// 44A2FC: using guessed type int dword_44A2FC[4];

//----- (00407650) --------------------------------------------------------
int sub_407650()
{
  int result; // eax
  bool v1; // cf
  int v2; // ebx
  __int64 v3; // rax
  unsigned __int8 *v4; // esi
  int v5; // ebp

  if ( dword_4400E8 )
    return -1;
  if ( qword_42FFD0 <= 0 )
  {
    qword_440008 = 0i64;
    v1 = (_DWORD)qword_42FFD0 != 0;
    LODWORD(qword_42FFD0) = qword_42FFD0 - 1;
    HIDWORD(qword_42FFD0) = v1 + HIDWORD(qword_42FFD0) - 1;
    return -1;
  }
  v2 = HIDWORD(qword_440008);
  if ( qword_440008 > 0 )
    goto LABEL_9;
  v3 = sub_407917((int)dword_440000, 0x2000);
  qword_440008 = v3;
  if ( !(_DWORD)v3 )
  {
LABEL_15:
    qword_440008 = 0i64;
    return -1;
  }
  if ( (((int)v3 >> 31) & (unsigned int)v3) == -1 )
  {
    sub_401A53(dword_44A2FC, (int)&word_4525F2);
    goto LABEL_15;
  }
  qword_440040 += 0x2000i64;
  Src = dword_440000;
  sub_40710E();
  v2 = HIDWORD(qword_440008);
LABEL_9:
  v4 = (unsigned __int8 *)Src;
  if ( (*(_BYTE *)(dword_42FFF4 + 64) & 1) != 0 )
  {
    v5 = qword_440008;
    if ( v2 | (unsigned int)qword_440008 )
    {
      do
      {
        v1 = v5-- != 0;
        v2 = v1 + v2 - 1;
        *v4 ^= sub_40A2DA();
        sub_40A3EC(*v4++);
      }
      while ( v2 | v5 );
      v2 = HIDWORD(qword_440008);
      v4 = (unsigned __int8 *)Src;
    }
  }
  v1 = (_DWORD)qword_440008 != 0;
  LODWORD(qword_440008) = qword_440008 - 1;
  HIDWORD(qword_440008) = v1 + v2 - 1;
  result = *v4;
  Src = v4 + 1;
  return result;
}
// 42FFD0: using guessed type __int64 qword_42FFD0;
// 42FFF4: using guessed type int dword_42FFF4;
// 440008: using guessed type __int64 qword_440008;
// 440040: using guessed type __int64 qword_440040;
// 4400E8: using guessed type int dword_4400E8;
// 44A2FC: using guessed type int dword_44A2FC[4];

//----- (00407786) --------------------------------------------------------
int __stdcall sub_407786(__int64 a1)
{
  int v1; // edi
  __int64 v2; // kr00_8
  __int64 v4; // rax
  bool v5; // cf
  char *v6; // eax
  int v7; // eax
  int v8; // esi

  v1 = (a1 + qword_440048) % 0x2000;
  v2 = a1 + qword_440048 - (a1 + qword_440048) % 0x2000;
  if ( (((unsigned __int64)(a1 + qword_440048) >> 32) & 0x80000000) != 0i64 )
    return 3;
  if ( v2 == qword_440040 )
  {
    v4 = (_BYTE *)Src - dword_440000 - v1;
    v5 = __CFADD__((_DWORD)v4, (_DWORD)qword_440008);
    LODWORD(qword_440008) = v4 + qword_440008;
    v6 = &dword_440000[v1];
    HIDWORD(qword_440008) += HIDWORD(v4) + v5;
  }
  else
  {
    (*(void (__thiscall **)(int, _DWORD, _DWORD, _DWORD))(*(_DWORD *)dword_440020 + 12))(
      dword_440020,
      v2,
      HIDWORD(v2),
      0);
    qword_440040 = ((__int64 (__thiscall *)(int))*(_DWORD *)(*(_DWORD *)dword_440020 + 16))(dword_440020);
    v7 = (*(int (__thiscall **)(int, char *, int))(*(_DWORD *)dword_440020 + 8))(dword_440020, dword_440000, 0x2000);
    v8 = v7 >> 31;
    qword_440008 = v7;
    if ( (v8 < 0 || v7 >= 0) && (v8 < 0 || !v7) )
      return 51;
    qword_440008 = v7 - (__int64)v1;
    v6 = &dword_440000[v1];
  }
  Src = v6;
  return 0;
}
// 440008: using guessed type __int64 qword_440008;
// 440020: using guessed type int dword_440020;
// 440040: using guessed type __int64 qword_440040;
// 440048: using guessed type __int64 qword_440048;

//----- (00407885) --------------------------------------------------------
int sub_407885()
{
  int result; // eax
  int v1; // ecx
  __int64 v2; // rdi

  result = qword_440008;
  if ( qword_440008 <= 0 )
  {
    v1 = qword_42FFD0;
  }
  else
  {
    v1 = qword_440008 + qword_42FFD0;
    qword_42FFD0 += qword_440008;
  }
  HIDWORD(v2) = dword_44118C;
  if ( dword_44118C >= 0 && ((LODWORD(v2) = dword_441188, dword_44118C > 0) || dword_441188) )
  {
    dword_441188 = 0;
    dword_44118C = 0;
    qword_440008 = v2 + v1;
    result = dword_441190 - v1;
    Src = (void *)(dword_441190 - v1);
  }
  else if ( qword_440008 < 0 )
  {
    qword_440008 = 0i64;
  }
  return result;
}
// 42FFD0: using guessed type __int64 qword_42FFD0;
// 440008: using guessed type __int64 qword_440008;
// 441188: using guessed type int dword_441188;
// 44118C: using guessed type int dword_44118C;
// 441190: using guessed type int dword_441190;

//----- (00407917) --------------------------------------------------------
int __stdcall sub_407917(int a1, int a2)
{
  int v2; // eax
  int v3; // edi
  int v4; // ecx
  bool v5; // zf
  wchar_t *v6; // eax
  int v7; // eax
  wchar_t Destination[2048]; // [esp+10h] [ebp-1048h] BYREF
  __int64 v10; // [esp+1010h] [ebp-48h]

  v2 = (*(int (__thiscall **)(int, int, int))(*(_DWORD *)dword_440020 + 8))(dword_440020, a1, a2);
  v3 = v2;
  if ( byte_441194 && v2 != a2 && v2 != -1 && dword_441198 != -1 && dword_441198 < (unsigned __int16)word_4400B8 )
  {
    sub_40241E(Destination);
    if ( sub_4028CC(&word_4525F2, Destination, 0) )
      qword_440038 += v10;
    v4 = dword_441198 + 1;
    dword_441198 = v4;
    if ( v4 == (unsigned __int16)word_4400B8 )
    {
      if ( word_4525F2 )
      {
        v5 = !sub_40583F(&word_4525F2);
        v6 = (wchar_t *)L"zipx";
        if ( v5 )
          v6 = L"zip";
        sub_403715(&word_4525F2, v6, 2048);
      }
    }
    else if ( word_4525F2 )
    {
      sub_40587A(&word_4525F2, 2048, v4);
    }
    if ( dword_440020 )
      (**(void (__thiscall ***)(int, int))dword_440020)(dword_440020, 1);
    dword_440020 = 0;
    if ( !sub_407438((int)&word_4525F2) )
    {
      sub_405365(byte_44F4E1 == 0, &word_4525F2);
      v7 = (*(int (__thiscall **)(int, int, int))(*(_DWORD *)dword_440020 + 8))(dword_440020, v3 + a1, a2 - v3);
      if ( v7 < 0 )
        return -1;
      v3 += v7;
    }
  }
  return v3;
}
// 422B24: using guessed type wchar_t aZip[4];
// 440020: using guessed type int dword_440020;
// 440038: using guessed type __int64 qword_440038;
// 4400B8: using guessed type __int16 word_4400B8;
// 441194: using guessed type char byte_441194;
// 441198: using guessed type int dword_441198;
// 44F4E1: using guessed type char byte_44F4E1;

//----- (00407A70) --------------------------------------------------------
#error "407A89: call analysis failed (funcsize=9)"

//----- (00407A93) --------------------------------------------------------
int __stdcall sub_407A93(int *a1, unsigned int a2, unsigned int a3, int a4, int a5, _DWORD *a6, unsigned int *a7)
{
  int *v7; // ebx
  unsigned int v8; // esi
  int *v9; // ecx
  unsigned int v10; // edx
  int v11; // eax
  unsigned int i; // ecx
  int v13; // edi
  int v14; // edi
  int v15; // eax
  int v16; // edi
  int v17; // ecx
  unsigned int v18; // esi
  int v19; // eax
  unsigned int v20; // ecx
  int v21; // edx
  int v22; // eax
  signed int v23; // ebx
  unsigned int v24; // edx
  int v25; // ebp
  int v26; // eax
  signed int v27; // esi
  int *v28; // eax
  unsigned int *v29; // ecx
  int v30; // eax
  unsigned int v31; // edx
  int v32; // ebx
  int *v33; // ecx
  int j; // esi
  int result; // eax
  unsigned int v36; // esi
  _DWORD *v37; // eax
  _DWORD *v38; // edx
  unsigned int v39; // ecx
  unsigned int v40; // edx
  int v41; // ecx
  signed int v42; // eax
  unsigned int v43; // ecx
  __int16 v44; // ax
  int v45; // ecx
  int v46; // eax
  unsigned int v47; // ebx
  char *v48; // esi
  unsigned int v49; // eax
  unsigned int v50; // ecx
  unsigned int v52; // [esp+10h] [ebp-5D8h]
  int *v53; // [esp+14h] [ebp-5D4h]
  unsigned int v54; // [esp+18h] [ebp-5D0h]
  unsigned int v55; // [esp+18h] [ebp-5D0h]
  unsigned int v56; // [esp+1Ch] [ebp-5CCh]
  signed int v57; // [esp+20h] [ebp-5C8h]
  int v58; // [esp+24h] [ebp-5C4h]
  char *v59; // [esp+28h] [ebp-5C0h]
  unsigned int v60; // [esp+2Ch] [ebp-5BCh]
  int v61; // [esp+2Ch] [ebp-5BCh]
  unsigned int v62; // [esp+30h] [ebp-5B8h]
  char *v63; // [esp+34h] [ebp-5B4h]
  int v64; // [esp+38h] [ebp-5B0h]
  signed int v65; // [esp+3Ch] [ebp-5ACh]
  int *v66; // [esp+40h] [ebp-5A8h]
  unsigned int v67; // [esp+44h] [ebp-5A4h]
  _DWORD *v68; // [esp+48h] [ebp-5A0h]
  int v69; // [esp+4Ch] [ebp-59Ch]
  int v70; // [esp+58h] [ebp-590h]
  int v71[17]; // [esp+5Ch] [ebp-58Ch] BYREF
  int v72; // [esp+A0h] [ebp-548h]
  int v73[16]; // [esp+A4h] [ebp-544h]
  int v74; // [esp+E4h] [ebp-504h]
  int v75[16]; // [esp+E8h] [ebp-500h]
  int v76[16]; // [esp+128h] [ebp-4C0h]
  unsigned int v77[288]; // [esp+168h] [ebp-480h] BYREF

  v7 = a1;
  v8 = 16;
  if ( a2 <= 0x100 )
    v67 = 16;
  else
    v67 = a1[256];
  memset(v71, 0, sizeof(v71));
  v9 = a1;
  v10 = a2;
  do
  {
    v11 = *v9++;
    ++v71[v11];
    --v10;
  }
  while ( v10 );
  if ( v71[0] == a2 )
  {
    *a6 = 0;
    *a7 = 0;
    return 0;
  }
  for ( i = 1; i <= 0x10; ++i )
  {
    if ( v71[i] )
      break;
  }
  v57 = i;
  if ( *a7 < i )
    *a7 = i;
  do
  {
    if ( v71[v8] )
      break;
    --v8;
  }
  while ( v8 );
  v65 = v8;
  if ( *a7 > v8 )
    *a7 = v8;
  v13 = 1 << i;
  while ( i < v8 )
  {
    v14 = v13 - v71[i];
    if ( v14 < 0 )
      return 2;
    ++i;
    v13 = 2 * v14;
  }
  v60 = v8;
  v15 = v71[v8];
  v16 = v13 - v15;
  v70 = v16;
  if ( v16 < 0 )
    return 2;
  v71[v8] = v16 + v15;
  v17 = 0;
  v73[0] = 0;
  v18 = v8 - 1;
  if ( v18 )
  {
    v19 = 0;
    do
    {
      v17 += v71[++v19];
      v73[v19] = v17;
      --v18;
    }
    while ( v18 );
  }
  memset(v77, 0, sizeof(v77));
  v20 = 0;
  do
  {
    v21 = *v7++;
    if ( v21 )
    {
      v22 = v73[v21 - 1];
      v77[v22] = v20;
      v73[v21 - 1] = v22 + 1;
    }
    ++v20;
  }
  while ( v20 < a2 );
  v23 = v57;
  v24 = 0;
  v52 = 0;
  v25 = -1;
  v74 = 0;
  v26 = v73[v60 - 1];
  v72 = 0;
  v76[0] = 0;
  v63 = 0;
  v54 = 0;
  v27 = v65;
  v69 = v26;
  v53 = (int *)v77;
  v64 = -1;
  v56 = 0;
  if ( v57 <= v65 )
  {
    v28 = &v71[v57];
    v68 = a6;
    v29 = v77;
    v66 = v28;
    while ( 1 )
    {
      v30 = *v28;
      if ( v30 )
        break;
LABEL_69:
      ++v23;
      v28 = v66 + 1;
      v57 = v23;
      ++v66;
      if ( v23 > v27 )
        goto LABEL_70;
    }
    v62 = v30 + 1;
    while ( 1 )
    {
      --v62;
      v61 = v30 - 1;
      if ( v23 > (int)(v24 + v75[v25]) )
        break;
LABEL_51:
      BYTE1(v58) = v23 - v24;
      if ( v29 < &v77[v69] )
      {
        v43 = *v29;
        if ( v43 >= a3 )
        {
          v45 = v43 - a3;
          ++v53;
          LOBYTE(v58) = *(_BYTE *)(v45 + a5);
          v44 = *(_WORD *)(a4 + 2 * v45);
        }
        else
        {
          LOBYTE(v58) = (v43 < 0x100) + 31;
          v44 = *(_WORD *)v53++;
        }
        LOWORD(v59) = v44;
      }
      else
      {
        LOBYTE(v58) = 99;
      }
      v46 = 1 << (v23 - v24);
      v47 = v52 >> v24;
      if ( v52 >> v24 < v54 )
      {
        v48 = &v63[8 * v47];
        do
        {
          v47 += v46;
          *(_DWORD *)v48 = v58;
          *((_DWORD *)v48 + 1) = v59;
          v48 += 8 * v46;
        }
        while ( v47 < v54 );
        v24 = v56;
        v16 = v70;
        v25 = v64;
      }
      v23 = v57;
      v49 = 1 << (v57 - 1);
      v50 = v52;
      while ( (v49 & v50) != 0 )
      {
        v50 ^= v49;
        v49 >>= 1;
      }
      v52 = v49 ^ v50;
      if ( ((v49 ^ v50) & ((1 << v24) - 1)) != v73[v25 - 1] )
      {
        do
          v24 -= v75[--v25];
        while ( (v52 & ((1 << v24) - 1)) != v73[v25 - 1] );
        v23 = v57;
        v64 = v25;
        v56 = v24;
      }
      v30 = v61;
      v29 = (unsigned int *)v53;
      if ( !v61 )
      {
        v27 = v65;
        goto LABEL_69;
      }
    }
    while ( 1 )
    {
      v31 = v75[v25++] + v24;
      v56 = v31;
      v64 = v25;
      v55 = v65 - v31;
      if ( v65 - v31 > *a7 )
        v55 = *a7;
      v32 = v23 - v31;
      if ( 1 << v32 > v62 )
      {
        v33 = v66;
        for ( j = -1 - v61 + (1 << v32); ; j = v36 - *v33 )
        {
          if ( ++v32 < v55 )
          {
            v36 = 2 * j;
            if ( v36 > *++v33 )
              continue;
          }
          break;
        }
      }
      if ( v31 + v32 > v67 && v31 < v67 )
        v32 = v67 - v31;
      v54 = 1 << v32;
      v75[v25] = v32;
      v37 = malloc(8 * (1 << v32) + 8);
      if ( !v37 )
        break;
      v38 = v68;
      v63 = (char *)(v37 + 2);
      v68 = v37 + 1;
      v76[v25] = (int)(v37 + 2);
      *v38 = v37 + 2;
      v37[1] = 0;
      if ( v25 )
      {
        v59 = (char *)(v37 + 2);
        v39 = v56 - v75[v25 - 1];
        v73[v25 - 1] = v52;
        v40 = (v52 & ((1 << v56) - 1)) >> v39;
        v41 = v75[v25 + 15];
        BYTE1(v58) = v75[v25 - 1];
        LOBYTE(v58) = v32 + 32;
        *(_DWORD *)(v41 + 8 * v40) = v58;
        *(_DWORD *)(v41 + 8 * v40 + 4) = v63;
      }
      v24 = v56;
      v42 = v56 + v32;
      v23 = v57;
      if ( v57 <= v42 )
      {
        v29 = (unsigned int *)v53;
        goto LABEL_51;
      }
    }
    if ( v25 )
      sub_407F34(v76[0]);
    return 3;
  }
LABEL_70:
  *a7 = v75[0];
  if ( !v16 )
    return 0;
  result = 1;
  if ( v27 == 1 )
    return 0;
  return result;
}
// 407D7E: variable 'v58' is possibly undefined
// 407E52: variable 'v59' is possibly undefined
// 407A93: using guessed type unsigned int var_480[288];
// 407A93: using guessed type int var_4C0[16];

//----- (00407F34) --------------------------------------------------------
int __stdcall sub_407F34(int a1)
{
  int v1; // eax
  int v2; // esi

  v1 = a1;
  if ( a1 )
  {
    do
    {
      v2 = *(_DWORD *)(v1 - 4);
      j___free_base((void *)(v1 - 8));
      v1 = v2;
    }
    while ( v2 );
  }
  return 0;
}

//----- (00407F58) --------------------------------------------------------
int __stdcall sub_407F58(int a1)
{
  __int64 v1; // rdi
  int v2; // ebp
  unsigned __int64 v3; // kr00_8
  int v4; // eax
  int result; // eax
  __int64 v6; // rax
  unsigned int v7; // [esp-8h] [ebp-1Ch]
  int v8; // [esp-4h] [ebp-18h]
  int v9; // [esp+Ch] [ebp-8h]
  int v10; // [esp+10h] [ebp-4h] BYREF

  HIDWORD(v1) = HIDWORD(qword_42FFD0);
  v3 = qword_42FFD0;
  v9 = HIDWORD(v3);
  v2 = v3;
  Size = 0;
  dword_441184 = 0;
  dword_441180 = 0;
  if ( a1 )
  {
    dword_441140 = dword_441150;
    dword_441148 = dword_441158;
    dword_441144 = dword_441154;
    v4 = dword_44115C;
    dword_441170 = (int)&unk_422B60;
    dword_441174 = (int)&unk_422BE0;
    dword_441178 = (int)&unk_422C60;
  }
  else
  {
    dword_441140 = dword_441160;
    dword_441148 = dword_441168;
    dword_441144 = dword_441164;
    v4 = dword_44116C;
    dword_441170 = (int)&unk_422BA0;
    dword_441174 = (int)&unk_422C00;
    dword_441178 = (int)&unk_422C80;
  }
  dword_44114C = v4;
  while ( 1 )
  {
    result = sub_4080E2(&v10);
    if ( result )
      break;
    if ( sub_40535F() )
      return 1;
    LODWORD(v1) = v2;
    v8 = dword_440034;
    v7 = dword_440030;
    v1 -= qword_42FFD0;
    v6 = ((__int64 (__thiscall *)(int))*(_DWORD *)(*(_DWORD *)dword_440020 + 16))(dword_440020);
    sub_405320(v1, SHIDWORD(v1), v2, v9, qword_440038 + v6, (unsigned __int64)(qword_440038 + v6) >> 32, v7, v8);
    HIDWORD(v1) = v9;
    if ( v10 )
    {
      if ( a1 )
      {
        dword_441150 = dword_441140;
        dword_441158 = dword_441148;
        dword_441154 = dword_441144;
        dword_44115C = dword_44114C;
      }
      else
      {
        dword_441160 = dword_441140;
        dword_441168 = dword_441148;
        dword_441164 = dword_441144;
        dword_44116C = dword_44114C;
      }
      return sub_407A70(Size);
    }
  }
  return result;
}
// 42FFD0: using guessed type __int64 qword_42FFD0;
// 440020: using guessed type int dword_440020;
// 440030: using guessed type int dword_440030;
// 440034: using guessed type int dword_440034;
// 440038: using guessed type __int64 qword_440038;
// 441140: using guessed type int dword_441140;
// 441144: using guessed type int dword_441144;
// 441148: using guessed type int dword_441148;
// 44114C: using guessed type int dword_44114C;
// 441150: using guessed type int dword_441150;
// 441154: using guessed type int dword_441154;
// 441158: using guessed type int dword_441158;
// 44115C: using guessed type int dword_44115C;
// 441160: using guessed type int dword_441160;
// 441164: using guessed type int dword_441164;
// 441168: using guessed type int dword_441168;
// 44116C: using guessed type int dword_44116C;
// 441170: using guessed type int dword_441170;
// 441174: using guessed type int dword_441174;
// 441178: using guessed type int dword_441178;
// 441180: using guessed type int dword_441180;
// 441184: using guessed type int dword_441184;

//----- (004080E2) --------------------------------------------------------
int __stdcall sub_4080E2(int *a1)
{
  unsigned int v1; // esi
  int v2; // ebp
  int v3; // edi
  int v4; // eax
  unsigned __int8 *v5; // ebx
  bool v6; // cf
  int v7; // edx
  int v8; // eax
  char v9; // cl
  int v10; // ecx
  unsigned int v11; // esi
  unsigned int v12; // edi
  int v13; // eax
  unsigned __int8 *v14; // ebx
  int v15; // edx
  int v16; // eax
  char v17; // cl
  int v18; // ecx

  v1 = dword_441180;
  v2 = 0;
  v3 = dword_441184;
  if ( !dword_441184 )
  {
    v4 = qword_440008;
    v5 = (unsigned __int8 *)Src;
    while ( 1 )
    {
      v6 = v4-- != 0;
      LODWORD(qword_440008) = v4;
      HIDWORD(qword_440008) = v6 + HIDWORD(qword_440008) - 1;
      if ( qword_440008 < 0 )
      {
        v8 = sub_407650();
        v5 = (unsigned __int8 *)Src;
        v7 = v8;
        v4 = qword_440008;
      }
      else
      {
        v7 = *v5++;
        Src = v5;
      }
      if ( v7 == -1 )
        break;
      v9 = v3;
      v3 += 8;
      v1 |= v7 << v9;
      if ( v3 )
        goto LABEL_10;
    }
    v2 = 1;
  }
LABEL_10:
  v10 = v1 & 1;
  v11 = v1 >> 1;
  v12 = v3 - 1;
  *a1 = v10;
  if ( v12 < 2 )
  {
    v13 = qword_440008;
    v14 = (unsigned __int8 *)Src;
    while ( 1 )
    {
      v6 = v13-- != 0;
      LODWORD(qword_440008) = v13;
      HIDWORD(qword_440008) = v6 + HIDWORD(qword_440008) - 1;
      if ( qword_440008 < 0 )
      {
        v16 = sub_407650();
        v14 = (unsigned __int8 *)Src;
        v15 = v16;
        v13 = qword_440008;
      }
      else
      {
        v15 = *v14++;
        Src = v14;
      }
      if ( v15 == -1 )
        break;
      v17 = v12;
      v12 += 8;
      v11 |= v15 << v17;
      if ( v12 >= 2 )
        goto LABEL_19;
    }
    v2 = 1;
  }
LABEL_19:
  v18 = v11 & 3;
  if ( v2 )
    return 2;
  dword_441180 = v11 >> 2;
  dword_441184 = v12 - 2;
  if ( v18 == 2 )
    return sub_408677();
  if ( (v11 & 3) == 0 )
    return sub_408DA9();
  if ( v18 != 1 )
    return 2;
  else
    return sub_408C6F();
}
// 440008: using guessed type __int64 qword_440008;
// 441180: using guessed type int dword_441180;
// 441184: using guessed type int dword_441184;

//----- (00408203) --------------------------------------------------------
int __stdcall sub_408203(int a1, int a2, unsigned int a3, unsigned int a4)
{
  unsigned int v4; // edx
  int v5; // ebp
  unsigned int v6; // edi
  int v7; // esi
  unsigned __int8 *v8; // ebx
  bool v9; // cf
  int v10; // eax
  unsigned __int8 *v11; // eax
  unsigned int v12; // ebp
  int v13; // eax
  char v14; // cl
  int v15; // ecx
  unsigned int v16; // ebp
  int v17; // ebx
  int v18; // eax
  int v19; // eax
  unsigned int v20; // edx
  unsigned int i; // edi
  int v22; // eax
  unsigned __int8 *v23; // eax
  unsigned int v24; // ebp
  int v25; // eax
  unsigned int v26; // edx
  char v27; // cl
  int v28; // ecx
  unsigned int v29; // ebp
  int v30; // eax
  int v31; // esi
  unsigned int v32; // ebp
  unsigned int v33; // eax
  size_t v34; // ebx
  int v36; // [esp+10h] [ebp-20h]
  unsigned int v37; // [esp+10h] [ebp-20h]
  unsigned int v38; // [esp+10h] [ebp-20h]
  size_t v39; // [esp+14h] [ebp-1Ch]
  int v40; // [esp+18h] [ebp-18h]
  unsigned int v41; // [esp+1Ch] [ebp-14h]
  unsigned __int8 *v42; // [esp+20h] [ebp-10h]
  unsigned __int8 *v43; // [esp+20h] [ebp-10h]

  v40 = 0;
  v4 = dword_441180;
  v39 = Size;
  v36 = dword_441180;
  v5 = (1 << a3) - 1;
  v6 = dword_441184;
  while ( 2 )
  {
    v7 = qword_440008;
    v8 = (unsigned __int8 *)Src;
    while ( v6 < a3 )
    {
      v9 = v7-- != 0;
      LODWORD(qword_440008) = v7;
      HIDWORD(qword_440008) = v9 + HIDWORD(qword_440008) - 1;
      if ( qword_440008 < 0 )
      {
        v10 = sub_407650();
        v7 = qword_440008;
        v8 = (unsigned __int8 *)Src;
        v4 = v36;
      }
      else
      {
        v10 = *v8++;
        Src = v8;
      }
      if ( v10 == -1 )
      {
        v40 = 1;
        break;
      }
      v4 |= v10 << v6;
      v6 += 8;
      v36 = v4;
    }
    v11 = (unsigned __int8 *)(a1 + 8 * (v4 & v5));
    while ( 1 )
    {
      v15 = v11[1];
      v16 = *v11;
      v6 -= v15;
      v4 >>= v15;
      v36 = v4;
      v42 = v11;
      if ( v16 == 32 )
        break;
      if ( v16 < 0x1F )
      {
        while ( v6 < v16 )
        {
          v9 = v7-- != 0;
          LODWORD(qword_440008) = v7;
          HIDWORD(qword_440008) = v9 + HIDWORD(qword_440008) - 1;
          if ( qword_440008 < 0 )
          {
            v18 = sub_407650();
            v7 = qword_440008;
            v8 = (unsigned __int8 *)Src;
            v4 = v36;
          }
          else
          {
            v18 = *v8++;
            Src = v8;
          }
          if ( v18 == -1 )
          {
            v40 = 1;
            break;
          }
          v4 |= v18 << v6;
          v6 += 8;
          v36 = v4;
        }
        v19 = v4 & ((1 << v16) - 1);
        v20 = v4 >> v16;
        v41 = *((unsigned __int16 *)v42 + 2) + v19;
        for ( i = v6 - v16; ; i += 8 )
        {
          v37 = v20;
          if ( i >= a4 )
            break;
          v9 = v7-- != 0;
          LODWORD(qword_440008) = v7;
          HIDWORD(qword_440008) = v9 + HIDWORD(qword_440008) - 1;
          if ( qword_440008 < 0 )
          {
            v22 = sub_407650();
            v7 = qword_440008;
            v8 = (unsigned __int8 *)Src;
            v20 = v37;
          }
          else
          {
            v22 = *v8++;
            Src = v8;
          }
          if ( v22 == -1 )
          {
            v40 = 1;
            break;
          }
          v20 |= v22 << i;
        }
        v23 = (unsigned __int8 *)(a2 + 8 * (v20 & ((1 << a4) - 1)));
        while ( 1 )
        {
          v28 = v23[1];
          v29 = *v23;
          i -= v28;
          v26 = v20 >> v28;
          v38 = v26;
          v43 = v23;
          if ( v29 < 0x20 )
            break;
          if ( v29 == 99 )
            return 1;
          v24 = v29 & 0x1F;
          if ( i < v24 )
          {
            while ( 1 )
            {
              v9 = v7-- != 0;
              LODWORD(qword_440008) = v7;
              HIDWORD(qword_440008) = v9 + HIDWORD(qword_440008) - 1;
              if ( qword_440008 < 0 )
              {
                v25 = sub_407650();
                v7 = qword_440008;
                v8 = (unsigned __int8 *)Src;
                v26 = v38;
              }
              else
              {
                v25 = *v8++;
                Src = v8;
              }
              if ( v25 == -1 )
                break;
              v27 = i;
              i += 8;
              v26 |= v25 << v27;
              v38 = v26;
              if ( i >= v24 )
                goto LABEL_58;
            }
            v40 = 1;
LABEL_58:
            v23 = v43;
          }
          v23 = (unsigned __int8 *)(*((_DWORD *)v23 + 1) + 8 * (v38 & ((1 << v24) - 1)));
          v20 = v38;
        }
        while ( i < v29 )
        {
          v9 = v7-- != 0;
          LODWORD(qword_440008) = v7;
          HIDWORD(qword_440008) = v9 + HIDWORD(qword_440008) - 1;
          if ( qword_440008 < 0 )
          {
            v30 = sub_407650();
            v7 = qword_440008;
            v8 = (unsigned __int8 *)Src;
          }
          else
          {
            v30 = *v8++;
            Src = v8;
          }
          v26 = v38;
          if ( v30 == -1 )
          {
            v40 = 1;
            break;
          }
          v26 = (v30 << i) | v38;
          i += 8;
          v38 = v26;
        }
        v36 = v26 >> v29;
        v31 = v39 - (v26 & ((1 << v29) - 1)) - *((unsigned __int16 *)v43 + 2);
        v6 = i - v29;
        v32 = v39;
        do
        {
          v31 = (unsigned __int16)v31;
          v33 = v31;
          if ( (unsigned __int16)v31 <= v32 )
            v33 = v32;
          v34 = 0x10000 - v33;
          if ( 0x10000 - v33 > v41 )
            v34 = v41;
          v41 -= v34;
          if ( v32 - (unsigned __int16)v31 < v34 )
          {
            do
            {
              byte_42FFF8[v32++] = byte_42FFF8[v31++];
              --v34;
            }
            while ( v34 );
          }
          else
          {
            memmove(&byte_42FFF8[v32], &byte_42FFF8[(unsigned __int16)v31], v34);
            v32 += v34;
            LOWORD(v31) = v34 + v31;
          }
          v39 = v32;
          if ( v32 == 0x10000 )
          {
            v17 = sub_407A70(0x10000u);
            if ( v17 )
              return v17;
            v32 = 0;
            v39 = 0;
          }
        }
        while ( v41 );
        goto LABEL_29;
      }
      if ( v16 == 31 )
        goto LABEL_84;
      if ( v16 == 99 )
        return 1;
      v12 = v16 & 0x1F;
      if ( v6 < v12 )
      {
        while ( 1 )
        {
          v9 = v7-- != 0;
          LODWORD(qword_440008) = v7;
          HIDWORD(qword_440008) = v9 + HIDWORD(qword_440008) - 1;
          if ( qword_440008 < 0 )
          {
            v13 = sub_407650();
            v7 = qword_440008;
            v8 = (unsigned __int8 *)Src;
            v4 = v36;
          }
          else
          {
            v13 = *v8++;
            Src = v8;
          }
          if ( v13 == -1 )
            break;
          v14 = v6;
          v6 += 8;
          v4 |= v13 << v14;
          v36 = v4;
          if ( v6 >= v12 )
            goto LABEL_23;
        }
        v40 = 1;
LABEL_23:
        v11 = v42;
      }
      v11 = (unsigned __int8 *)(*((_DWORD *)v11 + 1) + 8 * (v36 & ((1 << v12) - 1)));
      v4 = v36;
    }
    byte_42FFF8[v39++] = v11[4];
    if ( v39 == 0x10000 )
    {
      v17 = sub_407A70(0x10000u);
      if ( v17 )
        return v17;
      v39 = 0;
    }
LABEL_29:
    v4 = v36;
    if ( !v40 )
    {
      v5 = (1 << a3) - 1;
      continue;
    }
    break;
  }
LABEL_84:
  v17 = 0;
  Size = v39;
  dword_441180 = v4;
  dword_441184 = v6;
  return v17;
}
// 440008: using guessed type __int64 qword_440008;
// 441180: using guessed type int dword_441180;
// 441184: using guessed type int dword_441184;

//----- (00408677) --------------------------------------------------------
int sub_408677()
{
  unsigned int v0; // ebx
  unsigned int v1; // esi
  int v2; // edx
  unsigned __int8 *v3; // edi
  bool v4; // cf
  int v5; // eax
  char v6; // bp
  unsigned int v7; // ebx
  unsigned int v8; // ebp
  unsigned int v9; // esi
  int v10; // eax
  char v11; // al
  unsigned int v12; // ebx
  unsigned int v13; // esi
  int v14; // eax
  int v15; // ecx
  unsigned int v16; // esi
  int v17; // eax
  unsigned int v18; // ebx
  unsigned int v19; // eax
  unsigned int v20; // ebp
  int v21; // edi
  int v23; // eax
  int v24; // eax
  int v25; // ecx
  unsigned int v26; // ebp
  unsigned int v27; // edi
  int v28; // edx
  unsigned __int8 *v29; // ebp
  int v30; // eax
  unsigned int v31; // eax
  int v32; // ecx
  unsigned int v33; // eax
  int v34; // eax
  int v35; // ecx
  unsigned int v36; // ecx
  int v37; // eax
  int v38; // ecx
  int v39; // ecx
  int v40; // eax
  int v41; // ecx
  unsigned int v42; // ebx
  int v43; // esi
  int v44; // eax
  int v45; // [esp+10h] [ebp-528h]
  unsigned int v46; // [esp+14h] [ebp-524h] BYREF
  int v47; // [esp+18h] [ebp-520h] BYREF
  unsigned int v48; // [esp+1Ch] [ebp-51Ch] BYREF
  unsigned int v49; // [esp+20h] [ebp-518h] BYREF
  unsigned int v50; // [esp+24h] [ebp-514h]
  int v51; // [esp+28h] [ebp-510h]
  unsigned int v52; // [esp+2Ch] [ebp-50Ch]
  unsigned int v53; // [esp+30h] [ebp-508h]
  int v54; // [esp+34h] [ebp-504h]
  int v55[320]; // [esp+38h] [ebp-500h] BYREF

  v45 = 0;
  memset(v55, 0, sizeof(v55));
  v0 = dword_441180;
  v1 = dword_441184;
  v2 = qword_440008;
  v3 = (unsigned __int8 *)Src;
  while ( v1 < 5 )
  {
    v4 = v2-- != 0;
    LODWORD(qword_440008) = v2;
    HIDWORD(qword_440008) = v4 + HIDWORD(qword_440008) - 1;
    if ( qword_440008 < 0 )
    {
      v5 = sub_407650();
      v2 = qword_440008;
      v3 = (unsigned __int8 *)Src;
    }
    else
    {
      v5 = *v3++;
      Src = v3;
    }
    if ( v5 == -1 )
    {
      v45 = 1;
      break;
    }
    v0 |= v5 << v1;
    v1 += 8;
  }
  v6 = v0;
  v7 = v0 >> 5;
  v8 = (v6 & 0x1F) + 257;
  v9 = v1 - 5;
  v53 = v8;
  while ( v9 < 5 )
  {
    v4 = v2-- != 0;
    LODWORD(qword_440008) = v2;
    HIDWORD(qword_440008) = v4 + HIDWORD(qword_440008) - 1;
    if ( qword_440008 < 0 )
    {
      v10 = sub_407650();
      v2 = qword_440008;
      v3 = (unsigned __int8 *)Src;
    }
    else
    {
      v10 = *v3++;
      Src = v3;
    }
    if ( v10 == -1 )
    {
      v45 = 1;
      break;
    }
    v7 |= v10 << v9;
    v9 += 8;
  }
  v11 = v7;
  v12 = v7 >> 5;
  v13 = v9 - 5;
  v48 = (v11 & 0x1F) + 1;
  while ( 1 )
  {
    if ( v13 >= 4 )
    {
      v15 = v45;
      goto LABEL_27;
    }
    v4 = v2-- != 0;
    LODWORD(qword_440008) = v2;
    HIDWORD(qword_440008) = v4 + HIDWORD(qword_440008) - 1;
    if ( qword_440008 < 0 )
    {
      v14 = sub_407650();
      v2 = qword_440008;
      v3 = (unsigned __int8 *)Src;
    }
    else
    {
      v14 = *v3++;
      Src = v3;
    }
    if ( v14 == -1 )
      break;
    v12 |= v14 << v13;
    v13 += 8;
  }
  v15 = 1;
  v45 = 1;
LABEL_27:
  v16 = v13 - 4;
  v17 = v12 & 0xF;
  v18 = v12 >> 4;
  v19 = v17 + 4;
  v49 = v19;
  if ( v8 > 0x120 || v48 > 0x20 )
    return 1;
  v20 = 0;
  if ( v19 )
  {
    while ( 1 )
    {
      if ( v15 )
        goto LABEL_31;
      while ( 1 )
      {
        if ( v16 >= 3 )
          goto LABEL_50;
        v4 = v2-- != 0;
        LODWORD(qword_440008) = v2;
        HIDWORD(qword_440008) = v4 + HIDWORD(qword_440008) - 1;
        if ( qword_440008 < 0 )
        {
          v23 = sub_407650();
          v2 = qword_440008;
          v3 = (unsigned __int8 *)Src;
        }
        else
        {
          v23 = *v3++;
          Src = v3;
        }
        if ( v23 == -1 )
          break;
        v18 |= v23 << v16;
        v16 += 8;
      }
      v45 = 1;
LABEL_50:
      v24 = dword_422CA0[v20];
      v25 = v18 & 7;
      v18 >>= 3;
      v16 -= 3;
      ++v20;
      v55[v24] = v25;
      if ( v20 >= v49 )
        goto LABEL_31;
      v15 = v45;
    }
  }
  do
  {
    v55[dword_422CA0[v20++]] = 0;
LABEL_31:
    ;
  }
  while ( v20 < 0x13 );
  v46 = 7;
  v21 = sub_407A93(v55, 0x13u, 0x13u, 0, 0, &v47, &v46);
  if ( !v46 )
    v21 = 1;
  if ( v21 )
  {
    if ( v21 == 1 )
      sub_407F34(v47);
    return v21;
  }
  v26 = v48;
  v27 = 0;
  v51 = 0;
  v52 = v48 + v53;
  v54 = (1 << v46) - 1;
  if ( !(v48 + v53) )
    goto LABEL_106;
  v28 = qword_440008;
  v29 = (unsigned __int8 *)Src;
  while ( !v45 )
  {
    while ( v16 < v46 )
    {
      v4 = v28-- != 0;
      LODWORD(qword_440008) = v28;
      HIDWORD(qword_440008) = v4 + HIDWORD(qword_440008) - 1;
      if ( qword_440008 < 0 )
      {
        v30 = sub_407650();
        v28 = qword_440008;
        v29 = (unsigned __int8 *)Src;
      }
      else
      {
        v30 = *v29++;
        Src = v29;
      }
      if ( v30 == -1 )
      {
        v45 = 1;
        break;
      }
      v18 |= v30 << v16;
      v16 += 8;
    }
    v31 = v47 + 8 * (v18 & v54);
    v32 = *(unsigned __int8 *)(v31 + 1);
    v49 = v31;
    v16 -= v32;
    v33 = *(unsigned __int16 *)(v31 + 4);
    v18 >>= v32;
    if ( v33 >= 0x10 )
    {
      if ( v33 == 16 )
      {
        while ( v16 < 2 )
        {
          v4 = v28-- != 0;
          LODWORD(qword_440008) = v28;
          HIDWORD(qword_440008) = v4 + HIDWORD(qword_440008) - 1;
          if ( qword_440008 < 0 )
          {
            v34 = sub_407650();
            v28 = qword_440008;
            v29 = (unsigned __int8 *)Src;
          }
          else
          {
            v34 = *v29++;
            Src = v29;
          }
          if ( v34 == -1 )
          {
            v45 = 1;
            break;
          }
          v18 |= v34 << v16;
          v16 += 8;
        }
        v16 -= 2;
        v35 = v18 & 3;
        v18 >>= 2;
        v36 = v35 + 3;
        v50 = v27 + v36;
        if ( v27 + v36 > v52 )
          return 1;
        if ( v36 )
        {
          memset32(&v55[v27], v51, v36);
          v27 = v50;
        }
        goto LABEL_104;
      }
      if ( v33 == 17 )
      {
        while ( v16 < 3 )
        {
          v4 = v28-- != 0;
          LODWORD(qword_440008) = v28;
          HIDWORD(qword_440008) = v4 + HIDWORD(qword_440008) - 1;
          if ( qword_440008 < 0 )
          {
            v37 = sub_407650();
            v28 = qword_440008;
            v29 = (unsigned __int8 *)Src;
          }
          else
          {
            v37 = *v29++;
            Src = v29;
          }
          if ( v37 == -1 )
          {
            v45 = 1;
            break;
          }
          v18 |= v37 << v16;
          v16 += 8;
        }
        v16 -= 3;
        v38 = v18 & 7;
        v18 >>= 3;
        v39 = v38 + 3;
        v50 = v27 + v39;
        if ( v27 + v39 > v52 )
          return 1;
        if ( v39 )
          goto LABEL_101;
      }
      else
      {
        while ( v16 < 7 )
        {
          v4 = v28-- != 0;
          LODWORD(qword_440008) = v28;
          HIDWORD(qword_440008) = v4 + HIDWORD(qword_440008) - 1;
          if ( qword_440008 < 0 )
          {
            v40 = sub_407650();
            v28 = qword_440008;
            v29 = (unsigned __int8 *)Src;
          }
          else
          {
            v40 = *v29++;
            Src = v29;
          }
          if ( v40 == -1 )
          {
            v45 = 1;
            break;
          }
          v18 |= v40 << v16;
          v16 += 8;
        }
        v16 -= 7;
        v41 = v18 & 0x7F;
        v18 >>= 7;
        v39 = v41 + 11;
        v50 = v27 + v39;
        if ( v27 + v39 > v52 )
          return 1;
        if ( v39 )
        {
LABEL_101:
          memset(&v55[v27], 0, 4 * v39);
          v27 = v50;
        }
      }
      v33 = 0;
      goto LABEL_103;
    }
    v55[v27++] = v33;
LABEL_103:
    v51 = v33;
LABEL_104:
    if ( v27 >= v52 )
      break;
  }
  v26 = v48;
LABEL_106:
  sub_407F34(v47);
  dword_441180 = v18;
  v42 = v53;
  dword_441184 = v16;
  v46 = 9;
  v43 = sub_407A93(v55, v53, 0x101u, dword_441170, dword_441174, &v47, &v46);
  if ( !v46 )
    v43 = 1;
  if ( v43 )
  {
    if ( v43 == 1 )
      goto LABEL_110;
  }
  else
  {
    v48 = 6;
    v44 = sub_407A93(&v55[v42], v26, 0, (int)&unk_422C20, dword_441178, &v49, &v48);
    v43 = v44 != 1 ? v44 : 0;
    if ( !v48 && v42 > 0x101 )
      v43 = 1;
    if ( v43 )
    {
      if ( v43 == 1 )
        sub_407F34(v49);
LABEL_110:
      sub_407F34(v47);
    }
    else
    {
      v43 = sub_408203(v47, v49, v46, v48);
      sub_407F34(v47);
      sub_407F34(v49);
    }
  }
  return v43;
}
// 422CA0: using guessed type int dword_422CA0[19];
// 440008: using guessed type __int64 qword_440008;
// 441170: using guessed type int dword_441170;
// 441174: using guessed type int dword_441174;
// 441178: using guessed type int dword_441178;
// 441180: using guessed type int dword_441180;
// 441184: using guessed type int dword_441184;
// 408677: using guessed type int var_500[320];

//----- (00408C6F) --------------------------------------------------------
int sub_408C6F()
{
  int v0; // eax
  int result; // eax
  int v2; // esi
  int v3[144]; // [esp+8h] [ebp-480h] BYREF
  _DWORD v4[112]; // [esp+248h] [ebp-240h] BYREF
  _DWORD v5[24]; // [esp+408h] [ebp-80h] BYREF
  _DWORD v6[8]; // [esp+468h] [ebp-20h] BYREF

  v0 = dword_441140;
  if ( !dword_441140 )
  {
    memset32(v3, 8, 0x90u);
    memset32(v4, 9, 0x70u);
    dword_441148 = 7;
    memset32(v5, 7, 0x18u);
    memset32(v6, 8, 8u);
    result = sub_407A93(v3, 0x120u, 0x101u, dword_441170, dword_441174, &dword_441140, (unsigned int *)&dword_441148);
    if ( result )
    {
      dword_441140 = 0;
      return result;
    }
    dword_44114C = 5;
    memset32(v3, 5, 0x20u);
    v2 = sub_407A93(v3, 0x20u, 0, (int)&unk_422C20, dword_441178, &dword_441144, (unsigned int *)&dword_44114C);
    if ( v2 > 1 )
    {
      sub_407F34(dword_441140);
      dword_441140 = 0;
      result = v2;
      dword_441144 = 0;
      return result;
    }
    v0 = dword_441140;
  }
  return sub_408203(v0, dword_441144, dword_441148, dword_44114C);
}
// 441140: using guessed type int dword_441140;
// 441144: using guessed type int dword_441144;
// 441148: using guessed type int dword_441148;
// 44114C: using guessed type int dword_44114C;
// 441170: using guessed type int dword_441170;
// 441174: using guessed type int dword_441174;
// 441178: using guessed type int dword_441178;
// 408C6F: using guessed type int var_480[144];

//----- (00408D79) --------------------------------------------------------
int sub_408D79()
{
  if ( dword_441140 )
  {
    sub_407F34(dword_441144);
    sub_407F34(dword_441140);
    dword_441140 = 0;
    dword_441144 = 0;
  }
  return 0;
}
// 441140: using guessed type int dword_441140;
// 441144: using guessed type int dword_441144;

//----- (00408DA9) --------------------------------------------------------
int sub_408DA9()
{
  int v0; // edx
  size_t v1; // ebp
  int v2; // ecx
  unsigned __int8 *v3; // edi
  unsigned int v4; // ebx
  unsigned int i; // esi
  bool v6; // cf
  int v7; // eax
  int v8; // ecx
  unsigned int v9; // esi
  unsigned int v10; // ebx
  int v11; // eax
  char v12; // cl
  int result; // eax
  unsigned int v14; // ebx
  unsigned int v15; // esi
  int v16; // eax
  char v17; // cl
  int v18; // [esp+10h] [ebp-Ch]
  int v19; // [esp+10h] [ebp-Ch]
  int v20; // [esp+14h] [ebp-8h]

  v20 = 0;
  v0 = qword_440008;
  v1 = Size;
  v2 = dword_441184 & 7;
  v3 = (unsigned __int8 *)Src;
  v4 = (unsigned int)dword_441180 >> v2;
  for ( i = dword_441184 - v2; i < 0x10; i += 8 )
  {
    v6 = v0-- != 0;
    LODWORD(qword_440008) = v0;
    HIDWORD(qword_440008) = v6 + HIDWORD(qword_440008) - 1;
    if ( qword_440008 < 0 )
    {
      v7 = sub_407650();
      v0 = qword_440008;
      v3 = (unsigned __int8 *)Src;
    }
    else
    {
      v7 = *v3++;
      Src = v3;
    }
    if ( v7 == -1 )
    {
      v20 = 1;
      break;
    }
    v4 |= v7 << i;
  }
  v8 = (unsigned __int16)v4;
  v9 = i - 16;
  v10 = HIWORD(v4);
  v18 = v8;
  if ( v9 < 0x10 )
  {
    while ( 1 )
    {
      v6 = v0-- != 0;
      LODWORD(qword_440008) = v0;
      HIDWORD(qword_440008) = v6 + HIDWORD(qword_440008) - 1;
      if ( qword_440008 < 0 )
      {
        v11 = sub_407650();
        v0 = qword_440008;
        v3 = (unsigned __int8 *)Src;
      }
      else
      {
        v11 = *v3++;
        Src = v3;
      }
      if ( v11 == -1 )
        break;
      v12 = v9;
      v9 += 8;
      v10 |= v11 << v12;
      if ( v9 >= 0x10 )
        goto LABEL_18;
    }
    v20 = 1;
LABEL_18:
    v8 = v18;
  }
  if ( v8 != (unsigned __int16)~(_WORD)v10 )
    return 1;
  v14 = HIWORD(v10);
  v15 = v9 - 16;
  if ( v8 )
  {
    while ( 1 )
    {
      v19 = --v8;
      if ( v20 )
        break;
      if ( v15 < 8 )
      {
        while ( 1 )
        {
          v6 = v0-- != 0;
          LODWORD(qword_440008) = v0;
          HIDWORD(qword_440008) = v6 + HIDWORD(qword_440008) - 1;
          if ( qword_440008 < 0 )
          {
            v16 = sub_407650();
            v0 = qword_440008;
            v3 = (unsigned __int8 *)Src;
          }
          else
          {
            v16 = *v3++;
            Src = v3;
          }
          if ( v16 == -1 )
            break;
          v17 = v15;
          v15 += 8;
          v14 |= v16 << v17;
          if ( v15 >= 8 )
            goto LABEL_31;
        }
        v20 = 1;
LABEL_31:
        v8 = v19;
      }
      byte_42FFF8[v1++] = v14;
      if ( v1 == 0x10000 )
      {
        result = sub_407A70(0x10000u);
        if ( result )
          return result;
        v8 = v19;
        v1 = 0;
      }
      v14 >>= 8;
      v15 -= 8;
      if ( !v8 )
        break;
      v0 = qword_440008;
      v3 = (unsigned __int8 *)Src;
    }
  }
  result = 0;
  Size = v1;
  dword_441180 = v14;
  dword_441184 = v15;
  return result;
}
// 440008: using guessed type __int64 qword_440008;
// 441180: using guessed type int dword_441180;
// 441184: using guessed type int dword_441184;

//----- (00408F82) --------------------------------------------------------
int sub_408F82()
{
  void *v0; // eax

  dword_440000 = (char *)malloc(0x2004u);
  v0 = malloc(0x10001u);
  dword_4400FC = v0;
  dword_440100 = (int)v0;
  if ( dword_440000 && v0 )
  {
    dword_440054 = dword_440000 + 0x2000;
    return 0;
  }
  else
  {
    sub_4019D7(dword_44A2FC);
    return 4;
  }
}
// 440100: using guessed type int dword_440100;
// 44A2FC: using guessed type int dword_44A2FC[4];

//----- (00408FD2) --------------------------------------------------------
int sub_408FD2()
{
  int v0; // esi
  int v1; // esi
  int v3; // [esp+0h] [ebp-2058h]
  int v4; // [esp+4h] [ebp-2054h]
  int v5; // [esp+8h] [ebp-2050h]
  int v6; // [esp+Ch] [ebp-204Ch]
  int Destination[1024]; // [esp+10h] [ebp-2048h] BYREF
  wchar_t v8[2048]; // [esp+1010h] [ebp-1048h] BYREF
  __int64 v9; // [esp+2010h] [ebp-48h]

  v0 = 0;
  sub_4045C8((wchar_t *)Destination, &word_4525F2, 2048);
  sub_40587A((wchar_t *)Destination, 2048, 0);
  while ( 1 )
  {
    sub_40241E(v8);
    if ( !sub_4028CC((wchar_t *)Destination, v8, 0) )
      break;
    qword_440030 += v9;
    ++v0;
    sub_4045C8((wchar_t *)Destination, &word_4525F2, 2048);
    sub_40587A((wchar_t *)Destination, 2048, v0);
  }
  qword_440038 = 0i64;
  v1 = sub_4098F0(v0);
  if ( v1 == 9 )
    sub_4019EC(dword_44A2FC, (int)&word_4525F2, (int)&word_4525F2);
  if ( v1 == 2 || v1 == 3 )
    sub_401901(dword_44A2FC, (int)&word_4525F2);
  if ( !v1 )
  {
    sub_407786(qword_4400D8);
    v1 = sub_405903(
           v3,
           v4,
           v5,
           v6,
           Destination[0],
           Destination[1],
           (wchar_t *)Destination[2],
           Destination[3],
           Destination[4],
           Destination[5],
           Destination[6],
           Destination[7],
           Destination[8],
           Destination[9],
           Destination[10],
           Destination[11],
           Destination[12],
           Destination[13],
           Destination[14],
           Destination[15],
           Destination[16],
           Destination[17],
           Destination[18],
           Destination[19],
           Destination[20],
           Destination[21],
           Destination[22],
           Destination[23]);
    if ( v1 == 2 )
      sub_401901(dword_44A2FC, (int)&word_4525F2);
    if ( v1 == 9 || v1 == 76 )
      sub_4019EC(dword_44A2FC, (int)&word_4525F2, (int)&word_4525F2);
    if ( dword_440020 )
      (**(void (__thiscall ***)(int, int))dword_440020)(dword_440020, 1);
    dword_440020 = 0;
  }
  return v1;
}
// 4090A0: variable 'v3' is possibly undefined
// 4090A0: variable 'v4' is possibly undefined
// 4090A0: variable 'v5' is possibly undefined
// 4090A0: variable 'v6' is possibly undefined
// 440020: using guessed type int dword_440020;
// 440030: using guessed type __int64 qword_440030;
// 440038: using guessed type __int64 qword_440038;
// 4400D8: using guessed type __int64 qword_4400D8;
// 44A2FC: using guessed type int dword_44A2FC[4];

//----- (004090EA) --------------------------------------------------------
int __stdcall sub_4090EA(__int64 a1)
{
  __int64 v2; // kr00_8
  unsigned __int16 v3; // bx
  unsigned __int16 v4; // bp
  unsigned __int64 v5; // kr08_8
  unsigned __int64 v6; // kr10_8
  int v7; // ebp
  int Buf2; // [esp+0h] [ebp-64h] BYREF
  int v9; // [esp+4h] [ebp-60h]
  unsigned __int64 v10; // [esp+8h] [ebp-5Ch]
  unsigned __int64 v11; // [esp+10h] [ebp-54h]
  int v12; // [esp+18h] [ebp-4Ch]
  int v13; // [esp+1Ch] [ebp-48h]
  int v14; // [esp+20h] [ebp-44h]
  int v15; // [esp+24h] [ebp-40h]
  char v16[16]; // [esp+28h] [ebp-3Ch] BYREF
  unsigned __int8 v17[4]; // [esp+38h] [ebp-2Ch] BYREF
  unsigned __int8 v18[4]; // [esp+3Ch] [ebp-28h] BYREF
  unsigned __int8 v19[8]; // [esp+40h] [ebp-24h] BYREF
  unsigned __int8 v20[8]; // [esp+48h] [ebp-1Ch] BYREF
  unsigned __int8 v21[8]; // [esp+50h] [ebp-14h] BYREF
  unsigned __int8 v22[12]; // [esp+58h] [ebp-Ch] BYREF

  Buf2 = 101075792;
  if ( sub_409E36(a1, &Buf2, 56) == 2 )
    return 0;
  v2 = qword_440040 + (_BYTE *)Src - dword_440000;
  if ( !sub_407568(v16, 0x3Cu) )
    return 51;
  v3 = sub_407400(v17);
  v13 = v3;
  v4 = sub_407400(v18);
  v15 = v4;
  v5 = sub_40737D(v19);
  v9 = HIDWORD(v5);
  v10 = sub_40737D(v20);
  v11 = sub_40737D(v21);
  v6 = sub_40737D(v22);
  v12 = HIDWORD(v6);
  Buf2 = v6;
  v14 = 0xFFFF;
  if ( (word_4400B8 == -1 || word_4400B8 == v3)
    && (word_4400BA == -1 || word_4400BA == v4)
    && (dword_4400C0 == 0xFFFF && !dword_4400C4 || dword_4400C0 == (_DWORD)v5 && dword_4400C4 == v9) )
  {
    v7 = HIDWORD(qword_4400C8);
    if ( (qword_4400C8 == 0xFFFF || qword_4400C8 == v10)
      && (qword_4400D0 == 0xFFFFFFFFi64 || qword_4400D0 == v11)
      && (dword_4400D8 == -1 && !dword_4400DC || dword_4400D8 == Buf2 && dword_4400DC == v12) )
    {
      if ( word_4400B8 == -1 )
      {
        word_4400B8 = v13;
        v7 = HIDWORD(qword_4400C8);
      }
      if ( word_4400BA == (_WORD)v14 )
        word_4400BA = v15;
      if ( dword_4400C0 == 0xFFFF && !dword_4400C4 )
      {
        dword_4400C0 = v5;
        dword_4400C4 = v9;
      }
      if ( (_DWORD)qword_4400C8 == 0xFFFF && !v7 )
        qword_4400C8 = v10;
      if ( qword_4400D0 == 0xFFFFFFFFi64 )
        qword_4400D0 = v11;
      if ( dword_4400D8 == -1 && !dword_4400DC )
      {
        dword_4400D8 = Buf2;
        dword_4400DC = v12;
      }
      qword_42FFC0 = v2;
      byte_44119C = 1;
    }
  }
  return 0;
}
// 42FFC0: using guessed type __int64 qword_42FFC0;
// 440040: using guessed type __int64 qword_440040;
// 4400B8: using guessed type __int16 word_4400B8;
// 4400BA: using guessed type __int16 word_4400BA;
// 4400C0: using guessed type int dword_4400C0;
// 4400C4: using guessed type int dword_4400C4;
// 4400C8: using guessed type __int64 qword_4400C8;
// 4400D0: using guessed type __int64 qword_4400D0;
// 4400D8: using guessed type int dword_4400D8;
// 4400DC: using guessed type int dword_4400DC;
// 44119C: using guessed type char byte_44119C;
// 4090EA: using guessed type char var_3C[16];
// 4090EA: using guessed type unsigned __int8 var_2C[4];
// 4090EA: using guessed type unsigned __int8 var_28[4];
// 4090EA: using guessed type unsigned __int8 var_24[8];
// 4090EA: using guessed type unsigned __int8 var_1C[8];
// 4090EA: using guessed type unsigned __int8 var_14[8];
// 4090EA: using guessed type unsigned __int8 var_C[12];

//----- (0040936D) --------------------------------------------------------
int __stdcall sub_40936D(__int64 a1)
{
  int v1; // ebp
  int v2; // eax
  __int64 v3; // kr00_8
  char *v4; // edi
  char *i; // esi
  int v6; // eax
  int v7; // ebx
  const char *v8; // edi
  char *j; // esi
  __int64 v10; // rax
  int v11; // ebx
  int v12; // edx
  int v13; // eax
  const char *v14; // edi
  char *k; // esi
  int result; // eax
  __int64 v18; // [esp+10h] [ebp-24h]
  int v19; // [esp+18h] [ebp-1Ch]
  char v20[4]; // [esp+1Ch] [ebp-18h] BYREF
  unsigned __int16 v21; // [esp+20h] [ebp-14h] BYREF
  unsigned __int16 v22; // [esp+22h] [ebp-12h] BYREF
  unsigned __int16 v23; // [esp+24h] [ebp-10h] BYREF
  unsigned __int16 v24; // [esp+26h] [ebp-Eh] BYREF
  unsigned __int8 v25[4]; // [esp+28h] [ebp-Ch] BYREF
  unsigned __int8 v26[4]; // [esp+2Ch] [ebp-8h] BYREF
  unsigned __int16 v27; // [esp+30h] [ebp-4h] BYREF

  v1 = 0;
  if ( qword_440028 <= 0x2000 )
  {
    (*(void (__thiscall **)(int, _DWORD, _DWORD, _DWORD))(*(_DWORD *)dword_440020 + 12))(dword_440020, 0, 0, 0);
    v2 = sub_407917((int)dword_440000, qword_440028);
    v3 = v2;
    qword_440008 = v2;
    if ( v2 == (__int64)(int)qword_440028 )
    {
      v4 = dword_440000;
      for ( i = &dword_440000[qword_440028 - 22]; ; --i )
      {
        Src = i;
        if ( i < v4 )
          break;
        if ( sub_406DA4(i) )
        {
          qword_440008 = v3 - (i - v4);
          goto LABEL_33;
        }
      }
    }
    return 2;
  }
  v19 = qword_440028 % 0x2000;
  if ( v19 <= 18 )
  {
    v18 = v19;
    qword_440040 = qword_440028 - v19;
  }
  else
  {
    v18 = v19;
    (*(void (__thiscall **)(int, _DWORD, _DWORD, _DWORD))(*(_DWORD *)dword_440020 + 12))(
      dword_440020,
      qword_440028 - v19,
      (unsigned __int64)(qword_440028 - v19) >> 32,
      0);
    qword_440040 = ((__int64 (__thiscall *)(int))*(_DWORD *)(*(_DWORD *)dword_440020 + 16))(dword_440020);
    v6 = sub_407917((int)dword_440000, v19);
    v7 = v6 >> 31;
    qword_440008 = v6;
    if ( v6 != (__int64)v19 )
      return 2;
    v8 = dword_440000;
    for ( j = &dword_440000[v19 - 22]; ; --j )
    {
      Src = j;
      if ( j < v8 )
        break;
      if ( sub_406DA4(j) )
      {
        qword_440008 = __PAIR64__(v7, qword_440008) - (j - v8);
        v1 = 1;
        break;
      }
    }
    strncpy(dword_440054, v8, 3u);
  }
  v10 = (a1 - v18 + 0x1FFF) / 0x2000;
  v11 = 1;
  if ( !v1 )
  {
    do
    {
      if ( v11 > (int)v10 )
        break;
      v12 = ((unsigned __int64)(qword_440040 + 4294959104i64) >> 32) - 1;
      LODWORD(qword_440040) = qword_440040 - 0x2000;
      HIDWORD(qword_440040) = v12;
      (*(void (__thiscall **)(int, _DWORD, int, _DWORD))(*(_DWORD *)dword_440020 + 12))(
        dword_440020,
        qword_440040,
        v12,
        0);
      v13 = sub_407917((int)dword_440000, 0x2000);
      qword_440008 = v13;
      if ( v13 != 0x2000 )
        break;
      v14 = dword_440000;
      for ( k = dword_440000 + 0x1FFF; ; --k )
      {
        Src = k;
        if ( k < v14 )
          break;
        if ( sub_406DA4(k) )
        {
          qword_440008 = 0x2000i64 - (k - v14);
          v1 = 1;
          break;
        }
      }
      strncpy(dword_440054, v14, 3u);
      LODWORD(v10) = (a1 - v18 + 0x1FFF) / 0x2000;
      ++v11;
    }
    while ( !v1 );
    if ( !v1 )
      return 2;
  }
  i = (char *)Src;
  v4 = dword_440000;
LABEL_33:
  qword_42FFC0 = qword_440040 + i - v4;
  if ( !sub_407568(v20, 0x16u) )
    return 51;
  word_4400B8 = sub_407425(&v21);
  word_4400BA = sub_407425(&v22);
  qword_4400C0 = (unsigned __int16)sub_407425(&v23);
  qword_4400C8 = (unsigned __int16)sub_407425(&v24);
  qword_4400D0 = (unsigned int)sub_407400(v25);
  qword_4400D8 = (unsigned int)sub_407400(v26);
  word_4400E0 = sub_407425(&v27);
  result = sub_4090EA(a1 + 76);
  if ( !result )
  {
    result = 0;
    qword_42FFC8 = qword_4400D0 + qword_4400D8;
  }
  return result;
}
// 42FFC0: using guessed type __int64 qword_42FFC0;
// 42FFC8: using guessed type __int64 qword_42FFC8;
// 440008: using guessed type __int64 qword_440008;
// 440020: using guessed type int dword_440020;
// 440028: using guessed type __int64 qword_440028;
// 440040: using guessed type __int64 qword_440040;
// 4400B8: using guessed type __int16 word_4400B8;
// 4400BA: using guessed type __int16 word_4400BA;
// 4400C0: using guessed type __int64 qword_4400C0;
// 4400C8: using guessed type __int64 qword_4400C8;
// 4400D0: using guessed type __int64 qword_4400D0;
// 4400D8: using guessed type __int64 qword_4400D8;
// 4400E0: using guessed type __int16 word_4400E0;
// 40936D: using guessed type char var_18[4];
// 40936D: using guessed type unsigned __int8 var_C[4];
// 40936D: using guessed type unsigned __int8 var_8[4];

//----- (00409723) --------------------------------------------------------
void sub_409723()
{
  sub_408D79();
  if ( lpMultiByteStr )
  {
    j___free_base(lpMultiByteStr);
    lpMultiByteStr = 0;
  }
  if ( dword_4400FC )
    j___free_base(dword_4400FC);
  if ( dword_440000 )
    j___free_base(dword_440000);
  dword_4400FC = 0;
  dword_440000 = 0;
}

//----- (0040976E) --------------------------------------------------------
int __stdcall sub_40976E(int a1, unsigned int a2, char a3)
{
  unsigned int v3; // edi
  int v4; // esi
  int v6; // ebp
  int v7; // ebp
  unsigned int v9; // [esp+14h] [ebp+Ch]

  v3 = a2;
  if ( a2 )
  {
    v4 = a1;
    if ( a1 )
    {
      if ( a2 >= 4 )
      {
        do
        {
          v6 = (unsigned __int16)sub_407425((unsigned __int16 *)v4);
          v9 = (unsigned __int16)sub_407425((unsigned __int16 *)(v4 + 2));
          if ( v9 > v3 - 4 )
            return 0;
          if ( v6 != 1 )
            goto LABEL_21;
          byte_44119C = 1;
          v7 = 4;
          if ( a3 )
          {
            if ( qword_440070 != 0xFFFFFFFFi64 )
              goto LABEL_11;
          }
          else if ( qword_440098 != 0xFFFFFFFFi64 )
          {
            goto LABEL_12;
          }
          qword_440098 = sub_40737D((unsigned __int8 *)(v4 + 4));
          qword_440070 = qword_440098;
          *(_QWORD *)&qword_42FFD8 = qword_440098;
          v7 = 12;
LABEL_11:
          if ( a3 )
          {
            if ( qword_440068 != 0xFFFFFFFFi64 )
              goto LABEL_16;
            goto LABEL_15;
          }
LABEL_12:
          if ( qword_440090 != 0xFFFFFFFFi64 )
            goto LABEL_17;
LABEL_15:
          qword_440090 = sub_40737D((unsigned __int8 *)(v4 + v7));
          v7 += 8;
          qword_440068 = qword_440090;
          qword_42FFD0 = qword_440090;
LABEL_16:
          if ( !a3 )
          {
LABEL_17:
            if ( qword_4400B0 == 0xFFFFFFFFi64 )
            {
              qword_4400B0 = sub_40737D((unsigned __int8 *)(v4 + v7));
              v7 += 8;
            }
            if ( word_4400A6 == -1 )
              word_4400A6 = sub_407400((unsigned __int8 *)(v4 + v7));
          }
LABEL_21:
          v4 += v9 + 4;
          v3 += -4 - v9;
        }
        while ( v3 >= 4 );
      }
    }
  }
  return 0;
}
// 40983F: conditional instruction was optimized away because bl.1==0
// 4098AF: conditional instruction was optimized away because bl.1==0
// 42FFD0: using guessed type __int64 qword_42FFD0;
// 440068: using guessed type __int64 qword_440068;
// 440070: using guessed type __int64 qword_440070;
// 440090: using guessed type __int64 qword_440090;
// 440098: using guessed type __int64 qword_440098;
// 4400A6: using guessed type __int16 word_4400A6;
// 4400B0: using guessed type __int64 qword_4400B0;
// 44119C: using guessed type char byte_44119C;

//----- (004098F0) --------------------------------------------------------
int __usercall sub_4098F0@<eax>(int a1@<esi>)
{
  char v1; // al
  __int64 v3; // rax
  int v4; // ecx
  int v5; // esi
  int v6; // edi
  int v7; // [esp-4h] [ebp-105Ch]
  wchar_t Destination[2054]; // [esp+10h] [ebp-1048h] BYREF
  char v9; // [esp+101Ch] [ebp-3Ch]

  sub_40241E(Destination);
  v1 = sub_4028CC(&word_4525F2, Destination, 0);
  if ( !v1 || v9 )
    return v1 != 0 ? 76 : 9;
  if ( sub_407438(a1) )
    return 9;
  v3 = sub_401E8E((int *)dword_440020);
  qword_440040 = 0i64;
  v4 = v3;
  Src = dword_440000;
  qword_440028 = v3;
  qword_440030 = v3;
  if ( v3 >= 66000 )
  {
    v4 = 66000;
    HIDWORD(v3) = 0;
  }
  if ( sub_40936D(__SPAIR64__(HIDWORD(v3), v4)) || (v5 = sub_40A0A6(), v5 > 1) )
  {
    if ( dword_440020 )
      (**(void (__thiscall ***)(int, int))dword_440020)(dword_440020, 1);
    v7 = 2;
    goto LABEL_42;
  }
  if ( dword_42FFB0 > 0 )
  {
    if ( dword_440020 )
      (**(void (__thiscall ***)(int, int))dword_440020)(dword_440020, 1);
    goto LABEL_43;
  }
  byte_441194 = word_4400B8 != 0;
  dword_441198 = -1;
  qword_440048 = qword_42FFC0 - qword_42FFC8;
  if ( (int)((unsigned __int64)(qword_42FFC0 - qword_42FFC8) >> 32) > 0 )
  {
LABEL_15:
    if ( qword_4400D8 || !qword_4400D0 )
      goto LABEL_19;
    qword_440048 = 0i64;
    qword_4400D8 = qword_42FFC0 - qword_42FFC8;
    goto LABEL_18;
  }
  if ( (((unsigned __int64)(qword_42FFC0 - qword_42FFC8) >> 32) & 0x80000000) == 0i64 )
  {
    if ( qword_42FFC0 - qword_42FFC8 <= 0 )
      goto LABEL_19;
    goto LABEL_15;
  }
LABEL_18:
  v5 = 2;
LABEL_19:
  if ( !qword_42FFC8 && !qword_4400D0 )
  {
    if ( v5 <= 0 )
      return 0;
    return v5;
  }
  v6 = sub_407786(qword_4400D8);
  if ( v6 == 3 )
  {
    if ( dword_440020 )
      (**(void (__thiscall ***)(int, int))dword_440020)(dword_440020, 1);
    v7 = 3;
LABEL_42:
    v5 = v7;
LABEL_43:
    dword_440020 = 0;
    return v5;
  }
  if ( sub_407568(byte_42FFEC, 4u) && sub_406D5A(byte_42FFEC)
    || (qword_440048 = 0i64, (v6 = sub_407786(qword_4400D8)) == 0)
    && sub_407568(byte_42FFEC, 4u)
    && sub_406D5A(byte_42FFEC) )
  {
    if ( v6 <= v5 )
      return v5;
  }
  else
  {
    if ( dword_440020 )
      (**(void (__thiscall ***)(int, int))dword_440020)(dword_440020, 1);
    dword_440020 = 0;
    if ( !v6 )
      return 3;
  }
  return v6;
}
// 42FFB0: using guessed type int dword_42FFB0;
// 42FFC0: using guessed type __int64 qword_42FFC0;
// 42FFC8: using guessed type __int64 qword_42FFC8;
// 440020: using guessed type int dword_440020;
// 440028: using guessed type __int64 qword_440028;
// 440030: using guessed type __int64 qword_440030;
// 440040: using guessed type __int64 qword_440040;
// 440048: using guessed type __int64 qword_440048;
// 4400B8: using guessed type __int16 word_4400B8;
// 4400D0: using guessed type __int64 qword_4400D0;
// 4400D8: using guessed type __int64 qword_4400D8;
// 441194: using guessed type char byte_441194;
// 441198: using guessed type int dword_441198;

//----- (00409B5E) --------------------------------------------------------
int sub_409B5E()
{
  int v1; // ecx
  char v2[4]; // [esp+0h] [ebp-2Ch] BYREF
  unsigned __int16 v3; // [esp+4h] [ebp-28h] BYREF
  unsigned __int16 v4; // [esp+6h] [ebp-26h] BYREF
  unsigned __int16 v5; // [esp+8h] [ebp-24h] BYREF
  unsigned __int16 v6; // [esp+Ah] [ebp-22h] BYREF
  unsigned __int8 v7[4]; // [esp+Ch] [ebp-20h] BYREF
  unsigned __int8 v8[4]; // [esp+10h] [ebp-1Ch] BYREF
  unsigned __int8 v9[4]; // [esp+14h] [ebp-18h] BYREF
  unsigned __int16 v10; // [esp+18h] [ebp-14h] BYREF
  unsigned __int16 v11; // [esp+1Ah] [ebp-12h] BYREF
  unsigned __int16 v12; // [esp+1Ch] [ebp-10h] BYREF
  unsigned __int16 v13; // [esp+1Eh] [ebp-Eh] BYREF
  unsigned __int16 v14; // [esp+20h] [ebp-Ch] BYREF
  unsigned __int8 v15[4]; // [esp+22h] [ebp-Ah] BYREF
  unsigned __int8 v16[6]; // [esp+26h] [ebp-6h] BYREF

  if ( !sub_407568(v2, 0x2Au) )
    return 51;
  byte_440080 = v2[0];
  byte_440081 = v2[1];
  byte_440082 = v2[2];
  byte_440083 = v2[3];
  LOWORD(dword_440084) = sub_407425(&v3);
  HIWORD(dword_440084) = sub_407425(&v4);
  word_440088 = sub_407425(&v5);
  word_44008A = sub_407425(&v6);
  dword_44008C = sub_407400(v7);
  qword_440090 = (unsigned int)sub_407400(v8);
  qword_440098 = (unsigned int)sub_407400(v9);
  word_4400A0 = sub_407425(&v10);
  word_4400A2 = sub_407425(&v11);
  word_4400A4 = sub_407425(&v12);
  word_4400A6 = sub_407425(&v13);
  word_4400A8 = sub_407425(&v14);
  dword_4400AC = sub_407400(v15);
  qword_4400B0 = (unsigned int)sub_407400(v16);
  if ( qword_440090 == 0xFFFFFFFFi64 || qword_440098 == 0xFFFFFFFFi64 )
    byte_44119C = 1;
  if ( (unsigned __int8)byte_440081 >= 0x12u )
    v1 = 18;
  else
    v1 = (unsigned __int8)byte_440081;
  *(_DWORD *)(dword_42FFF4 + 28) = v1;
  *(_DWORD *)(dword_42FFF4 + 32) = (unsigned __int16)word_4400A6;
  return 0;
}
// 42FFF4: using guessed type int dword_42FFF4;
// 440080: using guessed type char byte_440080;
// 440081: using guessed type char byte_440081;
// 440082: using guessed type char byte_440082;
// 440083: using guessed type char byte_440083;
// 440084: using guessed type int dword_440084;
// 440088: using guessed type __int16 word_440088;
// 44008A: using guessed type __int16 word_44008A;
// 44008C: using guessed type int dword_44008C;
// 440090: using guessed type __int64 qword_440090;
// 440098: using guessed type __int64 qword_440098;
// 4400A0: using guessed type __int16 word_4400A0;
// 4400A2: using guessed type __int16 word_4400A2;
// 4400A4: using guessed type __int16 word_4400A4;
// 4400A6: using guessed type __int16 word_4400A6;
// 4400A8: using guessed type __int16 word_4400A8;
// 4400AC: using guessed type int dword_4400AC;
// 4400B0: using guessed type __int64 qword_4400B0;
// 44119C: using guessed type char byte_44119C;
// 409B5E: using guessed type unsigned __int8 var_20[4];
// 409B5E: using guessed type unsigned __int8 var_1C[4];
// 409B5E: using guessed type unsigned __int8 var_18[4];
// 409B5E: using guessed type unsigned __int8 var_A[4];
// 409B5E: using guessed type unsigned __int8 var_6[6];

//----- (00409CD5) --------------------------------------------------------
int sub_409CD5()
{
  char v1[2]; // [esp+0h] [ebp-1Ch] BYREF
  unsigned __int16 v2; // [esp+2h] [ebp-1Ah] BYREF
  unsigned __int16 v3; // [esp+4h] [ebp-18h] BYREF
  unsigned __int16 v4; // [esp+6h] [ebp-16h] BYREF
  unsigned __int16 v5; // [esp+8h] [ebp-14h] BYREF
  unsigned __int8 v6[4]; // [esp+Ah] [ebp-12h] BYREF
  unsigned __int8 v7[4]; // [esp+Eh] [ebp-Eh] BYREF
  unsigned __int8 v8[4]; // [esp+12h] [ebp-Ah] BYREF
  unsigned __int16 v9; // [esp+16h] [ebp-6h] BYREF
  unsigned __int16 v10; // [esp+18h] [ebp-4h] BYREF

  if ( !sub_407568(v1, 0x1Au) )
    return 51;
  byte_440058 = v1[0];
  byte_440059 = v1[1];
  word_44005A = sub_407425(&v2);
  word_44005C = sub_407425(&v3);
  word_44005E = sub_407425(&v4);
  word_440060 = sub_407425(&v5);
  dword_440064 = sub_407400(v6);
  qword_440068 = (unsigned int)sub_407400(v7);
  qword_440070 = (unsigned int)sub_407400(v8);
  word_440078 = sub_407425(&v9);
  word_44007A = sub_407425(&v10);
  qword_42FFD0 = qword_440068;
  *(_QWORD *)&qword_42FFD8 = qword_440070;
  if ( (word_44005A & 8) != 0 )
  {
    dword_440064 = *(_DWORD *)(dword_42FFF4 + 24);
    qword_440068 = *(_QWORD *)(dword_42FFF4 + 8);
    qword_42FFD0 = qword_440068;
    qword_440070 = *(_QWORD *)(dword_42FFF4 + 16);
    *(_QWORD *)&qword_42FFD8 = qword_440070;
  }
  return 0;
}
// 42FFD0: using guessed type __int64 qword_42FFD0;
// 42FFF4: using guessed type int dword_42FFF4;
// 440058: using guessed type char byte_440058;
// 440059: using guessed type char byte_440059;
// 44005A: using guessed type __int16 word_44005A;
// 44005C: using guessed type __int16 word_44005C;
// 44005E: using guessed type __int16 word_44005E;
// 440060: using guessed type __int16 word_440060;
// 440064: using guessed type int dword_440064;
// 440068: using guessed type __int64 qword_440068;
// 440070: using guessed type __int64 qword_440070;
// 440078: using guessed type __int16 word_440078;
// 44007A: using guessed type __int16 word_44007A;
// 409CD5: using guessed type unsigned __int8 var_12[4];
// 409CD5: using guessed type unsigned __int8 var_E[4];
// 409CD5: using guessed type unsigned __int8 var_A[4];

//----- (00409E11) --------------------------------------------------------
int sub_409E11()
{
  int v0; // esi
  int result; // eax
  int v2; // eax

  v0 = 0;
  result = sub_408F82();
  if ( !result )
  {
    v2 = sub_408FD2();
    if ( v2 != 76 && v2 > 0 )
      v0 = v2;
    sub_409723();
    return v0;
  }
  return result;
}

//----- (00409E36) --------------------------------------------------------
int __stdcall sub_409E36(__int64 a1, void *Buf2, int a3)
{
  int v3; // esi
  unsigned int v4; // ecx
  unsigned int v5; // ebp
  char *v6; // ecx
  char *i; // eax
  int v8; // eax
  bool v9; // zf
  int v10; // edi
  unsigned int v11; // ebx
  __int64 v12; // rax
  int v13; // ebp
  int v14; // eax
  char *v15; // ecx
  char *j; // eax
  int v17; // eax
  unsigned int v19; // [esp+10h] [ebp-4h]
  int v20; // [esp+24h] [ebp+10h]

  v3 = 0;
  v4 = (unsigned __int64)(qword_440028 % 0x2000) >> 32;
  v5 = qword_440028 % 0x2000;
  v19 = v4;
  if ( qword_440028 % 0x2000 <= a3 )
  {
    qword_440040 = qword_440028 - __PAIR64__(v4, v5);
    v10 = (qword_440028 - __PAIR64__(v4, v5)) >> 32;
    v11 = qword_440028 - v5;
  }
  else
  {
    (*(void (__thiscall **)(int, _DWORD, _DWORD, _DWORD))(*(_DWORD *)dword_440020 + 12))(
      dword_440020,
      qword_440028 - v5,
      (qword_440028 - __PAIR64__(v4, v5)) >> 32,
      0);
    qword_440040 = ((__int64 (__thiscall *)(int))*(_DWORD *)(*(_DWORD *)dword_440020 + 16))(dword_440020);
    qword_440008 = (*(int (__thiscall **)(int, char *, unsigned int))(*(_DWORD *)dword_440020 + 8))(
                     dword_440020,
                     dword_440000,
                     v5);
    if ( qword_440008 != v5 )
      goto LABEL_27;
    v6 = dword_440000;
    for ( i = &dword_440000[v5 - 4 - a3]; ; --i )
    {
      Src = i;
      if ( i < v6 )
        break;
      if ( *i == 80 )
      {
        v8 = memcmp(i, Buf2, 4u);
        v6 = dword_440000;
        v9 = v8 == 0;
        i = (char *)Src;
        if ( v9 )
        {
          qword_440008 -= (_BYTE *)Src - dword_440000;
          v3 = 1;
          break;
        }
      }
    }
    memmove(dword_440054, v6, 3u);
    v10 = HIDWORD(qword_440040);
    v11 = qword_440040;
  }
  v12 = (__int64)(a1 - __PAIR64__(v19, v5) + 0x1FFF) / 0x2000;
  v20 = v12;
  v13 = 1;
  if ( !v3 )
  {
    while ( v13 <= (int)v12 && v10 >= 0 && (v10 > 0 || v11 >= 0x2000) )
    {
      LODWORD(qword_440040) = v11 - 0x2000;
      HIDWORD(qword_440040) = __CFADD__(v11, -8192) + v10 - 1;
      (*(void (__thiscall **)(int, unsigned int, _DWORD, _DWORD))(*(_DWORD *)dword_440020 + 12))(
        dword_440020,
        v11 - 0x2000,
        HIDWORD(qword_440040),
        0);
      v14 = (*(int (__thiscall **)(int, char *, int))(*(_DWORD *)dword_440020 + 8))(dword_440020, dword_440000, 0x2000);
      qword_440008 = v14;
      if ( v14 != 0x2000 )
        break;
      v15 = dword_440000;
      for ( j = dword_440000 + 0x1FFF; ; --j )
      {
        Src = j;
        if ( j < v15 )
          break;
        if ( *j == 80 )
        {
          v17 = memcmp(j, Buf2, 4u);
          v15 = dword_440000;
          v9 = v17 == 0;
          j = (char *)Src;
          if ( v9 )
          {
            qword_440008 -= (_BYTE *)Src - dword_440000;
            v3 = 1;
            break;
          }
        }
      }
      memmove(dword_440054, v15, 3u);
      ++v13;
      if ( v3 )
        break;
      v10 = HIDWORD(qword_440040);
      v11 = qword_440040;
      LODWORD(v12) = v20;
    }
  }
LABEL_27:
  if ( Src < dword_440000 )
  {
    qword_440040 = -1i64;
    Src = dword_440000;
  }
  return v3 != 0 ? 0 : 2;
}
// 440008: using guessed type __int64 qword_440008;
// 440020: using guessed type int dword_440020;
// 440028: using guessed type __int64 qword_440028;
// 440040: using guessed type __int64 qword_440040;

//----- (0040A0A6) --------------------------------------------------------
int sub_40A0A6()
{
  int v0; // esi

  v0 = 0;
  if ( word_4400E0 && dword_42FFB0 >= 0 && sub_40719B((unsigned __int16)word_4400E0, 0, 0, 0) )
  {
    sub_40188E(57, (int)&word_4525F2);
    return 1;
  }
  return v0;
}
// 42FFB0: using guessed type int dword_42FFB0;
// 4400E0: using guessed type __int16 word_4400E0;

//----- (0040A0E3) --------------------------------------------------------
int sub_40A0E3()
{
  int v0; // edx
  int v1; // ecx
  char *v2; // esi
  bool v3; // cf
  char v4; // al
  char *v5; // eax
  CHAR *v7; // eax
  int v8; // eax
  int v10; // [esp+10h] [ebp-110h] BYREF
  char Src[12]; // [esp+14h] [ebp-10Ch] BYREF
  WCHAR WideCharStr[128]; // [esp+20h] [ebp-100h] BYREF

  if ( !byte_44119D )
  {
    *(_DWORD *)(dword_42FFF4 + 64) &= ~1u;
    sub_40710E();
    v0 = qword_440008;
    v1 = 0;
    v2 = (char *)::Src;
    v10 = 0;
    do
    {
      v3 = v0-- != 0;
      LODWORD(qword_440008) = v0;
      HIDWORD(qword_440008) = v3 + HIDWORD(qword_440008) - 1;
      if ( qword_440008 < 0 )
      {
        v4 = sub_407650();
        v1 = v10;
        v0 = qword_440008;
        v2 = (char *)::Src;
      }
      else
      {
        v4 = *v2++;
        ::Src = v2;
      }
      Src[v1++] = v4;
      v10 = v1;
    }
    while ( v1 < 12 );
    sub_407885();
    *(_DWORD *)(dword_42FFF4 + 64) |= 1u;
  }
  v5 = lpMultiByteStr;
  if ( dword_42FFBC )
  {
    dword_42FFBC = 0;
    if ( byte_44E444 )
    {
      if ( lpMultiByteStr )
        goto LABEL_18;
      lpMultiByteStr = (LPSTR)malloc(0x81u);
      if ( !lpMultiByteStr )
        return 5;
      sub_40416A(byte_44E344, WideCharStr, 128);
      sub_40557F(WideCharStr, lpMultiByteStr, 128);
      sub_40431E(WideCharStr, 256);
      v5 = lpMultiByteStr;
      dword_441128 = 1;
    }
    else
    {
      if ( !lpMultiByteStr )
        goto LABEL_23;
      j___free_base(lpMultiByteStr);
      v5 = 0;
      lpMultiByteStr = 0;
    }
  }
  if ( !v5 )
  {
LABEL_23:
    v7 = (CHAR *)malloc(0x81u);
    lpMultiByteStr = v7;
    if ( !v7 )
      return 5;
    goto LABEL_24;
  }
LABEL_18:
  if ( byte_44119D || !sub_40A33B(Src, v5) )
    return 0;
  if ( dword_441128 )
    return 1;
  v7 = lpMultiByteStr;
LABEL_24:
  v10 = 0;
  v8 = sub_406F37((int)&dword_42FFB0, &v10, v7, 129);
  if ( v8 == 5 )
  {
    j___free_base(lpMultiByteStr);
    lpMultiByteStr = 0;
    return 5;
  }
  if ( v8 == -2 )
    return 9;
  if ( v8 )
  {
    *lpMultiByteStr = 0;
    v10 = 0;
  }
  return !byte_44119D && sub_40A33B(Src, lpMultiByteStr);
}
// 42FFB0: using guessed type int dword_42FFB0;
// 42FFBC: using guessed type int dword_42FFBC;
// 42FFF4: using guessed type int dword_42FFF4;
// 440008: using guessed type __int64 qword_440008;
// 441128: using guessed type int dword_441128;
// 44119D: using guessed type char byte_44119D;
// 44E444: using guessed type char byte_44E444;
// 40A0E3: using guessed type char Src[12];

//----- (0040A2C7) --------------------------------------------------------
int sub_40A2C7()
{
  return sub_40A0E3();
}
// 44119D: using guessed type char byte_44119D;

//----- (0040A2DA) --------------------------------------------------------
int sub_40A2DA()
{
  return (unsigned __int16)((dword_441134 & 0xFFFD | 2) * ((dword_441134 & 0xFFFD | 2) ^ 1)) >> 8;
}
// 441134: using guessed type int dword_441134;

//----- (0040A2F8) --------------------------------------------------------
char __stdcall sub_40A2F8(char *a1)
{
  char result; // al

  sub_401859((int)dword_42FBB0);
  dword_44112C = 305419896;
  dword_441130 = 591751049;
  dword_441134 = 878082192;
  while ( 1 )
  {
    result = *a1;
    if ( !*a1 )
      break;
    sub_40A3EC(result);
    ++a1;
  }
  return result;
}
// 42FBB0: using guessed type int dword_42FBB0[256];
// 44112C: using guessed type int dword_44112C;
// 441130: using guessed type int dword_441130;
// 441134: using guessed type int dword_441134;

//----- (0040A33B) --------------------------------------------------------
int __stdcall sub_40A33B(void *Src, char *a2)
{
  int i; // esi
  unsigned __int8 v3; // al
  int v4; // ecx
  int v6; // esi
  _BYTE *j; // edi
  char v8[12]; // [esp+4h] [ebp-Ch] BYREF

  sub_40A2F8(a2);
  memmove(v8, Src, 0xCu);
  for ( i = 0; i < 12; ++i )
  {
    v3 = v8[i] ^ sub_40A2DA();
    v8[i] = v3;
    sub_40A3EC(v3);
  }
  v4 = HIBYTE(word_44005E);
  if ( (*(_BYTE *)(dword_42FFF4 + 64) & 2) == 0 )
    v4 = HIBYTE(dword_440064);
  if ( (unsigned __int8)v8[11] != v4 )
    return -1;
  if ( (int)qword_440008 >> 31 < SHIDWORD(qword_42FFD0)
    || (v6 = qword_42FFD0, (int)qword_440008 >> 31 <= SHIDWORD(qword_42FFD0))
    && (unsigned int)qword_440008 <= (unsigned int)qword_42FFD0 )
  {
    v6 = qword_440008;
  }
  for ( j = ::Src; v6; --v6 )
  {
    *j ^= sub_40A2DA();
    sub_40A3EC((unsigned __int8)*j++);
  }
  return 0;
}
// 42FFD0: using guessed type __int64 qword_42FFD0;
// 42FFF4: using guessed type int dword_42FFF4;
// 440008: using guessed type __int64 qword_440008;
// 44005E: using guessed type __int16 word_44005E;
// 440064: using guessed type int dword_440064;

//----- (0040A3EC) --------------------------------------------------------
int __stdcall sub_40A3EC(int a1)
{
  int result; // eax

  dword_44112C = dword_42FBB0[(unsigned __int8)(a1 ^ dword_44112C)] ^ ((unsigned int)dword_44112C >> 8);
  result = a1;
  dword_441130 = 134775813 * (dword_441130 + (unsigned __int8)dword_44112C) + 1;
  dword_441134 = dword_42FBB0[(unsigned __int8)(dword_441134 ^ HIBYTE(dword_441130))] ^ ((unsigned int)dword_441134 >> 8);
  return result;
}
// 42FBB0: using guessed type int dword_42FBB0[256];
// 44112C: using guessed type int dword_44112C;
// 441130: using guessed type int dword_441130;
// 441134: using guessed type int dword_441134;

//----- (0040A446) --------------------------------------------------------
int sub_40A446()
{
  int v0; // esi
  int v1; // eax
  _DWORD v3[8]; // [esp+0h] [ebp-20h] BYREF

  v3[7] = 0;
  v3[4] = v3;
  memset(&dword_42FFB0, 0, 0x111F8u);
  v0 = sub_409E11();
  if ( Block )
  {
    j___free_base(Block);
    Block = 0;
  }
  if ( sub_40535F() )
  {
    v1 = 255;
LABEL_6:
    sub_401A82(dword_44A2FC, v1);
    return v0;
  }
  v1 = sub_40A539(v0);
  if ( v1 )
    goto LABEL_6;
  return v0;
}
// 42FFB0: using guessed type int dword_42FFB0;
// 4400F8: using guessed type int dword_4400F8;
// 44A2FC: using guessed type int dword_44A2FC[4];

//----- (0040A539) --------------------------------------------------------
int __stdcall sub_40A539(unsigned int a1)
{
  if ( a1 <= 0xB )
    return dword_42B008[a1];
  switch ( a1 )
  {
    case '2':
      return 5;
    case '3':
      return 1;
    case '4':
      return 9;
  }
  if ( a1 != 80 )
    return 1;
  return 255;
}
// 42B008: using guessed type int dword_42B008[12];

//----- (0040A581) --------------------------------------------------------
char __stdcall sub_40A581(unsigned __int8 *a1, int a2)
{
  if ( a2 != 3 || sub_4044AE((char *)a1) )
    return 0;
  else
    return sub_405401(a1, 0, 0);
}

//----- (0040A5A9) --------------------------------------------------------
bool __stdcall sub_40A5A9(char a1, unsigned __int8 a2)
{
  return (unsigned int)a2 - 21 > 6 || a1 != 10 && a1 != 11 && a1 != 3;
}

//----- (0040A5D3) --------------------------------------------------------
bool __stdcall sub_40A5D3(wchar_t *String, int a2, int a3, int a4, _DWORD *a5)
{
  wchar_t *v5; // esi
  bool v6; // dl
  _DWORD *v7; // ecx

  v5 = sub_40368A(String);
  v6 = sub_4035F5(*v5);
  if ( v6 )
    *v5 = 0;
  if ( !a2 || a2 == 6 || a2 == 10 || a2 == 11 || a2 == 14 )
  {
    v7 = a5;
    if ( !v6 && (*a5 & 0x10) != 0 )
    {
      if ( a4 || a3 )
        *a5 &= ~0x10u;
      else
        v6 = 1;
    }
    *a5 = (unsigned __int8)*a5;
  }
  else
  {
    v7 = a5;
    *a5 = !v6 ? 32 : 16;
  }
  if ( v6 )
    *v7 |= 0x10u;
  return v6;
}

//----- (0040A65B) --------------------------------------------------------
_DWORD *__thiscall sub_40A65B(_DWORD *this)
{
  this[6] = 0;
  this[7] = 0;
  *this = &off_422CEC;
  this[1] = &off_422D10;
  this[2] = &off_422D4C;
  this[3] = &off_422D88;
  this[4] = &off_422DA4;
  this[5] = 1;
  memset(this + 8, 0, 0x10u);
  return this;
}
// 422CEC: using guessed type int (__stdcall *off_422CEC)(int, void *Buf1, int);
// 422D10: using guessed type int (__stdcall *off_422D10)(int, int, int);
// 422D4C: using guessed type int (__stdcall *off_422D4C)(int, int, int);
// 422D88: using guessed type void *off_422D88;
// 422DA4: using guessed type int (__stdcall *off_422DA4)(int, int, int);

//----- (0040A6A2) --------------------------------------------------------
_DWORD *__thiscall sub_40A6A2(_DWORD *this)
{
  *this = 0;
  this[1] = 0;
  this[2] = 0;
  this[3] = 0;
  this[4] = 0;
  this[5] = 0;
  this[6] = 0;
  *((_WORD *)this + 14) = 0;
  *((_BYTE *)this + 30) = 0;
  this[8] = 0;
  return this;
}

//----- (0040A6C5) --------------------------------------------------------
int __thiscall sub_40A6C5(_DWORD *this)
{
  int v2; // ecx
  int result; // eax

  v2 = this[7];
  *this = &off_422CEC;
  this[1] = &off_422D10;
  this[2] = &off_422D4C;
  this[3] = &off_422D88;
  this[4] = &off_422DA4;
  if ( v2 )
  {
    result = (*(int (__stdcall **)(int))(*(_DWORD *)v2 + 8))(v2);
    this[7] = 0;
  }
  return result;
}
// 422CEC: using guessed type int (__stdcall *off_422CEC)(int, void *Buf1, int);
// 422D10: using guessed type int (__stdcall *off_422D10)(int, int, int);
// 422D4C: using guessed type int (__stdcall *off_422D4C)(int, int, int);
// 422D88: using guessed type void *off_422D88;
// 422DA4: using guessed type int (__stdcall *off_422DA4)(int, int, int);

//----- (0040A722) --------------------------------------------------------
int __thiscall sub_40A722(_DWORD *this)
{
  int v2; // ecx
  int result; // eax
  _DWORD *v4; // ecx

  v2 = this[4];
  if ( v2 )
  {
    result = (*(int (__stdcall **)(int))(*(_DWORD *)v2 + 8))(v2);
    this[4] = 0;
  }
  v4 = (_DWORD *)this[3];
  if ( v4 )
  {
    sub_40B382(v4);
    result = (*(int (__stdcall **)(_DWORD))(*(_DWORD *)this[3] + 8))(this[3]);
    this[3] = 0;
  }
  return result;
}

//----- (0040A776) --------------------------------------------------------
int __stdcall sub_40A776(int a1)
{
  int result; // eax

  result = *(_DWORD *)(a1 + 20) + 1;
  *(_DWORD *)(a1 + 20) = result;
  return result;
}

//----- (0040A784) --------------------------------------------------------
int __stdcall sub_40A784(int a1)
{
  return sub_40A776(a1 - 4);
}

//----- (0040A78E) --------------------------------------------------------
int __stdcall sub_40A78E(int a1)
{
  return sub_40A776(a1 - 8);
}

//----- (0040A798) --------------------------------------------------------
int __stdcall sub_40A798(int a1)
{
  return sub_40A776(a1 - 16);
}

//----- (0040A7AC) --------------------------------------------------------
BOOL __thiscall sub_40A7AC(HWND *this)
{
  BOOL result; // eax

  if ( this[1] )
  {
    result = DestroyWindow(this[1]);
    this[1] = 0;
  }
  return result;
}

//----- (0040A7C4) --------------------------------------------------------
int __stdcall sub_40A7C4(int a1, int a2)
{
  return sub_40B115(a1 - 4, a2);
}

//----- (0040A7CE) --------------------------------------------------------
int __stdcall sub_40A7CE(int a1, int a2)
{
  return sub_40B115(a1 - 8, a2);
}

//----- (0040A7D8) --------------------------------------------------------
int __stdcall sub_40A7D8(int a1, int a2, _DWORD *a3)
{
  *a3 = 0;
  return 1;
}

//----- (0040A7E5) --------------------------------------------------------
int __stdcall sub_40A7E5(int a1, int a2)
{
  return -2147467262;
}

//----- (0040A7ED) --------------------------------------------------------
int __stdcall sub_40A7ED(int a1, _DWORD *a2)
{
  *a2 = 0;
  return 1;
}

//----- (0040A7FA) --------------------------------------------------------
int __stdcall sub_40A7FA(int a1, _DWORD *a2)
{
  a2[2] = 0;
  *a2 = 20;
  a2[1] = 0x40000000;
  return 0;
}

//----- (0040A814) --------------------------------------------------------
int __stdcall sub_40A814(int a1, int a2, int a3, int a4, int a5, _DWORD *a6)
{
  *a6 = -1;
  return -2147352570;
}

//----- (0040A823) --------------------------------------------------------
int __stdcall sub_40A823(int a1, int a2, int a3)
{
  return 1;
}

//----- (0040A829) --------------------------------------------------------
int __stdcall sub_40A829(int a1, int a2, int a3, int a4)
{
  return -2147467263;
}

//----- (0040A831) --------------------------------------------------------
int __stdcall sub_40A831(int a1, _DWORD *a2)
{
  if ( !IsWindow(*(HWND *)(a1 + 20)) )
    return 1;
  *a2 = *(_DWORD *)(a1 + 20);
  return 0;
}

//----- (0040A855) --------------------------------------------------------
int __stdcall sub_40A855(int a1, _DWORD *a2)
{
  return sub_40A831(a1 - 4, a2);
}

//----- (0040A85F) --------------------------------------------------------
int __stdcall sub_40A85F(int a1, _DWORD *a2, _DWORD *a3, RECT *lprcSrc, LPRECT lprcDst, _DWORD *a6)
{
  int v6; // eax
  LONG bottom; // eax
  struct tagRECT Rect; // [esp+Ch] [ebp-10h] BYREF

  v6 = a1 + 4;
  if ( a1 == 4 )
    v6 = 0;
  *a2 = v6;
  *a3 = 0;
  GetClientRect(*(HWND *)(a1 + 20), &Rect);
  lprcSrc->right = Rect.right;
  bottom = Rect.bottom;
  lprcSrc->left = 0;
  lprcSrc->top = 0;
  lprcSrc->bottom = bottom;
  CopyRect(lprcDst, lprcSrc);
  *a6 = 20;
  a6[1] = 0;
  a6[2] = *(_DWORD *)(a1 + 20);
  a6[3] = 0;
  a6[4] = 0;
  (*(void (__stdcall **)(_DWORD))(*(_DWORD *)*a2 + 4))(*a2);
  return 0;
}

//----- (0040A8D9) --------------------------------------------------------
int __stdcall sub_40A8D9(int a1, int a2, int a3, int a4, int a5, int a6, int a7, int a8, int a9)
{
  return -2147352573;
}

//----- (0040A8E1) --------------------------------------------------------
char __stdcall sub_40A8E1(_WORD *a1)
{
  int v2; // ecx

  while ( 1 )
  {
    if ( !*a1 )
      return 0;
    if ( *a1 == 60 && a1[1] == 47 )
      break;
LABEL_7:
    ++a1;
  }
  v2 = 2;
  while ( a1[v2] != 62 )
  {
    if ( (unsigned int)++v2 >= 0x14 )
      goto LABEL_7;
  }
  return 1;
}

//----- (0040A918) --------------------------------------------------------
BOOL __thiscall sub_40A918(int this, int a2, int a3)
{
  DWORD TickCount; // ebp
  int v5; // esi
  int v6; // ecx
  WCHAR *v7; // ebx
  int v9; // [esp+30h] [ebp-24h] BYREF
  int v10; // [esp+34h] [ebp-20h] BYREF
  struct tagMSG Msg; // [esp+38h] [ebp-1Ch] BYREF

  v9 = 0;
  v10 = 0;
  TickCount = GetTickCount();
  while ( ((*(int (__stdcall **)(int, int *))(*(_DWORD *)a2 + 72))(a2, &v9) < 0 || !v9)
       && GetTickCount() - TickCount <= 0x7D0 )
  {
    if ( PeekMessageW(&Msg, 0, 0, 0, 0) )
    {
      GetMessageW(&Msg, 0, 0, 0);
      TranslateMessage(&Msg);
      DispatchMessageW(&Msg);
    }
  }
  v5 = (*(int (__stdcall **)(int, int *))(*(_DWORD *)a2 + 72))(a2, &v9);
  if ( v5 < 0 )
    goto LABEL_24;
  v6 = v9;
  if ( v9 )
  {
    v5 = (**(int (__stdcall ***)(int, void *, int *))v9)(v9, &unk_4234FC, &v10);
    if ( v5 >= 0 )
    {
      v5 = (*(int (__stdcall **)(int))(*(_DWORD *)v10 + 32))(v10);
      if ( v5 >= 0 )
        v5 = (*(int (__stdcall **)(int, int))(*(_DWORD *)v10 + 20))(v10, a3);
      (*(void (__stdcall **)(int))(*(_DWORD *)v10 + 8))(v10);
    }
    (*(void (__stdcall **)(int))(*(_DWORD *)v9 + 8))(v9);
    v6 = v9;
  }
  if ( v5 < 0 || !v6 )
  {
LABEL_24:
    if ( *(_DWORD *)(this + 8) )
    {
      if ( !*(_DWORD *)(this + 24) )
      {
        if ( *(_DWORD *)(this + 20) )
        {
          v7 = sub_40AF4D(*(wchar_t **)(this + 20));
          if ( v7 )
          {
            SetWindowPos(*(HWND *)(this + 4), (HWND)1, 0, 0, 0, 0, 0x204u);
            ShowWindow(*(HWND *)(this + 8), 5);
            SetWindowTextW(*(HWND *)(this + 8), v7);
            j___free_base(v7);
          }
        }
      }
    }
  }
  return v5 >= 0;
}

//----- (0040AA67) --------------------------------------------------------
void __thiscall sub_40AA67(int *this, wchar_t *String)
{
  const wchar_t *v3; // edi
  size_t v4; // eax
  wchar_t *v5; // eax
  wchar_t *v6; // esi
  const WCHAR *i; // ebp
  int v8; // eax
  bool v9; // zf
  SIZE_T v10; // ebp
  _BYTE *v11; // edi
  LPSTREAM ppstm; // [esp+4h] [ebp-8h] BYREF
  int v13; // [esp+8h] [ebp-4h]
  char Stringa; // [esp+10h] [ebp+4h]

  if ( this[4] )
  {
    ppstm = 0;
    v3 = String;
    Stringa = sub_40A8E1(String);
    v4 = wcslen(v3);
    v5 = (wchar_t *)malloc(2 * v4 + 512);
    v6 = v5;
    if ( v5 )
    {
      wcscpy(v5, L"<html>");
      wcscat(v6, L"<head><meta http-equiv=\"content-type\" content=\"text/html; charset=");
      wcscat(v6, L"utf-8\"></head>");
      for ( i = v3; *i == 32; ++i )
        ;
      v8 = -sub_405666(i, L"<html>", 6u);
      LOBYTE(v8) = -(v8 != 0);
      v9 = (_BYTE)v8 == 0xFF;
      LOBYTE(v8) = v8 + 1;
      v13 = v8;
      if ( !v9 )
        v3 = i + 6;
      wcscat(v6, v3);
      if ( !(_BYTE)v13 )
        wcscat(v6, L"</html>");
      if ( !Stringa )
        v6 = sub_40AC70(v6);
      v10 = 6 * wcslen(v6) + 9;
      v11 = GlobalAlloc(0x40u, v10);
      if ( v11 )
      {
        if ( WideCharToMultiByte(0xFDE9u, 0, v6, -1, v11 + 3, v10 - 3, 0, 0) )
        {
          *(_WORD *)v11 = -17425;
          v11[2] = -65;
        }
        else
        {
          *v11 = 0;
        }
      }
      j___free_base(v6);
      if ( CreateStreamOnHGlobal(v11, 1, &ppstm) >= 0 )
      {
        sub_40A918((int)this, this[4], (int)ppstm);
        ppstm->lpVtbl->Release(ppstm);
      }
    }
  }
}

//----- (0040ABAF) --------------------------------------------------------
void __userpurge sub_40ABAF(int a1@<ecx>, int a2@<ebx>, int a3)
{
  _DWORD *v4; // eax
  _DWORD *v5; // eax
  int (__stdcall ***v6)(_DWORD, void *, int); // eax
  int (__stdcall ***v7)(_DWORD, void *, int); // ebx
  int v8; // esi
  int *v9; // ecx
  int v10; // edx
  int v11; // eax

  *(_DWORD *)(a1 + 4) = a3;
  v4 = operator new(0x30u);
  if ( v4 )
    v5 = sub_40A65B(v4);
  else
    v5 = 0;
  *(_DWORD *)(a1 + 12) = v5;
  if ( v5 )
  {
    v5[6] = a3;
    sub_40B2B5(*(LPVOID **)(a1 + 12), L"Shell.Explorer");
    sub_40B44E(*(_DWORD *)(a1 + 12), a2, a3, 1);
    sub_40B404(*(_DWORD **)(a1 + 12), 1);
    v6 = (int (__stdcall ***)(_DWORD, void *, int))sub_40B369(*(_DWORD **)(a1 + 12));
    v7 = v6;
    if ( v6
      && (v8 = (**v6)(v6, &unk_42350C, a1 + 16),
          ((void (__stdcall *)(int (__stdcall ***)(_DWORD, void *, int)))(*v7)[2])(v7),
          v8 < 0) )
    {
      *(_DWORD *)(a1 + 16) = 0;
    }
    else
    {
      v9 = *(int **)(a1 + 16);
      if ( v9 )
      {
        v10 = *(_DWORD *)(a1 + 24);
        *(_BYTE *)(a1 + 29) = 0;
        v11 = *v9;
        if ( v10 )
        {
          (*(void (__stdcall **)(int *, int, _DWORD, _DWORD, _DWORD, _DWORD))(v11 + 44))(v9, v10, 0, 0, 0, 0);
        }
        else
        {
          (*(void (__stdcall **)(int *, const wchar_t *, _DWORD, _DWORD, _DWORD, _DWORD))(v11 + 44))(
            v9,
            L"about:blank",
            0,
            0,
            0,
            0);
          sub_40B33C(a1);
        }
      }
    }
  }
}
// 422E30: using guessed type wchar_t aAboutBlank[12];

//----- (0040AC6B) --------------------------------------------------------
int __stdcall sub_40AC6B(int a1)
{
  return 0;
}

//----- (0040AC70) --------------------------------------------------------
wchar_t *__stdcall sub_40AC70(wchar_t *String)
{
  wchar_t *v1; // ebp
  size_t v2; // eax
  wchar_t *v3; // eax
  const wchar_t *v4; // edi
  size_t v6; // ebx
  wchar_t *i; // esi
  wchar_t v8; // ax
  wchar_t *v9; // ebp
  wchar_t *v10; // [esp+8h] [ebp-8h]
  wchar_t *v11; // [esp+Ch] [ebp-4h]

  v1 = String;
  v2 = wcslen(String);
  v3 = (wchar_t *)malloc(12 * v2 + 512);
  v4 = v3;
  v11 = v3;
  if ( !v3 )
    return String;
  wcscpy(v3, L"<style>body{font-family:\"Arial\";font-size:12;}</style>");
  v6 = wcslen(v4);
  for ( i = String; *i; ++i )
  {
    v8 = *i;
    if ( *i == 13 && i[1] == 10 && (v10 = i + 2, i[2] == 13) && i[3] == 10 )
    {
      v9 = (wchar_t *)&v4[v6];
      do
      {
        if ( i[3] != 10 )
          break;
        wcscpy(v9, L"<br>");
        i = v10;
        v6 += 4;
        v9 += 4;
        v10 += 2;
      }
      while ( *v10 == 13 );
      v4 = v11;
      ++i;
      v1 = String;
    }
    else if ( i > v1 && v8 == 32 && *(i - 1) == 32 )
    {
      wcscpy((wchar_t *)&v4[v6], L"&nbsp;");
      v6 += 6;
    }
    else
    {
      v4[v6++] = v8;
    }
  }
  v4[v6] = 0;
  j___free_base(v1);
  return (wchar_t *)v4;
}

//----- (0040AD88) --------------------------------------------------------
int __stdcall sub_40AD88(int a1, void *Buf1, _DWORD *a3)
{
  int v4; // ecx
  int v5; // eax

  if ( !a3 )
    return -2147467261;
  if ( !memcmp(Buf1, &unk_4234AC, 0x10u) )
    goto LABEL_19;
  if ( !memcmp(Buf1, &unk_4234EC, 0x10u) )
  {
    v4 = a1;
    if ( a1 )
    {
      v5 = a1 + 4;
LABEL_17:
      *a3 = v5;
LABEL_20:
      (*(void (__stdcall **)(int))(*(_DWORD *)v4 + 4))(v4);
      return 0;
    }
    goto LABEL_16;
  }
  if ( !memcmp(Buf1, &unk_4234CC, 0x10u) )
  {
    v4 = a1;
    if ( a1 )
    {
      v5 = a1 + 8;
      goto LABEL_17;
    }
LABEL_16:
    v5 = 0;
    goto LABEL_17;
  }
  if ( !memcmp(Buf1, &unk_42349C, 0x10u) )
  {
    v4 = a1;
    if ( a1 )
    {
      v5 = a1 + 12;
      goto LABEL_17;
    }
    goto LABEL_16;
  }
  if ( !memcmp(Buf1, &unk_42351C, 0x10u) )
  {
    v4 = a1;
    if ( a1 )
    {
      v5 = a1 + 16;
      goto LABEL_17;
    }
    goto LABEL_16;
  }
  if ( !memcmp(Buf1, &Buf2, 0x10u) )
  {
LABEL_19:
    v4 = a1;
    *a3 = a1;
    goto LABEL_20;
  }
  *a3 = 0;
  return -2147467262;
}

//----- (0040AE6F) --------------------------------------------------------
int __stdcall sub_40AE6F(int a1, void *a2, _DWORD *a3)
{
  return sub_40AD88(a1 - 4, a2, a3);
}

//----- (0040AE79) --------------------------------------------------------
int __stdcall sub_40AE79(int a1, void *a2, _DWORD *a3)
{
  return sub_40AD88(a1 - 8, a2, a3);
}

//----- (0040AE83) --------------------------------------------------------
int __stdcall sub_40AE83(int a1, void *a2, _DWORD *a3)
{
  return sub_40AD88(a1 - 16, a2, a3);
}

//----- (0040AE97) --------------------------------------------------------
ATOM __thiscall sub_40AE97(HINSTANCE *this, HINSTANCE a2)
{
  ATOM result; // ax
  WNDCLASSEXW v4; // [esp+Ch] [ebp-30h] BYREF

  v4.cbSize = 48;
  v4.style = 2088;
  v4.lpfnWndProc = (WNDPROC)sub_40B266;
  v4.cbClsExtra = 0;
  v4.cbWndExtra = 0;
  v4.hInstance = a2;
  v4.hIcon = 0;
  v4.hCursor = LoadCursorW(0, (LPCWSTR)0x7F00);
  v4.hbrBackground = (HBRUSH)6;
  v4.lpszMenuName = 0;
  v4.lpszClassName = L"RarHtmlClassName";
  v4.hIconSm = 0;
  result = RegisterClassExW(&v4);
  *this = a2;
  return result;
}

//----- (0040AF00) --------------------------------------------------------
int __stdcall sub_40AF00(_DWORD *Block)
{
  bool v1; // zf
  int result; // eax

  v1 = Block[5]-- == 1;
  result = Block[5];
  if ( v1 )
  {
    sub_40A6C5(Block);
    sub_40F500(Block);
    return 0;
  }
  return result;
}

//----- (0040AF25) --------------------------------------------------------
int __stdcall sub_40AF25(int a1)
{
  return sub_40AF00((_DWORD *)(a1 - 4));
}

//----- (0040AF2F) --------------------------------------------------------
int __stdcall sub_40AF2F(int a1)
{
  return sub_40AF00((_DWORD *)(a1 - 8));
}

//----- (0040AF39) --------------------------------------------------------
int __stdcall sub_40AF39(int a1)
{
  return sub_40AF00((_DWORD *)(a1 - 16));
}

//----- (0040AF4D) --------------------------------------------------------
WCHAR *__stdcall sub_40AF4D(wchar_t *String)
{
  const WCHAR *v1; // esi
  size_t v2; // eax
  WCHAR *result; // eax
  WCHAR *v4; // ebp
  char v5; // al
  wchar_t v6; // cx
  WCHAR *v7; // edi
  char v8; // bl
  unsigned int i; // eax
  int v10; // ecx
  WCHAR v11; // ax
  int v12; // eax
  bool v13; // bl
  WCHAR v15; // ax
  char Stringa; // [esp+1Ch] [ebp+4h]

  v1 = String;
  v2 = wcslen(String);
  result = (WCHAR *)malloc(2 * v2 + 2);
  v4 = result;
  if ( result )
  {
    v5 = sub_40A8E1(String);
    v6 = *String;
    v7 = v4;
    Stringa = v5;
    if ( *v1 )
    {
      v8 = 0;
LABEL_27:
      if ( v6 )
        goto LABEL_4;
      while ( 1 )
      {
        v12 = sub_405666(v1, L"</p>", 4u);
        v13 = v12 == 0;
        if ( !v12 || !sub_405666(v1, L"<br>", 4u) )
        {
          *v7 = 13;
          v7[1] = 10;
          v7 += 2;
          if ( v13 )
          {
            *v7 = 13;
            v7[1] = 10;
            v7 += 2;
          }
        }
        *v7 = 0;
        if ( !sub_405666(v1, L"<style>", 7u) )
        {
          v8 = 0;
          if ( !*v1 )
            return v4;
          while ( sub_405666(v1++, L"</style>", 8u) )
          {
            if ( !*v1 )
              goto LABEL_44;
          }
          v1 += 7;
          goto LABEL_44;
        }
        v15 = *v1;
        if ( *v1 )
          break;
LABEL_41:
        if ( *v1 == 62 )
          goto LABEL_42;
LABEL_43:
        v8 = 0;
LABEL_44:
        v6 = *v1;
        v5 = Stringa;
        if ( !*v1 )
          return v4;
LABEL_4:
        if ( v6 != 60 )
        {
          if ( v5 )
          {
            if ( v6 != 13 && v6 != 10 )
            {
              if ( v6 == 38 )
              {
                for ( i = 0; i < 20; ++i )
                {
                  v10 = v1[i];
                  if ( !(_WORD)v10 )
                    break;
                  if ( v10 == 59 )
                  {
                    v1 = (const WCHAR *)((char *)v1 + i * 2 + 2);
                    v8 = 1;
                  }
                }
                if ( v8 )
                  goto LABEL_25;
              }
              goto LABEL_19;
            }
            if ( v7 == v4 || *(v7 - 1) != 32 )
              *v7++ = 32;
            ++v1;
LABEL_26:
            v6 = *v1;
            goto LABEL_27;
          }
LABEL_19:
          v11 = *v1;
          if ( *v1 )
          {
            if ( v11 != 32 || v7 == v4 || *(v7 - 1) != 32 )
              *v7++ = v11;
            ++v1;
LABEL_25:
            v5 = Stringa;
            v8 = 0;
            goto LABEL_26;
          }
        }
      }
      while ( v15 != 62 )
      {
        v15 = *++v1;
        if ( !*v1 )
          goto LABEL_41;
      }
LABEL_42:
      ++v1;
      goto LABEL_43;
    }
    return v4;
  }
  return result;
}
// 40AFE8: conditional instruction was optimized away because al.1!=0

//----- (0040B115) --------------------------------------------------------
int __stdcall sub_40B115(int a1, int a2)
{
  return -2147467263;
}

//----- (0040B11D) --------------------------------------------------------
int __stdcall sub_40B11D(int a1)
{
  return -2147467263;
}

//----- (0040B125) --------------------------------------------------------
int __stdcall sub_40B125(int a1, int a2, int a3, int a4)
{
  return 0;
}

//----- (0040B12A) --------------------------------------------------------
int __stdcall sub_40B12A(int a1, int a2, int a3)
{
  return -2147467263;
}

//----- (0040B132) --------------------------------------------------------
int __stdcall sub_40B132(int a1, int a2)
{
  return 0;
}

//----- (0040B137) --------------------------------------------------------
void __thiscall sub_40B137(LPVOID lpParam, HINSTANCE a2, HWND hWnd, int a4, int a5, char a6)
{
  HWND Parent; // eax
  int v8; // edi
  int v9; // esi
  HWND v10; // eax
  HWND Window; // eax
  WCHAR *v12; // esi
  HINSTANCE v13; // [esp-Ch] [ebp-28h]
  struct tagRECT Rect; // [esp+Ch] [ebp-10h] BYREF

  *((_DWORD *)lpParam + 2) = hWnd;
  *((_BYTE *)lpParam + 30) = a6;
  ShowWindow(hWnd, 0);
  sub_40AE97((HINSTANCE *)lpParam, a2);
  *((_DWORD *)lpParam + 5) = a4;
  *((_DWORD *)lpParam + 6) = a5;
  GetWindowRect(hWnd, &Rect);
  Parent = GetParent(hWnd);
  MapWindowPoints(0, Parent, (LPPOINT)&Rect, 2u);
  if ( *((_DWORD *)lpParam + 1) )
    DestroyWindow(*((HWND *)lpParam + 1));
  v13 = *(HINSTANCE *)lpParam;
  v8 = Rect.left + 1;
  v9 = Rect.right - Rect.left - 2;
  v10 = GetParent(hWnd);
  Window = CreateWindowExW(
             0,
             L"RarHtmlClassName",
             0,
             0x40000000u,
             v8,
             Rect.top,
             v9,
             Rect.bottom - Rect.top,
             v10,
             0,
             v13,
             lpParam);
  *((_DWORD *)lpParam + 1) = Window;
  if ( *((_DWORD *)lpParam + 4) )
  {
    if ( Window )
    {
      ShowWindow(Window, 5);
      UpdateWindow(*((HWND *)lpParam + 1));
    }
  }
  else if ( hWnd && !*((_DWORD *)lpParam + 6) && *((_DWORD *)lpParam + 5) )
  {
    v12 = sub_40AF4D(*((wchar_t **)lpParam + 5));
    if ( v12 )
    {
      ShowWindow(hWnd, 5);
      SetWindowTextW(hWnd, v12);
      j___free_base(v12);
    }
  }
}

//----- (0040B242) --------------------------------------------------------
int __stdcall sub_40B242(int a1, int a2, int a3, int a4, int a5)
{
  return 1;
}

//----- (0040B248) --------------------------------------------------------
int __stdcall sub_40B248(int a1, int a2, int a3, int a4, int a5, int a6)
{
  return 1;
}

//----- (0040B24E) --------------------------------------------------------
int __stdcall sub_40B24E(int a1, int a2, int a3)
{
  return 0;
}

//----- (0040B253) --------------------------------------------------------
int __stdcall sub_40B253(int a1, int a2, int a3, int a4)
{
  return 1;
}

//----- (0040B259) --------------------------------------------------------
int __stdcall sub_40B259(int a1, int a2, int a3, _DWORD *a4)
{
  *a4 = 0;
  return 1;
}

//----- (0040B266) --------------------------------------------------------
LRESULT __userpurge sub_40B266@<eax>(int a1@<ebx>, HWND hWnd, UINT Msg, WPARAM wParam, LONG *lParam)
{
  int WindowLongW; // eax

  if ( Msg == 1 )
  {
    WindowLongW = GetWindowLongW(hWnd, -21);
    sub_40ABAF(WindowLongW, a1, (int)hWnd);
  }
  else if ( Msg == 129 )
  {
    SetWindowLongW(hWnd, -21, *lParam);
  }
  return DefWindowProcW(hWnd, Msg, wParam, (LPARAM)lParam);
}

//----- (0040B2B5) --------------------------------------------------------
HRESULT __thiscall sub_40B2B5(LPVOID *this, LPCOLESTR lpsz)
{
  HRESULT result; // eax
  CLSID pclsid; // [esp+8h] [ebp-14h] BYREF
  int v5; // [esp+18h] [ebp-4h] BYREF

  CLSIDFromString(lpsz, &pclsid);
  result = CoCreateInstance(&pclsid, 0, 5u, &Buf2, this + 7);
  if ( this[7] )
  {
    result = (**(int (__stdcall ***)(LPVOID, void *, LPCOLESTR *))this[7])(this[7], &unk_4234BC, &lpsz);
    if ( result >= 0 )
    {
      (*(void (__stdcall **)(LPCOLESTR, LPVOID *))(*(_DWORD *)lpsz + 12))(lpsz, this);
      (*(void (__stdcall **)(LPCOLESTR))(*(_DWORD *)lpsz + 8))(lpsz);
      result = (**(int (__stdcall ***)(LPVOID, void *, int *))this[7])(this[7], &unk_4234FC, &v5);
      if ( result >= 0 )
      {
        (*(void (__stdcall **)(int))(*(_DWORD *)v5 + 32))(v5);
        return (*(int (__stdcall **)(int))(*(_DWORD *)v5 + 8))(v5);
      }
    }
  }
  return result;
}

//----- (0040B33C) --------------------------------------------------------
void __thiscall sub_40B33C(int this)
{
  bool v2; // zf

  if ( !*(_DWORD *)(this + 24) && !*(_BYTE *)(this + 29) )
    sub_40AA67((int *)this, *(wchar_t **)(this + 20));
  v2 = *(_BYTE *)(this + 30) == 0;
  *(_BYTE *)(this + 29) = 1;
  if ( !v2 )
    sub_40B404(*(_DWORD **)(this + 12), 1);
}

//----- (0040B369) --------------------------------------------------------
int __thiscall sub_40B369(_DWORD *this)
{
  int v2; // edx

  v2 = this[7];
  if ( !v2 )
    return 0;
  (*(void (__stdcall **)(_DWORD))(*(_DWORD *)v2 + 4))(this[7]);
  return this[7];
}

//----- (0040B382) --------------------------------------------------------
void __thiscall sub_40B382(_DWORD *this)
{
  int (__stdcall ***v2)(_DWORD, void *, int *); // ecx
  int v3; // [esp+4h] [ebp-8h] BYREF
  int v4; // [esp+8h] [ebp-4h] BYREF

  v2 = (int (__stdcall ***)(_DWORD, void *, int *))this[7];
  if ( v2 )
  {
    if ( (**v2)(v2, &unk_4234BC, &v4) >= 0 )
    {
      (*(void (__stdcall **)(int, int))(*(_DWORD *)v4 + 24))(v4, 1);
      (*(void (__stdcall **)(int, _DWORD))(*(_DWORD *)v4 + 12))(v4, 0);
      (*(void (__stdcall **)(int))(*(_DWORD *)v4 + 8))(v4);
    }
    if ( (**(int (__stdcall ***)(_DWORD, void *, int *))this[7])(this[7], &unk_4234DC, &v3) >= 0 )
    {
      (*(void (__stdcall **)(int))(*(_DWORD *)v3 + 24))(v3);
      (*(void (__stdcall **)(int))(*(_DWORD *)v3 + 20))(v3);
      (*(void (__stdcall **)(int))(*(_DWORD *)v3 + 8))(v3);
    }
    (*(void (__stdcall **)(_DWORD))(*(_DWORD *)this[7] + 8))(this[7]);
    this[7] = 0;
  }
}

//----- (0040B404) --------------------------------------------------------
void __thiscall sub_40B404(_DWORD *this, int a2)
{
  int (__stdcall ***v3)(_DWORD, void *, int *); // edx

  v3 = (int (__stdcall ***)(_DWORD, void *, int *))this[7];
  if ( v3 && a2 && (**v3)(v3, &unk_4234BC, &a2) >= 0 )
  {
    (*(void (__stdcall **)(int, int, _DWORD, _DWORD *, _DWORD, _DWORD, _DWORD *))(*(_DWORD *)a2 + 44))(
      a2,
      -4,
      0,
      this,
      0,
      this[6],
      this + 8);
    (*(void (__stdcall **)(int))(*(_DWORD *)a2 + 8))(a2);
  }
}

//----- (0040B44E) --------------------------------------------------------
void __userpurge sub_40B44E(int a1@<ecx>, int a2@<ebx>, int a3@<esi>, int a4)
{
  int (__stdcall ***v5)(_DWORD, void *, int *); // ecx
  int v6; // ecx
  int *v7; // [esp+4h] [ebp-4h] BYREF

  v5 = *(int (__stdcall ****)(_DWORD, void *, int *))(a1 + 28);
  if ( v5 && (**v5)(v5, &unk_4234BC, (int *)&v7) >= 0 )
  {
    v6 = *v7;
    if ( a4 )
    {
      (*(void (__stdcall **)(int *, int, _DWORD, int, _DWORD, _DWORD, int, int))(v6 + 44))(
        v7,
        -5,
        0,
        a1,
        0,
        *(_DWORD *)(a1 + 24),
        a1 + 32,
        a3);
      (*(void (__stdcall **)(int *, int, _DWORD, int, _DWORD, _DWORD, int))(*v7 + 44))(
        v7,
        -1,
        0,
        a1,
        0,
        *(_DWORD *)(a1 + 24),
        a1 + 32);
    }
    else
    {
      (*(void (__stdcall **)(int *, int, _DWORD, int, _DWORD, _DWORD, _DWORD, int))(v6 + 44))(
        v7,
        -3,
        0,
        a1,
        0,
        *(_DWORD *)(a1 + 24),
        0,
        a2);
    }
    (*(void (__cdecl **)(int *))(*v7 + 8))(v7);
  }
}
// 40B44E: could not find valid save-restore pair for ebx
// 40B44E: could not find valid save-restore pair for esi

//----- (0040B4BF) --------------------------------------------------------
char __stdcall sub_40B4BF(char a1, int a2, int a3, int a4, int a5, int a6, int a7)
{
  char v7; // bl
  int v8; // ecx
  int v10; // [esp+4h] [ebp-8h] BYREF
  LPVOID ppv; // [esp+8h] [ebp-4h] BYREF

  v7 = 0;
  if ( CoCreateInstance(&rclsid, 0, 1u, &stru_42346C, &ppv) >= 0 )
  {
    if ( (**(int (__stdcall ***)(LPVOID, void *, int *))ppv)(ppv, &unk_42352C, &v10) >= 0 )
    {
      if ( a1 )
        (*(void (__stdcall **)(int, int, int))(*(_DWORD *)v10 + 20))(v10, a3, 2);
      (*(void (__stdcall **)(LPVOID, int))(*(_DWORD *)ppv + 80))(ppv, a2);
      if ( a5 )
        (*(void (__stdcall **)(LPVOID, int))(*(_DWORD *)ppv + 28))(ppv, a5);
      v8 = *(_DWORD *)ppv;
      if ( a6 )
        (*(void (__stdcall **)(LPVOID, int, _DWORD))(v8 + 68))(ppv, a6, 0);
      else
        (*(void (__stdcall **)(LPVOID, const WCHAR *, _DWORD))(v8 + 68))(ppv, &String, 0);
      if ( a7 )
        (*(void (__stdcall **)(LPVOID, int))(*(_DWORD *)ppv + 44))(ppv, a7);
      if ( a4 )
        (*(void (__stdcall **)(LPVOID, int))(*(_DWORD *)ppv + 36))(ppv, a4);
      if ( (*(int (__stdcall **)(int, int, int))(*(_DWORD *)v10 + 24))(v10, a3, 1) >= 0 )
        v7 = 1;
      (*(void (__stdcall **)(int))(*(_DWORD *)v10 + 8))(v10);
    }
    (*(void (__stdcall **)(LPVOID))(*(_DWORD *)ppv + 8))(ppv);
  }
  return v7;
}

//----- (0040B599) --------------------------------------------------------
BOOL sub_40B599()
{
  return sub_40B5B8(100) >= 125 || sub_40B5FB(100) >= 125;
}

//----- (0040B5B8) --------------------------------------------------------
int __stdcall sub_40B5B8(int a1)
{
  HDC DC; // eax
  HDC v2; // esi

  if ( !dword_4411A8 )
  {
    DC = GetDC(0);
    v2 = DC;
    if ( DC )
    {
      dword_4411A8 = GetDeviceCaps(DC, 88);
      ReleaseDC(0, v2);
    }
  }
  return a1 * dword_4411A8 / 96;
}
// 4411A8: using guessed type int dword_4411A8;

//----- (0040B5FB) --------------------------------------------------------
int __stdcall sub_40B5FB(int a1)
{
  HDC DC; // eax
  HDC v2; // esi

  if ( !dword_4411AC )
  {
    DC = GetDC(0);
    v2 = DC;
    if ( DC )
    {
      dword_4411AC = GetDeviceCaps(DC, 90);
      ReleaseDC(0, v2);
    }
  }
  return a1 * dword_4411AC / 96;
}
// 4411AC: using guessed type int dword_4411AC;

//----- (0040B63E) --------------------------------------------------------
BOOL __stdcall sub_40B63E(LPWSTR lpBuffer, DWORD nBufferLength)
{
  return GetCurrentDirectoryW(nBufferLength, lpBuffer) != 0;
}

//----- (0040B655) --------------------------------------------------------
BOOL sub_40B655()
{
  HDC DC; // esi
  int DeviceCaps; // edi

  DC = GetDC(0);
  DeviceCaps = GetDeviceCaps(DC, 12);
  ReleaseDC(0, DC);
  return DeviceCaps >= 32;
}

//----- (0040B680) --------------------------------------------------------
int __stdcall sub_40B680(HWND hWnd, LPCWSTR lpText, LPCWSTR lpCaption, UINT uType)
{
  UINT v4; // eax

  v4 = uType;
  if ( byte_44A31C )
    v4 = uType | 0x180000;
  return MessageBoxW(hWnd, lpText, lpCaption, v4);
}
// 44A31C: using guessed type char byte_44A31C;

//----- (0040B6A8) --------------------------------------------------------
HBITMAP __userpurge sub_40B6A8@<eax>(
        int a1@<ebx>,
        int a2@<ebp>,
        int a3@<edi>,
        int a4@<esi>,
        HANDLE h,
        int wDest,
        int cy,
        char a8,
        int a9,
        int a10)
{
  HANDLE v11; // edi
  int v13; // ebx
  HBITMAP v14; // esi
  bool v15; // sf
  int v16; // eax
  HBITMAP DIBSection; // ebp
  LPVOID ppv; // [esp+78h] [ebp-64h] BYREF
  int v23; // [esp+7Ch] [ebp-60h] BYREF
  int v24; // [esp+84h] [ebp-58h] BYREF
  int v25; // [esp+88h] [ebp-54h]
  int v26; // [esp+8Ch] [ebp-50h]
  void *ppvBits[2]; // [esp+90h] [ebp-4Ch] BYREF
  int pv; // [esp+98h] [ebp-44h] BYREF
  int v29; // [esp+9Ch] [ebp-40h]
  int v30; // [esp+A0h] [ebp-3Ch]
  int v31; // [esp+A4h] [ebp-38h]
  int v32[3]; // [esp+BCh] [ebp-20h] BYREF
  __int16 v33; // [esp+C8h] [ebp-14h]
  __int16 v34; // [esp+CAh] [ebp-12h]
  int v35; // [esp+CCh] [ebp-10h]

  if ( !sub_40B655() )
    return sub_40B89F(h, wDest, cy);
  v11 = h;
  GetObjectW(h, 24, &pv);
  v13 = cy;
  if ( wDest * v30 / v29 < cy )
    v13 = wDest * v30 / v29;
  v14 = 0;
  if ( CoCreateInstance(&stru_42354C, 0, 1u, &stru_422FDC, &ppv) >= 0 )
  {
    v15 = (*(int (__stdcall **)(LPVOID, HANDLE, _DWORD, int, int *, int))(*(_DWORD *)ppv + 84))(ppv, h, 0, 2, &v23, a4) < 0;
    v16 = v23;
    if ( !v15 )
    {
      v24 = 0;
      if ( (*(int (__stdcall **)(int, int *, int))(*(_DWORD *)v23 + 40))(v23, &v24, a3) >= 0 )
      {
        if ( (*(int (__stdcall **)(int, int, void *, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, int))(*(_DWORD *)v25 + 32))(
               v25,
               v24,
               &unk_42355C,
               0,
               0,
               COERCE_UNSIGNED_INT64(0.0),
               HIDWORD(COERCE_UNSIGNED_INT64(0.0)),
               0,
               a2) >= 0 )
        {
          memset(v32, 0, 0x2Cu);
          v32[0] = 40;
          v32[1] = wDest;
          v35 = 0;
          v32[2] = -v13;
          v33 = 1;
          v34 = 32;
          DIBSection = CreateDIBSection(0, (const BITMAPINFO *)v32, 0, ppvBits, 0, 0);
          if ( (DIBSection != 0 ? 0 : -2147024882) >= 0 )
          {
            (*(void (__stdcall **)(int, char *, int))(*(_DWORD *)v24 + 44))(v24, &a8, a1);
            (*(void (__stdcall **)(int, int, int, int, int))(*(_DWORD *)a9 + 32))(a9, v26, a10, v13, 3);
            v30 = a10;
            pv = 0;
            v29 = 0;
            v31 = v13;
            if ( (*(int (__stdcall **)(int, int *, int, int, void *))(*(_DWORD *)a9 + 28))(
                   a9,
                   &pv,
                   4 * a10,
                   4 * v13 * a10,
                   ppvBits[1]) < 0 )
              DeleteObject(DIBSection);
            else
              v14 = DIBSection;
            (*(void (__cdecl **)(int))(*(_DWORD *)a9 + 8))(a9);
          }
          (*(void (__cdecl **)(int))(*(_DWORD *)v25 + 8))(v25);
          (*(void (__cdecl **)(int))(*(_DWORD *)v25 + 8))(v25);
          (*(void (__cdecl **)(int))(*(_DWORD *)v23 + 8))(v23);
          if ( v14 )
            return v14;
          return (HBITMAP)v11;
        }
        (*(void (__cdecl **)(int))(*(_DWORD *)v26 + 8))(v26);
      }
      (*(void (__cdecl **)(int))(*(_DWORD *)v24 + 8))(v24);
      v16 = v23;
    }
    (*(void (__cdecl **)(int))(*(_DWORD *)v16 + 8))(v16);
  }
  return (HBITMAP)v11;
}
// 40B6A8: could not find valid save-restore pair for ebx
// 40B6A8: could not find valid save-restore pair for ebp
// 40B6A8: could not find valid save-restore pair for edi
// 40B6A8: could not find valid save-restore pair for esi

//----- (0040B89F) --------------------------------------------------------
HBITMAP __stdcall sub_40B89F(HANDLE h, int wDest, int cy)
{
  HDC DC; // ebp
  HDC CompatibleDC; // ebx
  HDC v5; // esi
  int v6; // eax
  HBITMAP CompatibleBitmap; // ebp
  HGDIOBJ v8; // edi
  HGDIOBJ v9; // esi
  HDC hdcDest; // [esp+10h] [ebp-24h]
  HDC hDC; // [esp+18h] [ebp-1Ch]
  char pv[4]; // [esp+1Ch] [ebp-18h] BYREF
  int wSrc; // [esp+20h] [ebp-14h]
  int hSrc; // [esp+24h] [ebp-10h]

  DC = GetDC(0);
  hDC = DC;
  CompatibleDC = CreateCompatibleDC(DC);
  v5 = CreateCompatibleDC(DC);
  hdcDest = v5;
  GetObjectW(h, 24, pv);
  v6 = cy;
  if ( wDest * hSrc / wSrc < cy )
  {
    v6 = wDest * hSrc / wSrc;
    cy = v6;
  }
  CompatibleBitmap = CreateCompatibleBitmap(DC, wDest, v6);
  v8 = SelectObject(CompatibleDC, h);
  v9 = SelectObject(v5, CompatibleBitmap);
  StretchBlt(hdcDest, 0, 0, wDest, cy, CompatibleDC, 0, 0, wSrc, hSrc, 0xCC0020u);
  SelectObject(CompatibleDC, v8);
  SelectObject(hdcDest, v9);
  DeleteDC(CompatibleDC);
  DeleteDC(hdcDest);
  ReleaseDC(0, hDC);
  return CompatibleBitmap;
}
// 40B89F: using guessed type char pv[4];

//----- (0040B97D) --------------------------------------------------------
HWND __stdcall sub_40B97D(HWND hWnd)
{
  HWND v1; // esi
  HWND result; // eax
  WCHAR ClassName[80]; // [esp+4h] [ebp-A0h] BYREF

  v1 = hWnd;
  result = (HWND)GetClassNameW(hWnd, ClassName, 80);
  if ( result )
  {
    result = (HWND)sub_405644(ClassName, L"EDIT");
    if ( result )
    {
      result = FindWindowExW(hWnd, 0, L"EDIT", 0);
      v1 = result;
    }
  }
  if ( v1 )
    return (HWND)SHAutoComplete(v1, 0x10u);
  return result;
}

//----- (0040B9D8) --------------------------------------------------------
BOOL __stdcall sub_40B9D8(LPCWSTR lpPathName)
{
  return SetCurrentDirectoryW(lpPathName);
}

//----- (0040B9EB) --------------------------------------------------------
HMODULE *__thiscall sub_40B9EB(HMODULE *this)
{
  INITCOMMONCONTROLSEX picce; // [esp+4h] [ebp-8h] BYREF

  *this = sub_4047AA((wchar_t *)L"riched20.dll");
  OleInitialize(0);
  picce.dwSize = 8;
  picce.dwICC = 2047;
  InitCommonControlsEx(&picce);
  SHGetMalloc(&ppMalloc);
  return this;
}

//----- (0040BA31) --------------------------------------------------------
void sub_40BA31()
{
  ppMalloc->lpVtbl->Release(ppMalloc);
  OleUninitialize();
}

//----- (0040BAAA) --------------------------------------------------------
int __stdcall sub_40BAAA(_WORD *a1)
{
  _WORD *v1; // eax
  _WORD *v2; // ecx
  int v3; // esi
  int result; // eax

  v1 = a1;
  v2 = a1;
  if ( *a1 )
  {
    while ( *v1 == 92 )
    {
      v3 = (unsigned __int16)v1[1];
      if ( (_WORD)v3 == 92 )
      {
        *v2 = 92;
      }
      else
      {
        if ( v3 != 110 )
          break;
        *v2 = 10;
      }
      ++v2;
      v1 += 2;
LABEL_9:
      if ( !*v1 )
        goto LABEL_10;
    }
    *v2++ = *v1++;
    goto LABEL_9;
  }
LABEL_10:
  result = 0;
  *v2 = 0;
  return result;
}

//----- (0040BAFF) --------------------------------------------------------
int sub_40BAFF()
{
  int result; // eax
  wchar_t *v1; // eax
  const WCHAR *v2; // [esp-8h] [ebp-1028h]
  wchar_t String[2048]; // [esp+0h] [ebp-1020h] BYREF
  struct _SHFILEOPSTRUCTW FileOp; // [esp+1000h] [ebp-20h] BYREF

  result = sub_40B63E(String, 0x800u);
  if ( !byte_4538C2 )
  {
    v2 = off_42B038;
    v1 = sub_4036A6(String);
    result = sub_405666(v1, v2, 6u);
    if ( !result )
    {
      sub_40B9D8(L"..");
      String[wcslen(String) + 1] = 0;
      memset(&FileOp, 0, sizeof(FileOp));
      FileOp.wFunc = 3;
      FileOp.fFlags = 20;
      FileOp.pFrom = String;
      return SHFileOperationW(&FileOp);
    }
  }
  return result;
}
// 4538C2: using guessed type char byte_4538C2;

//----- (0040BB98) --------------------------------------------------------
_WORD *__stdcall sub_40BB98(_WORD *a1)
{
  _WORD *result; // eax

  result = a1;
  if ( !a1 || !*a1 )
    return 0;
  return result;
}

//----- (0040BBAC) --------------------------------------------------------
LPCWSTR sub_40BBAC(LPCWSTR a1, ...)
{
  LPCWSTR result; // eax
  WCHAR v2[5120]; // [esp+0h] [ebp-2800h] BYREF
  va_list va; // [esp+280Ch] [ebp+Ch] BYREF

  va_start(va, a1);
  result = a1;
  if ( a1 )
  {
    if ( !*a1 )
      return result;
    wvsprintfW(v2, a1, va);
    result = (LPCWSTR)sub_40DF38(1, (LPARAM)v2);
  }
  ++dword_4481E0;
  return result;
}
// 4481E0: using guessed type int dword_4481E0;

//----- (0040BBF0) --------------------------------------------------------
int __stdcall sub_40BBF0(__int64 a1, LPWSTR lpNumberStr, int cchNumber)
{
  int result; // eax
  WCHAR LCData[100]; // [esp+Ch] [ebp-12Ch] BYREF
  WCHAR Value[50]; // [esp+D4h] [ebp-64h] BYREF

  if ( !Format.lpThousandSep )
  {
    GetLocaleInfoW(0x400u, 0xFu, LCData, 100);
    word_4558F0 = LCData[0];
    word_4558F2 = 0;
    Format.lpThousandSep = (LPWSTR)&word_4558F0;
  }
  sub_4044E8(a1, (int)Value, 50);
  *lpNumberStr = 0;
  GetNumberFormatW(0x400u, 0, Value, &Format, lpNumberStr, cchNumber);
  result = 0;
  lpNumberStr[cchNumber - 1] = 0;
  return result;
}
// 4558F0: using guessed type __int16 word_4558F0;
// 4558F2: using guessed type __int16 word_4558F2;
// 40BBF0: using guessed type WCHAR LCData[100];

//----- (0040BC7B) --------------------------------------------------------
unsigned __int16 *__stdcall sub_40BC7B(unsigned __int16 *a1, _WORD *a2)
{
  unsigned __int16 *v2; // esi
  unsigned __int16 v3; // ax
  _WORD *v4; // edi
  char v5; // cl
  unsigned __int16 v6; // dx
  char v7; // bl

  v2 = a1;
  if ( !a1 || (v3 = *a1) == 0 )
  {
    *a2 = 0;
    return 0;
  }
  v4 = a2;
  v5 = 0;
  while ( v3 == 34 )
  {
    if ( v2[1] != 34 || !v5 && v2 == a1 && ((v6 = v2[2], v6 == 44) || !v6) )
    {
      v7 = v5;
      if ( v5 )
        v5 = 0;
      else
        v5 = wcschr(v2 + 1, 0x22u) != 0;
      if ( v7 != v5 )
        goto LABEL_19;
      break;
    }
    ++v2;
    *v4 = 34;
LABEL_18:
    ++v4;
LABEL_19:
    v3 = *++v2;
    if ( !*v2 )
    {
      *v4 = 0;
      return v2;
    }
  }
  if ( *v2 != 44 || v5 )
  {
    *v4 = *v2;
    goto LABEL_18;
  }
  *v4 = 0;
  do
    ++v2;
  while ( sub_404496(*v2) );
  return v2;
}

//----- (0040BD46) --------------------------------------------------------
bool __stdcall sub_40BD46(int a1, WCHAR *lpFileName, WCHAR **a3, int *a4)
{
  char *v4; // edi
  __int64 v5; // rax
  DWORD v6; // ebx
  int i; // esi
  int v8; // eax
  int v9; // ebx
  WCHAR *v10; // ecx
  _DWORD v12[1036]; // [esp+4h] [ebp-1030h] BYREF

  sub_401BAB(v12);
  v12[1035] = 0;
  if ( sub_401F07((int)v12, lpFileName, 0) )
  {
    v4 = (char *)malloc(0x10000u);
    if ( v4 )
    {
      sub_40217B((int)v12, 0i64, 2u);
      LODWORD(v5) = sub_402286((int)v12);
      if ( v5 >= 0x10000 )
        sub_40217B((int)v12, v5 - 0x10000, 0);
      else
        sub_40217B((int)v12, 0i64, 0);
      v6 = sub_4020A8(v12, v4, 0x10000u);
      sub_401C84((int)v12);
      for ( i = v6 - 4; i > 0; --i )
      {
        if ( v4[i] == 80 && v4[i + 1] == 75 && v4[i + 2] == 5 && v4[i + 3] == 6 && i < (int)(v6 - 22) )
        {
          v8 = *(unsigned __int16 *)&v4[i + 20];
          if ( *(_WORD *)&v4[i + 20] )
          {
            v9 = v6 - i - 22;
            if ( v8 >= v9 )
              v8 = v9;
            *a4 = v8;
            v10 = (WCHAR *)malloc(2 * v8 + 2);
            *a3 = v10;
            if ( v10 )
            {
              sub_405386(&v4[i + 22], v10, *a4 + 1);
              (*a3)[*a4] = 0;
            }
            else
            {
              *a4 = 0;
            }
            break;
          }
        }
      }
      j___free_base(v4);
    }
  }
  return sub_401BE1(v12);
}
// 40BDBC: variable 'v5' is possibly undefined

//----- (0040BE95) --------------------------------------------------------
void __stdcall sub_40BE95(wchar_t *Destination, int a2)
{
  DWORD v2; // eax
  WCHAR ValueName[2048]; // [esp+0h] [ebp-200Ch] BYREF
  wchar_t Data[2048]; // [esp+1000h] [ebp-100Ch] BYREF
  DWORD Type; // [esp+2000h] [ebp-Ch] BYREF
  HKEY phkResult; // [esp+2004h] [ebp-8h] BYREF
  DWORD cbData; // [esp+2008h] [ebp-4h] BYREF

  if ( byte_4481F8 )
  {
    sub_40D230(Destination, ValueName);
    if ( !RegOpenKeyExW(HKEY_CURRENT_USER, L"Software\\WinRAR SFX", 0, 1u, &phkResult) )
    {
      cbData = 4096;
      if ( !RegQueryValueExW(phkResult, ValueName, 0, &Type, (LPBYTE)Data, &cbData) )
      {
        v2 = cbData >> 1;
        cbData = v2;
        if ( v2 >= 0x7FF )
          v2 = 2047;
        Data[v2] = 0;
        sub_4045C8(Destination, Data, a2);
      }
      RegCloseKey(phkResult);
    }
  }
}
// 4481F8: using guessed type char byte_4481F8;
// 40BE95: using guessed type wchar_t Data[2048];

//----- (0040BF44) --------------------------------------------------------
INT_PTR __stdcall sub_40BF44(HWND hDlg, int a2, int a3, const WCHAR *lpString)
{
  WCHAR String[128]; // [esp+Ch] [ebp-100h] BYREF

  if ( !sub_4013B0(hDlg, a2, a3, (int)lpString, L"GETPASSWORD1", 0, 0) )
  {
    if ( a2 == 272 )
    {
      SetDlgItemTextW(hDlg, 102, lpString);
    }
    else
    {
      if ( a2 != 273 )
        return 0;
      if ( (unsigned __int16)a3 == 1 )
      {
        GetDlgItemTextW(hDlg, 101, String, 128);
        sub_4042D3(byte_4537C0, String);
        sub_40431E(String, 128);
        EndDialog(hDlg, 1);
      }
      else
      {
        if ( (unsigned __int16)a3 != 2 )
          return 0;
        EndDialog(hDlg, 0);
      }
    }
  }
  return 1;
}

//----- (0040BFEA) --------------------------------------------------------
WCHAR *__stdcall sub_40BFEA(WCHAR *a1, WCHAR *a2, wchar_t *Destination, _BYTE *a4, _BYTE *a5, int a6)
{
  const WCHAR *v6; // ebx
  WCHAR *v7; // esi
  WCHAR v8; // ax
  int v11; // [esp+8h] [ebp-2004h]
  WCHAR Dst[4096]; // [esp+Ch] [ebp-2000h] BYREF

  v6 = 0;
  if ( a4 )
    *a4 = 0;
  if ( a5 )
    *a5 = 0;
  v7 = a1;
  if ( !a1 )
    return 0;
  v8 = *a1;
  if ( !*a1 )
    return 0;
  v11 = 0;
  while ( 1 )
  {
    ++v7;
    if ( v8 != 61 )
      break;
    if ( Destination && !v6 )
    {
      if ( a4 )
        *a4 = 1;
      v6 = a2;
      goto LABEL_17;
    }
LABEL_16:
    *a2++ = v8;
    if ( v11 >= a6 - 2 )
    {
      *a5 = 1;
      goto LABEL_21;
    }
LABEL_17:
    v8 = *v7;
    ++v11;
    if ( !*v7 )
      goto LABEL_21;
  }
  if ( v8 != 13 )
  {
    if ( v8 == 10 )
      goto LABEL_21;
    goto LABEL_16;
  }
  ++v7;
LABEL_21:
  *a2 = 0;
  if ( Destination )
  {
    *Destination = 0;
    if ( v6 )
    {
      ExpandEnvironmentStringsW(v6, Dst, 0x1000u);
      sub_4045C8(Destination, Dst, a6);
      *v6 = 0;
    }
  }
  return v7;
}

//----- (0040C0E2) --------------------------------------------------------
bool __stdcall sub_40C0E2(LPWSTR pszPath, int csidl)
{
  HRESULT v2; // eax
  bool v3; // bl
  IMalloc *ppMalloc; // [esp+4h] [ebp-8h] BYREF
  LPITEMIDLIST ppidl; // [esp+8h] [ebp-4h] BYREF

  SHGetMalloc(&ppMalloc);
  v2 = SHGetFolderLocation(0, csidl, 0, 0, &ppidl);
  v3 = v2 == 0;
  if ( v2 )
  {
    *pszPath = 0;
  }
  else
  {
    v3 = SHGetPathFromIDListW(ppidl, pszPath);
    ppMalloc->lpVtbl->Free(ppMalloc, ppidl);
  }
  return v3;
}

//----- (0040C142) --------------------------------------------------------
wchar_t *__stdcall sub_40C142(WCHAR **a1)
{
  wchar_t *v1; // esi
  int v2; // edi
  size_t v3; // eax
  wchar_t *v4; // eax
  WCHAR *v5; // eax
  char v7; // [esp+13h] [ebp-2001h] BYREF
  WCHAR v8[4096]; // [esp+14h] [ebp-2000h] BYREF

  v1 = (wchar_t *)malloc(0x80000u);
  if ( !v1 )
    sub_4019C4(dword_44A2FC);
  *v1 = 0;
  v2 = 0;
  while ( 1 )
  {
    v5 = sub_40BFEA(*a1, v8, 0, 0, &v7, 4096);
    *a1 = v5;
    if ( !v5 )
      break;
    if ( *v1 || v8[0] != 123 )
    {
      if ( v8[0] == 125 || v2 + wcslen(v8) > 0x3FFFB )
        return v1;
      wcscat(v1, v8);
      v3 = wcslen(v1);
      v2 = v3;
      if ( v3 )
      {
        v4 = &v1[v3 - 1];
        do
        {
          if ( *v4 != 32 )
            break;
          --v4;
          --v2;
        }
        while ( v2 );
      }
      if ( !v7 )
        wcscpy(&v1[v2], L"\r\n");
    }
  }
  return v1;
}
// 44A2FC: using guessed type int dword_44A2FC[4];

//----- (0040C21C) --------------------------------------------------------
LRESULT sub_40C21C()
{
  LRESULT result; // eax
  struct tagMSG Msg; // [esp+4h] [ebp-1Ch] BYREF

  result = PeekMessageW(&Msg, 0, 0, 0, 0);
  if ( result )
  {
    GetMessageW(&Msg, 0, 0, 0);
    TranslateMessage(&Msg);
    return DispatchMessageW(&Msg);
  }
  return result;
}

//----- (0040C25D) --------------------------------------------------------
INT_PTR __stdcall DialogFunc(HWND hWnd, int a2, int a3, LPARAM a4)
{
  HWND DlgItem; // ebx
  LPARAM SysColor; // eax

  if ( sub_4013B0(hWnd, a2, a3, a4, L"LICENSEDLG", 0, 0) )
    return 1;
  if ( a2 == 272 )
  {
    if ( lParam )
      SendMessageW(hWnd, 0x80u, 1u, lParam);
    if ( dword_4548D4 )
      SendDlgItemMessageW(hWnd, 102, 0x172u, 0, dword_4548D4);
    sub_40E0DC(a3, (char)SendMessageW, (int)hWnd, hWnd);
    DlgItem = GetDlgItem(hWnd, 101);
    SendMessageW(DlgItem, 0x435u, 0, 0x10000);
    SysColor = GetSysColor(15);
    SendMessageW(DlgItem, 0x443u, 0, SysColor);
    sub_40D273(hWnd, (WCHAR *)dword_4411BC, 3);
    if ( dword_4548DC )
    {
      SetForegroundWindow(hWnd);
      sub_40B137(lpParam, dword_4481D8, DlgItem, (int)dword_4548DC, 0, 0);
      j___free_base(dword_4548DC);
      return 1;
    }
LABEL_14:
    EndDialog(hWnd, 1);
    return 1;
  }
  if ( a2 != 273 )
    return 0;
  if ( (unsigned __int16)a3 == 1 )
    goto LABEL_14;
  if ( (unsigned __int16)a3 != 2 )
    return 0;
  EndDialog(hWnd, 0);
  return 1;
}

//----- (0040C371) --------------------------------------------------------
void sub_40C371(int a1, char *Format, ...)
{
  DWORD LastError; // esi
  va_list va; // [esp+Ch] [ebp+Ch] BYREF

  va_start(va, Format);
  if ( !byte_4481E9 && *(_WORD *)Format )
  {
    LastError = GetLastError();
    _vsprintf_s_l(Buffer, 0x1000u, Format, 0, va);
    sub_40BBAC(L"%s", Buffer);
    if ( LastError )
      SetLastError(LastError);
  }
}
// 4481E9: using guessed type char byte_4481E9;

//----- (0040C3C5) --------------------------------------------------------
INT_PTR __stdcall sub_40C3C5(HWND hDlg, int a2, LPCVOID lpBaseAddress, HWND hWnd)
{
  WCHAR *v6; // eax
  bool v7; // zf
  WCHAR *v8; // eax
  char v9; // al
  HWND v10; // eax
  HWND v11; // ebx
  void *v12; // eax
  char *v13; // eax
  DWORD LastError; // eax
  bool v15; // dl
  DWORD v16; // eax
  char v17; // al
  char v18; // cl
  DWORD TickCount; // eax
  HWND FileMappingW; // esi
  wchar_t *CommandLineW; // eax
  BOOL v22; // esi
  HWND v23; // esi
  WCHAR *v24; // eax
  WCHAR *v25; // eax
  WCHAR *v26; // eax
  HWND v27; // eax
  HWND v28; // esi
  LONG WindowLongW; // eax
  WCHAR *v30; // eax
  UINT v31; // esi
  WCHAR *v32; // eax
  HWND DlgItem; // eax
  HWND v34; // esi
  WCHAR *v35; // ecx
  WCHAR *v36; // eax
  WCHAR *v37; // eax
  signed int v38; // esi
  WCHAR *v39; // eax
  WCHAR *v40; // eax
  WCHAR *v41; // [esp-8h] [ebp-9CB4h]
  char v42[1560]; // [esp+Ch] [ebp-9CA0h] BYREF
  wchar_t Destination[8192]; // [esp+624h] [ebp-9688h] BYREF
  WCHAR Text[2560]; // [esp+4624h] [ebp-5688h] BYREF
  char Buffer[4352]; // [esp+5A24h] [ebp-4288h] BYREF
  _DWORD v46[1033]; // [esp+6B24h] [ebp-3188h] BYREF
  WCHAR Source[2048]; // [esp+7B48h] [ebp-2164h] BYREF
  WCHAR String[2048]; // [esp+8B48h] [ebp-1164h] BYREF
  _WORD v49[128]; // [esp+9B48h] [ebp-164h] BYREF
  struct tagMSG Msg; // [esp+9C48h] [ebp-64h] BYREF
  SHELLEXECUTEINFOW pExecInfo; // [esp+9C64h] [ebp-48h] BYREF
  int v52; // [esp+9CA8h] [ebp-4h]
  HWND hDlga; // [esp+9CB4h] [ebp+8h]
  int v54; // [esp+9CB8h] [ebp+Ch]
  HWND lpBaseAddressa; // [esp+9CBCh] [ebp+10h]
  HWND lpBaseAddressb; // [esp+9CBCh] [ebp+10h]
  bool lpBaseAddress_3; // [esp+9CBFh] [ebp+13h]
  HWND hWnda; // [esp+9CC0h] [ebp+14h]
  char hWnd_3; // [esp+9CC3h] [ebp+17h]

  if ( sub_4013B0(hDlg, a2, (int)lpBaseAddress, (int)hWnd, L"STARTDLG", 0, 0) )
    return 1;
  if ( a2 == 272 )
  {
    ::hWnd = hDlg;
    ::hDlg = hDlg;
    if ( lParam )
      SendMessageW(hDlg, 0x80u, 1u, lParam);
    if ( dword_4548D4 )
      SendDlgItemMessageW(hDlg, 108, 0x172u, 0, dword_4548D4);
    sub_40E0DC(1, (char)hDlg, 0, hDlg);
    hWnda = GetDlgItem(hDlg, 104);
    SendMessageW(hWnda, 0x435u, 0, (LPARAM)&_ImageBase);
    sub_40B63E(String, 0x800u);
    DlgItem = GetDlgItem(hDlg, 102);
    v34 = DlgItem;
    lpBaseAddressb = DlgItem;
    v35 = &word_4481FA;
    if ( !word_4481FA )
      v35 = String;
    SetWindowTextW(DlgItem, v35);
    sub_40B97D(v34);
    byte_4481E8 = 0;
    sub_40BD46((int)hDlg, Value, (WCHAR **)&dword_4411BC, &dword_4481C4);
    if ( dword_4481C4 )
      sub_40D273(hDlg, (WCHAR *)dword_4411BC, 7);
    if ( !byte_4548E1 )
    {
      v36 = sub_4040A7(0xBFu);
      SetDlgItemTextW(hDlg, 107, v36);
      v37 = sub_4040A7(0xBEu);
      SetDlgItemTextW(hDlg, 1, v37);
    }
    if ( dword_4481C4 )
    {
      sub_40D273(hDlg, (WCHAR *)dword_4411BC, 0);
      if ( ::Destination && !dword_4481F4 )
      {
        sub_40B137(dword_4481C8, dword_4481D8, hWnda, (int)::Destination, 0, 0);
        j___free_base(::Destination);
      }
      if ( dword_4481F4 != 1 )
      {
        SetForegroundWindow(hDlg);
        if ( dword_4481F4 != 1
          && !byte_4481F9
          && !DialogBoxParamW(dword_4481D8, L"LICENSEDLG", 0, (DLGPROC)DialogFunc, 0) )
        {
          goto LABEL_24;
        }
      }
      sub_40D273(hDlg, (WCHAR *)dword_4411BC, 1);
    }
    if ( !byte_4481E8 && !::Destination && !dword_4481F4 )
    {
      v38 = 170;
      Destination[0] = 0;
      do
      {
        if ( (v38 != 170 || byte_4548E1) && (v38 != 171 || !byte_4548E1) )
        {
          wcscat(Destination, L" ");
          v39 = sub_4040A7(v38);
          wcscat(Destination, v39);
        }
        ++v38;
      }
      while ( v38 <= 176 );
      sub_40B137(dword_4481C8, dword_4481D8, hWnda, (int)Destination, 0, 0);
      v34 = lpBaseAddressb;
    }
    if ( dword_4481F4 == 2 )
      EnableWindow(v34, 0);
    if ( byte_4481F0 )
    {
      sub_40136D(hDlg, 103, 0);
      sub_40136D(hDlg, 102, 0);
    }
    if ( dword_4481F4 && !byte_4481E9 )
    {
      if ( dword_4481F4 == 1 )
        SendMessageW(hDlg, 0x111u, 1u, 0);
      else
        PostMessageW(hDlg, 0x111u, 1u, 0);
    }
    if ( byte_4481C3 )
    {
      v40 = sub_4040A7(0x90u);
      SetDlgItemTextW(hDlg, 1, v40);
    }
    return 1;
  }
  if ( a2 != 273 )
    return 0;
  if ( (unsigned __int16)lpBaseAddress == 1 )
  {
    if ( byte_4578F8 )
    {
      v7 = byte_4578F9 != 0;
      byte_4578F9 = byte_4578F9 == 0;
      v8 = sub_4040A7(!v7 + 230);
      SetDlgItemTextW(hDlg, 1, v8);
      while ( byte_4578F9 && !byte_4481E9 && GetMessageW(&Msg, 0, 0, 0) )
      {
        if ( !IsDialogMessageW(hDlg, &Msg) )
        {
          TranslateMessage(&Msg);
          DispatchMessageW(&Msg);
        }
      }
      return 1;
    }
    GetDlgItemTextW(hDlg, 102, Source, 2048);
    if ( byte_4481C2 )
    {
      if ( !byte_4481C3 )
      {
LABEL_25:
        EndDialog(hDlg, 1);
        return 1;
      }
LABEL_24:
      byte_4481E9 = 1;
      goto LABEL_25;
    }
    if ( byte_4481C3 )
    {
      v9 = 1;
      byte_4481E9 = 1;
      goto LABEL_74;
    }
    v10 = GetDlgItem(hDlg, 104);
    v11 = v10;
    if ( !dword_4481E0 )
    {
      SendMessageW(v10, 0xB1u, 0, -1);
      SendMessageW(v11, 0xC2u, 0, (LPARAM)&::String);
    }
    SetFocus(v11);
    if ( byte_4481F0 )
    {
      v12 = sub_4040A7(0xBAu);
    }
    else
    {
      sub_4045C8(String, Source, 2048);
      sub_40DEB7(String, 2048);
      v13 = (char *)sub_4040A7(0xB9u);
      sub_4037C1(Buffer, 0x880u, v13, String);
      v12 = Buffer;
    }
    sub_40DF38(0, (LPARAM)v12);
    if ( !byte_4481F9 )
      sub_40E533((BYTE *)Source);
    hWnd_3 = 0;
    if ( !sub_402447(Source, 0) )
    {
      LastError = GetLastError();
      if ( LastError == 5 || LastError == 3 )
        hWnd_3 = 1;
    }
    v15 = sub_40B9D8(Source);
    lpBaseAddress_3 = v15;
    if ( v15 || (v16 = GetLastError(), v15 = 0, v16 != 5) )
    {
      v17 = hWnd_3;
    }
    else
    {
      v17 = 1;
      hWnd_3 = 1;
    }
    v18 = byte_4481F9;
    if ( !byte_4481F9 )
    {
      if ( !v15 )
        goto LABEL_51;
      TickCount = GetTickCount();
      sub_4037C1((char *)String, 0x800u, (char *)L"__tmp_rar_sfx_access_check_%u", TickCount);
      sub_401BAB(v46);
      v52 = 0;
      lpBaseAddress_3 = sub_401CD2((int)v46, String, 17);
      if ( !lpBaseAddress_3 && GetLastError() == 5 )
        hWnd_3 = 1;
      v52 = -1;
      sub_401BE1(v46);
      v18 = byte_4481F9;
    }
    if ( lpBaseAddress_3 )
    {
      dword_4411B8 = 1;
      sub_40138B(hDlg, 103, 0);
      sub_40138B(hDlg, 102, 0);
      v26 = sub_4040A7(0xE6u);
      SetDlgItemTextW(hDlg, 1, v26);
      sub_40138B(hDlg, 105, 1);
      SetDlgItemTextW(hDlg, 101, &::String);
      v27 = GetDlgItem(hDlg, 101);
      v28 = v27;
      if ( v27 )
      {
        WindowLongW = GetWindowLongW(v27, -16);
        SetWindowLongW(v28, -16, WindowLongW | 0x80);
      }
      sub_40D273(hDlg, (WCHAR *)dword_4411BC, 5);
      sub_40D273(hDlg, (WCHAR *)dword_4411BC, 2);
      byte_4578F8 = 1;
      sub_40E463(hDlg, Value);
      byte_4578F8 = 0;
      sub_40D273(hDlg, (WCHAR *)dword_4411BC, 6);
      if ( !byte_4481E9 && !dword_4481E0 && !hHandle )
        sub_40D273(hDlg, (WCHAR *)dword_4411BC, 4);
      sub_40136D(hDlg, 1, 1u);
      dword_4411B8 = 0;
      v9 = byte_4481E9;
LABEL_74:
      if ( dword_4481E0 > 0 && !v9 )
      {
        byte_4481C2 = 1;
        v30 = sub_4040A7(0x90u);
        SetDlgItemTextW(hDlg, 1, v30);
        if ( dword_44A2FC[0] == 9 )
          v31 = 160;
        else
          v31 = dword_44A2FC[0] != 3 ? 151 : 161;
        v41 = sub_4040A7(0x96u);
        v32 = sub_4040A7(v31);
        sub_40B680(hDlg, v32, v41, 0x30u);
        return 1;
      }
      goto LABEL_25;
    }
    v17 = v18 != 0 ? 0 : hWnd_3;
LABEL_51:
    HIBYTE(hWnd) = v17 == 0;
    if ( !v17 )
      goto LABEL_66;
    GetModuleFileNameW(0, String, 0x800u);
    sub_40416A(byte_44A1FA, v49, 128);
    sub_4037C1(v42, 0x230Cu, (char *)L"-el -s2 \"-d%s\" \"-p%s\" \"-sp%s\"", Source, v49, &word_4491FA);
    pExecInfo.cbSize = 60;
    pExecInfo.fMask = 64;
    pExecInfo.lpFile = String;
    pExecInfo.lpParameters = (LPCWSTR)v42;
    pExecInfo.hwnd = hDlg;
    pExecInfo.lpVerb = L"runas";
    pExecInfo.lpDirectory = asc_422268;
    pExecInfo.nShow = 1;
    pExecInfo.hInstApp = 0;
    FileMappingW = (HWND)CreateFileMappingW((HANDLE)0xFFFFFFFF, 0, 0x8000004u, 0, 0x7002u, L"winrarsfxmappingfile.tmp");
    hDlga = FileMappingW;
    if ( FileMappingW )
    {
      byte_4411C0 = 0;
      CommandLineW = GetCommandLineW();
      if ( CommandLineW )
        sub_4045C8(&word_4411C2, CommandLineW, 0x2000);
      sub_40C0E2(pszPath, 7);
      sub_40C0E2(word_4461C2, 2);
      sub_40C0E2(word_4471C2, 16);
      lpBaseAddressa = (HWND)MapViewOfFile(FileMappingW, 2u, 0, 0, 0);
      memmove(lpBaseAddressa, &byte_4411C0, 0x7002u);
    }
    else
    {
      lpBaseAddressa = hWnd;
    }
    v22 = ShellExecuteExW(&pExecInfo);
    sub_40431E(v49, 128);
    sub_40431E(v42, 8972);
    if ( v22 )
    {
      WaitForInputIdle(pExecInfo.hProcess, 0x2710u);
      v54 = 0;
      v23 = lpBaseAddressa;
      do
      {
        if ( *(_BYTE *)lpBaseAddressa )
          break;
        Sleep(0x64u);
        ++v54;
      }
      while ( v54 < 100 );
      hHandle = pExecInfo.hProcess;
    }
    else
    {
      v23 = lpBaseAddressa;
      HIBYTE(hWnd) = 1;
    }
    if ( hDlga )
    {
      UnmapViewOfFile(v23);
      CloseHandle(hDlga);
    }
    if ( HIBYTE(hWnd) )
    {
LABEL_66:
      v24 = sub_4040A7(0x9Au);
      sub_4037C1((char *)Text, 0xA00u, (char *)L"\"%s\"\n%s", Source, v24);
      sub_401A82(dword_44A2FC, 1);
      v25 = sub_4040A7(0x96u);
      sub_40B680(hDlg, Text, v25, 0x30u);
      ++dword_4481E0;
    }
LABEL_13:
    EndDialog(hDlg, 0);
    return 1;
  }
  if ( (unsigned __int16)lpBaseAddress != 2 )
  {
    if ( (unsigned __int16)lpBaseAddress == 103 )
    {
      v6 = sub_4040A7(0x64u);
      if ( sub_4012F0(hDlg, v6, String) )
        SetDlgItemTextW(hDlg, 102, String);
      return 1;
    }
    return 0;
  }
  byte_4481E9 = 1;
  if ( !dword_4411B8 || !dword_4481E0 )
    goto LABEL_13;
  return 1;
}
// 423200: using guessed type wchar_t aRunas[6];
// 4411B8: using guessed type int dword_4411B8;
// 4411C0: using guessed type char byte_4411C0;
// 4451C2: using guessed type wchar_t pszPath[2048];
// 4461C2: using guessed type wchar_t word_4461C2[2048];
// 4471C2: using guessed type wchar_t word_4471C2[2048];
// 4481C2: using guessed type char byte_4481C2;
// 4481C3: using guessed type char byte_4481C3;
// 4481C4: using guessed type int dword_4481C4;
// 4481E0: using guessed type int dword_4481E0;
// 4481E8: using guessed type char byte_4481E8;
// 4481E9: using guessed type char byte_4481E9;
// 4481F0: using guessed type char byte_4481F0;
// 4481F4: using guessed type int dword_4481F4;
// 4481F9: using guessed type char byte_4481F9;
// 4491FA: using guessed type __int16 word_4491FA;
// 44A2FC: using guessed type int dword_44A2FC[4];
// 4538D0: using guessed type wchar_t Value[2048];
// 4548E1: using guessed type char byte_4548E1;
// 4578F8: using guessed type char byte_4578F8;
// 4578F9: using guessed type char byte_4578F9;
// 40C3C5: using guessed type _DWORD var_3188[1033];
// 40C3C5: using guessed type _WORD var_164[128];

//----- (0040CD67) --------------------------------------------------------
INT_PTR __stdcall sub_40CD67(HWND hDlg, int a2, int a3, wchar_t *a4)
{
  INT_PTR v5; // esi
  HICON v6; // eax
  HWND DlgItem; // eax
  HANDLE FirstFileW; // ebp
  WCHAR *v9; // eax
  WCHAR *v10; // eax
  WCHAR *v11; // eax
  WCHAR *v12; // eax
  int v13; // [esp-4h] [ebp-1A64h]
  struct _FILETIME LocalFileTime; // [esp+10h] [ebp-1A50h] BYREF
  struct _SYSTEMTIME SystemTime; // [esp+18h] [ebp-1A48h] BYREF
  FILETIME FileTime; // [esp+28h] [ebp-1A38h] BYREF
  WCHAR TimeStr[50]; // [esp+30h] [ebp-1A30h] BYREF
  WCHAR DateStr[50]; // [esp+94h] [ebp-19CCh] BYREF
  WCHAR ArgList[50]; // [esp+F8h] [ebp-1968h] BYREF
  struct _WIN32_FIND_DATAW FindFileData; // [esp+15Ch] [ebp-1904h] BYREF
  WCHAR v21[512]; // [esp+3ACh] [ebp-16B4h] BYREF
  SHFILEINFOW psfi; // [esp+7ACh] [ebp-12B4h] BYREF
  WCHAR String[2048]; // [esp+A60h] [ebp-1000h] BYREF

  if ( sub_4013B0(hDlg, a2, a3, (int)a4, L"REPLACEFILEDLG", 0, 0) )
    return 1;
  if ( a2 == 272 )
  {
    DlgItem = GetDlgItem(hDlg, 108);
    SetFocus(DlgItem);
    sub_4045C8(String, a4, 2048);
    sub_40377F(String, (int)String, 2048);
    SetDlgItemTextW(hDlg, 101, String);
    SHGetFileInfoW(String, 0, &psfi, 0x2B4u, 0x100u);
    SendDlgItemMessageW(hDlg, 102, 0x170u, (WPARAM)psfi.hIcon, 0);
    FirstFileW = FindFirstFileW(String, &FindFileData);
    if ( FirstFileW != (HANDLE)-1 )
    {
      FileTimeToLocalFileTime(&FindFileData.ftLastWriteTime, &LocalFileTime);
      FileTimeToSystemTime(&LocalFileTime, &SystemTime);
      GetTimeFormatW(0x400u, 2u, &SystemTime, 0, TimeStr, 50);
      GetDateFormatW(0x400u, 0, &SystemTime, 0, DateStr, 50);
      v9 = sub_4040A7(0x99u);
      sub_4037C1((char *)v21, 0x200u, (char *)L"%s %s %s", v9, DateStr, TimeStr);
      SetDlgItemTextW(hDlg, 106, v21);
      FindClose(FirstFileW);
      if ( (FindFileData.dwFileAttributes & 0x10) == 0 )
      {
        sub_40BBF0(__SPAIR64__(FindFileData.nFileSizeHigh, FindFileData.nFileSizeLow), ArgList, 50);
        v10 = sub_4040A7(0x98u);
        sub_4037C1((char *)v21, 0x200u, (char *)L"%s %s", ArgList, v10);
        SetDlgItemTextW(hDlg, 104, v21);
      }
      SendDlgItemMessageW(hDlg, 103, 0x170u, (WPARAM)psfi.hIcon, 0);
      sub_404DA6((int *)dword_4538C4, &FileTime);
      FileTimeToLocalFileTime(&FileTime, &LocalFileTime);
      FileTimeToSystemTime(&LocalFileTime, &SystemTime);
      GetTimeFormatW(0x400u, 2u, &SystemTime, 0, TimeStr, 50);
      GetDateFormatW(0x400u, 0, &SystemTime, 0, DateStr, 50);
      v11 = sub_4040A7(0x99u);
      sub_4037C1((char *)v21, 0x200u, (char *)L"%s %s %s", v11, DateStr, TimeStr);
      SetDlgItemTextW(hDlg, 107, v21);
      if ( (FindFileData.dwFileAttributes & 0x10) == 0 || *(_QWORD *)&qword_4538C8 )
      {
        sub_40BBF0(*(__int64 *)&qword_4538C8, ArgList, 50);
        v12 = sub_4040A7(0x98u);
        sub_4037C1((char *)v21, 0x200u, (char *)L"%s %s", ArgList, v12);
        SetDlgItemTextW(hDlg, 105, v21);
      }
    }
  }
  else if ( a2 == 273 )
  {
    v5 = 2;
    switch ( (unsigned __int16)a3 )
    {
      case 2u:
        goto LABEL_12;
      case 0x6Cu:
        v5 = 0;
        goto LABEL_14;
      case 0x6Du:
        v5 = 1;
        goto LABEL_14;
      case 0x6Eu:
        v13 = 4;
        goto LABEL_13;
      case 0x6Fu:
LABEL_14:
        v6 = (HICON)SendDlgItemMessageW(hDlg, 102, 0x171u, 0, 0);
        if ( v6 )
          DestroyIcon(v6);
        EndDialog(hDlg, v5);
        return 1;
      case 0x70u:
        v13 = 3;
        goto LABEL_13;
      case 0x71u:
LABEL_12:
        v13 = 6;
LABEL_13:
        v5 = v13;
        goto LABEL_14;
    }
  }
  return 0;
}
// 4538C4: using guessed type int dword_4538C4;
// 40CD67: using guessed type WCHAR ArgList[50];

//----- (0040D104) --------------------------------------------------------
unsigned __int16 *__stdcall sub_40D104(unsigned __int16 *a1)
{
  int v1; // esi
  unsigned __int16 *result; // eax
  unsigned __int16 *i; // edi
  LPWSTR v4; // eax
  char *v5; // eax
  char *v6; // eax
  LPWSTR v7; // eax
  char *v8; // eax
  char *v9; // eax
  __int16 v10[2]; // [esp+8h] [ebp-2000h] BYREF
  wchar_t Source; // [esp+Ch] [ebp-1FFCh] BYREF
  wchar_t v12[4093]; // [esp+Eh] [ebp-1FFAh] BYREF

  v1 = 0;
  result = sub_40439F(a1, (int)v10, 4096);
  for ( i = result; result; i = result )
  {
    if ( ++v1 == 1 || v10[0] != 47 && v10[0] != 45 )
      goto LABEL_22;
    v4 = CharUpperW((LPWSTR)(unsigned __int16)v10[1]) - 34;
    if ( v4 )
    {
      v5 = (char *)v4 - 1;
      if ( !v5 )
      {
        if ( CharUpperW((LPWSTR)Source) == (LPWSTR)76 && !v12[0] )
          byte_4481F9 = 1;
        goto LABEL_22;
      }
      v6 = v5 - 11;
      if ( v6 )
      {
        if ( v6 == (char *)3 )
        {
          v7 = CharUpperW((LPWSTR)Source);
          if ( v7 && (v8 = (char *)v7 - 49) != 0 )
          {
            v9 = v8 - 1;
            if ( v9 )
            {
              if ( v9 == (char *)30 )
                sub_4045C8(word_4491FA, v12, 2048);
              goto LABEL_22;
            }
            dword_4481F4 = 2;
          }
          else
          {
            dword_4481F4 = 1;
          }
          byte_4538C3 = 1;
        }
      }
      else
      {
        sub_4042D3(byte_44A1FA, &Source);
      }
    }
    else
    {
      sub_4045C8(word_4481FA, &Source, 2048);
    }
LABEL_22:
    result = sub_40439F(i, (int)v10, 4096);
  }
  return result;
}
// 4481F4: using guessed type int dword_4481F4;
// 4481F9: using guessed type char byte_4481F9;
// 4481FA: using guessed type wchar_t word_4481FA[2048];
// 4491FA: using guessed type wchar_t word_4491FA[2048];
// 4538C3: using guessed type char byte_4538C3;
// 40D104: using guessed type wchar_t var_1FFA[4093];

//----- (0040D230) --------------------------------------------------------
wchar_t *__stdcall sub_40D230(wchar_t *Source, wchar_t *Destination)
{
  wchar_t *result; // eax
  int v3; // ecx
  int v4; // edx

  result = wcscpy(Destination, Source);
  v3 = 0;
  if ( *Destination )
  {
    result = Destination;
    do
    {
      v4 = *result;
      if ( v4 == 58 || v4 == 92 || v4 == 47 )
        *result = 37;
      result = &Destination[++v3];
    }
    while ( *result );
  }
  return result;
}

//----- (0040D273) --------------------------------------------------------
WCHAR *__stdcall sub_40D273(HWND hWnd, WCHAR *a2, int a3)
{
  WCHAR *result; // eax
  int v4; // ebx
  unsigned __int16 *p_String; // eax
  wchar_t *v6; // esi
  size_t v7; // edi
  int v8; // esi
  size_t v9; // esi
  int v10; // esi
  const wchar_t *v11; // eax
  bool v12; // bl
  char v13; // bh
  WCHAR *v14; // esi
  size_t v15; // eax
  wchar_t *v16; // eax
  WCHAR *v17; // edi
  int v18; // eax
  DWORD v19; // eax
  size_t v20; // esi
  wchar_t *v21; // eax
  HWND DlgItem; // esi
  int v23; // eax
  int v24; // esi
  int v25; // esi
  WCHAR *v26; // eax
  int v27; // eax
  wchar_t *v28; // eax
  wchar_t *v29; // ebx
  wchar_t *v30; // esi
  wchar_t v31; // di
  wchar_t *v32; // eax
  wchar_t *v33; // eax
  wchar_t *v34; // eax
  _WORD *v35; // eax
  int v36; // edx
  wchar_t *v37; // [esp-14h] [ebp-1BCA0h]
  wchar_t *v38; // [esp-10h] [ebp-1BC9Ch]
  wchar_t Source[4096]; // [esp+0h] [ebp-1BC8Ch] BYREF
  wchar_t v40; // [esp+2000h] [ebp-19C8Ch] BYREF
  wchar_t v41[4095]; // [esp+2002h] [ebp-19C8Ah] BYREF
  wchar_t v42[4096]; // [esp+4000h] [ebp-17C8Ch] BYREF
  __int16 v43[4096]; // [esp+6000h] [ebp-15C8Ch] BYREF
  wchar_t v44; // [esp+8000h] [ebp-13C8Ch] BYREF
  WCHAR v45[4096]; // [esp+A000h] [ebp-11C8Ch] BYREF
  WCHAR String1[4096]; // [esp+C000h] [ebp-FC8Ch] BYREF
  wchar_t v47[2048]; // [esp+E000h] [ebp-DC8Ch] BYREF
  wchar_t dwItem1[2048]; // [esp+F000h] [ebp-CC8Ch] BYREF
  wchar_t v49[2048]; // [esp+10000h] [ebp-BC8Ch] BYREF
  wchar_t v50[2048]; // [esp+11000h] [ebp-AC8Ch] BYREF
  wchar_t v51[2048]; // [esp+12000h] [ebp-9C8Ch] BYREF
  HANDLE v52[1026]; // [esp+13000h] [ebp-8C8Ch] BYREF
  WCHAR Buffer[2048]; // [esp+14008h] [ebp-7C84h] BYREF
  wchar_t v54; // [esp+15008h] [ebp-6C84h] BYREF
  wchar_t Str[2047]; // [esp+1500Ah] [ebp-6C82h] BYREF
  WCHAR String; // [esp+16008h] [ebp-5C84h] BYREF
  _WORD v57[4095]; // [esp+1600Ah] [ebp-5C82h] BYREF
  WCHAR FileName[2054]; // [esp+18008h] [ebp-3C84h] BYREF
  char v59; // [esp+19014h] [ebp-2C78h]
  wchar_t pszPath[2048]; // [esp+19050h] [ebp-2C3Ch] BYREF
  wchar_t v61; // [esp+1A050h] [ebp-1C3Ch] BYREF
  wchar_t v62[1023]; // [esp+1A052h] [ebp-1C3Ah] BYREF
  wchar_t Destination[512]; // [esp+1A850h] [ebp-143Ch] BYREF
  wchar_t NewFileName[2048]; // [esp+1AC50h] [ebp-103Ch] BYREF
  struct _SHFILEOPSTRUCTW FileOp; // [esp+1BC50h] [ebp-3Ch] BYREF
  DWORD Type; // [esp+1BC70h] [ebp-1Ch] BYREF
  HKEY phkResult; // [esp+1BC74h] [ebp-18h] BYREF
  DWORD cbData; // [esp+1BC78h] [ebp-14h] BYREF
  _BYTE v69[10]; // [esp+1BC7Eh] [ebp-Eh] BYREF
  int v70; // [esp+1BC88h] [ebp-4h]

  result = (WCHAR *)&loc_421F16;
  if ( a2 )
  {
    result = sub_40BFEA(a2, String1, &String, &v69[1], v69, 4096);
    a2 = result;
    if ( result )
    {
      v4 = a3;
      while ( 1 )
      {
        p_String = &String;
        v6 = Source;
        v7 = 6;
        do
        {
          p_String = sub_40BC7B(p_String, v6);
          v6 += 4096;
          --v7;
        }
        while ( v7 );
        v8 = 0;
        while ( sub_405644(String1, (&lpString2)[v8]) )
        {
          if ( (unsigned int)++v8 >= 0xE )
            goto LABEL_158;
        }
        switch ( v8 )
        {
          case 0:
            if ( v4 != 2 )
              goto LABEL_158;
            sub_40B63E(Buffer, 0x800u);
            sub_403631(Buffer, &String, v47, 2048);
            sub_4028A3(v52);
            v70 = 0;
            sub_4029DD((wchar_t *)v52, v47);
            sub_40241E(FileName);
            if ( !sub_402930((WCHAR *)v52, FileName, 0) )
              goto LABEL_26;
            do
            {
              SetFileAttributesW(FileName, 0);
              if ( v59 )
              {
                sub_403309(Buffer, NewFileName, 0x800u);
                sub_402FFE(NewFileName, 0x800u);
                v9 = wcslen(Buffer);
                if ( (v9 < 4 || v9 <= wcslen(NewFileName)) && sub_40360D(&String) )
                  break;
                FileName[wcslen(FileName) + 1] = 0;
                memset(&FileOp, 0, sizeof(FileOp));
                FileOp.wFunc = 3;
                FileOp.fFlags = 20;
                FileOp.pFrom = FileName;
                SHFileOperationW(&FileOp);
              }
              if ( GetFileAttributesW(FileName) != -1 && !DeleteFileW(FileName) )
              {
                v10 = 0;
                sub_4037C1((char *)NewFileName, 0x800u, (char *)L"%s.%d.tmp", FileName, 0);
                while ( GetFileAttributesW(NewFileName) != -1 )
                  sub_4037C1((char *)NewFileName, 0x800u, (char *)L"%s.%d.tmp", FileName, ++v10);
                if ( MoveFileW(FileName, NewFileName) )
                  MoveFileExW(NewFileName, 0, 4u);
              }
            }
            while ( sub_402930((WCHAR *)v52, FileName, 0) );
LABEL_26:
            v70 = -1;
            sub_4028B9(v52);
            goto LABEL_158;
          case 1:
            if ( !v4 )
            {
              v11 = ::Destination;
              v12 = ::Destination == 0;
              if ( ::Destination )
              {
                wcscat(::Destination, L"<br>");
                v11 = ::Destination;
              }
              v13 = v69[1];
              if ( v69[1] )
              {
                v14 = &String;
              }
              else
              {
                v14 = sub_40C142(&a2);
                v11 = ::Destination;
              }
              if ( !v12 )
                v7 = wcslen(v11);
              v15 = wcslen(v14);
              v16 = (wchar_t *)realloc(::Destination, 2 * (v7 + v15) + 10);
              if ( v16 )
              {
                ::Destination = v16;
                if ( v12 )
                  *v16 = 0;
                wcscat(v16, v14);
              }
              if ( !v13 )
                j___free_base(v14);
            }
            goto LABEL_158;
          case 2:
            if ( !v4 )
              SetWindowTextW(hWnd, &String);
            goto LABEL_158;
          case 3:
            if ( v4 || word_4481FA )
              goto LABEL_158;
            v17 = &String;
            NewFileName[0] = 0;
            if ( String == 34 )
              v17 = v57;
            if ( wcslen(v17) >= 0x800 )
              goto LABEL_158;
            v18 = *v17;
            if ( v18 == 46 && v17[1] == 92 )
            {
              v17 += 2;
              if ( !*v17 )
                goto LABEL_158;
LABEL_64:
              wcscpy(NewFileName, v17);
              goto LABEL_65;
            }
            if ( (_WORD)v18 == 92 || (_WORD)v18 && v17[1] == 58 )
              goto LABEL_64;
            if ( !RegOpenKeyExW(HKEY_LOCAL_MACHINE, L"Software\\Microsoft\\Windows\\CurrentVersion", 0, 1u, &phkResult) )
            {
              cbData = 4096;
              RegQueryValueExW(phkResult, L"ProgramFilesDir", 0, &Type, (LPBYTE)NewFileName, &cbData);
              RegCloseKey(phkResult);
              v19 = cbData >> 1;
              if ( cbData >> 1 >= 0x7FF )
                v19 = 2047;
              NewFileName[v19] = 0;
            }
            if ( NewFileName[0] && Destination[wcslen(NewFileName) + 511] != 92 )
              wcscat(NewFileName, L"\\");
            v20 = wcslen(v17);
            if ( wcslen(NewFileName) + v20 < 0x7FF )
              wcscat(NewFileName, v17);
LABEL_65:
            v21 = wcsrchr(NewFileName, 0x22u);
            if ( v21 && !v21[1] )
              *v21 = 0;
            wcscpy(&::String1, NewFileName);
            sub_40BE95(NewFileName, 2048);
            DlgItem = GetDlgItem(hWnd, 102);
            SetWindowTextW(DlgItem, NewFileName);
            SendMessageW(DlgItem, 0x143u, 0, (LPARAM)&::String1);
            if ( wcscmp(&::String1, NewFileName) )
              SendMessageW(DlgItem, 0x143u, 0, (LPARAM)NewFileName);
            goto LABEL_158;
          case 4:
            if ( dword_4481F4 != 1 )
            {
              if ( sub_404484(String) )
                dword_4481F4 = String - 48;
              else
                dword_4481F4 = 2;
            }
            goto LABEL_158;
          case 5:
            if ( !String )
              goto LABEL_81;
            if ( String == 48 )
            {
              byte_4481E4 = 0;
LABEL_80:
              byte_4481E5 = 0;
              goto LABEL_158;
            }
            if ( String != 49 )
            {
              if ( String != 50 )
                goto LABEL_158;
              byte_4481E4 = 1;
              goto LABEL_80;
            }
LABEL_81:
            byte_4481E4 = 0;
            byte_4481E5 = 1;
LABEL_158:
            result = sub_40BFEA(a2, String1, &String, &v69[1], v69, 4096);
            v4 = a3;
            a2 = result;
            if ( !result )
              return result;
            break;
          case 6:
            if ( v4 == 4 && wcscmp(&String, L"<>") )
              sub_40E1D2(hWnd, &String, 0);
            goto LABEL_90;
          case 7:
            if ( v4 != 1 )
              goto LABEL_109;
            GetTempPathW(0x800u, Buffer);
            sub_402FFE(Buffer, 0x800u);
            v24 = 0;
            sub_4037C1((char *)NewFileName, 0x800u, (char *)L"%s%s%d", Buffer, off_42B038, 0);
            while ( GetFileAttributesW(NewFileName) != -1 )
              sub_4037C1((char *)NewFileName, 0x800u, (char *)L"%s%s%d", Buffer, off_42B038, ++v24);
            SetDlgItemTextW(hWnd, 102, NewFileName);
            if ( !String || byte_4538C3 )
              goto LABEL_158;
            Destination[0] = 0;
            if ( wcschr(&String, 0x2Cu) )
              goto LABEL_105;
            v25 = 0;
            if ( !String )
              goto LABEL_105;
            v26 = &String;
            while ( *v26 != 64 )
            {
              v26 = &v57[v25++];
              if ( !*v26 )
                goto LABEL_105;
            }
            wcscpy(Destination, &v57[v25]);
            v57[v25 - 1] = 0;
LABEL_105:
            if ( !Destination[0] )
            {
              wcscpy(&String, Source);
              wcscpy(Destination, &v40);
            }
            sub_40BAAA(&String);
            v57[2047] = 0;
            if ( sub_40B680(hWnd, &String, Destination, 0x24u) != 6 )
            {
              byte_4538C2 = 1;
              byte_4481E9 = 1;
              EndDialog(hWnd, 1);
LABEL_109:
              if ( v4 == 7 )
              {
                if ( !dword_4481F4 )
                  dword_4481F4 = 2;
                byte_4481F0 = 1;
              }
            }
            goto LABEL_158;
          case 8:
            if ( v4 == 3 )
            {
              if ( String )
                SetWindowTextW(hWnd, &String);
              dword_4548DC = sub_40C142(&a2);
            }
            byte_4548E0 = 1;
            goto LABEL_158;
          case 9:
            if ( v4 == 5 )
              sub_40E1D2(hWnd, &String, 1);
LABEL_90:
            byte_4548E1 = 1;
            goto LABEL_158;
          case 10:
            if ( v4 == 6 )
            {
              pszPath[0] = 0;
              v27 = toupper(Source[0]);
              if ( v27 == 80 )
              {
                sub_4045C8(pszPath, &word_4461C2, 2048);
                cbData = 2;
              }
              else if ( v27 == 84 )
              {
                sub_4045C8(pszPath, &::pszPath, 2048);
                cbData = 7;
              }
              else
              {
                sub_4045C8(pszPath, &word_4471C2, 2048);
                cbData = 16;
              }
              v51[0] = 0;
              v61 = 0;
              wcscpy(&v54, &v40);
              if ( v54 == 34 )
              {
                wcscpy(&v54, v41);
                v28 = wcschr(Str, 0x22u);
                if ( v28 )
                {
                  *v28 = 0;
                  wcscpy(&v61, v28 + 1);
                }
              }
              else if ( !sub_402578(&v54) )
              {
                v29 = 0;
                v30 = &v54;
                if ( v54 )
                {
                  do
                  {
                    if ( *v30 == 32 || *v30 == 47 )
                    {
                      v31 = *v30;
                      *v30 = 0;
                      if ( sub_402578(&v54) )
                      {
                        v29 = v30;
                        if ( v31 == 47 )
                        {
                          v61 = 47;
                          wcscpy(v62, v30 + 1);
                        }
                        else
                        {
                          do
                            ++v30;
                          while ( *v30 == 32 );
                          wcscpy(&v61, v30);
                        }
                        *v29 = v31;
                      }
                      else
                      {
                        *v30 = v31;
                      }
                    }
                    ++v30;
                  }
                  while ( *v30 );
                  if ( v29 )
                    *v29 = 0;
                }
              }
              if ( v45[0] )
                sub_40302E(v45, v51, 2048);
              sub_40302E(&v54, v49, 2048);
              if ( !pszPath[0] )
                sub_40C0E2(pszPath, cbData);
              sub_402FFE(pszPath, 0x800u);
              if ( v42[0] )
              {
                sub_40459C(pszPath, v42, 2048);
                sub_402FFE(pszPath, 0x800u);
              }
              wcscpy(dwItem1, pszPath);
              v32 = &v44;
              if ( !v44 )
                v32 = &v40;
              v33 = sub_4036A6(v32);
              sub_40459C(pszPath, v33, 2048);
              v34 = sub_4032A5(pszPath);
              if ( !v34 || sub_405644(v34, L".lnk") )
                sub_40459C(pszPath, (wchar_t *)L".lnk", 2048);
              sub_402447(pszPath, 1);
              wcscpy(v50, v49);
              sub_4036E9(v50);
              v38 = v61 != 0 ? &v61 : 0;
              v37 = v51[0] != 0 ? v51 : 0;
              v35 = sub_40BB98(v43);
              sub_40B4BF(0, (int)v49, (int)pszPath, v36, (int)v35, (int)v37, (int)v38);
              if ( dwItem1[0] )
                SHChangeNotify(4096, 5u, dwItem1, 0);
            }
            goto LABEL_158;
          case 11:
            if ( v4 == 7 )
              byte_4481F8 = 1;
            goto LABEL_158;
          case 12:
            v23 = toupper(String);
            if ( v23 == 70 )
            {
              byte_4481E6 = 1;
            }
            else if ( v23 == 85 )
            {
              byte_4481E7 = 1;
            }
            else
            {
              byte_4481E6 = 0;
              byte_4481E7 = 0;
            }
            goto LABEL_158;
          case 13:
            byte_4548E2 = 1;
            goto LABEL_158;
          default:
            goto LABEL_158;
        }
      }
    }
  }
  return result;
}
// 40DE07: variable 'v36' is possibly undefined
// 4481E4: using guessed type char byte_4481E4;
// 4481E5: using guessed type char byte_4481E5;
// 4481E6: using guessed type char byte_4481E6;
// 4481E7: using guessed type char byte_4481E7;
// 4481E9: using guessed type char byte_4481E9;
// 4481F0: using guessed type char byte_4481F0;
// 4481F4: using guessed type int dword_4481F4;
// 4481F8: using guessed type char byte_4481F8;
// 4538C2: using guessed type char byte_4538C2;
// 4538C3: using guessed type char byte_4538C3;
// 4548E0: using guessed type char byte_4548E0;
// 4548E1: using guessed type char byte_4548E1;
// 4548E2: using guessed type char byte_4548E2;
// 40D273: using guessed type _BYTE var_E[10];
// 40D273: using guessed type HANDLE var_8C8C[1026];
// 40D273: using guessed type wchar_t NewFileName[2048];
// 40D273: using guessed type wchar_t var_19C8A[4095];
// 40D273: using guessed type wchar_t Str[2047];
// 40D273: using guessed type wchar_t var_1C3A[1023];
// 40D273: using guessed type WCHAR var_11C8C[4096];
// 40D273: using guessed type wchar_t var_17C8C[4096];
// 40D273: using guessed type __int16 var_15C8C[4096];

//----- (0040DEB7) --------------------------------------------------------
wchar_t *__stdcall sub_40DEB7(wchar_t *Str, int a2)
{
  size_t v2; // edi
  wchar_t *v3; // esi

  if ( wcschr(Str, 0x20u) && (*Str != 34 || *sub_40368A(Str) != 34) )
  {
    v2 = wcslen(Str);
    v3 = (wchar_t *)unknown_libname_4((unsigned __int64)(v2 + 3) >> 31 != 0 ? -1 : 2 * (v2 + 3));
    wcscpy(v3 + 1, Str);
    v3[v2 + 1] = 34;
    *v3 = 34;
    v3[v2 + 2] = 0;
    sub_4045C8(Str, v3, a2);
    j_j_j___free_base(v3);
  }
  return Str;
}
// 40FAA5: using guessed type int __cdecl unknown_libname_4(_DWORD);

//----- (0040DF38) --------------------------------------------------------
LRESULT __stdcall sub_40DF38(char a1, LPARAM a2)
{
  HWND DlgItem; // esi
  LPARAM lParam; // [esp+10h] [ebp-5Ch] BYREF
  int v5; // [esp+14h] [ebp-58h]
  unsigned int v6; // [esp+18h] [ebp-54h]
  int v7; // [esp+24h] [ebp-48h]
  char v8; // [esp+29h] [ebp-43h]

  DlgItem = GetDlgItem(hDlg, 104);
  if ( !byte_4481E8 )
  {
    sub_40A7AC((HWND *)dword_4481C8);
    ShowWindow(DlgItem, 5);
    SendMessageW(DlgItem, 0xB1u, 0, -1);
    SendMessageW(DlgItem, 0xC2u, 0, (LPARAM)&String);
    byte_4481E8 = 1;
  }
  SendMessageW(DlgItem, 0xB1u, 0x5F5E100u, 100000000);
  lParam = 92;
  SendMessageW(DlgItem, 0x43Au, 0, (LPARAM)&lParam);
  v8 = 0;
  v5 = 1;
  if ( a1 )
  {
    v7 = 160;
    v5 = 1073741825;
    v6 = v6 & 0xBFFFFFFE | 1;
  }
  SendMessageW(DlgItem, 0x444u, 1u, (LPARAM)&lParam);
  SendMessageW(DlgItem, 0xC2u, 0, a2);
  SendMessageW(DlgItem, 0xB1u, 0x5F5E100u, 100000000);
  if ( a1 )
  {
    v6 = v6 & 0xBFFFFFFE | 0x40000000;
    SendMessageW(DlgItem, 0x444u, 1u, (LPARAM)&lParam);
  }
  return SendMessageW(DlgItem, 0xC2u, 0, (LPARAM)L"\r\n");
}
// 4481E8: using guessed type char byte_4481E8;

//----- (0040E04A) --------------------------------------------------------
INT_PTR __stdcall sub_40E04A(HWND hDlg, int a2, int a3, WCHAR *lpString)
{
  if ( !sub_4013B0(hDlg, a2, a3, (int)lpString, L"RENAMEDLG", 0, 0) )
  {
    if ( a2 == 272 )
    {
      ::lpString = lpString;
      SetDlgItemTextW(hDlg, 101, lpString);
      SetDlgItemTextW(hDlg, 102, ::lpString);
    }
    else
    {
      if ( a2 != 273 )
        return 0;
      if ( (unsigned __int16)a3 == 1 )
      {
        GetDlgItemTextW(hDlg, 102, ::lpString, 2048);
        EndDialog(hDlg, 1);
      }
      else
      {
        if ( (unsigned __int16)a3 != 2 )
          return 0;
        EndDialog(hDlg, 0);
      }
    }
  }
  return 1;
}

//----- (0040E0DC) --------------------------------------------------------
HWND __userpurge sub_40E0DC@<eax>(int a1@<ebx>, char a2@<dil>, int a3@<esi>, HWND hWnd)
{
  HWND result; // eax
  HWND v5; // esi
  int v6; // ebx
  void *v7; // edi
  int v8; // eax
  HBITMAP v9; // eax
  int v10; // [esp-10h] [ebp-1028h]
  char v11; // [esp-Ch] [ebp-1024h]
  int v12; // [esp-8h] [ebp-1020h]
  int v13; // [esp-4h] [ebp-101Ch]
  WCHAR ClassName[2048]; // [esp+0h] [ebp-1018h] BYREF
  char pv[4]; // [esp+1000h] [ebp-18h] BYREF
  int v16; // [esp+1004h] [ebp-14h]
  int v17; // [esp+1008h] [ebp-10h]
  int savedregs; // [esp+1018h] [ebp+0h] BYREF
  HWND hWnda; // [esp+1020h] [ebp+8h]

  result = (HWND)sub_40B599();
  if ( (_BYTE)result )
  {
    v13 = a1;
    v12 = a3;
    result = GetWindow(hWnd, 5u);
    v5 = result;
    v6 = 0;
    hWnda = result;
    if ( result )
    {
      v11 = a2;
      do
      {
        if ( v6 >= 512 )
          break;
        GetClassNameW(v5, ClassName, 2048);
        if ( !sub_405644(ClassName, L"STATIC") && (GetWindowLongW(v5, -16) & 0x1F) == 14 )
        {
          v7 = (void *)SendMessageW(v5, 0x173u, 0, 0);
          if ( v7 )
          {
            GetObjectW(v7, 24, pv);
            v10 = sub_40B5FB(v17);
            v8 = sub_40B5B8(v16);
            v9 = sub_40B6A8(v6, (int)&savedregs, (int)v7, (int)v5, v7, v8, v10, v11, v12, v13);
            SendMessageW(v5, 0x172u, 0, (LPARAM)v9);
            if ( v7 != (void *)dword_4548D4 )
              DeleteObject(v7);
          }
        }
        result = GetWindow(v5, 2u);
        v5 = result;
        if ( result == hWnda )
          break;
        ++v6;
      }
      while ( result );
    }
  }
  return result;
}
// 40E0DC: could not find valid save-restore pair for ebx
// 40E0DC: could not find valid save-restore pair for edi
// 40E0DC: could not find valid save-restore pair for esi
// 40E18D: variable 'v11' is possibly undefined
// 40E18D: variable 'v12' is possibly undefined
// 40E18D: variable 'v13' is possibly undefined
// 40E0DC: using guessed type char pv[4];

//----- (0040E1D2) --------------------------------------------------------
void __stdcall sub_40E1D2(HWND hWnd, wchar_t *String, char a3)
{
  char v3; // bl
  wchar_t v4; // cx
  WCHAR *v5; // edx
  int v6; // eax
  wchar_t *v7; // ecx
  const WCHAR *lpParameters; // eax
  wchar_t *v9; // eax
  const WCHAR *v10; // esi
  char v11; // al
  DWORD ExitCode; // [esp+8h] [ebp-1040h] BYREF
  SHELLEXECUTEINFOW pExecInfo; // [esp+Ch] [ebp-103Ch] BYREF
  wchar_t Destination[2048]; // [esp+48h] [ebp-1000h] BYREF

  v3 = 0;
  if ( *String && wcslen(String) < 0x7F6 )
  {
    memset(&pExecInfo, 0, sizeof(pExecInfo));
    v4 = *String;
    v5 = String + 1;
    pExecInfo.cbSize = 60;
    pExecInfo.fMask = 448;
    if ( v4 != 34 )
      v5 = String;
    pExecInfo.lpFile = v5;
    v6 = 0;
    if ( v4 )
    {
      v7 = String;
      while ( 1 )
      {
        if ( *v7 == 34 )
        {
          while ( String[++v6] )
          {
            if ( String[v6] == 34 )
            {
              String[v6] = 32;
              break;
            }
          }
        }
        if ( String[v6] == 32 )
          break;
        if ( String[v6 + 1] == 47 )
        {
          if ( String[v6] != 32 )
            goto LABEL_45;
          break;
        }
        v7 = &String[++v6];
        if ( !*v7 )
          goto LABEL_16;
      }
      String[v6] = 0;
LABEL_45:
      lpParameters = &String[v6 + 1];
      pExecInfo.lpParameters = lpParameters;
    }
    else
    {
LABEL_16:
      lpParameters = pExecInfo.lpParameters;
    }
    if ( (!lpParameters || !*lpParameters) && !a3 && word_4491FA )
      pExecInfo.lpParameters = (LPCWSTR)&word_4491FA;
    pExecInfo.nShow = 1;
    v9 = sub_4032A5(v5);
    v10 = v9;
    if ( v9 && !sub_405644(v9, L".inf") )
      pExecInfo.lpVerb = L"Install";
    if ( sub_402578((WCHAR *)pExecInfo.lpFile) )
    {
      sub_40302E((WCHAR *)pExecInfo.lpFile, Destination, 2048);
      pExecInfo.lpFile = Destination;
    }
    if ( ShellExecuteExW(&pExecInfo) )
    {
      if ( byte_4481F0 || a3 || byte_4548E2 )
      {
        if ( hWnd && IsWindowVisible(hWnd) )
        {
          ShowWindow(hWnd, 0);
          v3 = 1;
        }
        WaitForInputIdle(pExecInfo.hProcess, 0x7D0u);
        sub_40E652(pExecInfo.hProcess);
        if ( byte_4548E2 && GetExitCodeProcess(pExecInfo.hProcess, &ExitCode) && ExitCode + 1000 > dword_4548E4 )
          dword_4548E4 = ExitCode + 1000;
      }
      CloseHandle(pExecInfo.hProcess);
      if ( v10 && !sub_405644(v10, L".exe") )
      {
        v11 = a3;
      }
      else
      {
        v11 = a3;
        if ( byte_4481F0 && !a3 )
          dwMilliseconds = 7000;
      }
      if ( v3 )
      {
        if ( v11 )
          ShowWindow(hWnd, 1);
      }
    }
  }
}
// 4233BC: using guessed type wchar_t aInstall[8];
// 4481F0: using guessed type char byte_4481F0;
// 4491FA: using guessed type __int16 word_4491FA;
// 4548E2: using guessed type char byte_4548E2;
// 4548E4: using guessed type int dword_4548E4;

//----- (0040E404) --------------------------------------------------------
LRESULT __stdcall sub_40E404(HWND hWnd)
{
  LRESULT result; // eax

  dword_4411B8 = 0;
  byte_4481C2 = 1;
  byte_4481C3 = 1;
  ShowWindow(hWnd, 1);
  result = sub_40136D(hWnd, 2, 0);
  if ( !dword_4481C4 && !byte_4481E8 || !dword_4481E0 )
    return SendMessageW(hWnd, 0x111u, 1u, 0);
  return result;
}
// 4411B8: using guessed type int dword_4411B8;
// 4481C2: using guessed type char byte_4481C2;
// 4481C3: using guessed type char byte_4481C3;
// 4481C4: using guessed type int dword_4481C4;
// 4481E0: using guessed type int dword_4481E0;
// 4481E8: using guessed type char byte_4481E8;

//----- (0040E463) --------------------------------------------------------
int __stdcall sub_40E463(HWND hWnd, wchar_t *Source)
{
  _DWORD v3[7]; // [esp+0h] [ebp-1Ch] BYREF

  v3[3] = v3;
  wcscpy(&word_4515D2, L"X");
  sub_40468A(dword_4535F4, (wchar_t *)L"*");
  wcscpy(&word_4525F2, Source);
  sub_401472(word_44A320, Source);
  v3[6] = 0;
  dword_4505B4 = 4;
  dword_4505B0 = 4;
  dword_4505AC = 4;
  byte_44F473 = byte_4481E6;
  byte_44F4A8 = 1;
  byte_44F4AB = 1;
  byte_44F474 = byte_4481E7;
  return sub_40A446();
}
// 4481E6: using guessed type char byte_4481E6;
// 4481E7: using guessed type char byte_4481E7;
// 44A320: using guessed type wchar_t word_44A320[8210];
// 44F473: using guessed type char byte_44F473;
// 44F474: using guessed type char byte_44F474;
// 44F4A8: using guessed type char byte_44F4A8;
// 44F4AB: using guessed type char byte_44F4AB;
// 4505AC: using guessed type int dword_4505AC;
// 4505B0: using guessed type int dword_4505B0;
// 4505B4: using guessed type int dword_4505B4;
// 4535F4: using guessed type _DWORD dword_4535F4[115];

//----- (0040E533) --------------------------------------------------------
void __stdcall sub_40E533(BYTE *lpData)
{
  size_t v1; // eax
  WCHAR ValueName[2048]; // [esp+0h] [ebp-1008h] BYREF
  DWORD dwDisposition; // [esp+1000h] [ebp-8h] BYREF
  HKEY phkResult; // [esp+1004h] [ebp-4h] BYREF

  if ( byte_4481F8 && String1 )
  {
    sub_40D230(&String1, ValueName);
    if ( !RegCreateKeyExW(HKEY_CURRENT_USER, L"Software\\WinRAR SFX", 0, 0, 0, 0x20006u, 0, &phkResult, &dwDisposition) )
    {
      v1 = wcslen((const wchar_t *)lpData);
      RegSetValueExW(phkResult, ValueName, 0, 1u, lpData, 2 * v1 + 2);
      RegCloseKey(phkResult);
    }
  }
}
// 4481F8: using guessed type char byte_4481F8;

//----- (0040E5C3) --------------------------------------------------------
unsigned __int16 *__stdcall sub_40E5C3(WCHAR *lpValue)
{
  unsigned __int16 *result; // eax
  const WCHAR *v2; // esi
  bool i; // al
  char v4[8192]; // [esp+4h] [ebp-2000h] BYREF

  SetEnvironmentVariableW(L"sfxcmd", lpValue);
  result = sub_40439F(lpValue, (int)v4, 4096);
  v2 = result;
  if ( result )
  {
    for ( i = sub_404496(*result); i; i = sub_404496(*v2) )
      ++v2;
    return (unsigned __int16 *)SetEnvironmentVariableW(L"sfxpar", v2);
  }
  return result;
}
// 40E5C3: using guessed type char var_2000[8192];

//----- (0040E622) --------------------------------------------------------
unsigned int __stdcall sub_40E622(unsigned int a1, unsigned int a2)
{
  unsigned int v2; // eax
  unsigned int v3; // ecx

  v2 = a1;
  v3 = a2;
  if ( a1 > 0xF4240 )
  {
    v2 = a1 >> 8;
    v3 = a2 >> 8;
  }
  if ( !v3 )
    return 0;
  if ( v3 >= v2 )
    return 100 * v2 / v3;
  return 100;
}

//----- (0040E652) --------------------------------------------------------
DWORD __stdcall sub_40E652(HANDLE hHandle)
{
  DWORD result; // eax
  struct tagMSG Msg; // [esp+4h] [ebp-1Ch] BYREF

  for ( result = WaitForSingleObject(hHandle, 0xAu); result == 258; result = WaitForSingleObject(hHandle, 0xAu) )
    PeekMessageW(&Msg, 0, 0, 0, 1u);
  return result;
}

//----- (0040E693) --------------------------------------------------------
INT_PTR __stdcall sub_40E693(LPARAM dwInitParam, int a2, __int64 a3, int a4, int a5)
{
  INT_PTR v6; // esi

  *(_QWORD *)&qword_4538C8 = a3;
  dword_4538C4 = a4;
  if ( byte_4481E5 )
    return 0;
  if ( byte_4481E4 )
    return 1;
  do
    v6 = DialogBoxParamW(dword_4481D8, L"REPLACEFILEDLG", hDlg, (DLGPROC)sub_40CD67, dwInitParam);
  while ( v6 == 4 && !DialogBoxParamW(hInstance, L"RENAMEDLG", hWnd, (DLGPROC)sub_40E04A, dwInitParam) );
  return v6;
}
// 4481E4: using guessed type char byte_4481E4;
// 4481E5: using guessed type char byte_4481E5;
// 4538C4: using guessed type int dword_4538C4;

//----- (0040E723) --------------------------------------------------------
LRESULT __stdcall sub_40E723(int a1, int a2, int a3, int a4, unsigned int a5, int a6, unsigned int a7, int a8)
{
  unsigned int v8; // eax

  v8 = sub_40E622(a5, a7);
  SendDlgItemMessageW(hDlg, 106, 0x402u, v8, 0);
  return sub_40C21C();
}

//----- (0040E74E) --------------------------------------------------------
char __stdcall sub_40E74E(int a1, LPCCH lpMultiByteStr, wchar_t *Source, char *a4)
{
  char *v4; // ebx
  char *v5; // esi
  char *v6; // edi
  HWND v7; // esi
  wchar_t dwInitParam[2048]; // [esp+Ch] [ebp-1000h] BYREF

  if ( byte_44A2FA )
  {
    v4 = a4;
    v5 = byte_44A1FA;
    v6 = a4;
LABEL_11:
    qmemcpy(v6, v5, 0x102u);
    return v4[256];
  }
  v7 = hDlg;
  if ( a1 == 2 )
    v7 = IsWindowVisible(hDlg) ? v7 : 0;
  sub_403396(lpMultiByteStr, Source, dwInitParam, 0x800u);
  if ( byte_4538C0 || DialogBoxParamW(dword_4481D8, L"GETPASSWORD1", v7, (DLGPROC)sub_40BF44, (LPARAM)dwInitParam) )
  {
    v4 = a4;
    qmemcpy(a4, byte_4537C0, 0x102u);
  }
  else
  {
    v4 = a4;
    sub_4042D3(a4, (wchar_t *)&String);
    byte_4481E9 = 1;
  }
  if ( v4[256] )
  {
    v5 = v4;
    v6 = byte_44A1FA;
    goto LABEL_11;
  }
  return v4[256];
}
// 4481E9: using guessed type char byte_4481E9;
// 44A2FA: using guessed type char byte_44A2FA;
// 4538C0: using guessed type char byte_4538C0;
// 40E74E: using guessed type wchar_t dwInitParam[2048];

//----- (0040E820) --------------------------------------------------------
LRESULT __stdcall sub_40E820(char a1, wchar_t *String)
{
  char *v2; // eax
  wchar_t *v4; // [esp-4h] [ebp-1408h]
  char Buffer[5120]; // [esp+4h] [ebp-1400h] BYREF

  v4 = sub_4036A6(String);
  v2 = (char *)sub_4040A7(a1 == 84 ? 523 : 141);
  sub_4037C1(Buffer, 0xA00u, v2, v4);
  return sub_40DF38(0, (LPARAM)Buffer);
}

//----- (0040E87D) --------------------------------------------------------
BOOL __stdcall sub_40E87D(int ArgList, int a2, int a3, char a4)
{
  char *v4; // eax
  WCHAR String[2560]; // [esp+0h] [ebp-1400h] BYREF

  if ( a4 )
    v4 = (char *)sub_4040A7(0x66u);
  else
    v4 = (char *)sub_4040A7(0x65u);
  sub_4037C1((char *)String, 0xA00u, v4, ArgList);
  SetDlgItemTextW(hDlg, 101, String);
  sub_40C21C();
  return byte_4481E9 == 0;
}
// 4481E9: using guessed type char byte_4481E9;
// 40E87D: using guessed type _DWORD ArgList;

//----- (0040E8DE) --------------------------------------------------------
int __stdcall WinMain(HINSTANCE hInstance, HINSTANCE hPrevInstance, LPSTR lpCmdLine, int nShowCmd)
{
  unsigned __int16 *CommandLineW; // eax
  WCHAR *v5; // esi
  HANDLE v6; // eax
  void *v7; // edi
  _BYTE *v8; // eax
  _BYTE *v9; // esi
  HMODULE ModuleHandleW; // esi
  int result; // eax
  HMODULE v12; // [esp+0h] [ebp-C0h] BYREF
  struct _SYSTEMTIME SystemTime; // [esp+4h] [ebp-BCh] BYREF
  _DWORD v14[9]; // [esp+14h] [ebp-ACh] BYREF
  _DWORD v15[9]; // [esp+38h] [ebp-88h] BYREF
  WCHAR Value[50]; // [esp+5Ch] [ebp-64h] BYREF

  sub_4047F4(1);
  OleInitialize(0);
  sub_4053BF(byte_42FAA8);
  memset(&byte_4411C0, 0, 0x7002u);
  CommandLineW = GetCommandLineW();
  v5 = CommandLineW;
  if ( CommandLineW )
  {
    sub_40D104(CommandLineW);
    if ( byte_4481F9 )
    {
      v6 = OpenFileMappingW(0xF001Fu, 0, L"winrarsfxmappingfile.tmp");
      v7 = v6;
      if ( v6 )
      {
        v8 = MapViewOfFile(v6, 0xF001Fu, 0, 0, 0x7002u);
        v9 = v8;
        if ( v8 )
        {
          memmove(&byte_4411C0, v8, 0x7002u);
          *v9 = 1;
          sub_40E5C3(word_4411C2);
        }
        UnmapViewOfFile(v9);
      }
      CloseHandle(v7);
    }
    else
    {
      sub_40E5C3(v5);
    }
  }
  GetModuleFileNameW(0, ::Value, 0x800u);
  SetEnvironmentVariableW(L"sfxname", ::Value);
  GetLocalTime(&SystemTime);
  sub_4037C1(
    (char *)Value,
    0x32u,
    (char *)L"%4d-%02d-%02d-%02d-%02d-%02d-%03d",
    SystemTime.wYear,
    SystemTime.wMonth,
    SystemTime.wDay,
    SystemTime.wHour,
    SystemTime.wMinute,
    SystemTime.wSecond,
    SystemTime.wMilliseconds);
  SetEnvironmentVariableW(L"sfxstime", Value);
  ModuleHandleW = GetModuleHandleW(0);
  dword_4481D8 = ModuleHandleW;
  ::hInstance = ModuleHandleW;
  lParam = (LPARAM)LoadIconW(ModuleHandleW, (LPCWSTR)0x64);
  dword_4548D4 = (LPARAM)LoadBitmapW(::hInstance, (LPCWSTR)0x65);
  sub_40B9EB(&v12);
  sub_403A07((int)dword_44A30C, ::Value);
  sub_40A6A2(v15);
  sub_40A6A2(v14);
  dword_4481C8 = v15;
  lpParam = v14;
  DialogBoxParamW(ModuleHandleW, L"STARTDLG", 0, (DLGPROC)sub_40C3C5, 0);
  lpParam = 0;
  dword_4481C8 = 0;
  sub_40A722(v14);
  sub_40A722(v15);
  sub_40BA31();
  if ( dwMilliseconds )
    Sleep(dwMilliseconds);
  if ( byte_4481F0 )
    sub_40BAFF();
  sub_404157(byte_4537C0);
  if ( dword_4481C4 )
    j___free_base(dword_4411BC);
  DeleteObject((HGDIOBJ)lParam);
  if ( dword_4548D4 )
    DeleteObject((HGDIOBJ)dword_4548D4);
  if ( !dword_44A2FC[0] && byte_4481E9 )
    sub_401A82(dword_44A2FC, 255);
  byte_4481E9 = 1;
  if ( hHandle )
  {
    sub_40E652(hHandle);
    CloseHandle(hHandle);
  }
  OleUninitialize();
  result = dword_4548E4;
  if ( !dword_4548E4 )
    return dword_44A2FC[0];
  return result;
}
// 42FAA8: using guessed type _BYTE byte_42FAA8[264];
// 4411C0: using guessed type char byte_4411C0;
// 4411C2: using guessed type wchar_t word_4411C2[8192];
// 4481C4: using guessed type int dword_4481C4;
// 4481E9: using guessed type char byte_4481E9;
// 4481F0: using guessed type char byte_4481F0;
// 4481F9: using guessed type char byte_4481F9;
// 44A2FC: using guessed type int dword_44A2FC[4];
// 44A30C: using guessed type _DWORD dword_44A30C[4];
// 4538D0: using guessed type wchar_t Value[2048];
// 4548E4: using guessed type int dword_4548E4;
// 40E8DE: using guessed type _DWORD var_88[9];
// 40E8DE: using guessed type _DWORD var_AC[9];

//----- (0040EF0C) --------------------------------------------------------
void sub_40EF0C()
{
  ;
}

//----- (0040EF3F) --------------------------------------------------------
bool sub_40EF3F()
{
  HMODULE ModuleHandleW; // eax
  signed __int32 v2; // esi
  void (__stdcall *AcquireSRWLockExclusive)(PSRWLOCK); // eax
  void (__stdcall *ReleaseSRWLockExclusive)(PSRWLOCK); // eax
  signed __int32 v5; // eax

  if ( dword_457918 == 1 )
    return 0;
  if ( dword_457918 )
    return 1;
  ModuleHandleW = GetModuleHandleW(L"KERNEL32.DLL");
  v2 = (signed __int32)ModuleHandleW;
  if ( ModuleHandleW
    && (AcquireSRWLockExclusive = (void (__stdcall *)(PSRWLOCK))GetProcAddress(ModuleHandleW, "AcquireSRWLockExclusive")) != 0
    && (dword_45791C = (int)AcquireSRWLockExclusive,
        (ReleaseSRWLockExclusive = (void (__stdcall *)(PSRWLOCK))GetProcAddress((HMODULE)v2, "ReleaseSRWLockExclusive")) != 0) )
  {
    dword_457920 = (int)ReleaseSRWLockExclusive;
  }
  else
  {
    v2 = 1;
  }
  v5 = _InterlockedCompareExchange(&dword_457918, v2, 0);
  return (v5 || v2 != 1) && v5 != 1;
}
// 457918: using guessed type int dword_457918;
// 45791C: using guessed type int dword_45791C;
// 457920: using guessed type int dword_457920;

//----- (0040EFBA) --------------------------------------------------------
int sub_40EFBA()
{
  int result; // eax

  if ( sub_40EF3F() )
    return dword_45791C(dword_45791C, &dword_457924);
  do
  {
    while ( dword_457924 )
      _mm_pause();
    result = _InterlockedCompareExchange(&dword_457924, 1, 0);
  }
  while ( result );
  return result;
}
// 45791C: invalid function type '?' has been ignored
// 45791C: using guessed type int (__thiscall *dword_45791C)(_DWORD, _DWORD);
// 457924: using guessed type int dword_457924;

//----- (0040F017) --------------------------------------------------------
SIZE_T __stdcall sub_40F017(unsigned int lpAddress, unsigned int a2)
{
  SIZE_T result; // eax
  DWORD dwPageSize; // edi
  volatile signed __int32 *v4; // esi
  DWORD i; // ecx
  struct _SYSTEM_INFO SystemInfo; // [esp+0h] [ebp-40h] BYREF
  struct _MEMORY_BASIC_INFORMATION Buffer; // [esp+24h] [ebp-1Ch] BYREF

  result = VirtualQuery((LPCVOID)lpAddress, &Buffer, 0x1Cu);
  if ( !result )
    __fastfail(0x19u);
  if ( (Buffer.Protect & 0x44) != 0 )
  {
    GetSystemInfo(&SystemInfo);
    dwPageSize = SystemInfo.dwPageSize;
    v4 = (volatile signed __int32 *)(lpAddress & ~(SystemInfo.dwPageSize - 1));
    result = a2 / SystemInfo.dwPageSize;
    for ( i = a2 / SystemInfo.dwPageSize
            + (SystemInfo.dwPageSize + (lpAddress & (SystemInfo.dwPageSize - 1)) + (a2 & (SystemInfo.dwPageSize - 1))
                                                                                 - 1)
            / SystemInfo.dwPageSize; i; --i )
    {
      result = 0;
      _InterlockedOr(v4, 0);
      v4 = (volatile signed __int32 *)((char *)v4 + dwPageSize);
    }
  }
  return result;
}

//----- (0040F089) --------------------------------------------------------
char *__stdcall sub_40F089(_DWORD *a1, _DWORD *a2)
{
  int v3; // esi
  _DWORD *v4; // edx
  unsigned int v5; // edi
  unsigned int v6; // esi

  if ( *(_DWORD *)&byte_400040[(_DWORD)off_40003C + 52] <= 0xDu )
    return 0;
  v3 = *(_DWORD *)&byte_400040[(_DWORD)off_40003C + 160];
  if ( !v3 )
    return 0;
  v4 = (_DWORD *)((char *)&word_400018
                + (_DWORD)off_40003C
                + *(unsigned __int16 *)((char *)&word_400014 + (_DWORD)off_40003C));
  v5 = *(_DWORD *)((char *)&word_40000C + v3);
  v6 = 0;
  if ( !*(__int16 *)((char *)&word_400006 + (_DWORD)off_40003C) )
    return 0;
  while ( v5 < v4[3] || v5 >= v4[3] + v4[2] )
  {
    ++v6;
    v4 += 10;
    if ( v6 >= *(unsigned __int16 *)((char *)&word_400006 + (_DWORD)off_40003C) )
      return 0;
  }
  *a1 = v4[2];
  *a2 = v4[9];
  return (char *)&_ImageBase + v4[3];
}
// 400006: using guessed type __int16 word_400006;
// 40000C: using guessed type __int16 word_40000C;
// 400014: using guessed type __int16 word_400014;
// 400018: using guessed type __int16 word_400018;
// 40003C: using guessed type int *off_40003C;

//----- (0040F10C) --------------------------------------------------------
PDWORD __stdcall sub_40F10C(DWORD flNewProtect, PDWORD lpflOldProtect)
{
  char *v2; // eax
  char *v3; // esi
  PDWORD result; // eax
  int v5; // [esp+4h] [ebp-8h] BYREF
  SIZE_T dwSize; // [esp+8h] [ebp-4h] BYREF

  v2 = sub_40F089(&dwSize, &v5);
  v3 = v2;
  if ( v2 )
  {
    if ( !dword_457930 )
    {
      dword_457930 = 1;
      if ( v5 >= 0 )
        __fastfail(0x19u);
      sub_40F017((unsigned int)v2, dwSize);
    }
    result = (PDWORD)VirtualProtect(v3, dwSize, flNewProtect, lpflOldProtect);
    if ( !result )
      __fastfail(0x19u);
  }
  else
  {
    result = lpflOldProtect;
    *lpflOldProtect = 4;
  }
  return result;
}
// 457930: using guessed type int dword_457930;

//----- (0040F17C) --------------------------------------------------------
void sub_40F17C()
{
  ;
}

//----- (0040F1B4) --------------------------------------------------------
char sub_40F1B4()
{
  char result; // al

  result = sub_40EF3F();
  if ( result )
    return dword_457920(dword_457920, &dword_457924);
  dword_457924 = 0;
  return result;
}
// 457920: invalid function type '?' has been ignored
// 457920: using guessed type int (__thiscall *dword_457920)(_DWORD, _DWORD);
// 457924: using guessed type int dword_457924;

//----- (0040F1FE) --------------------------------------------------------
int __stdcall sub_40F1FE(_DWORD *a1, char *a2)
{
  const CHAR *v2; // eax
  HMODULE *v3; // ebx
  char *v4; // edx
  char *v5; // esi
  char *v6; // edi
  bool v7; // zf
  HMODULE Library; // edi
  int v10; // ecx
  const CHAR *v11; // eax
  int (__thiscall *v12)(_DWORD, int, int *); // ebx
  FARPROC ProcAddress; // esi
  int v14; // eax
  int v15; // [esp+Ch] [ebp-38h]
  int v16; // [esp+10h] [ebp-34h]
  int v17[3]; // [esp+14h] [ebp-30h] BYREF
  LPCSTR lpLibFileName; // [esp+20h] [ebp-24h]
  BOOL v19; // [esp+24h] [ebp-20h]
  LPCSTR lpProcName; // [esp+28h] [ebp-1Ch]
  HMODULE v21; // [esp+2Ch] [ebp-18h]
  int (__stdcall *v22)(); // [esp+30h] [ebp-14h]
  DWORD LastError; // [esp+34h] [ebp-10h]
  ULONG_PTR v24; // [esp+38h] [ebp-Ch] BYREF
  ULONG_PTR Arguments; // [esp+3Ch] [ebp-8h] BYREF

  sub_40EF0C();
  v17[0] = 36;
  v17[1] = (int)a1;
  v2 = (char *)&_ImageBase + a1[1];
  v3 = (HMODULE *)((char *)&_ImageBase + a1[2]);
  v4 = (char *)&_ImageBase + a1[3];
  v5 = (char *)&_ImageBase + a1[4];
  Arguments = (ULONG_PTR)v3;
  v6 = (char *)&_ImageBase + a1[5];
  lpLibFileName = v2;
  v24 = (ULONG_PTR)v6;
  v16 = a1[7];
  v17[2] = (int)a2;
  v7 = (*a1 & 1) == 0;
  v19 = 0;
  lpProcName = 0;
  v21 = 0;
  v22 = 0;
  LastError = 0;
  if ( v7 )
  {
    Arguments = (ULONG_PTR)v17;
    sub_40F17C();
    RaiseException(0xC06D0057, 0, 1u, &Arguments);
    return 0;
  }
  Library = *v3;
  v15 = (a2 - v4) >> 2;
  v10 = *(_DWORD *)&v5[4 * v15];
  v19 = v10 >= 0;
  v11 = (char *)&_ImageBase.unused + v10 + 2;
  if ( v10 < 0 )
    v11 = (const CHAR *)(unsigned __int16)v10;
  v12 = (int (__thiscall *)(_DWORD, int, int *))dword_457934;
  ProcAddress = 0;
  lpProcName = v11;
  if ( dword_457934 )
  {
    ProcAddress = (FARPROC)dword_457934(dword_457934, 0, v17);
    if ( ProcAddress )
      goto LABEL_32;
    v12 = (int (__thiscall *)(_DWORD, int, int *))dword_457934;
  }
  if ( !Library )
  {
    if ( !v12 || (Library = (HMODULE)v12(v12, 1, v17)) == 0 )
    {
      Library = LoadLibraryExA(lpLibFileName, 0, 0);
      if ( !Library )
      {
        LastError = GetLastError();
        if ( !dword_457938 || (Library = (HMODULE)dword_457938(dword_457938, 3, v17)) == 0 )
        {
          Arguments = (ULONG_PTR)v17;
          sub_40F17C();
          RaiseException(0xC06D007E, 0, 1u, &Arguments);
          return (int)v22;
        }
      }
    }
    if ( (HMODULE)_InterlockedExchange((volatile __int32 *)Arguments, (__int32)Library) == Library )
      FreeLibrary(Library);
    v12 = (int (__thiscall *)(_DWORD, int, int *))dword_457934;
  }
  v21 = Library;
  if ( v12 )
    ProcAddress = (FARPROC)v12(v12, 2, v17);
  if ( !ProcAddress )
  {
    if ( !a1[5]
      || !a1[7]
      || (v14 = *((_DWORD *)Library + 15), *(_DWORD *)((char *)Library + v14) != 17744)
      || *(_DWORD *)((char *)Library + v14 + 8) != v16
      || Library != *(HMODULE *)((char *)Library + v14 + 52)
      || (ProcAddress = *(FARPROC *)(v24 + 4 * v15)) == 0 )
    {
      ProcAddress = GetProcAddress(Library, lpProcName);
      if ( !ProcAddress )
      {
        LastError = GetLastError();
        if ( !dword_457938 || (ProcAddress = (FARPROC)dword_457938(dword_457938, 4, v17)) == 0 )
        {
          v24 = (ULONG_PTR)v17;
          sub_40F17C();
          RaiseException(0xC06D007F, 0, 1u, &v24);
          sub_40EF0C();
          ProcAddress = v22;
        }
      }
    }
  }
  *(_DWORD *)a2 = ProcAddress;
LABEL_32:
  if ( dword_457934 )
  {
    LastError = 0;
    v21 = Library;
    v22 = ProcAddress;
    dword_457934(dword_457934, 5, v17);
  }
  sub_40F17C();
  return (int)ProcAddress;
}
// 457934: using guessed type int (__thiscall *dword_457934)(_DWORD, _DWORD, _DWORD);
// 457938: using guessed type int (__thiscall *dword_457938)(_DWORD, _DWORD, _DWORD);

//----- (0040F4DD) --------------------------------------------------------
_DWORD *__thiscall sub_40F4DD(_DWORD *Block, char a2)
{
  *Block = &type_info::`vftable';
  if ( (a2 & 1) != 0 )
    sub_40F500(Block);
  return Block;
}
// 4235BC: using guessed type void *type_info::`vftable';

//----- (0040F500) --------------------------------------------------------
void __cdecl sub_40F500(void *Block)
{
  j_j___free_base(Block);
}

//----- (0040FB57) --------------------------------------------------------
int sub_40FB57()
{
  __scrt_initialize_default_local_stdio_options();
  return 0;
}
// 4102CD: using guessed type int __scrt_initialize_default_local_stdio_options(void);

//----- (0040FB5F) --------------------------------------------------------
int sub_40FB5F()
{
  int v0; // eax

  sub_41004A();
  v0 = UserMathErrorFunction();
  return _set_new_mode(v0);
}

//----- (0040FEA8) --------------------------------------------------------
int sub_40FEA8()
{
  return 1;
}

//----- (0041004A) --------------------------------------------------------
LPTOP_LEVEL_EXCEPTION_FILTER sub_41004A()
{
  return SetUnhandledExceptionFilter(__scrt_unhandled_exception_filter);
}

//----- (00410097) --------------------------------------------------------
void sub_410097()
{
  dword_457968 = 0;
}
// 457968: using guessed type int dword_457968;

//----- (0041010B) --------------------------------------------------------
std::exception *__thiscall sub_41010B(std::exception *this, struct std::exception *a2)
{
  std::exception::exception(this, a2);
  *(_DWORD *)this = &std::bad_alloc::`vftable';
  return this;
}
// 423640: using guessed type void *std::bad_alloc::`vftable';

//----- (00410126) --------------------------------------------------------
_DWORD *__thiscall sub_410126(_DWORD *this)
{
  _DWORD *result; // eax

  this[1] = 0;
  result = this;
  this[2] = 0;
  this[1] = "bad allocation";
  *this = &std::bad_alloc::`vftable';
  return result;
}
// 423640: using guessed type void *std::bad_alloc::`vftable';

//----- (0041013E) --------------------------------------------------------
std::exception *__thiscall sub_41013E(std::exception *this, struct std::exception *a2)
{
  std::exception::exception(this, a2);
  *(_DWORD *)this = &std::bad_array_new_length::`vftable';
  return this;
}
// 42365C: using guessed type void *std::bad_array_new_length::`vftable';

//----- (00410159) --------------------------------------------------------
_DWORD *__thiscall sub_410159(_DWORD *this)
{
  _DWORD *result; // eax

  this[1] = 0;
  result = this;
  this[2] = 0;
  this[1] = "bad array new length";
  *this = &std::bad_array_new_length::`vftable';
  return result;
}
// 42365C: using guessed type void *std::bad_array_new_length::`vftable';

//----- (004101AE) --------------------------------------------------------
void __noreturn sub_4101AE()
{
  _DWORD pExceptionObject[3]; // [esp+0h] [ebp-Ch] BYREF

  sub_410126(pExceptionObject);
  _CxxThrowException(pExceptionObject, (_ThrowInfo *)&_TI2_AVbad_alloc_std__);
}
// 4101AE: using guessed type void __noreturn sub_4101AE();
// 4101AE: using guessed type _DWORD pExceptionObject[3];

//----- (004101CB) --------------------------------------------------------
void __noreturn sub_4101CB()
{
  _DWORD pExceptionObject[3]; // [esp+0h] [ebp-Ch] BYREF

  sub_410159(pExceptionObject);
  _CxxThrowException(pExceptionObject, (_ThrowInfo *)&_TI3_AVbad_array_new_length_std__);
}
// 4101CB: using guessed type void __noreturn sub_4101CB();
// 4101CB: using guessed type _DWORD pExceptionObject[3];

//----- (00410297) --------------------------------------------------------
int __cdecl UserMathErrorFunction()
{
  return 0;
}

//----- (0041029A) --------------------------------------------------------
void sub_41029A()
{
  InitializeSListHead(&ListHead);
}

//----- (004102C7) --------------------------------------------------------
void *sub_4102C7()
{
  return &unk_457978;
}

//----- (004102EA) --------------------------------------------------------
BOOL sub_4102EA()
{
  return dword_42B0B0 == 0;
}
// 42B0B0: using guessed type int dword_42B0B0;

//----- (004102F6) --------------------------------------------------------
void *sub_4102F6()
{
  return &unk_458360;
}

//----- (004102FC) --------------------------------------------------------
void *sub_4102FC()
{
  return &unk_45835C;
}

//----- (00410302) --------------------------------------------------------
void sub_410302()
{
  ;
}
// 410302: could not find valid save-restore pair for edi
// 41009F: using guessed type _DWORD _guard_check_icall_nop();

//----- (0041032D) --------------------------------------------------------
void __cdecl sub_41032D()
{
  ;
}
// 41032D: could not find valid save-restore pair for edi
// 41009F: using guessed type _DWORD _guard_check_icall_nop();

//----- (0041328F) --------------------------------------------------------
#error "413294: call analysis failed (funcsize=4)"

//----- (00413550) --------------------------------------------------------
std::exception *__thiscall sub_413550(std::exception *this, struct std::exception *a2)
{
  std::exception::exception(this, a2);
  *(_DWORD *)this = &std::bad_exception::`vftable';
  return this;
}
// 4236D0: using guessed type void *std::bad_exception::`vftable';

//----- (0041356B) --------------------------------------------------------
_DWORD *__thiscall sub_41356B(_DWORD *this)
{
  _DWORD *result; // eax

  this[1] = 0;
  result = this;
  this[2] = 0;
  this[1] = "bad exception";
  *this = &std::bad_exception::`vftable';
  return result;
}
// 4236D0: using guessed type void *std::bad_exception::`vftable';

//----- (00413DC2) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
int __cdecl sub_413DC2(int a1, int a2)
{
  __int32 v3; // [esp-8h] [ebp-8h]
  void *retaddr; // [esp+0h] [ebp+0h] BYREF

  return ((int (*)(void))_InterlockedExchange((volatile __int32 *)&retaddr, v3))();
}
// 413DC4: positive sp value 8 has been found
// 413DC4: variable 'v3' is possibly undefined

//----- (00414995) --------------------------------------------------------
int __cdecl sub_414995(int a1, int a2, int *a3, unsigned int a4, int a5, struct __crt_locale_pointers *a6, int a7)
{
  int *v8; // edi
  int v9; // esi
  int v10; // eax
  int v11; // [esp+4h] [ebp-484h] BYREF
  char v12[12]; // [esp+8h] [ebp-480h] BYREF
  int v13; // [esp+14h] [ebp-474h]
  int v14[2]; // [esp+18h] [ebp-470h] BYREF
  int v15; // [esp+20h] [ebp-468h]
  int v16; // [esp+24h] [ebp-464h]
  int *v17; // [esp+28h] [ebp-460h] BYREF
  char v18[64]; // [esp+2Ch] [ebp-45Ch] BYREF
  char v19[1048]; // [esp+6Ch] [ebp-41Ch] BYREF

  v17 = a3;
  if ( !a5 || a4 && !a3 )
  {
    *_errno() = 22;
    _invalid_parameter_noinfo();
    return -1;
  }
  _LocaleUpdate::_LocaleUpdate((_LocaleUpdate *)&v11, a6);
  v16 = 0;
  v8 = v17;
  v13 = a1 & 2;
  v14[0] = (int)v17;
  v14[1] = a4;
  v15 = 0;
  if ( (a1 & 2) != 0 || (LOBYTE(v16) = 0, !v17) )
    LOBYTE(v16) = 1;
  v17 = v14;
  unknown_libname_15(&v17, a1, a2, a5, v12, a7);
  v9 = sub_415016((int)v18);
  if ( !v8 )
    goto LABEL_22;
  if ( (a1 & 1) == 0 )
  {
    if ( v13 )
    {
      if ( !a4 )
        goto LABEL_22;
      if ( v9 < 0 )
      {
        *(_WORD *)v8 = 0;
        goto LABEL_22;
      }
      v10 = v15;
      if ( v15 != a4 )
      {
LABEL_21:
        *((_WORD *)v8 + v10) = 0;
        goto LABEL_22;
      }
    }
    else
    {
      if ( !a4 )
      {
LABEL_26:
        v9 = -1;
        goto LABEL_22;
      }
      v10 = v15;
      if ( v15 != a4 )
        goto LABEL_21;
      v9 = -2;
    }
    *((_WORD *)v8 + a4 - 1) = 0;
    goto LABEL_22;
  }
  if ( !a4 && v9 )
    goto LABEL_26;
  v10 = v15;
  if ( v15 != a4 )
    goto LABEL_21;
  if ( v9 >= 0 && v9 > a4 )
    goto LABEL_26;
LABEL_22:
  __crt_stdio_output::formatting_buffer::~formatting_buffer((__crt_stdio_output::formatting_buffer *)v19);
  if ( v12[8] )
    *(_DWORD *)(v11 + 848) &= ~2u;
  return v9;
}
// 414DDB: using guessed type _DWORD __stdcall unknown_libname_15(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD);
// 414995: using guessed type char var_45C[64];
// 414995: using guessed type char var_41C[1048];

//----- (00415016) --------------------------------------------------------
int __thiscall sub_415016(int this)
{
  int v3; // eax
  char v4; // al
  __int16 v5; // ax

  if ( !(unsigned __int8)unknown_libname_26(this + 1096) )
    return -1;
  if ( *(_DWORD *)(this + 16) )
  {
LABEL_21:
    while ( ++*(_DWORD *)(this + 1104) != 2 )
    {
      *(_DWORD *)(this + 56) = 0;
      *(_DWORD *)(this + 28) = 0;
      while ( 1 )
      {
        v5 = **(_WORD **)(this + 16);
        *(_WORD *)(this + 50) = v5;
        if ( !v5 )
          break;
        *(_DWORD *)(this + 16) += 2;
        if ( *(int *)(this + 24) < 0 )
          goto LABEL_21;
        v3 = unknown_libname_17(*(unsigned __int16 *)(this + 50), *(_DWORD *)(this + 28));
        *(_DWORD *)(this + 28) = v3;
        if ( v3 == 8 )
          goto LABEL_4;
        switch ( v3 )
        {
          case 0:
            v4 = sub_415173();
            break;
          case 1:
            *(_DWORD *)(this + 40) = -1;
            *(_DWORD *)(this + 36) = 0;
            *(_BYTE *)(this + 48) = 0;
            *(_DWORD *)(this + 32) = 0;
            *(_DWORD *)(this + 44) = 0;
            *(_BYTE *)(this + 60) = 0;
            continue;
          case 2:
            v4 = unknown_libname_19(this);
            break;
          case 3:
            v4 = sub_4155AF(this);
            break;
          case 4:
            *(_DWORD *)(this + 40) = 0;
            continue;
          case 5:
            v4 = sub_4151AD(this);
            break;
          case 6:
            v4 = sub_4151D6((_DWORD *)this);
            break;
          case 7:
            v4 = sub_415352(this);
            break;
          default:
            return -1;
        }
        if ( !v4 )
          return -1;
      }
      *(_DWORD *)(this + 16) += 2;
    }
    return *(_DWORD *)(this + 24);
  }
  else
  {
LABEL_4:
    *_errno() = 22;
    _invalid_parameter_noinfo();
    return -1;
  }
}
// 414F28: using guessed type _DWORD __stdcall unknown_libname_17(_DWORD, _DWORD);
// 415136: using guessed type int __thiscall unknown_libname_19(_DWORD);
// 415B4D: using guessed type int __thiscall unknown_libname_26(_DWORD);

//----- (00415173) --------------------------------------------------------
char sub_415173()
{
  if ( (unsigned __int8)unknown_libname_20() )
    return 1;
  *_errno() = 22;
  _invalid_parameter_noinfo();
  return 0;
}
// 415192: using guessed type int unknown_libname_20(void);

//----- (004151AD) --------------------------------------------------------
char __thiscall sub_4151AD(int this)
{
  int v2; // eax

  if ( *(_WORD *)(this + 50) != 42 )
    return unknown_libname_18(this + 40);
  *(_DWORD *)(this + 20) += 4;
  v2 = *(_DWORD *)(*(_DWORD *)(this + 20) - 4);
  *(_DWORD *)(this + 40) = v2;
  if ( v2 < 0 )
    *(_DWORD *)(this + 40) = -1;
  return 1;
}
// 414FB8: using guessed type _DWORD __stdcall unknown_libname_18(_DWORD);

//----- (004151D6) --------------------------------------------------------
char __thiscall sub_4151D6(_DWORD *this)
{
  int v1; // eax
  _WORD *v3; // eax
  unsigned __int16 *v4; // edx
  int v5; // eax
  _WORD *v6; // eax

  v1 = *((unsigned __int16 *)this + 25);
  if ( v1 == 70 )
  {
    if ( (*this & 8) == 0 )
    {
      this[7] = 7;
      return sub_415352((int)this);
    }
    return 1;
  }
  if ( v1 == 78 )
  {
    if ( (*this & 8) == 0 )
    {
      this[7] = 8;
LABEL_7:
      *_errno() = 22;
      _invalid_parameter_noinfo();
      return 0;
    }
  }
  else
  {
    if ( this[11] )
      goto LABEL_7;
    if ( *((unsigned __int16 *)this + 25) > 0x6Au )
    {
      switch ( v1 )
      {
        case 'l':
          v6 = (_WORD *)this[4];
          if ( *v6 == 108 )
          {
            this[11] = 4;
            this[4] = v6 + 1;
          }
          else
          {
            this[11] = 3;
          }
          break;
        case 't':
          this[11] = 7;
          break;
        case 'w':
          this[11] = 12;
          break;
        case 'z':
          this[11] = 6;
          break;
      }
    }
    else
    {
      switch ( v1 )
      {
        case 'j':
          this[11] = 5;
          break;
        case 'I':
          v4 = (unsigned __int16 *)this[4];
          v5 = *v4;
          if ( v5 == 51 && v4[1] == 50 )
          {
            this[11] = 10;
            this[4] = v4 + 2;
          }
          else if ( v5 == 54 && v4[1] == 52 )
          {
            this[11] = 11;
            this[4] = v4 + 2;
          }
          else if ( v5 == 100 || v5 == 105 || v5 == 111 || v5 == 117 || v5 == 120 || v5 == 88 )
          {
            this[11] = 9;
          }
          break;
        case 'L':
          this[11] = 8;
          break;
        case 'T':
          this[11] = 13;
          break;
        case 'h':
          v3 = (_WORD *)this[4];
          if ( *v3 == 104 )
          {
            this[11] = 1;
            this[4] = v3 + 1;
          }
          else
          {
            this[11] = 2;
          }
          break;
      }
    }
  }
  return 1;
}

//----- (00415352) --------------------------------------------------------
char __thiscall sub_415352(int this)
{
  int v2; // ebx
  unsigned int v3; // eax
  char v4; // al
  unsigned int v6; // eax
  unsigned int v7; // eax
  unsigned int v8; // eax
  unsigned int v9; // eax
  int v10; // edx
  int v11; // ecx
  bool v12; // ah
  bool v13; // al
  bool v14; // al
  int v15; // edi
  __int16 v16; // [esp-8h] [ebp-1Ch]
  char v17; // [esp-4h] [ebp-18h]
  int Src; // [esp+8h] [ebp-Ch] BYREF
  __int16 v19; // [esp+Ch] [ebp-8h]

  v2 = 0;
  v3 = *(unsigned __int16 *)(this + 50);
  if ( v3 <= 0x64 )
  {
    if ( v3 != 100 )
    {
      if ( *(unsigned __int16 *)(this + 50) > 0x58u )
      {
        v6 = v3 - 90;
        if ( !v6 )
        {
          v4 = unknown_libname_21(this);
          goto LABEL_11;
        }
        v7 = v6 - 7;
        if ( !v7 )
          goto LABEL_31;
        if ( v7 != 2 )
          return 0;
        goto LABEL_18;
      }
      if ( v3 != 88 )
      {
        if ( v3 != 65 )
        {
          if ( v3 != 67 )
          {
            if ( *(unsigned __int16 *)(this + 50) <= 0x44u )
              return 0;
            if ( *(unsigned __int16 *)(this + 50) > 0x47u )
            {
              if ( v3 == 83 )
              {
LABEL_10:
                v4 = sub_415A99((_DWORD *)this);
                goto LABEL_11;
              }
              return 0;
            }
            goto LABEL_31;
          }
LABEL_18:
          v4 = unknown_libname_23(0);
          goto LABEL_11;
        }
LABEL_31:
        v4 = unknown_libname_22(this);
        goto LABEL_11;
      }
      v17 = 1;
LABEL_14:
      v4 = sub_4158A4((_DWORD *)this, 16, v17);
      goto LABEL_11;
    }
    goto LABEL_28;
  }
  if ( *(unsigned __int16 *)(this + 50) > 0x70u )
  {
    v8 = v3 - 115;
    if ( !v8 )
      goto LABEL_10;
    v9 = v8 - 2;
    if ( v9 )
    {
      if ( v9 != 3 )
        return 0;
      v17 = 0;
      goto LABEL_14;
    }
    goto LABEL_29;
  }
  if ( v3 == 112 )
  {
    v4 = sub_415A81((_DWORD *)this);
    goto LABEL_11;
  }
  if ( *(unsigned __int16 *)(this + 50) <= 0x67u )
    goto LABEL_31;
  switch ( v3 )
  {
    case 'i':
LABEL_28:
      *(_DWORD *)(this + 32) |= 0x10u;
LABEL_29:
      v4 = sub_4158A4((_DWORD *)this, 10, 0);
      break;
    case 'n':
      v4 = unknown_libname_24(this);
      break;
    case 'o':
      v4 = sub_415A62((_DWORD *)this);
      break;
    default:
      return 0;
  }
LABEL_11:
  if ( !v4 )
    return 0;
  if ( !*(_BYTE *)(this + 48) )
  {
    v10 = *(_DWORD *)(this + 32);
    Src = 0;
    v19 = 0;
    if ( (v10 & 0x10) != 0 )
    {
      if ( (v10 & 0x40) != 0 )
      {
        v16 = 45;
LABEL_41:
        LOWORD(Src) = v16;
LABEL_46:
        v2 = 1;
        goto LABEL_47;
      }
      if ( (v10 & 1) != 0 )
      {
        v16 = 43;
        goto LABEL_41;
      }
      if ( (v10 & 2) != 0 )
      {
        LOWORD(Src) = 32;
        goto LABEL_46;
      }
    }
LABEL_47:
    v11 = *(unsigned __int16 *)(this + 50);
    v12 = (v11 == 120 || (_WORD)v11 == 88) && (v10 & 0x20) != 0;
    v13 = v11 == 97 || (_WORD)v11 == 65;
    if ( v12 || v13 )
    {
      *((_WORD *)&Src + v2) = 48;
      v14 = (_WORD)v11 == 88 || (_WORD)v11 == 65;
      *((_WORD *)&Src + v2 + 1) = !v14 ? 120 : 88;
      v2 += 2;
    }
    v15 = *(_DWORD *)(this + 36) - *(_DWORD *)(this + 56) - v2;
    if ( (v10 & 0xC) == 0 )
      __crt_stdio_output::write_multiple_characters<__crt_stdio_output::string_output_adapter<wchar_t>,char>(
        this + 1096,
        32,
        v15,
        this + 24);
    __crt_stdio_output::string_output_adapter<wchar_t>::write_string(&Src, v2, this + 24, *(_DWORD *)(this + 12));
    if ( (*(_DWORD *)(this + 32) & 8) != 0 && (*(_DWORD *)(this + 32) & 4) == 0 )
      __crt_stdio_output::write_multiple_characters<__crt_stdio_output::string_output_adapter<wchar_t>,char>(
        this + 1096,
        48,
        v15,
        this + 24);
    unknown_libname_27(0);
    if ( *(int *)(this + 24) >= 0 && (*(_DWORD *)(this + 32) & 4) != 0 )
      __crt_stdio_output::write_multiple_characters<__crt_stdio_output::string_output_adapter<wchar_t>,char>(
        this + 1096,
        32,
        v15,
        this + 24);
  }
  return 1;
}
// 414D22: using guessed type _DWORD __cdecl __crt_stdio_output::write_multiple_characters<__crt_stdio_output::string_output_adapter<wchar_t>,char>(_DWORD, char, _DWORD, _DWORD);
// 415637: using guessed type int __thiscall unknown_libname_21(_DWORD);
// 41569A: using guessed type int __thiscall unknown_libname_22(_DWORD);
// 41580C: using guessed type _DWORD __stdcall unknown_libname_23(_DWORD);
// 4159EE: using guessed type int __thiscall unknown_libname_24(_DWORD);
// 415BAD: using guessed type _DWORD __stdcall unknown_libname_27(_DWORD);

//----- (004155AF) --------------------------------------------------------
char __thiscall sub_4155AF(int this)
{
  int v2; // eax

  if ( *(_WORD *)(this + 50) != 42 )
    return unknown_libname_18(this + 36);
  *(_DWORD *)(this + 20) += 4;
  v2 = *(_DWORD *)(*(_DWORD *)(this + 20) - 4);
  *(_DWORD *)(this + 36) = v2;
  if ( v2 < 0 )
  {
    *(_DWORD *)(this + 32) |= 4u;
    *(_DWORD *)(this + 36) = -*(_DWORD *)(this + 36);
  }
  return 1;
}
// 414FB8: using guessed type _DWORD __stdcall unknown_libname_18(_DWORD);

//----- (004158A4) --------------------------------------------------------
char __thiscall sub_4158A4(_DWORD *this, int a2, char a3)
{
  int v4; // eax
  int v5; // ebx
  int v7; // ecx
  __int64 v8; // rax
  int v9; // eax
  bool v10; // zf
  int v11; // eax
  int v12; // eax
  int v13; // eax
  int v14; // eax

  v4 = __crt_stdio_output::to_integer_size(this[11]);
  v5 = v4;
  switch ( v4 )
  {
    case 1:
      v13 = this[8];
      this[5] += 4;
      v10 = (v13 & 0x10) == 0;
      v14 = this[5];
      if ( v10 )
        LODWORD(v8) = *(unsigned __int8 *)(v14 - 4);
      else
        LODWORD(v8) = *(char *)(v14 - 4);
      goto LABEL_16;
    case 2:
      v11 = this[8];
      this[5] += 4;
      v10 = (v11 & 0x10) == 0;
      v12 = this[5];
      if ( v10 )
        LODWORD(v8) = *(unsigned __int16 *)(v12 - 4);
      else
        LODWORD(v8) = *(__int16 *)(v12 - 4);
LABEL_16:
      v8 = (int)v8;
      v7 = v8;
      goto LABEL_17;
    case 4:
      v9 = this[8];
      this[5] += 4;
      v10 = (v9 & 0x10) == 0;
      LODWORD(v8) = this[5];
      if ( v10 )
      {
        v7 = *(_DWORD *)(v8 - 4);
        HIDWORD(v8) = 0;
        goto LABEL_17;
      }
      LODWORD(v8) = *(_DWORD *)(v8 - 4);
      goto LABEL_16;
  }
  if ( v4 != 8 )
  {
    *_errno() = 22;
    _invalid_parameter_noinfo();
    return 0;
  }
  this[5] += 8;
  LODWORD(v8) = this[5];
  v7 = *(_DWORD *)(v8 - 8);
  HIDWORD(v8) = *(_DWORD *)(v8 - 4);
LABEL_17:
  if ( (this[8] & 0x10) != 0 && v8 < 0 )
  {
    v7 = -v7;
    HIDWORD(v8) = (unsigned __int64)-__SPAIR64__(HIDWORD(v8), v7) >> 32;
    this[8] |= 0x40u;
  }
  if ( (int)this[10] >= 0 )
  {
    this[8] &= ~8u;
    if ( (int)this[10] > 512 )
      this[10] = 512;
  }
  else
  {
    this[10] = 1;
  }
  if ( !__PAIR64__(v7, HIDWORD(v8)) )
    this[8] &= ~0x20u;
  if ( v5 == 8 )
    unknown_libname_13(v7, HIDWORD(v8), a2, a3);
  else
    unknown_libname_12(v7, a2, a3);
  if ( (this[8] & 0x80) != 0 && (!this[14] || *(_BYTE *)this[13] != 48) )
  {
    *(_BYTE *)--this[13] = 48;
    ++this[14];
  }
  return 1;
}
// 414C25: using guessed type _DWORD __stdcall unknown_libname_12(_DWORD, _DWORD, char);
// 414C9A: using guessed type _DWORD __stdcall unknown_libname_13(_DWORD, _DWORD, _DWORD, char);
// 4155DB: using guessed type int __cdecl __crt_stdio_output::to_integer_size(_DWORD);

//----- (00415A62) --------------------------------------------------------
char __thiscall sub_415A62(_DWORD *this)
{
  if ( (this[8] & 0x20) != 0 )
    this[8] |= 0x80u;
  return sub_4158A4(this, 8, 0);
}

//----- (00415A81) --------------------------------------------------------
char __thiscall sub_415A81(_DWORD *this)
{
  this[10] = 8;
  this[11] = 10;
  return sub_4158A4(this, 16, 1);
}

//----- (00415A99) --------------------------------------------------------
char __thiscall sub_415A99(_DWORD *this)
{
  size_t v2; // edi
  int v3; // ebx
  size_t v4; // eax
  const wchar_t *v6; // [esp-8h] [ebp-14h]

  this[5] += 4;
  v2 = this[10];
  v3 = *(_DWORD *)(this[5] - 4);
  this[13] = v3;
  if ( v2 == -1 )
    v2 = 0x7FFFFFFF;
  if ( (unsigned __int8)__crt_stdio_output::is_wide_character_specifier<wchar_t>(
                          *this,
                          this[1],
                          *((_WORD *)this + 25),
                          this[11]) )
  {
    if ( !v3 )
      this[13] = L"(null)";
    v6 = (const wchar_t *)this[13];
    *((_BYTE *)this + 60) = 1;
    v4 = wcsnlen(v6, v2);
  }
  else
  {
    if ( !v3 )
      this[13] = "(null)";
    v4 = unknown_libname_25(v2, 0);
  }
  this[14] = v4;
  return 1;
}
// 414BB8: using guessed type _DWORD __cdecl __crt_stdio_output::is_wide_character_specifier<wchar_t>(_DWORD, _DWORD, __int16, _DWORD);
// 415B0D: using guessed type _DWORD __stdcall unknown_libname_25(_DWORD, _DWORD);
// 424014: using guessed type wchar_t aNull_0[7];

//----- (00415CD2) --------------------------------------------------------
int __cdecl sub_415CD2(int a1, int a2, int *a3, int a4, int a5, struct __crt_locale_pointers *a6, int a7)
{
  return sub_414995(a1, a2, a3, a4, a5, a6, a7);
}

//----- (0041710A) --------------------------------------------------------
int __cdecl sub_41710A(int a1)
{
  int v1; // ecx
  int v3; // [esp-14h] [ebp-14h] BYREF
  int v4; // [esp-10h] [ebp-10h]
  int v5; // [esp-Ch] [ebp-Ch]
  int v6; // [esp-8h] [ebp-8h]
  int v7; // [esp-4h] [ebp-4h]

  v7 = v1;
  v6 = 1;
  v5 = 10;
  v4 = v1;
  v3 = v1;
  unknown_libname_33(&v3, a1, 0);
  return __crt_strtox::parse_integer<unsigned long,__crt_strtox::c_string_character_source<char>>(0, v3, v4, v5, v6);
}
// 41710F: variable 'v1' is possibly undefined
// 418859: using guessed type _DWORD __cdecl unknown_libname_33(_DWORD, _DWORD, _DWORD);

//----- (004174E4) --------------------------------------------------------
int __cdecl sub_4174E4(int a1)
{
  int result; // eax

  result = a1;
  dword_457D6C = a1;
  return result;
}
// 457D6C: using guessed type int dword_457D6C;

//----- (00417A07) --------------------------------------------------------
void *__cdecl sub_417A07(void **a1)
{
  void *result; // eax

  result = *a1;
  if ( *a1 != dword_457E8C )
    return (void *)unknown_libname_28(*a1);
  return result;
}

//----- (00417A22) --------------------------------------------------------
void *__cdecl sub_417A22(void **a1)
{
  void *result; // eax

  result = *a1;
  if ( *a1 != dword_457E88 )
    return (void *)unknown_libname_28(*a1);
  return result;
}

//----- (00417B1B) --------------------------------------------------------
int __cdecl sub_417B1B(int a1, int a2)
{
  int v3; // [esp+0h] [ebp-Ch] BYREF
  int v4; // [esp+4h] [ebp-8h] BYREF

  v4 = a1;
  v3 = a1;
  return __crt_seh_guarded_call<char *>::operator()<_lambda_0fef6fff2b5e6b53303c9058db11ae1f_,_lambda_082c17da81b0962e08c0587ee0fac50c_ &,_lambda_fa6e051aed0a38726081083cc7c328e9_>(
           &v3,
           a2,
           &v4);
}
// 417ACA: using guessed type _DWORD __stdcall __crt_seh_guarded_call<char *>::operator()<_lambda_0fef6fff2b5e6b53303c9058db11ae1f_,_lambda_082c17da81b0962e08c0587ee0fac50c_ &,_lambda_fa6e051aed0a38726081083cc7c328e9_>(_DWORD, _DWORD, _DWORD);
// 417B1B: using guessed type int var_8;

//----- (00417B43) --------------------------------------------------------
int __cdecl sub_417B43(int a1, int a2)
{
  int v3; // [esp+0h] [ebp-Ch] BYREF
  int v4; // [esp+4h] [ebp-8h] BYREF

  v4 = a1;
  v3 = a1;
  return __crt_seh_guarded_call<char *>::operator()<_lambda_0fef6fff2b5e6b53303c9058db11ae1f_,_lambda_082c17da81b0962e08c0587ee0fac50c_ &,_lambda_fa6e051aed0a38726081083cc7c328e9_>(
           &v3,
           a2,
           &v4);
}
// 417A79: using guessed type _DWORD __stdcall __crt_seh_guarded_call<char *>::operator()<_lambda_0fef6fff2b5e6b53303c9058db11ae1f_,_lambda_082c17da81b0962e08c0587ee0fac50c_ &,_lambda_fa6e051aed0a38726081083cc7c328e9_>(_DWORD, _DWORD, _DWORD);
// 417B43: using guessed type int var_8;

//----- (00417DEB) --------------------------------------------------------
int __cdecl sub_417DEB(_onexit_t Function)
{
  return _register_onexit_function(&stru_457E90, Function);
}

//----- (00417E7F) --------------------------------------------------------
char sub_417E7F()
{
  unknown_libname_31(&off_42B1D8);
  return 1;
}
// 417F73: using guessed type _DWORD __stdcall unknown_libname_31(_DWORD);
// 42B1D8: using guessed type wchar_t *off_42B1D8;

//----- (00417EAB) --------------------------------------------------------
char sub_417EAB()
{
  __dcrt_uninitialize_environments_nolock();
  return 1;
}
// 417A3D: using guessed type int __dcrt_uninitialize_environments_nolock(void);

//----- (00417EF0) --------------------------------------------------------
__vcrt_bool sub_417EF0()
{
  return __vcrt_uninitialize(0);
}

//----- (00417F70) --------------------------------------------------------
char sub_417F70()
{
  return 1;
}

//----- (00417FC8) --------------------------------------------------------
int __cdecl sub_417FC8(int a1)
{
  return unknown_libname_31(a1);
}
// 417F73: using guessed type _DWORD __stdcall unknown_libname_31(_DWORD);

//----- (00418073) --------------------------------------------------------
int sub_418073()
{
  return dword_457EAC;
}
// 457EAC: using guessed type int dword_457EAC;

//----- (00418079) --------------------------------------------------------
int __cdecl sub_418079(int a1)
{
  int result; // eax

  result = a1;
  dword_457EAC = a1;
  return result;
}
// 457EAC: using guessed type int dword_457EAC;

//----- (004180A1) --------------------------------------------------------
int __cdecl sub_4180A1(int a1)
{
  return unknown_libname_31(a1);
}
// 417F73: using guessed type _DWORD __stdcall unknown_libname_31(_DWORD);

//----- (00418244) --------------------------------------------------------
__int32 sub_418244()
{
  return _InterlockedExchange(&dword_457EB8, 1);
}
// 457EB8: using guessed type int dword_457EB8;

//----- (00418303) --------------------------------------------------------
int sub_418303()
{
  return dword_457EBC;
}
// 457EBC: using guessed type int dword_457EBC;

//----- (00418338) --------------------------------------------------------
void *sub_418338()
{
  return &unk_457EC0;
}

//----- (00418696) --------------------------------------------------------
int __cdecl sub_418696(int a1)
{
  return unknown_libname_31(a1);
}
// 417F73: using guessed type _DWORD __stdcall unknown_libname_31(_DWORD);

//----- (00418AF8) --------------------------------------------------------
int __cdecl sub_418AF8(int a1, int a2)
{
  int v3; // [esp+0h] [ebp-Ch] BYREF
  int v4; // [esp+4h] [ebp-8h] BYREF

  v4 = a1;
  v3 = a1;
  return __crt_seh_guarded_call<void>::operator()<_lambda_51b6e8b1eb166f2a3faf91f424b38130_,_lambda_6250bd4b2a391816dd638c3bf72b0bcb_ &,_lambda_0b5a4a3e68152e1d9b943535f5f47bed_>(
           &v3,
           a2,
           &v4);
}
// 418A04: using guessed type _DWORD __stdcall __crt_seh_guarded_call<void>::operator()<_lambda_51b6e8b1eb166f2a3faf91f424b38130_,_lambda_6250bd4b2a391816dd638c3bf72b0bcb_ &,_lambda_0b5a4a3e68152e1d9b943535f5f47bed_>(_DWORD, _DWORD, _DWORD);
// 418AF8: using guessed type int var_8;

//----- (00418B20) --------------------------------------------------------
int __cdecl sub_418B20(int a1, int a2)
{
  int v3; // [esp+0h] [ebp-Ch] BYREF
  int v4; // [esp+4h] [ebp-8h] BYREF

  v4 = a1;
  v3 = a1;
  return __crt_seh_guarded_call<void>::operator()<_lambda_3518db117f0e7cdb002338c5d3c47b6c_,_lambda_b2ea41f6bbb362cd97d94c6828d90b61_ &,_lambda_abdedf541bb04549bc734292b4a045d4_>(
           &v3,
           a2,
           &v4);
}
// 4189B4: using guessed type _DWORD __stdcall __crt_seh_guarded_call<void>::operator()<_lambda_3518db117f0e7cdb002338c5d3c47b6c_,_lambda_b2ea41f6bbb362cd97d94c6828d90b61_ &,_lambda_abdedf541bb04549bc734292b4a045d4_>(_DWORD, _DWORD, _DWORD);
// 418B20: using guessed type int var_8;

//----- (00418B48) --------------------------------------------------------
int __cdecl sub_418B48(int a1, int a2)
{
  int v3; // [esp+0h] [ebp-Ch] BYREF
  int v4; // [esp+4h] [ebp-8h] BYREF

  v4 = a1;
  v3 = a1;
  return __crt_seh_guarded_call<void>::operator()<_lambda_5b71d36f03204c0beab531769a5b5694_,_lambda_be2b3da3f62db62e9dad5dc70221a656_ &,_lambda_8f9ce462984622f9bf76b59e2aaaf805_>(
           &v3,
           a2,
           &v4);
}
// 418A65: using guessed type _DWORD __stdcall __crt_seh_guarded_call<void>::operator()<_lambda_5b71d36f03204c0beab531769a5b5694_,_lambda_be2b3da3f62db62e9dad5dc70221a656_ &,_lambda_8f9ce462984622f9bf76b59e2aaaf805_>(_DWORD, _DWORD, _DWORD);
// 418B48: using guessed type int var_8;

//----- (00418B70) --------------------------------------------------------
int __cdecl sub_418B70(int a1, int a2)
{
  int v3; // [esp+0h] [ebp-Ch] BYREF
  int v4; // [esp+4h] [ebp-8h] BYREF

  v4 = a1;
  v3 = a1;
  return __crt_seh_guarded_call<void>::operator()<_lambda_9df27f884b057bc3edfc946cb5b7cf47_,_lambda_e69574bed617af4e071282c136b37893_ &,_lambda_cc0d902bcbbeb830f749456577db4721_>(
           &v3,
           a2,
           &v4);
}
// 418AB0: using guessed type _DWORD __stdcall __crt_seh_guarded_call<void>::operator()<_lambda_9df27f884b057bc3edfc946cb5b7cf47_,_lambda_e69574bed617af4e071282c136b37893_ &,_lambda_cc0d902bcbbeb830f749456577db4721_>(_DWORD, _DWORD, _DWORD);
// 418B70: using guessed type int var_8;

//----- (00418E75) --------------------------------------------------------
struct __crt_locale_data *__cdecl sub_418E75(int a1, struct __crt_locale_data **a2)
{
  struct __crt_locale_data *result; // eax

  result = *a2;
  if ( *a2 != dword_457EDC )
  {
    result = (struct __crt_locale_data *)dword_42B820;
    if ( (dword_42B820 & *(_DWORD *)(a1 + 848)) == 0 )
    {
      result = (struct __crt_locale_data *)__acrt_update_thread_locale_data();
      *a2 = result;
    }
  }
  return result;
}
// 41C1E6: using guessed type int __acrt_update_thread_locale_data(void);
// 42B820: using guessed type int dword_42B820;

//----- (00418EA2) --------------------------------------------------------
void *__cdecl sub_418EA2(int a1, void **a2)
{
  void *result; // eax

  result = *a2;
  if ( *a2 != off_42B7C0 )
  {
    result = (void *)dword_42B820;
    if ( (dword_42B820 & *(_DWORD *)(a1 + 848)) == 0 )
    {
      result = (void *)__acrt_update_thread_multibyte_data();
      *a2 = result;
    }
  }
  return result;
}
// 41AFE6: using guessed type int __acrt_update_thread_multibyte_data(void);
// 42B820: using guessed type int dword_42B820;

//----- (0041AA27) --------------------------------------------------------
int __thiscall sub_41AA27(_DWORD **this, void *Block)
{
  int v3; // edi

  v3 = unknown_libname_36();
  if ( v3 )
  {
    _free_base(Block);
    return v3;
  }
  else
  {
    *this[1]++ = Block;
    return 0;
  }
}
// 41AA5C: using guessed type int unknown_libname_36(void);

//----- (0041AB31) --------------------------------------------------------
int __cdecl sub_41AB31(int a1, int a2)
{
  int v3; // [esp+0h] [ebp-Ch] BYREF
  int v4; // [esp+4h] [ebp-8h] BYREF

  v4 = a1;
  v3 = a1;
  return __crt_seh_guarded_call<void>::operator()<_lambda_c76fdea48760d5f9368b465f31df4405_,_lambda_e378711a6f6581bf7f0efd7cdf97f5d9_ &,_lambda_e927a58b2a85c081d733e8c6192ae2d2_>(
           &v3,
           a2,
           &v4);
}
// 41AAEE: using guessed type _DWORD __stdcall __crt_seh_guarded_call<void>::operator()<_lambda_c76fdea48760d5f9368b465f31df4405_,_lambda_e378711a6f6581bf7f0efd7cdf97f5d9_ &,_lambda_e927a58b2a85c081d733e8c6192ae2d2_>(_DWORD, _DWORD, _DWORD);
// 41AB31: using guessed type int var_8;

//----- (0041B43E) --------------------------------------------------------
char *__cdecl sub_41B43E(void *Block, unsigned int a2, unsigned int a3)
{
  size_t v4; // edi
  unsigned int v5; // esi
  char *v6; // ebx
  int savedregs; // [esp+0h] [ebp+0h] BYREF

  savedregs = (int)&savedregs;
  if ( a2 && 0xFFFFFFE0 / a2 < a3 )
  {
    *_errno() = 12;
    return 0;
  }
  else
  {
    if ( Block )
      v4 = _msize(Block);
    else
      v4 = 0;
    v5 = a3 * a2;
    v6 = (char *)_realloc_base(Block, a3 * a2);
    if ( v6 )
    {
      if ( v4 < v5 )
        memset(&v6[v4], 0, v5 - v4);
    }
    return v6;
  }
}

//----- (0041B4C7) --------------------------------------------------------
char sub_41B4C7()
{
  hHeap = 0;
  return 1;
}

//----- (0041B5FB) --------------------------------------------------------
int __cdecl sub_41B5FB(int a1, int a2)
{
  int v3; // [esp+0h] [ebp-Ch] BYREF
  int v4; // [esp+4h] [ebp-8h] BYREF

  v4 = a1;
  v3 = a1;
  return __crt_seh_guarded_call<void (__cdecl *)(int)>::operator()<_lambda_a048d3beccc847880fc8490e18b82769_,_lambda_ec61778202f4f5fc7e7711acc23c3bca_ &,_lambda_f7496a158712204296dd6628a163878e_>(
           &v3,
           a2,
           &v4);
}
// 41B5A1: using guessed type _DWORD __stdcall __crt_seh_guarded_call<void (__cdecl *)(int)>::operator()<_lambda_a048d3beccc847880fc8490e18b82769_,_lambda_ec61778202f4f5fc7e7711acc23c3bca_ &,_lambda_f7496a158712204296dd6628a163878e_>(_DWORD, _DWORD, _DWORD);
// 41B5FB: using guessed type int var_8;

//----- (0041E257) --------------------------------------------------------
int sub_41E257()
{
  return common_flush_all(1);
}
// 41E260: using guessed type _DWORD __cdecl common_flush_all(_DWORD);

//----- (0041FA2B) --------------------------------------------------------
int __cdecl sub_41FA2B(int a1, int a2)
{
  int v3; // [esp+0h] [ebp-Ch] BYREF
  int v4; // [esp+4h] [ebp-8h] BYREF

  v4 = a1;
  v3 = a1;
  return __crt_seh_guarded_call<int>::operator()<_lambda_61cee617f5178ae960314fd4d05640a0_,_lambda_6978c1fb23f02e42e1d9e99668cc68aa_ &,_lambda_9cd88cf8ad10232537feb2133f08c833_>(
           &v3,
           a2,
           &v4);
}
// 41F993: using guessed type _DWORD __stdcall __crt_seh_guarded_call<int>::operator()<_lambda_61cee617f5178ae960314fd4d05640a0_,_lambda_6978c1fb23f02e42e1d9e99668cc68aa_ &,_lambda_9cd88cf8ad10232537feb2133f08c833_>(_DWORD, _DWORD, _DWORD);
// 41FA2B: using guessed type int var_8;

//----- (0041FBB3) --------------------------------------------------------
int __cdecl sub_41FBB3(int a1, int a2)
{
  int v3; // [esp+0h] [ebp-Ch] BYREF
  int v4; // [esp+4h] [ebp-8h] BYREF

  v4 = a1;
  v3 = a1;
  return __crt_seh_guarded_call<int>::operator()<_lambda_123407a5e2ac06da108355a851863b7a_,_lambda_2fe9b910cf3cbf4a0ab98a02ba45b3ec_ &,_lambda_ae55bdf541ad94d75914d381c370e64d_>(
           &v3,
           a2,
           &v4);
}
// 41FB31: using guessed type _DWORD __stdcall __crt_seh_guarded_call<int>::operator()<_lambda_123407a5e2ac06da108355a851863b7a_,_lambda_2fe9b910cf3cbf4a0ab98a02ba45b3ec_ &,_lambda_ae55bdf541ad94d75914d381c370e64d_>(_DWORD, _DWORD, _DWORD);
// 41FBB3: using guessed type int var_8;

//----- (0041FBDB) --------------------------------------------------------
int __cdecl sub_41FBDB(int a1)
{
  int *v2; // [esp+4h] [ebp-4h] BYREF

  if ( a1 == -2 )
  {
    *__doserrno() = 0;
    *_errno() = 9;
  }
  else
  {
    if ( a1 >= 0
      && a1 < (unsigned int)dword_4580E0
      && (*(_BYTE *)(dword_457EE0[a1 >> 6] + 48 * (a1 & 0x3F) + 40) & 1) != 0 )
    {
      v2 = &a1;
      return sub_41FBB3(a1, (int)&v2);
    }
    *__doserrno() = 0;
    *_errno() = 9;
    _invalid_parameter_noinfo();
  }
  return -1;
}
// 457EE0: using guessed type int dword_457EE0[124];
// 4580E0: using guessed type int dword_4580E0;

//----- (00420184) --------------------------------------------------------
int sub_420184()
{
  dword_45836C = IsProcessorFeaturePresent(0xAu);
  return 0;
}
// 45836C: using guessed type int dword_45836C;

//----- (00420424) --------------------------------------------------------
void __usercall sub_420424(char a1@<ch>, int a2@<ebp>)
{
  *(_BYTE *)(a2 - 144) = -2;
  if ( a1 && !isintTOS() )
    JUMPOUT(0x4207E3);
  _ffexpm1();
  JUMPOUT(0x420728);
}
// 420471: control flows out of bounds to 420728
// 420493: control flows out of bounds to 4207E3
// 42057E: using guessed type int _ffexpm1(void);
// 4205C1: using guessed type int isintTOS(void);

//----- (00421F45) --------------------------------------------------------
void __cdecl sub_421F45()
{
  if ( unk_42FA8C )
    FreeLibrary(unk_42FA8C);
  unk_42FA8C = 0;
  *((_DWORD *)&unk_42FA8C + 2) = 0;
  *((_DWORD *)&unk_42FA8C + 3) = 0;
}

//----- (00421F4F) --------------------------------------------------------
void __cdecl sub_421F4F()
{
  sub_404152(&unk_4537C0);
}
// 404152: using guessed type int __thiscall sub_404152(_DWORD);

//----- (00421F59) --------------------------------------------------------
void __cdecl sub_421F59()
{
  j___free_base(unk_44A30C);
}

//----- (00421F63) --------------------------------------------------------
void __cdecl sub_421F63()
{
  sub_404152(&unk_44A1FA);
}
// 404152: using guessed type int __thiscall sub_404152(_DWORD);

//----- (00421F6D) --------------------------------------------------------
void __usercall sub_421F6D(int a1@<esi>)
{
  int v1; // [esp-4h] [ebp-4h]
  int v2; // [esp-4h] [ebp-4h]
  int v3; // [esp-4h] [ebp-4h]
  int v4; // [esp-4h] [ebp-4h]
  int v5; // [esp-4h] [ebp-4h]

  unknown_libname_1((char *)&unk_44A320 + 37956, a1);
  unknown_libname_1((char *)&unk_44A320 + 37864, v2);
  unknown_libname_1((char *)&unk_44A320 + 37772, v3);
  unknown_libname_1((char *)&unk_44A320 + 37680, v4);
  unknown_libname_1((char *)&unk_44A320 + 37588, v5);
  memset(&unk_44A320, 0, 0x72A8u);
  unknown_libname_1((char *)&unk_44A320 + 20840, v1);
  sub_404152((char *)&unk_44A320 + 16420);
}
// 421F6D: could not find valid save-restore pair for esi
// 40BA7C: variable 'v2' is possibly undefined
// 40BA87: variable 'v3' is possibly undefined
// 40BA92: variable 'v4' is possibly undefined
// 40BA9D: variable 'v5' is possibly undefined
// 402F81: variable 'v1' is possibly undefined
// 402F5A: using guessed type int __thiscall unknown_libname_1(_DWORD, _DWORD);
// 404152: using guessed type int __thiscall sub_404152(_DWORD);

// nfuncs=940 queued=433 decompiled=433 lumina nreq=0 worse=0 better=0
#error "There were 2 decompilation failure(s) on 433 function(s)"
